<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Assign_Termination_Date</name>
        <label>Assign Termination Date</label>
        <locationX>379</locationX>
        <locationY>421</locationY>
        <assignmentItems>
            <assignToReference>vTIPProduct.PP_Effective_to_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vTerminationDate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_TIP_Product</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_BIN_Termination_date</name>
        <label>Set BIN Termination date</label>
        <locationX>835</locationX>
        <locationY>407</locationY>
        <assignmentItems>
            <assignToReference>vBINRange.TIP_Effective_To_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vTerminationDate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_BIN_Range</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Country_Config_Termination_date</name>
        <label>Set Country Config Termination date</label>
        <locationX>976</locationX>
        <locationY>158</locationY>
        <assignmentItems>
            <assignToReference>vProductCountryConfig.TIP_Effective_To_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vTerminationDate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Product_Country_Config</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Product_Termination_date</name>
        <label>Set Product Termination date</label>
        <locationX>224</locationX>
        <locationY>585</locationY>
        <assignmentItems>
            <assignToReference>vTerminationDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Effective_To_Date</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Termination_Date</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Is_Active_Product</name>
        <label>Is Active Product</label>
        <locationX>58</locationX>
        <locationY>304</locationY>
        <defaultConnector>
            <targetReference>Product_Not_Active</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Is_Active</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>vTIPProduct.PP_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ACTIVE</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Is_Sub_Flow</targetReference>
            </connector>
            <label>Is Active</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Sub_Flow</name>
        <label>Is Sub-Flow?</label>
        <locationX>57</locationX>
        <locationY>421</locationY>
        <defaultConnector>
            <targetReference>Enter_Product_Termination_Date</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>SubFlow</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>vIsSubflow</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Termination_Date</targetReference>
            </connector>
            <label>Sub-Flow</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Sub_Flow2</name>
        <label>Is Sub-Flow?</label>
        <locationX>981</locationX>
        <locationY>294</locationY>
        <defaultConnector>
            <targetReference>Termination_Date_Update_Complete</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Is_SubFlow</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>vIsSubflow</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>Is Sub-Flow</label>
        </rules>
    </decisions>
    <decisions>
        <name>TIP_Permission_Set_Assigned</name>
        <label>TIP Permission Set  Assigned</label>
        <locationX>381</locationX>
        <locationY>178</locationY>
        <defaultConnector>
            <targetReference>Get_TIP_Product</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>No_TIP_Permission_Set</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>vUserTIPPermissionSet</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>No_TIP_PermissionSet_Error</targetReference>
            </connector>
            <label>No TIP Permission Set</label>
        </rules>
    </decisions>
    <formulas>
        <name>vUserID</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <interviewLabel>TIP Product Termination {!$Flow.CurrentDateTime}</interviewLabel>
    <label>TIP Product Termination</label>
    <loops>
        <name>Update_BIN_Collection</name>
        <label>Update BIN Collection</label>
        <locationX>564</locationX>
        <locationY>413</locationY>
        <assignNextValueToReference>vBINRange</assignNextValueToReference>
        <collectionReference>collBINRanges</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_BIN_Termination_date</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Product_Country_Configs</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Update_Country_Config_Coll</name>
        <label>Update Country Config Coll</label>
        <locationX>753</locationX>
        <locationY>154</locationY>
        <assignNextValueToReference>vProductCountryConfig</assignNextValueToReference>
        <collectionReference>collProductCountryConfigs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Country_Config_Termination_date</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Is_Sub_Flow2</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>Flow</processType>
    <recordLookups>
        <name>Get_BIN_Ranges</name>
        <label>Get BIN Ranges</label>
        <locationX>561</locationX>
        <locationY>584</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_BIN_Collection</targetReference>
        </connector>
        <filters>
            <field>TIP_Payment_Provider_Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vProductId</elementReference>
            </value>
        </filters>
        <object>TIP_BIN_Range__c</object>
        <outputReference>collBINRanges</outputReference>
        <queriedFields>TIP_Effective_To_Date__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Product_Country_Configs</name>
        <label>Get Product Country Configs</label>
        <locationX>562</locationX>
        <locationY>201</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Country_Config_Coll</targetReference>
        </connector>
        <filters>
            <field>TIP_Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vProductId</elementReference>
            </value>
        </filters>
        <object>TIP_Pay_Prov_Prod_Country_Config__c</object>
        <outputReference>collProductCountryConfigs</outputReference>
        <queriedFields>TIP_Effective_To_Date__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_TIP_Permission_Set</name>
        <label>Get TIP Permission Set</label>
        <locationX>153</locationX>
        <locationY>19</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_TIP_Permission_Set</targetReference>
        </connector>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Transparency_in_Payments_Analyst</stringValue>
            </value>
        </filters>
        <object>PermissionSet</object>
        <outputReference>vTIPPermissionSet</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_TIP_Product</name>
        <label>Get TIP Product</label>
        <locationX>56</locationX>
        <locationY>177</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_Active_Product</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vProductId</elementReference>
            </value>
        </filters>
        <object>Partner_products__c</object>
        <outputReference>vTIPProduct</outputReference>
        <queriedFields>PP_Effective_to_Date__c</queriedFields>
        <queriedFields>Id</queriedFields>
        <queriedFields>PP_Status__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_User_TIP_Permission_Set</name>
        <label>Get User TIP Permission Set</label>
        <locationX>385</locationX>
        <locationY>21</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>TIP_Permission_Set_Assigned</targetReference>
        </connector>
        <filters>
            <field>AssigneeId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vUserID</elementReference>
            </value>
        </filters>
        <filters>
            <field>PermissionSetId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vTIPPermissionSet.Id</elementReference>
            </value>
        </filters>
        <object>PermissionSetAssignment</object>
        <outputReference>vUserTIPPermissionSet</outputReference>
    </recordLookups>
    <recordUpdates>
        <name>Update_BIN_Range</name>
        <label>Update BIN Range</label>
        <locationX>703</locationX>
        <locationY>305</locationY>
        <connector>
            <targetReference>Update_BIN_Collection</targetReference>
        </connector>
        <inputReference>vBINRange</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Product_Country_Config</name>
        <label>Update Product Country Config</label>
        <locationX>877</locationX>
        <locationY>40</locationY>
        <connector>
            <targetReference>Update_Country_Config_Coll</targetReference>
        </connector>
        <inputReference>vProductCountryConfig</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_TIP_Product</name>
        <label>Update TIP Product</label>
        <locationX>385</locationX>
        <locationY>585</locationY>
        <connector>
            <targetReference>Get_BIN_Ranges</targetReference>
        </connector>
        <inputReference>vTIPProduct</inputReference>
    </recordUpdates>
    <screens>
        <name>Enter_Product_Termination_Date</name>
        <label>Enter Product Termination Date</label>
        <locationX>55</locationX>
        <locationY>584</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Set_Product_Termination_date</targetReference>
        </connector>
        <fields>
            <name>WarningMessage</name>
            <fieldText>&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;B&gt;Cancellation of an enrolled product will remove all active Airline consent for that Product.&lt;/B&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;B&gt;Agents will not be authorized anymore to use this product.&lt;/B&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Effective_To_Date</name>
            <dataType>Date</dataType>
            <fieldText>Effective To Date</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>No_TIP_PermissionSet_Error</name>
        <label>No_TIP_PermissionSet_Error</label>
        <locationX>641</locationX>
        <locationY>15</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>User_No_TIP_PermissionSet</name>
            <fieldText>&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;You must have the &lt;B&gt;Transparency in Payments Analyst &lt;/B&gt;permission set in order to terminate ATM Products.&lt;/FONT&gt;&lt;/DIV&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Product_Not_Active</name>
        <label>Product Not Active</label>
        <locationX>382</locationX>
        <locationY>306</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>CannotProceed</name>
            <fieldText>Only Active Products can be terminated.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Termination_Date_Update_Complete</name>
        <label>Termination Date Update Complete</label>
        <locationX>1028</locationX>
        <locationY>448</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>UpdateComplete</name>
            <fieldText>The Effective Date has successfully been applied to the ATM Product and all its child BIN range &amp; Country Configuration records.

These records will be inactivated the next time the batch process runs.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>Get_TIP_Permission_Set</startElementReference>
    <status>Active</status>
    <variables>
        <name>collBINRanges</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>TIP_BIN_Range__c</objectType>
    </variables>
    <variables>
        <description>Product Country Configs for a TIP product</description>
        <name>collProductCountryConfigs</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>TIP_Pay_Prov_Prod_Country_Config__c</objectType>
    </variables>
    <variables>
        <name>vBINRange</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>TIP_BIN_Range__c</objectType>
    </variables>
    <variables>
        <name>vIsSubflow</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>vPermissonSet</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PermissionSet</objectType>
    </variables>
    <variables>
        <name>vProductCountryConfig</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>TIP_Pay_Prov_Prod_Country_Config__c</objectType>
    </variables>
    <variables>
        <description>Record ID of TIP Product</description>
        <name>vProductId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>vTerminationDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vTIPPermissionSet</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>PermissionSet</objectType>
    </variables>
    <variables>
        <name>vTIPPermissionSetName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>Transparency in Payments Analyst</stringValue>
        </value>
    </variables>
    <variables>
        <name>vTIPProduct</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Partner_products__c</objectType>
    </variables>
    <variables>
        <name>vUserTIPPermissionSet</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PermissionSetAssignment</objectType>
    </variables>
</Flow>
