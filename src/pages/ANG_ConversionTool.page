<apex:page controller="ANG_ConversionToolController" showHeader="true">

	<style>
		.hidden {
			display: none;
		}
	</style>


	<apex:sectionHeader title="Agencies migration tool" />   

	<apex:form >
		<apex:PageBlock title="Country Selection" id="selection"  >
			<br/>

			<table style="width:60%;padding: 0px;border: 0px;border-spacing: 0px;">
			<tr>
				<td>
					<apex:outputLabel value="ISO Country: " for="selectedCountry"/>&nbsp;
					<apex:inputfield value="{!iataCountryName.IATA_ISO_Country__c}" required="true"/>
				</td>
 				<td style="border:0px;text-align:right">
					<apex:commandButton action="{!runAnalysis}" value="Run Analysis"/>
				</td>
			</tr>
			</table>
			<br/><br/><br/>

			<apex:pageBlockSection title="Analysis overview" collapsible="true" id="Overview"  rendered="{!displayTable}" columns="1">

				<apex:outputPanel id="out" rendered="{!displayTable}">

					<table style="width:60%;padding: 0px;border: 1px solid #dddddd;border-spacing: 0px;">
						<tr style="background-color: #dddddd;">
							<th style="background-color: #dddddd;padding: 8px"><apex:outputLabel >{!selectedCountryName}</apex:outputLabel></th>
						</tr>
						<tr>
							<td>   
								<apex:pageblockTable value="{!OverviewTable}" var="tbl" headerClass="hidden" style="border:1px;" frame="vsides">
									<apex:column value="{!tbl.messageText}" style="border:1px ridge #dddddd;"/>
									<apex:column value="{!tbl.count}" style="border:1px ridge #dddddd;" />
									<apex:column style="border:1px ridge #dddddd;text-align:center">
										<apex:commandLink action="{!showDetailPage}" value="Detail"  rendered="{!IF((tbl.isDetail=true),true,false)}"  >
											<apex:param name="detailCode" value="{!tbl.detailCode}" assignTo="{!errorDetailCode}"/>
										</apex:commandLink>
										<apex:outputText value="" rendered="{!IF((!tbl.isDetail=true),true,false)}"/>
									</apex:column>
								</apex:pageBlockTable>
							</td>
						</tr>
					</table>
				</apex:outputPanel>

			</apex:pageblocksection>   

			<apex:pageBlockSection title="Run the migration" collapsible="true" id="RunMigration"  rendered="{!displayTable}" columns="1">

				<apex:outputPanel id="out2" rendered="{!displayTable}" style="width:100%;">
Click on the button to start the migration for {!selectedCountryName}. Keep in mind this will not affect the Hierarchies with BR Abroad or with mixed location classes.
<br /><br />
This operation may take a few minutes, we'll send you an email when it will be completed.
<br /><br />
					<apex:commandButton action="{!runMigration}" value="Run migraton" rendered="true"  />

				</apex:outputPanel>

			</apex:pageblocksection>
		
		</apex:PageBlock>  

	</apex:form>

</apex:page>