<apex:page showHeader="false" sidebar="false" standardController="Case" extensions="ANG_RiskForecastPropertiesController">

    <apex:includeScript value="/support/console/34.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery2_1_4}"/>

    <script type="text/javascript">
       function openPrimaryTab(tabId,tabName) {
            var changeTab = function(result){
                if(result.success == false){
                    sforce.console.focusPrimaryTabByName(tabId);
                }
            };
            //Open a new agency primary tab
            sforce.console.openPrimaryTab(null, tabId, true,tabName, changeTab, tabId);
        }

        function openSubTab(url,label,name,openimmediately) {
          sforce.console.getEnclosingPrimaryTabId(function(primarytab){
            sforce.console.openSubtab(primarytab.id , url, openimmediately, label, null, function(result){
              // do any processing here if passes or fails, use result.success (boolean)
            }, name);
          });
        }

    $(document).ready(function(){
        $(".bPageBlock").css("background-color","white");
        $(".bPageBlock").css("border-color","white");
    });

    </script>


                  <style type="text/css">
.customPopup {
    background-color: white;
    border-style: solid;
    border-width: 1px;
    left: 20%;
    padding: 5px;
    position: absolute;
    z-index: 9999;
    /* These are the 3 css properties you will need to tweak so the pop 
                            up displays in the center of the screen. First set the width. Then set 
                            margin-left to negative half of what the width is. You can also add 
                            the height property for a fixed size pop up.*/
    width: 500px;
    top: 0%;
}

.closeButton {
    float: right;
}

</style>

    <apex:form id="form">
        
        <apex:pageBlock >

            <apex:pageBlockSection columns="2">

                <apex:pageblockSectionItem >
                    
                            <apex:outputLabel value="Action to be forecasted"/>

                            <apex:outputPanel layout="block">
                                                
                                <apex:selectList size="1" value="{!riskOpt}">

                                    <apex:selectoptions value="{!riskOption}"/>
                                    <apex:actionSupport event="onchange" reRender="actionButton"/>

                                
                                </apex:selectList>

                            </apex:outputPanel>

                        </apex:pageblockSectionItem>

                    <apex:pageBlockSectionItem id="buttonForecast">
    
                        <apex:commandButton value="Forecast" action="{!showPopup}" id="actionButton" disabled="{!NOT(canExecuteForecast)}" rerender="popup" status="status" />
                        
                    </apex:pageBlockSectionItem>

            </apex:pageBlockSection>
    
            <apex:outputPanel id="popup" title="Risk Situation Forecast" layout="block">

                <apex:outputPanel title="Risk Situation Forecast" id="popInnerOutputPnl" styleClass="customPopup" layout="block" rendered="{!displayPopUp}">

                     <apex:pageblockSection title="Current Situation" columns="2">                         
                         
                         <apex:pageblockSectionItem >
                        
                            <apex:outputLabel value="Account"></apex:outputLabel>
                            <apex:outputLink value="#" onclick="openPrimaryTab('/{!myCase.Account}?inContextPane=true','{!JSINHTMLENCODE(myCase.Account.Name)}');return false;" >{!myCase.Account.Name}</apex:outputLink>

                         </apex:pageblockSectionItem>

                          <apex:pageblockSectionItem >

                            <apex:outputLabel value="Cash Condition" />
                            <apex:outputField id="AccountCashCondId" value="{!myCase.Account.ANG_CashCondition__c}"/>
                         </apex:pageblockSectionItem>

                         <apex:pageblockSectionItem >
                            <apex:outputLabel value="Risk Status" />
                            <apex:outputField id="AccountRiskStatusId" value="{!myCase.Account.ANG_RiskStatus__c}"/>
                         </apex:pageblockSectionItem>

                     </apex:pageblockSection>

                     <apex:pageblockSection title="Forecasted Situation">                         

                          <apex:pageblockSectionItem >

                            <apex:outputLabel value="Cash Condition" />
                            <apex:inputCheckbox id="AccountCashCondId2" value="{!newCashCondition}" disabled="true"/>
                         </apex:pageblockSectionItem>

                         <apex:pageblockSectionItem >
                            <apex:outputLabel value="Risk Status" />
                            <apex:outputText id="AccountRiskStatusId2" value="{!newRiskStatus}" />
                         </apex:pageblockSectionItem>



                     </apex:pageblockSection>

                     <apex:commandButton value="Close" action="{!redirectPopup}" styleClass="closeButton" rerender="popup">

                     </apex:commandButton>
                </apex:outputPanel>
            </apex:outputPanel>

          </apex:pageBlock>

    </apex:form>

</apex:page>