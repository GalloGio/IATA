<apex:page controller="ISSP_AMS_Accreditation"
           cache="false"
           sidebar="false"
           showHeader="false"
           language="{!displayLanguage}"
           standardStylesheets="true"
           applyBodyTag="false"
           applyHtmlTag="false"
           action="{!securityCheck}"
           >

    <html>
        <c:ISSP_Header communityName="{!communityName}" ></c:ISSP_Header>
        <body>
        <script src="{!URLFOR($Resource.bootbox)}" />
        <script src="{!URLFOR($Resource.datePickerFix)}" />
        <link rel="stylesheet" href="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/css/intlTelInput.css')}"/>
        <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
        <script src="{!URLFOR($Resource.jquery_file_upload, '/jQuery-File-Upload-9.11.2/js/jquery.iframe-transport.js')}" />
        <script src="{!URLFOR($Resource.jquery_file_upload, '/jQuery-File-Upload-9.11.2/js/jquery.fileupload.js')}" />

    <style>
        .pbTitle {
            width: {!IF(isstep2,'90% !important','40% !important')};
        }

       .pbBody {
        padding-left:10px !important;
       }

       .pbBody a{color:#337ab7 !important}

        .bPageBlock {
            border-top-width : thin !important;
        }

        .bEditBlock input {
            vertical-align:top !important;
        }

       .btn {
            padding: 2px 12px !important;
        }

        .btn-primary {
            color: #fff !important;
            background: inherit !important;
            background-color: #337ab7 !important;
            border-color: #2e6da4 !important;
            border: 1px solid transparent !important;
            /*background: */
        }

        .tb-header {
            padding-right:20px;
        }

        .modalrow {
            padding-top:10px;
        }

        input + label {
            font-weight:normal;
        }

        ul li, ol li {
            margin-left: inherit;
            padding-left: inherit;
        }

        #contentWrapper {  background: #fff !important; margin: 0 auto;max-width: 1170px;}

        .requiredText {display:none;}

        .dateFormat {display:none;}

        .errorMsg {color:#d74c3b}

        .progress-bar-off {
                color:#6BBBEA;
                font-weight:bold;
                background-image:none !important;
                background-color:transparent !important;
                border-right:2px solid white;
        }

        body .bPageBlock .pbBody .pbSubheader{
                background-image: url('') !important;
                background-color:  #1797c0;
                color: #fff;
        }

        body .bPageBlock .pbBody .summary-subsection .pbSubheader{
                background-image: url('') !important;
                background-color: initial;
                color: initial;
        }

        .pbSubheader {
            font-weight:bold;
            font-size:15px;
        }

        .contact-detail {
            font-size:12px;
            margin-bottom:3px;
        }

        .tbFooter {
         text-align:right;
        }

        .requiredBlock {
            width:5px !important;
        }

        .checkbox-td {
            text-align: center;
        }

        .summary-table th {
            text-align: center;
        }

        .summary-table td.dataCell {
            border: 1px solid #e0e3e5 !important;
        }

            .col1 {
                padding-bottom:5px;
                width:40%;
                vertical-align: text-top;
                font-weight:bold
            }

            .col1_regular {
                padding-bottom:5px;
                width:25%;
                vertical-align: text-top;
                font-weight:bold
            }

            .col2 {width:60%; padding-left:50px;vertical-align: text-top;}
            .col2_regular {width:25%; padding-left:50px;vertical-align: text-top;}
            .col2_4 {width:10%;padding-left:5px;vertical-align: text-top;}
            .col3 {width:50%;vertical-align: text-top;}

            .col1_inner {width:25%; vertical-align: text-top;}
            .col2_inner {width:25%; vertical-align: text-top;}

             .row1 {padding-bottom:16px; vertical-align: text-top;}
    </style>

    <script>

            var showProductComparisonLink = false;
            var hideProductComparisonLink = false;

            setVarsProductComparisonLink('{!namEnabled}', '{!sectorValue}', '{!isHOAccredited}', '{!con.Account.Sector__c}');


            $(function(){ $('.requiredIndicator').wrap('<div class="requiredInput">').before('<div class="requiredBlock"></div>'); } );
            var pilotList = {{!pilotList}};
            var defaultHQCountry = '{!newCase.IFAP_Country_ISO__c}';
            var vOfficeType = '{!newCase.Reason1__c}';
            console.log('vOfficeType '+vOfficeType);
            console.log('Default country '+ defaultHQCountry);
            var operationType = '{!sectorvalue}';
            var hasPermission = true;

            var isPilotCountry = pilotList[defaultHQCountry];
            var isEUcountry = {!isEUcountry};

            function setVarsProductComparisonLink(namEnabled, sectorValue, isHOAccredited, sector) {
               if(namEnabled == 'true' && (sectorValue === 'Travel_Agent') && (isHOAccredited == 'false' || sector === 'Cargo Agent')) {
                    showProductComparisonLink = true;
                    hideProductComparisonLink = false;
                } else {
                    hideProductComparisonLink = true;
                    showProductComparisonLink = false;
                }
            }

            function setIsPilotCountry(isocode) {
                isPilotCountry = pilotList[isocode];
            }

            function toggleCountries(v) {
                if (v==undefined || v.indexOf('New BR Abroad')==-1){
                    updateAmsCountry();
                    $('#brcountry').show();
                    $('#brabroadcountries').hide();
                }
                else{
                    $('#brcountry').hide();
                    $('#brabroadcountries').show();
                }
            }

            function toggleOfficeTypes(officeSelect, ctrylistid) {
                //var mySelectOptions = $('select[name="' + ctrylistid + '"] option');
                //var mySelect = $('select[name="' + ctrylistid + '"]');
                var officeTypeSel = $('select[name="' + officeSelect + '"]');
                vOfficeType = officeTypeSel.val();
                /**
                mySelectOptions.each(function() {
                  if(vOfficeType=='New BR Abroad') {
                    if(this.value != defaultHQCountry) {
                        $(this).prop('disabled', false);
                     } else {
                        $(this).prop('disabled', true);
                        mySelect.val('');
                     }
                  } else {
                    if(this.value != defaultHQCountry) {
                        $(this).prop('disabled', true);
                     } else {
                        $(this).prop('disabled', false);
                        mySelect.val(defaultHQCountry);
                     }
                  }
                });
                **/
            }

            function isInArray(arr, val) {
                for(var i=0; i<arr.length; i++) {
                    if (arr[i] == val) return true;
                }
                return false;
           }

            function isChinaDomestic() {
                var chinaAgentType;
                var chinaAgentTypeId = '{!$Component.step1Form.step1Block.chinaagenttype}';

                if(defaultHQCountry=='CN') {
                    var chinaAgentType = $('select[name="' + chinaAgentTypeId + '"]');
                    if(chinaAgentType.val() == 'Domestic') {
                        console.log('in domestic');
                        return true;
                    }
                }

                return false;
            }

            function checkBranchAbroad(nextStep) {
                var countriesNotAllowedList = JSON.parse('{!jsonCountriesNotAllowedList}');
                defaultHQCountry = $('[id$=countrySelected]').val();
                if (isInArray(countriesNotAllowedList, defaultHQCountry)){
                    bootbox.confirm("{!JSENCODE($Label.ISSP_AMS_Step1_Branch_Abroad_Not_Allowed)}", function(result) {
                            if(result) {
                                window.open('{!Portal_Login_URL}', '_blank');
                            }
                    });
                    hasPermission = false;
                }else {
                    document.getElementById("{!$Component.step1Form.NextStep}").value = nextStep;
                    hasPermission = true;
                }
            }

            function gotoStep1(myValue, nextStep) {
            defaultHQCountry = '{!newCase.IFAP_Country_ISO__c}';
            if($('#brcountry').css('display') == 'none'){
                checkBranchAbroad(nextStep);
            }
            if(hasPermission==true){
                var $lists = $('select[name="' + '{!$Component.step1Form.step1Block.officetypelist}' + '"]');
                vOfficeType = $lists.val();
                var countriesMap = JSON.parse('{!jsonCountriesMap}');
                var cargoAgentTypes = ["IATA Cargo Agent", "EACP Intermediary", "CASS Associate", "Courier", "Import Agent"];
                console.log('no empty voffice '+vOfficeType);
                if('{!isNoticeOfChange}'=='true' || vOfficeType=='')
                    isAllowedCountry = 't';
                else{
                    var idx = vOfficeType.indexOf(' - ');

                    console.log('vOfficeType goto '+vOfficeType);

                    if( (vOfficeType.substring(idx + 3).trim() == 'Legacy') || (vOfficeType.includes('Standard')) || (vOfficeType.includes('AE'))){
                        operationType = 'Travel_Agent';
                    } else {
                        operationType = 'Cargo_Agent';
                    }

                    // NHO -
                    console.log('vOfficeType.substring(0, idx) ' + operationType+'-'+vOfficeType.substring(0, idx));

                    var countryList = countriesMap[operationType+'-'+vOfficeType.substring(0, idx)];

                    var isAllowedCountry = false;
                    console.log('countryList ' + countryList);
                    if(defaultHQCountry != null && countryList != undefined) {
                        var isAllowedCountry = countryList[countryList.indexOf(defaultHQCountry)+3];
                    }
                    console.log('isAllowedCountry ' + isAllowedCountry);
                    ///alert( $('input[name="' + myValue + '"]:checked').val() + ' was selected.' );
                    var langId = '{!$Component.step1Form.step1Block.applylanguage}';
                    var langSel = $('select[name="' + langId + '"]');
                    var vLang = langSel.val();

                        //For pilot only English & Spanish HO applications for pilot countries alllowed

                    if( $('input[name="' + myValue + '"][value=Travel_Agent]').prop("checked")) {
                        console.log('Travel China Domestic: ' + isChinaDomestic());
                        if(isAllowedCountry=='f' || isChinaDomestic() ) {
                            bootbox.confirm("{!JSEncode($Label.ISSP_AMS_Step1_GoTo_Pax)}", function(result) {
                                if(result) {
                                    window.open('/ISSP_AMSCases{!if(communityName=='CNS','?CommunityName='+communityName,'')}', '_self');
                                    if(isChinaDomestic()) {
                                        window.open('https://www.iata-asd.com', '_blank');
                                    } else {
                                        window.open('http://www.iata.org/services/accreditation-travel/accreditation-travel/Pages/application.aspx', '_blank');
                                    }
                                }
                            });
                            hasPermission = false;
                        } else {
                            document.getElementById("{!$Component.step1Form.NextStep}").value = nextStep;
                            hasPermission = true;
                        }
                } else {
                    if(isAllowedCountry=='f' || isChinaDomestic()) {
                        // temporary for CNS
                        console.log('{!communityName}');
                        if('{!communityName}'==='CNS') {
                            bootbox.confirm("{!JSEncode($Label.ISSP_AMS_Step1_GoTo_Cargo_CNS)}", function(result) {
                                if(result) {
                                    window.open('/ISSP_AMSCases{!if(communityName=='CNS','?CommunityName='+communityName,'')}', '_self');
                                    if(isChinaDomestic()) {
                                        window.open('https://www.iata-asd.com', '_blank');
                                    } else {
                                        window.open('https://mycnsc.com/accreditation/step1', '_blank');
                                    }
                                }
                            });

                        } else {

                        bootbox.confirm("{!JSEncode($Label.ISSP_AMS_Step1_GoTo_Cargo)}", function(result) {
                                    if(result) {
                                        window.open('/ISSP_AMSCases{!if(communityName=='CNS','?CommunityName='+communityName,'')}', '_self');
                                        if(isChinaDomestic()) {
                                            window.open('https://www.iata-asd.com', '_blank');
                                        } else {
                                            window.open('http://www.iata.org/pages/freight-forwarders.aspx', '_blank');
                                        }
                                    }
                                });
                            }
                        hasPermission = false;
                        }

                    else {
                        document.getElementById("{!$Component.step1Form.NextStep}").value = nextStep;
                        hasPermission = true;
                    }
                }
            }
        }
    }

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            })

        function resetStep1(v) {
            operationType = v ;
            if(v=='Cargo_Agent') {
                $('#isGSA').hide();
                $('#langPanel').hide();
                $('#isLegal').hide();
            } else {
                $('#isGSA').show();
                $('#langPanel').show();
                $('#isLegal').show();
            }
        }

        function togglePageItem(v, fldId) {
            var el = document.getElementById(fldId);
            if(v=='HO - Selected Branches' || v=='Selected Branches Only') {
                el.style.display='block';
            } else {
                el.style.display='none';
            }
        }

        function getFileLink(fileName) {
            // alert(''+fileName);
            $("#loading").show();
            setTimeout(function(){
            try{
                ISSP_AmazonS3_Ctrl.getExpiringLinkIfap(fileName,function(result, event){
                    var result2= result.replace("&amp;","&");
                    var newWin = window.open(result2);
                    if(!newWin || newWin.closed || typeof newWin.closed=='undefined'){
                        alert('{!$Label.ISSP_AMS_ACCR_Alert1}');
                    }
                    $("#loading").hide();
                },{escape:false});
            }catch(err){alert( err.message);}
            },500);
        }

        function isIE(){
            //alert(navigator.userAgent);
            //return /MSIE/.test(navigator.userAgent);
            if (/MSIE/.test(navigator.userAgent)){
                return true;
            }
            else if (/rv:11/.test(navigator.userAgent)){
                return true;
            }
            else{
                return false;
            }
        }
    var vReqNo

    function resetUploadBar() {
        //$('.uploadbar-' + vReqNo).css('width', '0%');
        $("#loading-" + vReqNo).hide();
    }

    function resetUploadBarOnDelete() {
        $('.uploadbar-' + vReqNo).css('width', '0%');
    }

    function redirectToPDF() {
         window.open('/ISSP_AMS_PDF_NoC?caseId={!newCase.Id}&isNoticeOfChange=true&mode=pdf{!if(communityName=='CNS', '&CommunityName=CNS', '')}', '_blank');
    }

    </script>

    <apex:outputPanel id="amscountrylabel">
      <script>
      function getCountryFromController() {
        $('#brcountry').text("{!amsAllLangCountryLabel}");
        $('[id$=countrySelected]').val('{!con.Account.IATA_ISO_Country__r.ISO_Code__c}');
        //$('[id$=countrySelected]').val('');
      }
      </script>
    </apex:outputPanel>

     <div class="container">
       <div id="contentWrapper">
           <c:ISSP_CustomNavigation communityName="{!communityName}"/>

    <!----------------------------------------->
    <!-- STEP 1 -->
    <!----------------------------------------->
    <!--Online form to create the Accreditation process-->
    <apex:outputText rendered="{!isStep1}">
    <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">
                    {!IF(NOT(isNoticeOfChange), lblStep1Title, lblNoCRequest)}
                </h3>
            </div>
    <div class="panel-body" id="body-enquiries">

    <apex:form id="step1Form" styleClass="form-horizontal">
        <div class="progress">

            <div class="progress-bar" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%;">
                {!IF(NOT(isNoticeOfChange), lblStepA, lblNoCStepA)}
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '2');if(hasPermission != true) return false;" value="{!lblStepB}" id="Next2">
                    <apex:param value="2" assignTo="{!step1GoToNumber}" name="step1GoToNumber"/>
                </apex:commandLink>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '3');if(hasPermission != true) return false;" value="{!IF(NOT(isNoticeOfChange),lblStepC, lblNoCStepC)}" id="Next3">
                    <apex:param value="3" assignTo="{!step1GoToNumber}" name="step1GoToNumber"/>
                </apex:commandLink>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:16%;display:{!IF(isNoticeOfChange && newForm.Is_change_ownership_or_shareholding__c, 'none', '')}">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '4');if(hasPermission != true) return false;" value="{!lblStepD}" id="Next4">
                    <apex:param value="4" assignTo="{!step1GoToNumber}" name="step1GoToNumber"/>
                </apex:commandLink>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '5');if(hasPermission != true) return false;" value="{!IF(isNoticeOfChange && newForm.Is_change_ownership_or_shareholding__c, lblNoCStepD, lblStepE)}" id="Next5">
                    <apex:param value="5" assignTo="{!step1GoToNumber}" name="step1GoToNumber"/>
                </apex:commandLink>
            </div>

        </div>
        <apex:actionFunction action="{!null}" name="refreshOfficeTypes" reRender="optionsSetpA, langGSA">
            <apex:param value="" assignTo="{!sectorValue}" name="sectorValue"/>
        </apex:actionFunction>
        <apex:actionFunction action="{!null}" name="refreshGsaQuestion" reRender="langGSA">
            <apex:param value="" assignTo="{!amsLocationType}" name="amsLocationType"/>
        </apex:actionFunction>
        <apex:actionFunction action="{!updateAmsCountry}" name="updateAmsCountry" oncomplete="getCountryFromController()" reRender="amscountrylabel">
        </apex:actionFunction>
        <apex:inputHidden id="NextStep" value="{!newCase.Applicable_to_Which_Version_s__c}"/>

        <apex:pageBlock id="step1Block" mode="edit" >
            <apex:pageBlockButtons location="bottom" style="padding-left:100px">
                <apex:actionStatus id="buttonLoadingStep1">
                    <apex:facet name="stop"><apex:outputPanel >
                        <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true" status="buttonLoadingStep1" reRender="step1Form"/>
                        <apex:commandButton styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '2');if(hasPermission != true) return false;" value="{!$Label.ISSP_Next}" rendered="{!NOT(amsIsGSA=='YES')}" status="buttonLoadingStep1" reRender="step1Form"/>
                    </apex:outputPanel></apex:facet>
                    <apex:facet name="start"><apex:outputPanel >
                        <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" value="{!$Label.ISSP_Cancel}..." disabled="true" reRender="step1Form"/>
                        <apex:commandButton styleclass="btn btn-default"  value="{!$Label.ISSP_Next}..." rendered="{!NOT(amsIsGSA=='YES')}" disabled="true" reRender="step1Form"/>
                    </apex:outputPanel></apex:facet>
                </apex:actionStatus>
            </apex:pageBlockButtons>
         <apex:pageMessages escape="false"></apex:pageMessages>
        <apex:outputPanel id="formContainer" rendered="{!NOT(amsIsGSA=='YES')}">


            <div class="alert alert-info" role="alert" style="display:{!IF(NOT(isNoticeOfChange),'','none')}">
                <apex:outputText value="{!$Label.ISSP_AMS_Step1_Separate_Application}" escape="false"/>
            </div>
            <div class="alert alert-warning"  role="alert">
                {!IF(NOT(isNoticeOfChange),
                $Label.ISSP_AMS_Step1_Two_Weeks_Expiry,
                $Label.ISSP_AMS_Noc_StepA_message)}
            </div>

            <apex:outputPanel style="display:{!IF(newCase.Status!='Open - EDMC', '', 'none')}" rendered="{!NOT(isNoticeOfChange)}">

                <div class="form-group">
                    <label for="operationtype" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Operation_Type}</label>
                    <div class="col-lg-9" style="padding-top:7px">
                        <apex:selectRadio style="width:45%" id="operationType" value="{!sectorValue}" onchange="operationTypeChanged('{!namEnabled}', this.value, '{!isHOAccredited}', '{!con.Account.Sector__c}');">
                            <apex:selectOption itemValue="Travel_Agent" itemLabel="{!$Label.ISSP_Travel_Agent}" id="travelAgentCheck" />
                            <apex:selectOption itemValue="Cargo_Agent" itemLabel="{!IF(newlabels,$Label.ISSP_Cargo_Agent_New,$Label.ISSP_Cargo_Agent)}" id="cargoAgentCheck" />
                        </apex:selectRadio>
                        <script>
                        if('{!communityName}' === 'CNS') {
                            $(":radio[value=Travel_Agent]").parents('td').hide();
                        }
                        </script>
                    </div>
                </div>
                <apex:outputPanel id="optionsSetpA">
                    <apex:actionRegion >
                        <div class="form-group">
                            <label for="approval focus" class="col-lg-3 control-label">{!IF(NOT(newAccreditationModels), $Label.ISSP_AMS_Step1_Approval_Sought, $Label.Type_of_Accreditation)}</label>
                            <div class="col-lg-9">

                                <apex:selectList label="{!$Label.ISSP_AMS_Step1_Approval_Sought}" styleClass="form-control" id="officetypelist" style="width:55%;float:left" value="{!amsLocationType}" onchange="toggleOfficeTypes(this.id, ''); if ({!isMultiCountryNewAE} == false) { toggleCountries(this.value); }" size="1">
                                    <apex:selectOptions value="{!OfficeTypes}" />
                                </apex:selectList>

                                <apex:outputPanel id="compare">
                                    <apex:outputLink id="ProductComparisonLink" value="/apex/ISSP_ANG_ProductComparison">&nbsp;{!$Label.ISSP_AMS_Compare_Accreditation_Types}</apex:outputLink>
                                </apex:outputPanel>

                                <script>
                                    if ({!isMultiCountryNewAE} == true) $('[id$=officetypelist]').prop('disabled', true);

                                    if(showProductComparisonLink) {
                                        $('[name$=ProductComparisonLink]').show();
                                    }
                                    if(hideProductComparisonLink) {
                                        $('[name$=ProductComparisonLink]').hide();
                                    }
                                </script>
                            </div>
                        </div>

                        <!-- NEWGEN-1249-->
                        <apex:outputpanel id="isSameLegal" rendered="{!OR(AND(newAccreditationModels,con.Account.Category__c =='IATA Passenger Sales Agent', isHOAccredited), isMultiCountryNewAE)}">
                            <apex:outputpanel id="legalEntity" rendered="{!NOT(BEGINS(sectorValue,'Cargo_Agent'))}">
                                <div class="form-group" id='isLegal'>
                                    <label for="isLegal" class="col-lg-3 control-label">{!$Label.ANG_AE_separate_Legal_Entity}</label>

                                    <div style="width: 142px;padding-left:15px;padding-top:7px; float:left;margin-left:0px;">
                                        <apex:selectradio id="separateLegalEntitySelect" style="width:100%;" label="{!$Label.ANG_AE_separate_Legal_Entity}" value="{!newForm.AE_separate_Legal_Entity__c}">
                                            <apex:selectOption itemValue="Yes" itemLabel="{!$Label.ISSP_Yes}" />
                                            <apex:selectOption itemValue="No" itemLabel="{!$Label.ISSP_No}" />
                                        </apex:selectradio>

                                    </div>
                                    <div style="float: left;padding-top:10px;padding-right: 30px;">
                                        <apex:image value="/img/msg_icons/info16.png" title="{!$Label.ISSP_ANG_Step1_Legal_Display_Help}" style="float:left" html-data-placement="right" html-data-toggle="tooltip" />
                                    </div>

                                </div>
                            </apex:outputpanel>
                        </apex:outputPanel>

                        <apex:outputpanel id="chinatypeofagent">
                            <apex:outputPanel rendered="{!AND(isocountry.ISO_Code__c=='CN', NOT(isHOAccredited),BEGINS(sectorValue,'Travel_Agent'))}">
                                <div class="form-group">
                                    <label for="chinaagenttype" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Agency_Type}</label>
                                    <div class="col-lg-9">
                                        <apex:selectList required="true" label="{!$Label.ISSP_AMS_Agency_Type}" styleClass="form-control" id="chinaagenttype" style="width:40%" value="{!newForm.Local_Agent_Type__c}" size="1">
                                            <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Select}" />
                                            <apex:selectOption itemValue="Domestic" itemLabel="{!$Label.ISSP_AMS_Domestic}" />
                                            <apex:selectOption itemValue="International" itemLabel="{!$Label.ISSP_AMS_International}" />
                                        </apex:selectList>
                                    </div>
                                </div>
                            </apex:outputPanel>
                        </apex:outputpanel>
                    </apex:actionRegion>
                    </apex:outputPanel>
                </apex:outputPanel>



                            <apex:outputpanel rendered="{!isNoticeOfChange}">
                        <!--
                                <apex:outputPanel rendered="{!isBankAccountChange==false}">
                                    <div class="form-group">
                                        <label for="approval focus" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Noc_Type_of_Change}:</label>
                                        <div class="col-lg-9" style="top:7px">
                                            <apex:panelGrid columns="8">
                                                <apex:inputCheckbox styleClass="{!IF(AND(isValError, newForm.Is_change_bank_account_details__c==false,newForm.Is_change_legal_name__c==false,newForm.Is_change_location__c==false,newForm.Is_change_ownership_or_shareholding__c==false), 'requiredIndicator', '')}" value="{!newForm.Is_change_legal_name__c}" />
                                                <apex:outputText escape="false" value="&nbsp;{!$Label.ISSP_AMS_Noc_Legal_Name}&nbsp;&nbsp;&nbsp;&nbsp;"/>
                                                <apex:inputCheckbox styleClass="{!IF(AND(isValError, newForm.Is_change_bank_account_details__c==false,newForm.Is_change_legal_name__c==false,newForm.Is_change_location__c==false,newForm.Is_change_ownership_or_shareholding__c==false), 'requiredIndicator', '')}" value="{!newForm.Is_change_location__c}" />
                                                <apex:outputText escape="false" value="&nbsp;{!$Label.ISSP_AMS_Noc_Location}&nbsp;&nbsp;&nbsp;&nbsp;"/>
                                                <apex:inputCheckbox styleClass="{!IF(AND(isValError, newForm.Is_change_bank_account_details__c==false,newForm.Is_change_legal_name__c==false,newForm.Is_change_location__c==false,newForm.Is_change_ownership_or_shareholding__c==false), 'requiredIndicator', '')}" value="{!newForm.Is_change_ownership_or_shareholding__c}" />
                                                <apex:outputText escape="false" value="&nbsp;{!$Label.ISSP_AMS_NoC_Ownership_Shareholding}&nbsp;&nbsp;&nbsp;&nbsp;"/>
                                            </apex:panelGrid>
                                        </div>
                                    </div>
                                </apex:outputPanel>

                                <apex:outputText rendered="{!isBankAccountChange}">
                                    <div class="form-group">
                                        <label for="approval focus" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Noc_Type_of_Change}:</label>
                                        <div class="col-lg-9" style="top:7px">
                                            <apex:panelGrid columns="2">
                                                <apex:inputCheckbox value="{!newForm.Is_change_bank_account_details__c}" selected="true" disabled="true"/>
                                                <apex:outputText escape="false" value="&nbsp;{!$Label.ISSP_AMS_NoC_Bank_acount_details}&nbsp;&nbsp;&nbsp;&nbsp;"/>
                                            </apex:panelGrid>
                                        </div>
                                    </div>
                                </apex:outputText>
                                -->

                                <apex:outputpanel >
                                    <div class="form-group">
                                        <label for="operationtype" class="col-lg-3 control-label">
                                            {!IF(AND(isBankAccountChange == true, con.Account.Location_Type__c == 'AE'), $Label.ISSP_AMS_AE_NoC_Change_for, $Label.ISSP_AMS_NoC_Change_for)}
                                        </label>
                                        <div class="col-lg-9" style="padding-top:7px">
                                            <apex:outputPanel rendered="{!AND(isBankAccountChange == true, con.Account.Location_Type__c == 'AE')}">
                                                {!ContactAccount}
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!OR(isBankAccountChange != true, con.Account.Location_Type__c != 'AE')}">
                                                <apex:outputPanel rendered="{!OR(con.Account.ANG_Accreditation_Model__c == null, con.Account.ANG_Accreditation_Model__c == 'Legacy')}">
                                                    <apex:selectRadio required="true" id="LegacyLocationType" layout="pageDirection" label="{!$Label.ISSP_AMS_NoC_Change_for}" style="width:45%;" value="{!newForm.Scope_of_Change__c}" onchange="togglePageItem(this.value, '{!$Component.step1Form.step1Block.branchaccountsel}');">
                                            	    	<apex:selectOption itemValue="HO Only" itemLabel="{!$Label.ISSP_AMS_NoC_Head_Office}" rendered="{!isHOcontact}" />
                                            	    	<apex:selectOption itemValue="HO - All Branches" itemLabel="{!$Label.ISSP_AMS_NoC_HO_All_Branches}" rendered="{!AND(isHOcontact, OR(BranchAccounts.size>=1,agencyCodesConcerned.size>=1))}" />
	                                            	<apex:selectOption itemValue="HO - Selected Branches" itemLabel="{!$Label.ISSP_AMS_NoC_HO_Some_Branches}" rendered="{!AND(isHOcontact, OR(BranchAccounts.size>=1,agencyCodesConcerned.size>=1))}"/>
        	                                    	<apex:selectOption itemValue="Selected Branches Only" itemLabel="{!$Label.ISSP_AMS_NoC_Branch_Office}" rendered="{!OR(isHOcontact,BranchAccounts.size>=1,agencyCodesConcerned.size>=1)}"/>
                                                    </apex:selectRadio>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!AND(con.Account.ANG_Accreditation_Model__c != null, con.Account.ANG_Accreditation_Model__c != 'Legacy')}">
                                                    <apex:selectRadio required="true" id="LocationType" layout="pageDirection" label="{!$Label.ISSP_AMS_NoC_Change_for}" style="width:45%;" value="{!newForm.Scope_of_Change__c}" onchange="togglePageItem(this.value, '{!$Component.step1Form.step1Block.branchaccountsel}');">
                                                        <apex:selectOption itemValue="HO Only" itemLabel="{!$Label.ISSP_AMS_NoC_Head_Entity}"/>
                                                        <apex:selectOption itemValue="HO - All Branches" itemLabel="{!$Label.ISSP_AMS_NoC_HE_All_Branches}" rendered="{!OR(BranchAccounts.size>=1,agencyCodesConcerned.size>=1)}" />
                                                        <apex:selectOption itemValue="HO - Selected Branches" itemLabel="{!$Label.ISSP_AMS_NoC_HE_Some_Branches}" rendered="{!OR(BranchAccounts.size>=1,agencyCodesConcerned.size>=1)}"/>
                                                        <apex:selectOption itemValue="Selected Branches Only" itemLabel="{!$Label.ISSP_AMS_NoC_Associate_Entity}" rendered="{!OR(BranchAccounts.size>=1,agencyCodesConcerned.size>=1)}"/>
                                                    </apex:selectRadio>
                                                </apex:outputPanel>
                                            </apex:outputPanel>
                                        </div>
                                    </div>

                                    <apex:outputPanel id="branchaccountsel" style="display:{!IF(OR(newForm.Scope_of_Change__c=='HO - Selected Branches', newForm.Scope_of_Change__c=='Selected Branches Only'), '', 'none')}">
                                    <div class="form-group">
                                        <label for="approval focus" class="col-lg-3 control-label"></label>
                                        <div class="col-lg-9">
                                            <apex:outputPanel rendered="{!OR(isBankAccountChange = false, con.Account.Location_Type__c != 'AE')}">
                                                <c:MultiselectPicklist leftLabel="{!IF(OR(con.Account.ANG_Accreditation_Model__c == null, con.Account.ANG_Accreditation_Model__c == 'Legacy'), $Label.ISSP_AMS_NoC_Choose_Branch_Account, $Label.ISSP_AMS_NoC_Choose_Associate_Entities)}"
                                                                    leftOptions="{!BranchAccounts}"
                                                                    rightLabel="{!IF(OR(con.Account.ANG_Accreditation_Model__c == null, con.Account.ANG_Accreditation_Model__c == 'Legacy'), $Label.ISSP_AMS_Selected_Branch_Offices, $Label.ISSP_AMS_Selected_Associate_Entities)}"
                                                                    rightOptions="{!agencyCodesConcerned}"
                                                                    size="8"
                                                                    width="300px"
                                                                    btn_up_down="false"
                                                />
                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                    </apex:outputPanel>
                                </apex:outputpanel>
                            </apex:outputpanel>

                            <div class="form-group">
                                <label for="countryconcerned" class="col-lg-3 control-label">* {!$Label.ISSP_CountryConcerned}</label>

                                <div class="col-lg-9" id="brabroadcountries" style="padding-top:7px;">
                                    <apex:selectList id="countrySelected" required="false" styleClass="form-control" style="width:40%" value="{!newCase.IFAP_Country_ISO__c}" size="1">
                                            <apex:selectOptions value="{!countryISOCodeList}"/>
                                    </apex:selectList><!--onchange="setIsPilotCountry(this.value);"-->
                                </div>
                                <div class="col-lg-9" id="brcountry" style="padding-top:7px;display:none">
                                    <apex:outputText value="{!amsAllLangCountryLabel}"/>
                                </div>
                            </div>

                            <!-- apex:outputpanel id="langGSA" rendered="{!NOT(BEGINS(sectorValue,'Cargo_Agent')) || isNoticeOfChange}" -->
                            <apex:outputpanel id="langGSA">
                            <apex:actionRegion >
                                <apex:outputpanel rendered="{!NOT(AND(BEGINS(sectorValue,'Cargo_Agent'), NOT(isNoticeOfChange)))}">
                                    <div class="form-group">
                                    <label for="applylanguage" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Lang_Display}</label>
                                    <div class="col-lg-9">
                                        <apex:selectList styleClass="form-control" style="width:15%;float:left;" id="applylanguage" size="1" value="{!applyLanguage}" >
                                            <apex:selectOptions value="{!applyLanguageList}"/>
                                        </apex:selectList>&nbsp;
                                        <apex:image value="/img/msg_icons/info16.png" title="{!$Label.ISSP_AMS_Step1_Lang_Display_Help}" html-data-placement="right" html-data-toggle="tooltip"/>
                                    </div>
                                    </div>
                                </apex:outputpanel>

                                <apex:outputpanel rendered="{!AND(NOT(isNoticeOfChange),newCase.Status!='Open - EDMC')}">
                                    <apex:outputpanel id="GSAPanel" rendered="{!NOT(OR(BEGINS(sectorValue,'Cargo_Agent'),CONTAINS(amsLocationType,'New TIDS')))}">
                                        <div class="form-group" id="isGSA">
                                            <label for="isGSA" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Is_GSA}</label>
                                            <div class="col-lg-9" style="padding-top:7px">
                                                <apex:selectradio id="isGSASelect" style="width:15%" label="{!$Label.ISSP_AMS_Step1_Is_GSA}" value="{!amsIsGSA}" > <!-- required="{!isGSARequired}"> HANDLED IN CONTROLLER NOW -->
                                                    <apex:selectOption itemValue="YES" itemLabel="{!$Label.ISSP_Yes}" />
                                                    <apex:selectOption itemValue="NO" itemLabel="{!$Label.ISSP_No}" />
                                                </apex:selectradio>
                                            </div>
                                        </div>
                                    </apex:outputpanel>
                                </apex:outputpanel>
                                </apex:actionRegion>
                            </apex:outputpanel>
                    </apex:outputPanel>
            </apex:pageBlock>

                <script>
                    $(function() {
                       var $radios = $('input:radio[name="' + '{!$Component.step1Form.step1Block.operationType}' + '"]');
                        if($radios.is(':checked') === false) {
                            $radios.filter('[value=Travel_Agent]').prop('checked', true);
                        }

                    });

                    if ({!isMultiCountryNewAE} == false) toggleCountries($('[id$=officetypelist]').val());

                    //Disable country selection for the Pilot
                    //document.getElementById('{!$Component.step1Form.step1Block.countryconcerned}').disabled=true;

                    function operationTypeChanged(namEnabled, sectorValue, isHOAccredited, sector) {
                        if (sectorValue === 'Cargo_Agent') {
                            $('[name$=separateLegalEntitySelect]').prop('checked', false);
                            $('[name$=isGSASelect]').prop('checked', false);
                        }

                        setVarsProductComparisonLink(namEnabled, sectorValue, isHOAccredited, sector);

                        refreshOfficeTypes(sectorValue);
                    }
                </script>

           </apex:form>
        </div>
        </div>
        </apex:outputText>

    <!-- ----------------------------------------->
    <!--STEP 2 Display the country requirements-->
    <!----------------------------------------- -->
     <apex:outputText rendered="{!isStep2}">
        <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">
                    <!-- IMPORTANT - If new Agent_Type__c are created we need to add here the new Label-->
                    {!IF(isNoticeOfChange, lblNoCRequest,
                            IF(BEGINS(sectorValue,'Travel_Agent'), lblPAXTitle,
                                IF(BEGINS(newForm.Agent_Type__c,'IATA Cargo Agent'), lblCargoTitle,
                                    IF(BEGINS(newForm.Agent_Type__c,'EACP Intermediary'), lblEACPTitle,
                                        lblCASSTitle))))}</h3>
            </div>
            <div class="panel-body" id="body-enquiries">
                <apex:form >
                <div class="progress">
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep1}" value="{!IF(NOT(isNoticeOfChange), lblStepA, lblNoCStepA)}" id="Prev1"/>
                    </div>
                    <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
                        {!lblStepB}
                    </div>
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep3}" value="{!IF(NOT(isNoticeOfChange), lblStepC, lblNoCStepC)}" id="Next3"/>
                    </div>
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 16%;display:{!IF(isNoticeOfChange && newForm.Is_change_ownership_or_shareholding__c, 'none', '')}">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep4}" value="{!lblStepD}" id="Next4"/>
                    </div>
                     <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep5}" value="{!IF(isNoticeOfChange && newForm.Is_change_ownership_or_shareholding__c, lblNoCStepD, lblStepE)}" id="Next5"/>
                    </div>
                </div>
                </apex:form>
                <apex:form >
                    <apex:pageMessages id="theMessages" />
                    <apex:actionFunction action="{!CheckCountryReqments}" name="Check_CountryReqments" reRender="theMessages"/>
                    <apex:outputPanel rendered="{!(List_CountryReqments.size == 0)}">
                        <script>
                         Check_CountryReqments();
                        </script>
                    </apex:outputPanel>
                <apex:pageblock mode="detail" id="countryreqs" rendered="{!(List_CountryReqments.size > 0)}" title="{!$Label.ISSP_AMS_Step2_Instructions}" >
                    <apex:dataTable value="{!List_CountryReqments}" var="reqs"  style="background-color:white" styleClass="table table-condensed" >
                        <apex:column headerClass="info">
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                        </apex:column>
                        <apex:column headerClass="info" headerValue="{!$Label.ISSP_AMS_Step2_Check_List} {!amsCountryLabel} - {!IF(NOT(isNoticeOfChange), IF(BEGINS(sectorValue,'Travel_Agent'), $Label.ISSP_Travel_Agent, IF(BEGINS(sectorValue,'Cargo_Agent'), IF(newlabels,'IFACP Forwarder','IATA Cargo Agent'),newForm.Agent_Type__c)),
                                                                     $Label.ISSP_AMS_NoC_Request_for_Change)}">
                            <apex:outputText >
                                <strong>{!reqs.Name}</strong><br/>
                                <apex:outputField value="{!reqs.Requirement_text__c}"/>
                            </apex:outputText>
                        </apex:column>
                    </apex:dataTable>
                </apex:pageblock>

                    <center>
                    <apex:pageBlock mode="edit">
                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep1}" value="{!$Label.ISSP_Back}" id="Previous"/>
                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep3}" value="{!$Label.ISSP_Next}" id="Next"/>
                    </apex:pageBlock>
                    </center>
                </apex:form>
             </div>
        </div>
     </apex:outputText>

    <!-- ------------------------------ --->
    <!-- STEP 3 Display PAX or Cargo FORM -->
    <!-- ------------------------------- -->



    <!-- ---------------------------- -->
    <!-- STEP 4 Upload required docs -->
    <!-- ---------------------------- -->

    <apex:include pageName="ISSP_AMS_Upload" rendered="{!isStep4}" />

    <!-- ----------------------- -->
    <!-- STEP 5 Submit to IATA  -->
    <!-- ----------------------- -->
    <apex:outputText rendered="{!isStep5}">
        <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">
                <!--{ ! IF(BEGINS(sectorValue,'Travel_Agent'), $Label.ISSP_AMS_StepsAll_Travel_Title, 'Application for approval as' + IF(OR(BEGINS(newForm.Agent_Type__c, 'I'),BEGINS(newForm.Agent_Type__c, 'E')), ' an ', ' a ') + newForm.Agent_Type__c) } -->
                        {!IF(isNoticeOfChange, lblNoCRequest,
                    IF(BEGINS(sectorValue,'Travel_Agent'), lblPAXTitle,
                        IF(newForm.Agent_Type__c == 'IATA Cargo Agent', lblCargoTitle,
                            IF(newForm.Agent_Type__c == 'EACP Intermediary', lblEACPTitle,
                                IF(newForm.Agent_Type__c == 'CASS Associate', lblCASSTitle,
                                    IF(newForm.Agent_Type__c == 'Import Agent', lblImporAgentTitle,
                                        IF(newForm.Agent_Type__c == 'Courier', lblCourierTitle, $Label.ISSP_AMS_StepsAll_Application_Approval_Title)))))))}

                </h3>
            </div>
    <div class="panel-body" id="body-enquiries">
        <apex:form >
        <div class="progress">
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep1}" value="{!lblStepA}" id="Prev1"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep2}" value="{!lblStepB}" id="Prev2"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep3}" value="{!IF(NOT(isNoticeOfChange),lblStepC, lblNoCStepC)}" id="Prev3"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 16%;display:{!IF(isNoticeOfChange && newForm.Is_change_ownership_or_shareholding__c, 'none', '')}">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep4}" value="{!lblStepD}" id="Prev4"/>
            </div>
             <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                {!IF(AND(isNoticeOfChange, newForm.Is_change_ownership_or_shareholding__c), lblNoCStepD, lblStepE)}
            </div>
        </div>
       </apex:form>
        <div class="panel-body" id="body-enquiries">
         <apex:pageMessages />
        <apex:outputPanel rendered="{!BEGINS(sector, 'Cargo Agent') && !isNoticeOfChange}">
            <img src="{!URLFOR($Resource.PDF_icon_large)}" style="vertical-align:middle"/>
            <a href="/ISSP_AMS_PDF_CGO?caseId={!newCase.Id}{!if(communityName=='CNS', '&CommunityName=CNS', '')}&mode=pdf" target="_new">{!$Label.ISSP_AMS_download_a_PDF_version}
</a> {!$Label.ISSP_AMS_download_a_PDF_version_Of_your} {!IF(AND(newForm.Agent_Type__c=='IATA Cargo Agent', communityName=='CNS'), 'CNS Cargo Agent' , IF(newlabels,'IFACP Forwader',newForm.Agent_Type__c))} {!amsOfficeType} {!$Label.ISSP_AMS_download_a_PDF_version_Application}
        </apex:outputPanel>
        <apex:form >
        <apex:outputPanel rendered="{!isNoticeOfChange && !isBankAccountChange}" id="pdfnoc">
            <img src="{!URLFOR($Resource.PDF_icon_large)}" style="vertical-align:middle"/>
            <apex:commandLink action="{!goToDownloadPDF}" value="{!$Label.ISSP_AMS_download_a_PDF_version}" id="DownloadPDF" oncomplete="if ({!passedFormValidation}){redirectToPDF();}" reRender="NoCForm"/> {!$Label.ISSP_AMS_download_of}
            <!--a href="/ISSP_AMS_PDF_NoC?caseId={!newCase.Id}&isNoticeOfChange=true&mode=pdf" target="_new">{!$Label.ISSP_AMS_download_a_PDF_version}</a> {!$Label.ISSP_AMS_download_of} -->
        </apex:outputPanel>
        </apex:form>
            <br/>

        <apex:variable var="cnt" value="{!0}" />
        <apex:repeat value="{!List_CountryReqments}" var="reqs" rendered="{!OR(BEGINS(sector, 'Cargo Agent'),AND(isNoticeOfChange,BEGINS(sector, 'Travel Agent')))}">
        <apex:variable var="cnt" value="{!cnt+1}" />
            <c:ISSP_AMS_FormUpload reqCnt="{!cnt}"
            reqRequired="{!reqs.File_to_Upload__c}"
            reqName="{!reqs.Name}"
            reqDescription="{!reqs.Requirement_text__c}"
            reqIdentifier="{!reqs.File_Identifier2__c}"  
            rendered="{!NOT(ISBLANK(reqs.File_Identifier2__c))}" 
            />
        <apex:outputPanel  rendered="{!(ISBLANK(reqs.File_Identifier2__c))}">
            <div class = "well">
            <apex:outputText style="font-weight:bold" value ="{!reqs.Name}" escape="false"/>
            <br/> 
            <apex:outputText value ="{!reqs.Requirement_text__c}" escape="false"/>
            <br/>
            </div>
        </apex:outputPanel>
        </apex:repeat>
        
        <apex:pageBlock rendered="{!BEGINS(sectorValue,'Travel_Agent') && !isNoticeOfChange && NOT(isPartnership)}">
            <apex:form id="FinalForm">
                <apex:facet name="header">
                    <apex:outputPanel style="margin:20px 0px;font-size:110%" rendered="{!BEGINS(sectorValue, 'Travel_Agent')}">
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_Step5_ReviewBeforeSubmit}"/>
                    </apex:outputPanel>
                   </apex:facet>
           </apex:form>
        </apex:pageBlock>
        
        <apex:outputPanel rendered="{!BEGINS(sectorValue,'Travel_Agent') && !isNoticeOfChange && isPartnership}">
            <apex:pageBlock >
                <apex:form >
                    <apex:outputText escape="false" value="{!$Label.ISSP_AP_Partnership_Download_PDF}"/>
                    <br/>
                    <img src="{!URLFOR($Resource.PDF_icon_large)}" style="vertical-align:middle"/>&nbsp;
                    <apex:commandLink action="{!redirectToPDF}" value="{!$Label.ISSP_AMS_Download_PDF_Copy}" target="_new"/>
                </apex:form>
            </apex:pageBlock>
        
            <c:ISSP_AMS_FormUpload reqCnt="{!cnt+1}"
                reqRequired="true"
                reqName="{!$Label.ISSP_AMS_Form_Signed_Application_Form}"
                reqDescription="{!$Label.ISSP_AMS_Form_Signed_Application_Form_Description}"
                reqIdentifier="{!FILE_ID_FOR_PARTNERSHIP}"
            />
        </apex:outputPanel>

        <apex:outputPanel rendered="{!BEGINS(sectorValue,'Travel_Agent') && !isNoticeOfChange}">
        <div class="col-md-12"></div>
            <div class="apcontainer">
                <apex:include pageName="{!includedSummaryPage}" rendered="{!isStep5}" />
                <apex:form id="PAXForm">
                <apex:pageMessages />
                <apex:pageBlock >
                <apex:pageBlockSection title="{!$Label.ISSP_TC_Accept}" columns="1" collapsible="false" rendered="{!AND(BEGINS(sectorValue, 'Travel_Agent'), NOT(isMultiCountry))}">
                    <div class="aplabel">
                        <apex:outputText escape="false" value="{!IF(amsOfficeType=='HO', $Label.ISSP_AMS_T_Cs1, $Label.ISSP_AMS_Pax_Branch_T_Cs)}"/>
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_T_Cs2}"/>
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_T_Cs3}"/>
                    </div>
                    <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true"/>
                </apex:pageBlockSection>
                <br/>
                <div style="text-align:center;">
                    <apex:actionStatus id="buttonLoadingStep5PAX">
                    <apex:facet name="stop"><apex:outputPanel >
                    <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}" status="buttonLoadingStep5PAX"/>
                    <apex:commandButton action="{!goToFinalStep}" value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, IF(isMultiCountry, $Label.ISSP_ANG_Validate_Agency_Details, $Label.ISSP_AMS_Submit_IATA))}" status="buttonLoadingStep5PAX" reRender="PAXForm"/>
                    <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right" status="buttonLoadingStep5PAX"/>
                        </apex:outputPanel></apex:facet>
                    <apex:facet name="start"><apex:outputPanel >
                    <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}" disabled="true"/>
                    <apex:commandButton action="{!goToFinalStep}" value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, IF(isMultiCountry, $Label.ISSP_ANG_Validate_Agency_Details, $Label.ISSP_AMS_Submit_IATA))}..." disabled="true"/>
                    <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right" disabled="true"/>
                         </apex:outputPanel></apex:facet>
                    </apex:actionStatus>
                </div>
                </apex:pageBlock>
                </apex:form>
            </div>
        </apex:outputPanel>
         <br/>
        <apex:form >
        <apex:pageBlock rendered="{!BEGINS(sectorValue,'Cargo_Agent') && !isNoticeOfChange}">
            <apex:facet name="header">
                <apex:outputPanel style="margin:20px 0px;font-size:110%">
                    <apex:outputText escape="false" value="{!$Label.ISSP_AMS_ACCR_Review_Msg}"/>
                </apex:outputPanel>
               </apex:facet>
        </apex:pageBlock>
       </apex:form>
       <apex:outputPanel rendered="{!BEGINS(sectorValue,'Cargo_Agent') && !isNoticeOfChange}">
       <div class="col-md-12"></div>
        <div class="apcontainer">
            <apex:include pageName="{!includedSummaryPage}" rendered="{!isStep5}" />
        </div>
        <apex:form id="CGOForm">
        <apex:pageMessages />
        <apex:pageBlock >
        <!--Accept terms and conditions for CGO-->
        <c:ISSP_AMS_CGO_T_Cs ></c:ISSP_AMS_CGO_T_Cs>
        <apex:pageBlockSection columns="1" >
           <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true"/>
         </apex:pageBlockSection>
          <br/>
       <div style="text-align:center;">
        <apex:actionStatus id="buttonLoadingStep5CGO">
             <apex:facet name="stop"><apex:outputPanel >
            <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}" status="buttonLoadingStep5CGO"/>
            <apex:commandButton action="{!goToFinalStep}" value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, IF(isMultiCountry, $Label.ISSP_ANG_Validate_Agency_Details, $Label.ISSP_AMS_Submit_IATA))}" status="buttonLoadingStep5CGO" reRender="CGOForm"/>
            <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right" status="buttonLoadingStep5CGO"/>
            </apex:outputPanel></apex:facet>
            <apex:facet name="start"><apex:outputPanel >
           <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}" disabled="true"/>
            <apex:commandButton action="{!goToFinalStep}" value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, IF(isMultiCountry, $Label.ISSP_ANG_Validate_Agency_Details, $Label.ISSP_AMS_Submit_IATA))}..." disabled="true"/>
            <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right" disabled="true"/>
           </apex:outputPanel></apex:facet>
          </apex:actionStatus>
        </div>
        </apex:pageBlock>
       </apex:form>
        </apex:outputPanel>

        <apex:form >
        <apex:pageBlock rendered="{!isNoticeOfChange}" >
            <apex:facet name="header">
                <apex:outputPanel style="margin:20px 0px;font-size:110%" >
                    <apex:outputText escape="false" value="{!$Label.ISSP_AMS_Step5_ReviewBeforeSubmit}"/>
                </apex:outputPanel>
               </apex:facet>
        </apex:pageBlock>
    </apex:form>
    <apex:outputPanel rendered="{!isNoticeOfChange}">
            <div class="col-md-12"></div>
            <div class="apcontainer">
                <apex:include pageName="{!includedSummaryPage}" rendered="{!isStep5}" />
                <apex:form id="NoCForm">
                <apex:pageMessages />
                <apex:pageBlock >
                <!-- Accept terms and conditions -->
                <apex:pageBlockSection title="{!$Label.ISSP_TC_Accept}" columns="1" collapsible="false">
                    <div class="aplabel">
                        <apex:outputText rendered="{!newForm.Is_change_ownership_or_shareholding__c==true}">
                            <apex:outputText escape="false" value="{!IF(BEGINS(sectorValue,'Cargo_Agent'), IF(agencyCategory='IATA Cargo Agent', IF(isocountry.EACP_Country__c, $Label.ISSP_AMS_NoC_TC_Change_EACP, IF(newlabels, $Label.ISSP_AMS_NoC_TC_Change_CGO_New, $Label.ISSP_AMS_NoC_TC_Change_CGO)), $Label.ISSP_AMS_NoC_TC_Change_CASS), $Label.ISSP_AMS_NoC_Bank_Change1)}"/>
                            <br/><br/>
                            <apex:outputText escape="false" value="{!IF(BEGINS(sectorValue,'Cargo_Agent'), IF(agencyCategory='IATA Cargo Agent', IF(isocountry.EACP_Country__c, $Label.ISSP_AMS_NoC_TC_Change_EACP2, IF(newlabels, $Label.ISSP_AMS_NoC_TC_Change_CGO2_New, $Label.ISSP_AMS_NoC_TC_Change_CGO2)), ''), $Label.ISSP_AMS_NoC_Bank_Change2)}"/>
                            <br/><br/>
                            <apex:outputText escape="false" value="{!IF(BEGINS(sectorValue,'Cargo_Agent'), IF(agencyCategory='IATA Cargo Agent', IF(isocountry.EACP_Country__c, $Label.ISSP_AMS_NoC_TC_Change_EACP3, IF(newlabels, $Label.ISSP_AMS_NoC_TC_Change_CGO3_New, $Label.ISSP_AMS_NoC_TC_Change_CGO3)), ''), $Label.ISSP_AMS_NoC_Bank_Change3)}"/>
                        </apex:outputText>
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_NoC_TC}" rendered="{!newForm.Is_change_ownership_or_shareholding__c==false}"/>
                    <br/>
                    <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true" />
                    </div>
                </apex:pageBlockSection>
                <br/>
                <div style="text-align:center;">
                    <apex:actionStatus id="buttonLoadingStep5NoC">
                        <apex:facet name="stop"><apex:outputPanel >
                        <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}" status="buttonLoadingStep5NoC"/>
                        <apex:commandButton action="{!goToFinalStep}" value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, $Label.ISSP_AMS_Submit_IATA)}" status="buttonLoadingStep5NoC" reRender="NoCForm"/>
                        <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right" status="buttonLoadingStep5NoC"/>
                    </apex:outputPanel></apex:facet>
                    <apex:facet name="start"><apex:outputPanel >
                        <apex:commandButton value="{!$Label.ISSP_Back}" disabled="true"/>
                        <apex:commandButton value="{!if(communityName=='CNS', $Label.ISSP_AMS_Submit_CNS, $Label.ISSP_AMS_Submit_IATA)}..." disabled="true"/>
                        <apex:commandButton value="{!$Label.ISSP_Save_Draft}" style="float:right" disabled="true"/>
                    </apex:outputPanel></apex:facet>
                    </apex:actionStatus>
                </div>


                </apex:pageBlock>
                </apex:form>
            </div>
    </apex:outputPanel>
     </div>
     </div>
     </div>

     </apex:outputText>

    <!-- -------------------------------------- -->
    <!-- STEP 6 Check the created case details- -->
    <!-- -------------------------------------- -->

    <apex:pageBlock rendered="{!isFinalStep}" mode="maindetail">
       <div style="color:#000000; font-size:14px; padding-bottom:10px; padding-top:10px;margin-left:200px">

           <strong>
               <!--<apex:outputPanel rendered="{!NOT(isNoticeOfChange)}">
               {!IF(BEGINS(sectorValue, 'Travel_Agent'),
               IF(newCase.Reason1__c =='New AE', $Label.ISSP_ANG_StepFinal_AE_Thanks,
               IF(amsOfficeType!='HO', IF(CONTAINS(amsLocationType,'New TIDS'),$Label.ISSP_AMS_StepFinal_TIDS_BR,$Label.ISSP_AMS_StepFinal_Pax_Branch_Thanks),
               IF(newCase.Reason1__c!='New BR Abroad', $Label.ISSP_AMS_StepFinal_Thanks, $Label.ISSP_AMS_StepFinal_Pax_BR_Abroad_Thanks))),
               IF(CONTAINS(amsLocationType,'New TIDS'), $Label.ISSP_AMS_StepFinal_TIDS_HO,$Label.ISSP_AMS_StepFinal_Thanks),$Label.ISSP_AMS_StepFinal_Pax_BR_Abroad_Thanks))),
               IF(amsOfficeType=='HO',$Label.ISSP_AMS_ACCR_Submit_Msg_CargoHO,$Label.ISSP_AMS_ACCR_Submit_Msg_CargoBR))}
               </apex:outputPanel>-->
               <apex:outputPanel rendered="{!isNoticeOfChange}">
                {!IF(newform.Is_change_bank_account_details__c, $Label.ISSP_AMS_StepFinal_ChangeBank, $Label.ISSP_AMS_StepFinal_ChangeOther)}
               </apex:outputPanel>
            <apex:outputPanel rendered="{!newForm.SAAM_Case__r.Reason1__c == 'FoP Management'}">
                {!$Label.ISSP_PCI_Case_Submited}
               </apex:outputPanel>
            <apex:outputPanel rendered="{!newForm.SAAM_Case__r.Reason1__c == 'CLO - Closure'}">
                {!$Label.ISSP_VR_Case_Submited}
            </apex:outputPanel>
           </strong>


           <br/> <br/>
            {!$Label.ISSP_AMS_StepFinal_Your_CaseNumber} <a href="/ISSP_Case?caseId={!newCase.Id}{!if(communityName=='CNS','&CommunityName='+communityName,'')}" target="_self">{!newCase.CaseNumber}</a>.
            <br/><br/>
                <a href="/ISSP_Case?caseId={!newCase.Id}{!if(communityName=='CNS','&CommunityName='+communityName,'')}" target="_self">{!$Label.ISSP_AMS_StepFinal_Access_Direct}</a>&nbsp;{!$Label.ISSP_AMS_StepFinal_Access_Direct2}
            <br/><br/>
           {!IF(communityName=='CNS', $Label.ISSP_AMS_StepFinal_In_Addition_CNS, $Label.ISSP_AMS_StepFinal_In_Addition)} <a href="/ISSP_CaseList{!if(communityName=='CNS','?CommunityName='+communityName,'')}" target="_self">{!$Label.ISSP_AMS_StepFinal_In_Addition2}</a>.
            <br/><br/><br/><br/>
            <!---
            <a href="/ISSP_APCases?retURL=/ISSP_Homepage"><apex:image value="https://iata--preprod--c.cs18.content.force.com/servlet/servlet.ImageServer?id=01511000000UHn7&oid=00D1100000Bzzsg&lastMod=1425387500000" width="60" height="60" style="vertical-align: middle;"/></a>&nbsp;<b>Create new BSP / CASS Joining application.</b>
            -->
            <apex:form rendered="{!AND(OR(BEGINS(sectorValue, 'Travel_Agent'), AND(BEGINS(sectorValue, 'Cargo_Agent'), newForm.Agent_Type__c!='IATA Cargo Agent', newForm.Agent_Type__c!='EACP Intermediary')),!isNoticeOfChange,newForm.SAAM_Case__r.Reason1__c != 'FoP Management',newCase.Reason1__c!='CLO - Closure')}">
                 <apex:pageBlockSection rendered="{!newCase.Reason1__c!='Annual revalidation'}" >
                     <apex:pageBlockSectionItem >
                         <apex:image value="{!URLFOR($Resource.PDF_icon_large)}"/>
<!--                          <apex:outputLink value="/ISSP_AMS_PDF_ApplicationForm?caseId={!newCase.Id}" id="amsFormLink" target="_new">
                             {!$Label.ISSP_AMS_Download_PDF_Copy}
                        </apex:outputLink> -->
                                        <apex:commandLink action="{!redirectToPDF}" value="{!$Label.ISSP_AMS_Download_PDF_Copy}" styleClass="hist-submitButton" style="color: #ffffff" id="theCommandLink" target="_new"/>
                     </apex:pageBlockSectionItem>
                 </apex:pageBlockSection>

            </apex:form>
        </div>
    </apex:pageBlock>

         </div>
         <c:ISSP_CustomFooter communityName="{!communityName}"/>
         </div>

    </body>
</html>

</apex:page>