<apex:page controller="ISSP_AMS_Accreditation"
           cache="false"
           sidebar="false"
           showHeader="false"
           language="{!displayLanguage}"
           standardStylesheets="true"
           applyBodyTag="false"
           applyHtmlTag="false"
           action="{!securityCheck}"
           >

    <html> 
        <c:ISSP_Header ></c:ISSP_Header>
        <body>
        <script src="{!URLFOR($Resource.bootbox)}" />
        <script src="{!URLFOR($Resource.datePickerFix)}" />
        <link rel="stylesheet" href="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/css/intlTelInput.css')}"/>
        <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
        <script src="{!URLFOR($Resource.jquery_file_upload, '/jQuery-File-Upload-9.11.2/js/jquery.iframe-transport.js')}" />
    	<script src="{!URLFOR($Resource.jquery_file_upload, '/jQuery-File-Upload-9.11.2/js/jquery.fileupload.js')}" />
       
    <style>
        .datePicker{
            z-index:9999;
        }
        .pbTitle {
            width: {!IF(isstep2,'90% !important','40% !important')};
        }
       
       .pbBody {
        padding-left:10px !important;    
       }
            
       .pbBody a{color:#337ab7 !important}
               
        .bPageBlock {
            border-top-width : thin !important;
        }
        
        .bEditBlock input {
            vertical-align:top !important;
        }
       
       .btn {
            padding: 2px 12px !important;
        }
                             
        .btn-primary {
            color: #fff !important;
            background: inherit !important;
            background-color: #337ab7 !important;
            border-color: #2e6da4 !important;
            border: 1px solid transparent !important;
            /*background: */
        }
        
        .tb-header {
            padding-right:20px;
        }
                 
        .modalrow {
            padding-top:10px;
        }
            
        ul li, ol li {
            margin-left: inherit;
            padding-left: inherit;
        }
        
        #contentWrapper {  background: #fff !important; margin: 0 auto;max-width: 1170px;}
            
        .requiredText {display:none;}
        
        .dateFormat {display:none;}
        
        .errorMsg {color:#d74c3b}
            
        .progress-bar-off {
                color:#6BBBEA;
                font-weight:bold;
                background-image:none !important;
                background-color:transparent !important;
                border-right:2px solid white;
        }
        
        body .bPageBlock .pbBody .pbSubheader{
                background-image: url('') !important;
                background-color:  #1797c0;
                color: #fff;
        }

        body .bPageBlock .pbBody .summary-subsection .pbSubheader{
                background-image: url('') !important;
                background-color: initial;
                color: initial;
        }
        
        .pbSubheader {
        	font-weight:bold;
        	font-size:15px;
   		}
                   
        .contact-detail {
            font-size:12px;
            margin-bottom:3px;
        }
                   
        .tbFooter {
         text-align:right;
        }
                   
        .requiredBlock {
            width:5px !important;
        }

        .checkbox-td {
            text-align: center;
        }

        .summary-table th {
            text-align: center;
        }

        .summary-table td.dataCell {
            border: 1px solid #e0e3e5 !important;
        }
        
    		.col1 {
            	padding-bottom:5px;
            	width:40%;
    			vertical-align: text-top;
            	font-weight:bold
            }
            
            .col1_regular {
            	padding-bottom:5px;
            	width:25%;
    			vertical-align: text-top;
            	font-weight:bold
            }       
                   
        	.col2 {width:60%; padding-left:50px;vertical-align: text-top;}
            .col2_regular {width:25%; padding-left:50px;vertical-align: text-top;}
            .col2_4 {width:10%;padding-left:5px;vertical-align: text-top;}
            .col3 {width:50%}
       
    </style>
    
    <script>
            $(function(){ $('.requiredIndicator').wrap('<div class="requiredInput">').before('<div class="requiredBlock"></div>'); } );
            var pilotList = {{!pilotList}};
            var defaultHQCountry = '{!newCase.IFAP_Country_ISO__c}';
            var vOfficeType = '{!newCase.Reason1__c}';
            console.log('vOfficeType '+vOfficeType);
            var operationType = '{!sectorvalue}';
            var hasPermission = true;
            
            var isPilotCountry = pilotList[defaultHQCountry];
            var isEUcountry = {!isEUcountry};
         
            function setIsPilotCountry(isocode) {
                isPilotCountry = pilotList[isocode];
            }
                 
            function toggleOfficeTypes(officeSelect, ctrylistid) {
                
                //var mySelectOptions = $('select[name="' + ctrylistid + '"] option');
                //var mySelect = $('select[name="' + ctrylistid + '"]');         
                var officeTypeSel = $('select[name="' + officeSelect + '"]');
                vOfficeType = officeTypeSel.val();
                /**
                mySelectOptions.each(function() {
                  if(vOfficeType=='New BR Abroad') {
                    if(this.value != defaultHQCountry) {
                        $(this).prop('disabled', false);
                     } else {
                        $(this).prop('disabled', true);
                        mySelect.val('');
                     }
                  } else {
                    if(this.value != defaultHQCountry) {
                        $(this).prop('disabled', true);
                     } else {
                        $(this).prop('disabled', false);
                        mySelect.val(defaultHQCountry);
                     }
                  }
                });
                **/
            }
                   
            function isChinaDomestic() {
                var chinaAgentType;
                var chinaAgentTypeId = '{!$Component.step1Form.step1Block.chinaagenttype}';
            
            	if(defaultHQCountry=='CN') {
               		var chinaAgentType = $('select[name="' + chinaAgentTypeId + '"]');
                    if(chinaAgentType.val() == 'Domestic') {
                        console.log('in domestic');
                    	return true;
                    }
                }
                
                return false;
            }
                   
            function updateCargoHiddenTOS(){
                if ($('[id$=tos]').is(':checked')){
                    $('[id$=toshidden]').attr('checked', true);
                    $('[id$=toshidden]').attr('value', true);
                }
                else{
                    $('[id$=toshidden]').attr('checked', false);
                    $('[id$=toshidden]').attr('value', false);
                }
            }
            
            function gotoStep1(myValue, nextStep) {

            var $lists = $('select[name="' + '{!$Component.step1Form.step1Block.officetypelist}' + '"]'); 
            vOfficeType = $lists.val();

            var countriesMap = JSON.parse('{!jsonCountriesMap}');
            var cargoAgentTypes = ["IATA Cargo Agent", "EACP Intermediary", "CASS Associate", "Courier", "Import Agent"];
            console.log('no empty voffice '+vOfficeType);
            if(vOfficeType=='')
                isAllowedCountry = 't';
            else{
                var idx = vOfficeType.indexOf(' - ');

                console.log('vOfficeType goto '+vOfficeType);
                
                if(vOfficeType.substring(idx + 3).trim() == 'IATA Passenger Sales Agent') {
                	operationType = 'Travel_Agent';
                } else {
                	operationType = 'Cargo_Agent';
                }

               
                var countryList = countriesMap[operationType+'-'+vOfficeType.substring(0, idx)];     
                var isAllowedCountry = countryList[countryList.indexOf(defaultHQCountry)+3]; 
                
                ///alert( $('input[name="' + myValue + '"]:checked').val() + ' was selected.' );
                var langId = '{!$Component.step1Form.step1Block.applylanguage}';
                var langSel = $('select[name="' + langId + '"]');
                var vLang = langSel.val();
               
                    //For pilot only English & Spanish HO applications for pilot countries alllowed
                
                if( $('input[name="' + myValue + '"][value=Travel_Agent]').prop("checked")) {
                    if(isAllowedCountry=='f' || isChinaDomestic() ) {
                        bootbox.confirm("{!JSEncode($Label.ISSP_AMS_Step1_GoTo_Pax)}", function(result) {
                            if(result) {
                                window.open('/ISSP_AMSCases', '_self');
                                if(isChinaDomestic()) {
                                	window.open('https://www.iata-asd.com', '_blank');
                              	} else {
                                	window.open('http://www.iata.org/services/accreditation-travel/accreditation-travel/Pages/application.aspx', '_blank');
                                }
                            }
                        });
                        hasPermission = false;
                    } else {
                        document.getElementById("{!$Component.step1Form.NextStep}").value = nextStep;
                        hasPermission = true;
                    }
            } else {
                if(isAllowedCountry=='f' || isChinaDomestic()) {
                    bootbox.confirm("{!JSEncode($Label.ISSP_AMS_Step1_GoTo_Cargo)})", function(result) {
                                if(result) {
                                    window.open('/ISSP_AMSCases', '_self');
                                    if(isChinaDomestic()) {
                                		window.open('https://www.iata-asd.com', '_blank');
                              		} else {
                                		window.open('http://www.iata.org/services/accreditation-travel/accreditation-travel/Pages/application.aspx', '_blank');
                                	}
                                }
                            });
                    hasPermission = false;
                    }
                    
                else {
                    document.getElementById("{!$Component.step1Form.NextStep}").value = nextStep;
                    hasPermission = true;
                }
            }
        }
    }
           
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            })
           
        function resetStep1(v) {  
            operationType = v ;         
            if(v=='Cargo_Agent') {
                $('#isGSA').hide();
                $('#langPanel').hide();
            } else {
                $('#isGSA').show();
                $('#langPanel').show();
            }
            
        }
                 
        function getFileLink(fileName) {
            // alert(''+fileName);
            $("#loading").show();
            setTimeout(function(){
            try{
                ISSP_AmazonS3_Ctrl.getExpiringLinkIfap(fileName,function(result, event){
                    var result2= result.replace("&amp;","&"); 
                    var newWin = window.open(result2);
                    if(!newWin || newWin.closed || typeof newWin.closed=='undefined'){
                        alert('Please check the pop-up settings of your browser!');
                    }
                    $("#loading").hide();
                },{escape:false});
            }catch(err){alert( err.message);}
            },500);
        }
    
        function isIE(){
            //alert(navigator.userAgent);
            //return /MSIE/.test(navigator.userAgent);
            if (/MSIE/.test(navigator.userAgent)){
                return true;
            }
            else if (/rv:11/.test(navigator.userAgent)){
                return true;
            }
            else{
                return false;
            }
        }
    var vReqNo
    
    function resetUploadBar() {
        //$('.uploadbar-' + vReqNo).css('width', '0%');
        $("#loading-" + vReqNo).hide();
    }
    
    function resetUploadBarOnDelete() {
        $('.uploadbar-' + vReqNo).css('width', '0%');
    }
   
    </script>
            
     <div class="container">
       <div id="contentWrapper">
           <c:ISSP_CustomNavigation />
            
    <!----------------------------------------->
    <!-- STEP 1 -->
    <!----------------------------------------->
    <!--Online form to create the Accreditation process-->
    <apex:outputText rendered="{!isStep1}">
    <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">{!$Label.ISSP_AMS_Step1_Title}</h3>
            </div>
    <div class="panel-body" id="body-enquiries">
        
       
    <apex:form id="step1Form" styleClass="form-horizontal">
        <div class="progress">
          
            <div class="progress-bar" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%;">
                {!$Label.ISSP_AMS_Step1_ProgressBar}
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '2');if(hasPermission != true) return false;" value="{!$Label.ISSP_AMS_Step2_ProgressBar}" id="Next2"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '3');if(hasPermission != true) return false;" value="{!$Label.ISSP_AMS_Step3_ProgressBar}" id="Next3"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 16%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '4');if(hasPermission != true) return false;" value="{!$Label.ISSP_AMS_Step4_ProgressBar}" id="Next4"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%;">
                <apex:commandLink styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '5');if(hasPermission != true) return false;" value="{!$Label.ISSP_AMS_Step5_ProgressBar}" id="Next5"/>
            </div>
         
        </div> 
        <apex:actionFunction action="{!null}" name="refreshOfficeTypes" reRender="officetypelist,langGSA,chinatypeofagent">
            <apex:param value="" assignTo="{!sectorValue}" name="sectorValue"/>
        </apex:actionFunction>
        <apex:inputHidden id="NextStep" value="{!newCase.Applicable_to_Which_Version_s__c}"/>
      
        <apex:pageBlock id="step1Block" mode="edit" >
            <apex:pageBlockButtons location="bottom" style="padding-left:100px">
                <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true"/>
                <apex:commandButton styleclass="btn btn-default" action="{!save}" onclick="gotoStep1('{!$Component.step1Form.step1Block.operationType}', '2');if(hasPermission != true) return false;" value="{!$Label.ISSP_Next}" rendered="{!NOT(amsIsGSA=='YES')}"/>
            </apex:pageBlockButtons>
         <apex:pageMessages ></apex:pageMessages>
        <apex:outputPanel id="formContainer" rendered="{!NOT(amsIsGSA=='YES')}">
            
            <div class="alert alert-info" role="alert">
                <apex:outputText value="{!$Label.ISSP_AMS_Step1_Separate_Application}" escape="false"/>
            </div>
            <div class="alert alert-warning" role="alert">
                {!$Label.ISSP_AMS_Step1_Two_Weeks_Expiry}
            </div>
                <apex:actionRegion >
                    
                    <div class="form-group">
                    <label for="operationtype" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Operation_Type}</label>
                    <div class="col-lg-9" style="padding-top:7px">
                        <apex:selectRadio style="width:35%" id="operationType" value="{!sectorValue}" onchange="refreshOfficeTypes(this.value)"> <!--onchange="refreshOfficeTypes(this.value);"-->
                            <apex:selectOption itemValue="Travel_Agent" itemLabel="{!$Label.ISSP_Travel_Agent}" id="travelAgentCheck" />
                            <apex:selectOption itemValue="Cargo_Agent" itemLabel="{!$Label.ISSP_Cargo_Agent}" id="cargoAgentCheck" />
                            <!--apex:actionsupport event="onchange" rerender="langGSA,officetypelist" action="{!null}"/--> 
                        </apex:selectRadio>
                    </div>
                    </div>

                </apex:actionRegion>   
               
                    <div class="form-group"> 
                        <label for="approval focus" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Approval_Sought}</label>
                        <div class="col-lg-9">
                            <apex:selectList label="{!$Label.ISSP_AMS_Step1_Approval_Sought}" styleClass="form-control" id="officetypelist" style="width:45%" value="{!amsLocationType}" onchange="toggleOfficeTypes(this.id, '');" size="1"> <!--onchange="toggleOfficeTypes(this.id, '{!$Component.step1Form.step1Block.countryconcerned}');"-->
                                <apex:selectOptions value="{!OfficeTypes}"/>
                            </apex:selectList>                           
                        </div>
                    </div>      
                    
                    <apex:outputpanel id="chinatypeofagent">
                        <apex:outputPanel rendered="{!AND(isocountry.ISO_Code__c=='CN', NOT(isHOAccredited),BEGINS(sectorValue,'Travel_Agent'))}">
                        	<div class="form-group"> 
                            <label for="chinaagenttype" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Agency_Type}</label>
                            <div class="col-lg-9">
                                <apex:selectList required="true" label="{!$Label.ISSP_AMS_Agency_Type}" styleClass="form-control" id="chinaagenttype" style="width:40%" value="{!newForm.Local_Agent_Type__c}"  size="1">
                                    <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Select}"/>
                                    <apex:selectOption itemValue="Domestic" itemLabel="{!$Label.ISSP_AMS_Domestic}"/>
                                    <apex:selectOption itemValue="International" itemLabel="{!$Label.ISSP_AMS_International}"/>
                                </apex:selectList>                           
                            </div>
                        </div>
                        </apex:outputPanel> 
                    </apex:outputPanel>        
            
                            <div class="form-group">
                            <label for="countryconcerned" class="col-lg-3 control-label">* {!$Label.ISSP_CountryConcerned}</label>
                           <apex:inputHidden value="{!newCase.IFAP_Country_ISO__c}"/>
                            
                            <div class="col-lg-9" style="padding-top:7px">
                                <apex:outputText value="{!amsAllLangCountryLabel}"/>
                                <!--
                                <apex:selectList styleClass="form-control" id="countryconcerned" style="width:40%" value="" onchange="setIsPilotCountry(this.value);" size="1">
                                        <apex:selectOptions value="{!countryISOCodeList}"/>
                                </apex:selectList>
                                -->
                            </div>
                            </div>
            				
                            <apex:outputpanel id="langGSA">
                            <apex:outputpanel rendered="{!NOT(BEGINS(sectorValue,'Cargo_Agent'))}">
                                <div class="form-group">
                                <label for="applylanguage" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Lang_Display}</label>
                                <div class="col-lg-9">
                                    <apex:selectList styleClass="form-control" style="width:15%;float:left;" id="applylanguage" size="1" value="{!applyLanguage}" >
                                        <apex:selectOptions value="{!applyLanguageList}"/>
                                    </apex:selectList>&nbsp;
                                    <apex:image value="/img/msg_icons/info16.png" title="{!$Label.ISSP_AMS_Step1_Lang_Display_Help}" html-data-placement="right" html-data-toggle="tooltip"/>
                                </div>
                                </div>
                            </apex:outputpanel>
                     
                            <apex:outputpanel id="GSAPanel" rendered="{!NOT(BEGINS(sectorValue,'Cargo_Agent'))}">
                                <div class="form-group" id="isGSA">
                                    <label for="isGSA" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Step1_Is_GSA}</label>
                                    <div class="col-lg-9" style="padding-top:7px">
                                        <apex:selectradio style="width:15%" label="{!$Label.ISSP_AMS_Step1_Is_GSA}" value="{!amsIsGSA}" required="{!isGSARequired }">
                                            <apex:selectoptions value="{!isGSAList}" />
                                        </apex:selectradio>
                                    </div>
                                </div>
                            </apex:outputpanel>
                            </apex:outputpanel>                       
                    </apex:outputPanel>
            </apex:pageBlock>
                
                <script>
                    $(function() {
                       var $radios = $('input:radio[name="' + '{!$Component.step1Form.step1Block.operationType}' + '"]');
                        if($radios.is(':checked') === false) {
                            $radios.filter('[value=Travel_Agent]').prop('checked', true);
                        }
        
                    });
        
                    //Disable country selection for the Pilot
                    //document.getElementById('{!$Component.step1Form.step1Block.countryconcerned}').disabled=true;
                </script>
            
           </apex:form>         
        </div>
        </div>
        </apex:outputText>
    
    <!-- ----------------------------------------->
    <!--STEP 2 Display the country requirements-->
    <!----------------------------------------- -->
     <apex:outputText rendered="{!isStep2}">
        <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">{!IF(BEGINS(sectorValue,'Travel_Agent'), $Label.ISSP_AMS_StepsAll_Travel_Title, 'Application for Approval as' + IF(BEGINS(newForm.Agent_Type__c, 'I'), ' an ', ' a ') + newForm.Agent_Type__c)}</h3>
            </div>
            <div class="panel-body" id="body-enquiries">
                <apex:form >
                <div class="progress">
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep1}" value="{!$Label.ISSP_AMS_Step1_ProgressBar}" id="Prev1"/>
                    </div>
                    <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
                        {!$Label.ISSP_AMS_Step2_ProgressBar}
                    </div>
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep3}" value="{!$Label.ISSP_AMS_Step3_ProgressBar}" id="Next3"/>
                    </div>
                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 16%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep4}" value="{!$Label.ISSP_AMS_Step4_ProgressBar}" id="Next4"/>
                    </div>
                     <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                        <apex:commandLink styleclass="btn btn-default" action="{!goToStep5}" value="{!$Label.ISSP_AMS_Step5_ProgressBar}" id="Next5"/>
                    </div>
                </div>
                </apex:form>
                <apex:form >
                    <apex:pageMessages id="theMessages" />
                    <apex:actionFunction action="{!CheckCountryReqments}" name="Check_CountryReqments" reRender="theMessages"/>
                    <apex:outputPanel rendered="{!(List_CountryReqments.size == 0)}">
                        <script>
                         Check_CountryReqments();
                        </script> 
                    </apex:outputPanel>
                <apex:pageblock mode="detail" id="countryreqs" rendered="{!(List_CountryReqments.size > 0)}" title="{!$Label.ISSP_AMS_Step2_Instructions}" >
                    <apex:dataTable value="{!List_CountryReqments}" var="reqs"  style="background-color:white" styleClass="table table-condensed" > 
                        <apex:column headerClass="info">
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                        </apex:column>
                        <apex:column headerClass="info" headerValue="{!$Label.ISSP_AMS_Step2_Check_List} {!amsCountryLabel} - {!IF(BEGINS(sectorValue,'Travel_Agent'), $Label.ISSP_Travel_Agent, newForm.Agent_Type__c)}">
                            <apex:outputText >
                                <strong>{!reqs.Name}</strong><br/>
                                <apex:outputField value="{!reqs.Requirement_text__c}"/>
                            </apex:outputText>
                        </apex:column>
                    </apex:dataTable>
                </apex:pageblock>
                
                    <center>
                    <apex:pageBlock mode="edit">
                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep1}" value="{!$Label.ISSP_Back}" id="Previous"/>
                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep3}" value="{!$Label.ISSP_Next}" id="Next"/>
                    </apex:pageBlock>
                    </center>
                </apex:form>
             </div>   
        </div>
     </apex:outputText>
           
    <!-- ------------------------------ --->
    <!-- STEP 3 Display PAX or Cargo FORM -->
    <!-- ------------------------------- -->
   

    <!-- <apex:include pageName="{!IF(AND(sector=='Travel Agent', isStep3),'ISSP_AMS_Pax_Form',(IF(AND(sector=='Cargo Agent', isStep3),'ISSP_AMS_Cargo_Form','')))}"/> -->
    <apex:include pageName="{!includedPageName}" rendered="{!isStep3}"/>
   
   
    <!-- ---------------------------- -->
    <!-- STEP 4 Upload required docs -->
    <!-- ---------------------------- -->
      
    <apex:include pageName="ISSP_AMS_Upload" rendered="{!isStep4}" />
    
    <!-- ----------------------- -->
    <!-- STEP 5 Submit to IATA  -->
    <!-- ----------------------- -->
    <apex:outputText rendered="{!isStep5}"> 
        <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">{!IF(BEGINS(sectorValue,'Travel_Agent'), $Label.ISSP_AMS_StepsAll_Travel_Title, 'Application for approval as' + IF(OR(BEGINS(newForm.Agent_Type__c, 'I'),BEGINS(newForm.Agent_Type__c, 'E')), ' an ', ' a ') + newForm.Agent_Type__c)}</h3>
            </div>
    <div class="panel-body" id="body-enquiries">
        <apex:form >
        <div class="progress">
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep1}" value="{!$Label.ISSP_AMS_Step1_ProgressBar}" id="Prev1"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep2}" value="{!$Label.ISSP_AMS_Step2_ProgressBar}" id="Prev2"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep3}" value="{!$Label.ISSP_AMS_Step3_ProgressBar}" id="Prev3"/>
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 16%">
                <apex:commandLink styleclass="btn btn-default" action="{!goToStep4}" value="{!$Label.ISSP_AMS_Step4_ProgressBar}" id="Prev4"/>
            </div>
             <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                {!$Label.ISSP_AMS_Step5_ProgressBar}    
            </div>
        </div>
       </apex:form>
        <div class="panel-body" id="body-enquiries">
         <apex:pageMessages />
        <apex:pageBlock rendered="{!AND(BEGINS(sectorValue, 'Cargo_Agent'), OR(newForm.Agent_Type__c=='IATA Cargo Agent', newForm.Agent_Type__c=='EACP Intermediary'))}">
        <apex:outputPanel >
        	<img src="{!URLFOR($Resource.PDF_icon_large)}" style="vertical-align:middle"/>
            <a href="/ISSP_AMS_PDF_CGO?caseId={!newCase.Id}&mode=pdf" target="_new">download a PDF version</a> of your {!newForm.Agent_Type__c} {!amsOfficeType} application.
        </apex:outputPanel>
            <br/>
	 <apex:variable var="cnt" value="{!0}" />
    	<apex:repeat value="{!List_CountryReqments}" var="reqs">
        <apex:variable var="cnt" value="{!cnt+1}"/>
        	<c:ISSP_AMS_FormUpload reqCnt="{!cnt}" 
            reqRequired="{!reqs.File_to_Upload__c}" 
            reqName="{!reqs.Name}" 
            reqDescription="{!reqs.Requirement_text__c}"
            reqIdentifier="{!reqs.File_Identifier2__c}"
        	/>
    	</apex:repeat>
       </apex:pageBlock>
       
      <apex:form id="FinalForm">
        <apex:pageBlock rendered="{!BEGINS(sectorValue,'Travel_Agent') && !isNoticeOfChange}">
            <apex:facet name="header">
                <apex:outputPanel style="margin:20px 0px;font-size:110%" rendered="{!BEGINS(sectorValue, 'Travel_Agent')}">
                    <apex:outputText escape="false" value="{!$Label.ISSP_AMS_Step5_ReviewBeforeSubmit}"/>
                </apex:outputPanel>
               </apex:facet>
            <br/>
            
        </apex:pageBlock>  
        </apex:form>

        <apex:outputPanel rendered="{!BEGINS(sectorValue,'Travel_Agent') && !isNoticeOfChange}">
        <div class="col-md-12"></div>
            <div class="apcontainer">
                <apex:include pageName="{!includedSummaryPage}" rendered="{!isStep5}" />
                <apex:form >
                <apex:pageBlock >
                <apex:pageBlockSection title="{!$Label.ISSP_TC_Accept}" columns="1" rendered="{!BEGINS(sectorValue, 'Travel_Agent')}">
                    <div class="aplabel">
                        <apex:outputText escape="false" value="{!IF(amsOfficeType=='HO', $Label.ISSP_AMS_T_Cs1, $Label.ISSP_AMS_Pax_Branch_T_Cs)}"/>      
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_T_Cs2}"/>      
                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_T_Cs3}"/>                    
                    </div>
                    <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true"/> 
                </apex:pageBlockSection> 
                <br/>
                <div style="text-align:center;">
                    <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}"/>
                    <apex:commandButton action="{!goToFinalStep}" value="{!$Label.ISSP_AMS_Submit_IATA}"/>
                    <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right"/>
                </div>
                </apex:pageBlock> 
                </apex:form> 
            </div> 
        </apex:outputPanel> 
         <br/>
        <apex:form >
        <apex:pageBlock rendered="{!BEGINS(sectorValue,'Cargo_Agent') && !isNoticeOfChange}">
            <apex:facet name="header">
                <apex:outputPanel style="margin:20px 0px;font-size:110%">
                    <apex:outputText escape="false" value="You can also review your online application below before uploading a signed, scanned PDF copy above."/>
                </apex:outputPanel>
               </apex:facet>
        </apex:pageBlock>
       </apex:form>
       <apex:outputPanel rendered="{!BEGINS(sectorValue,'Cargo_Agent') && !isNoticeOfChange}">
       <div class="col-md-12"></div>
        <div class="apcontainer">
            <apex:include pageName="{!includedSummaryPage}" rendered="{!isStep5}" />
        </div>
        <apex:form >
        <apex:pageBlock >
        <!--Accept terms and conditions for CGO--> 
        <c:ISSP_AMS_CGO_T_Cs ></c:ISSP_AMS_CGO_T_Cs>
        <apex:pageBlockSection columns="1">
           <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true"/>             
         </apex:pageBlockSection>
          <br/>
       <div style="text-align:center;">
            <apex:commandButton action="{!goToStep4}" value="{!$Label.ISSP_Back}"/>
            <apex:commandButton action="{!goToFinalStep}" value="{!$Label.ISSP_AMS_Submit_IATA}"/>
            <apex:commandButton action="{!saveAMSFormAndLeave}" value="{!$Label.ISSP_Save_Draft}" style="float:right"/>
        </div>
        </apex:pageBlock>
       </apex:form>
        </apex:outputPanel>
       
     </div>
     </div>   
     </div>
        
     </apex:outputText>      
      
    <!-- -------------------------------------- -->
    <!-- STEP 6 Check the created case details- -->
    <!-- -------------------------------------- -->
           
    <apex:pageBlock rendered="{!isFinalStep}" mode="maindetail">
       <div style="color:#000000; font-size:14px; padding-bottom:10px; padding-top:10px;margin-left:200px">
           <strong>{!IF(BEGINS(sectorValue, 'Travel_Agent'),
               IF(amsOfficeType=='HO', $Label.ISSP_AMS_StepFinal_Thanks, $Label.ISSP_AMS_StepFinal_Pax_Branch_Thanks),
               IF(amsOfficeType=='HO',
               'Thank you for submitting your Accreditation application for your Cargo Agency Head Office.',
               'Thank you for submitting your Accreditation application for your Cargo Agency Branch Office.')
               )}</strong>
           <br/> <br/> 
            {!$Label.ISSP_AMS_StepFinal_Your_CaseNumber} <a href="/ISSP_Case?caseId={!newCase.Id}" target="_blank">{!newCase.CaseNumber}</a>.
            <br/><br/>
                <a href="/ISSP_Case?caseId={!newCase.Id}" target="_blank">{!$Label.ISSP_AMS_StepFinal_Access_Direct}</a>&nbsp;{!$Label.ISSP_AMS_StepFinal_Access_Direct2}
            <br/><br/>
           {!$Label.ISSP_AMS_StepFinal_In_Addition} <a href="/ISSP_CaseList" target="_blank">{!$Label.ISSP_AMS_StepFinal_In_Addition2}</a>.
            <br/><br/><br/><br/>
            <!---
            <a href="/ISSP_APCases?retURL=/ISSP_Homepage"><apex:image value="https://iata--preprod--c.cs18.content.force.com/servlet/servlet.ImageServer?id=01511000000UHn7&oid=00D1100000Bzzsg&lastMod=1425387500000" width="60" height="60" style="vertical-align: middle;"/></a>&nbsp;<b>Create new BSP / CASS Joining application.</b>
            -->
            <apex:form rendered="{!OR(BEGINS(sectorValue, 'Travel_Agent'), AND(BEGINS(sectorValue, 'Cargo_Agent'), newForm.Agent_Type__c!='IATA Cargo Agent', newForm.Agent_Type__c!='EACP Intermediary'))}">
                 <apex:pageBlockSection >
                     <apex:pageBlockSectionItem >
                         <apex:image value="{!URLFOR($Resource.PDF_icon_large)}"/>
<!--                          <apex:outputLink value="/ISSP_AMS_PDF_ApplicationForm?caseId={!newCase.Id}" id="amsFormLink" target="_new">
                             {!$Label.ISSP_AMS_Download_PDF_Copy}
                        </apex:outputLink> -->
                                        <apex:commandLink action="{!redirectToPDF}" value="{!$Label.ISSP_AMS_Download_PDF_Copy}" styleClass="hist-submitButton" style="color: #ffffff" id="theCommandLink" target="_new"/>
                     </apex:pageBlockSectionItem>
                 </apex:pageBlockSection>

            </apex:form>
        </div>
    </apex:pageBlock>
           
         </div>
         <c:ISSP_CustomFooter />
         </div>
       
    </body>  
</html>

</apex:page>