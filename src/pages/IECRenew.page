<apex:page title="Renew" controller="vfIECRenew" cache="false" sidebar="false" showHeader="false" standardStylesheets="false" action="{!pageLoad}">
 <title>Renew</title>
   
    <div class="gdpwrapper">    
    <div class="gdpbody">
        
    <apex:includeScript value="{!$Resource.postmessage_js}" />
    <apex:includeScript value="{!$Resource.IECjQuery172}" />
    <apex:outputPanel id="panelHeader" layout="block">
    	<c:IECSiteHeader id="componentHeader" />
    	
    <!-- only used for confirmation divs -->
    <apex:stylesheet value="{!URLFOR($Resource.IECStyles, 'register.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.IECStyles, 'cart.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.IECStyles, 'renew.css')}" />
    
    </apex:outputPanel>
    <style>
    
    #cart .checkout-wrapper .checkout-info tr td:first-child {
		padding-left: 15px;
		padding-right: 15px;
		}
    
    .paymentMethodRadio {
	padding-top: 15px;
	}
	.checkout-wrapper .checkout-submit{
	margin: 0px 0 0 auto;
}

    </style>
    <script type="text/javascript"> 
        var newPaymentMethod = null;


        function disablePaymentButtons() {
           	var proceedButton = this.document.getElementById('{!$Component.formRenew.buttonProceedPayment}');
	       	var proceedNewCardButton = this.document.getElementById('{!$Component.formRenew.buttonProceedWithNewCard}');
	            
	       	changeCursorProgress(proceedButton);
	       	changeCursorProgress(proceedNewCardButton);

	       	disableControl(proceedButton);
	       	disableControl(proceedNewCardButton);
        }

        function enablePaymentButtons() {
           	var proceedButton = this.document.getElementById('{!$Component.formRenew.buttonProceedPayment}');
	       	var proceedNewCardButton = this.document.getElementById('{!$Component.formRenew.buttonProceedWithNewCard}');
	            
	            
	      	changeCursorDefault(proceedButton);
	      	changeCursorDefault(proceedNewCardButton);

	       	//enableControl(proceedButton);
	       	enableControl(proceedNewCardButton);
	       	
	       	togglePaymentMethodType();
        }



        function proceedToPayment() {
            var pmType = getSelectedPaymentMethodType();

            // check if a new payment method was entered
            if (pmType == 'CREDIT_CARD' && getSelectedCreditCardPaymentMethodId() == 'NEW') {
                // submit HPM iFrame
                submitHostedPage('z_hppm_iframe');
            }
            else {
                proceedToPaymentBackend();
                disablePaymentButtons();
            }
        }
                
        function proceedToAddNew() {
			submitHostedPage('z_hppm_iframe');
     	}        
        
        function getSelectedPaymentMethodType() {
        	for (i = 0; i < document.getElementsByName('radiopaymentmethodtype').length; i++) {
                if(document.getElementsByName('radiopaymentmethodtype')[i].checked == true) {
                    var pmType = document.getElementsByName('radiopaymentmethodtype')[i].value;
                    return pmType;
                    break;
                }
            }
            return null;
        }
        
        function getSelectedCreditCardPaymentMethodId() {
            for (i = 0; i < document.getElementsByName('radiopaymentmethodid').length; i++) {
                if(document.getElementsByName('radiopaymentmethodid')[i].checked == true) {
                    var pmValue = document.getElementsByName('radiopaymentmethodid')[i].value;
                    return pmValue;
                    break;
                }
            }
            return null;
        }
        
        function callbacksuccess(pmid) {
            setSelectedCreditCardPaymentMethodId(pmid);
            proceedToPaymentBackend();
        }
        
        function callbackfailure( paramString ) {          
        	displayCallBackfailureJS(paramString);
        }
        
        function setSelectedCreditCardPaymentMethodId(paymentMethodId) {
            this.document.getElementById('{!$Component.formRenew.hiddenSelectedCreditCardPaymentId}').value = paymentMethodId;
        }
        
        function togglePaymentMethodType() {

			var btnProceedPayment = this.document.getElementById('{!$Component.formRenew.buttonProceedPayment}');
        
        	var creditCardSelected = (getSelectedPaymentMethodType() == 'CREDIT_CARD');
        	var ICHSelected = (getSelectedPaymentMethodType() == 'ICH');
        	
        	if (ICHSelected) {
        		btnProceedPayment.disabled = false;
        	}
        	else if (creditCardSelected) {
        		btnProceedPayment.disabled = (getSelectedCreditCardPaymentMethodId() == null);
        	}
        	else {
	        	btnProceedPayment.disabled = true;
        	}
        	
        	        	
        	// enable or disable the credit card radios based on the payment type selected
        	var creditCardRadios = document.getElementsByName('radiopaymentmethodid');
			for (var i = 0, length = creditCardRadios.length; i < length; i++) {
			    creditCardRadios[i].disabled = !creditCardSelected;
			}
			
			// hide Auto-Renew for Bank Transfer
			//if (getSelectedPaymentMethodType() == 'BANK_TRANSFER') {
			//	this.document.getElementById('{!$Component.formRenew.panelAutoRenew}').style.display = 'none';
			//}
			//else {
			//	this.document.getElementById('{!$Component.formRenew.panelAutoRenew}').style.display = '';
			//}
			
			// Show credit-card options only when Credit Card is selected
			if (this.document.getElementById('{!$Component.formRenew.panelCreditCard}') != null) {
				if (creditCardSelected) {
					this.document.getElementById('{!$Component.formRenew.panelCreditCard}').style.display = '';
				}
				else {
					this.document.getElementById('{!$Component.formRenew.panelCreditCard}').style.display = 'none';
				}
			}

			// store payment method type in hidden field
			this.document.getElementById('{!$Component.formRenew.hiddenSelectedPaymentType}').value = getSelectedPaymentMethodType();
			
			//resizeIFrame();
        }
        
        function resizeIFrame() {
        	if (this.document.getElementById('z_hppm_iframe') == null || this.document.getElementById('z_hppm_iframe') == 'undefined')
        		return;
        		
        	if (getSelectedCreditCardPaymentMethodId() == 'NEW') {
        		this.document.getElementById('z_hppm_iframe').height="390";
        	}
        	else {
        		this.document.getElementById('z_hppm_iframe').height="0";
        	}
        }
        
        function changeTextColor(object) {
        	
        	if (object.value == null || object.value == '') {
        		object.style.color = '#aaa';
        	}
        	else
        	{
        		object.style.color = '#000';
        	}
        }            
        
    </script>
    <apex:form id="formRenew" forceSSL="true">
     
          <div id="cart">
      
      
     	 <!-- Static caousel -->
		  	<div class="carouselWrapper static">
		
		    <div class="gradient"></div>
		
		    <div class="carousel">
		      <ul class="carousel__list">
		
          		<li class="carousel__slide" style="background-image:url({!$Resource.IECBannerHome}); width: 1263px;">
		         <div class="autoAdjustMargin">
		            <div class="carousel__slide-wrapper">
		              <!--<h1>About Us</h1>-->
		              <h2 class="carousel__slide-text -heading"><span>Renew your subscription</span></h2>
		                    <br/>
             		 <a class="carousel__slide-anchor customButton" style="color: #373C41;background: #fff;color: black;" href="mailto:globaldata@iata.org?subject=eCommerce">Contact us</a>
		            </div>
		          </div>
		        </li>
		        
		      </ul>
		    </div>
		  </div> 
		  
     
<!--        <div class="sepEmptyDiv"></div> -->
       
     
     
        <apex:inputHidden value="{!selectedCreditCardPaymentId}" id="hiddenSelectedCreditCardPaymentId" />
        <apex:inputHidden value="{!selectedPaymentMethodType}" id="hiddenSelectedPaymentType" />

    	<apex:actionFunction action="{!refreshRenewTotal}" name="refreshRenewTotal" rerender="panelTaxes, panelPaymentMethods, errorMessage" status="calculatingTaxesStatus" />
    	<apex:actionFunction action="{!proceedToPayment}" name="proceedToPaymentBackend" rerender="panelRenewPage" status="proceedingToPaymentStatus"/>
    	<apex:actionFunction action="{!displayCallBackfailure}" name="displayCallBackfailureJS" rerender="errorMessage, panelHPM">
    		<apex:param name="errMsg" value="" assignTo="{!sErrorMsgFromHPM}"/>
    	</apex:actionFunction>
    	
        <apex:outputPanel id="panelRenewPage" layout="block" style="margin:15px">
            <apex:outputPanel id="errorMessage">
            	<div class="errorPanel">
	                <apex:pageMessages escape="no"/>
            	</div>
            </apex:outputPanel>
            
            
            
            <apex:outputPanel id="panelRenew" layout="block" rendered="{!NOT(paymentSucessful)}" style="width: 100%">
            <div class="content-container tab">
				<!-- Links after the renew -->						
  				<apex:outputPanel id="shoppingCart_contentPanel" layout="block" rendered="{!subscriptionObj != null && subscriptionCharge != null && subscriptionChargeQuantity > 0}">
  				
  					<div class="content-container">
  	
    					<div class="checkout-wrapper">
      					
      						<div class="checkout-total">
          						<table class="checkout-table">
            						<thead>
            						<tr>
		              					<th class="checkout-table__heading -item">
		              					<div style="width:100%; text-align: left;padding-left: 0px">Product Name</div></th>
    		         					<th class="checkout-table__heading -price">Unit Price</th>
        		      					<th class="checkout-table__heading -price">Quantity</th>
        		      					 <th class="checkout-table__heading -price">Total</th>
        		      				</tr>
									</thead>            
            						<tbody>
										<tr>
											<td>
						       		 			<apex:outputText styleClass="checkout-table__item-text" value="{!subscriptionCharge.Zuora__ProductName__c}" />
						       		 			<apex:outputText styleClass="checkout-table__item-text" value="{!subscriptionCharge.Zuora__RatePlanName__c}" />
						       		 			
						       		 			 <span class="endDate">												
														<apex:outputText style="color: #1ebec8; font-size: 14px; font-weight: 700;line-height: 20px;" value="New end date: {0,date,dd MMM yyyy}">
						       				 				<apex:param value="{!renewalEndDate}" />
						       		 					</apex:outputText>
												</span>
											</td>
											<td>
						       		 			<apex:outputText styleClass="checkout-table__price" value="${0, number,###,###,##0.00}">
						       		 				<apex:param value="{!subscriptionCharge.Zuora__Price__c}"/>
						       		 			</apex:outputText>
											</td>
											<td>
				                        		<apex:outputText styleClass="checkout-table__price" value="{!subscriptionChargeQuantity}" /> 
					       		 			</td>
											<td>
												<apex:outputText styleClass="checkout-table__price" style="font-weight: 700;" value="${0, number,###,###,##0.00}">
						       		 				<apex:param value="{!subscriptionCharge.Zuora__Price__c}"/>
						       		 			</apex:outputText>
					       		 			</td>
										</tr>
										
										
										
    	       						</tbody>
            					</table>


								<!-- Sub total, tax and grand total -->
			    	        	<apex:outputPanel id="panelTaxes" layout="block" styleClass="checkout-taxesPanel" >
									<table class="checkout-table">	
										<tbody>
							    	        <tr class="checkout-table__row">
	    	            						<td colspan="2">
    	    	          							<h4 class="checkout-table__total-heading">Subtotal</h4>
        	    	    						</td>
	                							<td class="checkout-table__total">
				            						<apex:actionStatus id="calculatingTaxesStatus">
				            							<apex:facet name="start">
				            								<div style="width:100%; height: 100%;opacity:0.75; filter:alpha(opacity=75);"> 
				    	                        				<img src="{!$Resource.IEC_progress}" border="0" width="43" height="15" />
				        	                    			</div>
				            	            			</apex:facet>
				            						</apex:actionStatus>			        				              					
        	    	    						</td>
            	    							<td class="checkout-table__total">
			            							<apex:outputText value="${0, number,###,###,##0.00}">
			            								<apex:param value="{!renewTotalBeforeTax}"/>
			            							</apex:outputText><br />
                								</td>
             								</tr>
		
		
		
					            			<tr class="checkout-table__row">
	        	        						<td colspan="3">
    	        	      							<h4 class="checkout-table__total-heading">Taxes</h4>
                								</td>
                								<td class="checkout-table__total">
    							            		<apex:outputText value="${0, number,###,###,##0.00}">
			        					    			<apex:param value="{!renewTax}"/>
			            							</apex:outputText><br />
        	        							</td>
            	 							</tr>
	
	
	
    	          							<tr class="checkout-table__row">
        	        							<td colspan="3">
	            	      							<h4 class="checkout-table__total-heading">Order total</h4>
                								</td>
                								<td class="checkout-table__total">
								            		<apex:outputText value="${0, number,###,###,##0.00}">
			        					    			<apex:param value="{!renewTotal}"/>
			            							</apex:outputText><br />
        	        							</td>
            	  							</tr>
	
											<!-- 
    	          							<tr class="checkout-table__row">
        	        							<td colspan="3">
	            	      							<h4 class="checkout-table__total-heading">Purchase Order Number</h4>
                								</td>
                								<td class="checkout-table__total">
                									<apex:inputText id="txtPO" value="{!sPurchaseOrder}" styleClass="checkout-input" maxlength="40"/>
        	        							</td>
            	  							</tr>
            	  							
            	  							-->
			        	   				</tbody>
    	      						</table>
	    	      				</apex:outputPanel>
								
								
								
					 <div class="clear"></div>

                        <div class="cancelButton">
                          <apex:commandButton styleClass="customButton small" style="width: 245px;background: #c8c8c8;padding-left: 80px;padding-right: 80px; color:white; margin-top: -20px; cursor: pointer;" value="Cancel" action="{!onClickCancel}"/>
                        </div>
                        
                        

								 <apex:outputPanel id="panelPONumber" layout="block"  styleClass="checkout-submitPanel"  >                                    
							                    <br/>
							                     <div id="test" style="background-color: #efefef; width: 106%; padding: 0px; margin-left: -17px;  border: 1px solid #ccc;   border-left: 0px; border-right: 0px;   box-sizing: border-box; height: 20px;"> &nbsp;</div>
							                                                     
						                        <table class="checkout-table">  
						                        
							                          <tr >
								                           <td class="checkout-table__item">
								                          	<span>
								                           		<!-- img class="checkout-table__icon" src="https://icons.iconarchive.com/icons/visualpharm/icons8-metro-style/256/Accounting-Purchase-order-icon.png"/> -->
								                               	<h2 class="checkout-info__billingdetails-label">Purchase Order Number to appear on your invoice </h2>
								                            </span>
								                           </td>
								                           <td>
								                                <apex:inputText id="txtPO" value="{!sPurchaseOrder}" styleClass="checkout-input" maxlength="40"/>		                                   
								                           </td>
							                        </tr>
						                      </table>      
			                  </apex:outputPanel>   	

          						
            				</div>
            				
           				<apex:outputPanel id="panelPurchaseSteps" layout="block">
           					<div class="checkout-info">
	           			
	           			
	           						<!-- Billing address -->
           							<div class="checkout-info__section -short">  
										<apex:commandlink rendered="{!NOT(bExpandedBilling)}" action="{!toggleBilling}" value="Billing Details" rerender="panelPurchaseSteps" styleClass="checkout-info__heading -link"/>
																
	        	   						<apex:outputPanel id="panelContactInfo" layout="block" rendered="{!bExpandedBilling}">
											<h2 class="checkout-info__heading">Billing Details</h2>		
										 
							        		<apex:outputPanel id="errorMessageContactInfo">
						                		<apex:pageMessages escape="no" />
					    	        		</apex:outputPanel>
					        	    		<apex:outputText rendered="{!needToFillContactInfo}">
					            				<p class="checkout-info__subHeading">Please fill your contact information in order to continue</p>
						            		</apex:outputText>
						            		
						            		<!-- Non editable Contact and Billing Address Information -->
	        	   							<apex:outputPanel id="panelReadOnlyContactInfo" layout="block" rendered="{!NOT(inEditContactInfo)}">
												<table  style="width:100%; margin-left:20px;">

                                                    <tr>
                                                        <td colspan="2">
                                                            &nbsp;
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td colspan="2" class="checkout-info__billingdetails-value" style="font-size: 17px; font-family: 'Raleway', sans-serif;font-weight: 700;color: #1ebec8;">{!oAccount.Name}</td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td colspan="2" class="checkout-info__billingdetails-value">
                                                            <span style="display:{!IF(NOT(oContact.Salutation == ''), '', 'none')}">{!oContact.Salutation}&nbsp;</span>
                                                            {!oContact.FirstName}&nbsp;{!oContact.LastName}
                                                        </td>
                                                    </tr>
                                                    
													<tr>
														<td colspan="2">
															<p class="checkout-info__subHeading">Billing Address</p>
														</td>
													</tr>
													<tr>
														<td colspan="2" class="checkout-info__billingdetails-value">{!oBillingAddress.Street__c}</td>
													</tr>
                                                    <tr>
                                                        <td colspan="2" class="checkout-info__billingdetails-value">
                                                        	{!oBillingAddress.City__c}
                                                        	<span style="display:{!IF(NOT(oBillingAddress.City__c == ''), '', 'none')}">,&nbsp;</span>
                                                        	{!oBillingAddress.ISO_State_Name__c}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2" class="checkout-info__billingdetails-value">
                                                            {!oBillingAddress.ZipCode__c}
                                                            <span style="display:{!IF(NOT(oBillingAddress.ZipCode__c == ''), '', 'none')}">-&nbsp;</span>
                                                            {!oBillingAddress.ISO_Country_Name__c}
                                                        </td>
                                                    </tr>
													<apex:outputPanel id="panelVATReadOnly" layout="none" rendered="{!vatConfig <> NULL}">
														<tr>
															<td colspan="2">
																<p class="checkout-info__subHeading">Tax Information</p>
															</td>
														</tr>
                                                        <apex:outputPanel id="panelTax1ReadOnly" layout="none" rendered="{!vatConfig.ShowTax1}">
                                                            <tr>
                                                                <td class="checkout-info__billingdetails-label">{!vatConfig.Tax1Label}</td>
                                                                <td class="checkout-info__billingdetails-value">{!IF(vatConfig.VATValidationRequired, vatConfig.CountryCode, '')}{!oContact.Tax_1_ID__c}</td>
                                                            </tr>
                                                        </apex:outputPanel>
                                                        <apex:outputPanel id="panelTax2ReadOnly" layout="none" rendered="{!vatConfig.ShowTax2}">
                                                            <tr>
                                                                <td class="checkout-info__billingdetails-label">{!vatConfig.Tax2Label}</td>
                                                                <td class="checkout-info__billingdetails-value">{!oContact.Tax_2_ID__c}</td>
                                                            </tr>
                                                        </apex:outputPanel>
													</apex:outputPanel>
												</table>
												<apex:commandButton styleClass="checkout-submit -fixed100" id="btnModifyContactInfo" value="Modify" action="{!modifyContactInfo}" rerender="panelContactInfo, panelTCs, panelAutoRenew, panelMETApaymentMethods, panelSubmitButton" />
											</apex:outputPanel>
											
											
											<!-- Editable Contact and Billing Information -->
											<apex:outputPanel id="panelEditContactInfo" layout="block" rendered="{!inEditContactInfo}">
												<table style="width:100%;">
													<tr>
														<td colspan="2">
															<p class="checkout-info__subHeading">Contact Details</p>
														</td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">First Name<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oContact.FirstName}" styleClass="login__input -required" html-placeholder="First Name" title="First Name" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Last Name<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oContact.LastName}"  styleClass="login__input -required" html-placeholder="Last Name" title="Last Name" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Title<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oContact.Title}"  styleClass="login__input -required" html-placeholder="Job Title" title="Job Title" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Phone<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oContact.Phone}"  styleClass="login__input -required" html-placeholder="Phone" title="Phone" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Email<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oContact.Email}"  styleClass="login__input -required" html-placeholder="Email"  title="Email" disabled="{!IF(oContact.Email=='', 'false', 'true')}"/></td>
													</tr>
													<tr>
														<td colspan="2">
															<p class="checkout-info__subHeading">Billing Address</p>
														</td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Street<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oBillingAddress.Street__c}"  styleClass="login__input -required" html-placeholder="Address" title="Address" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">City<span class="required">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oBillingAddress.City__c}"  styleClass="login__input -required" html-placeholder="City" title="City" /></td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Country<span class="required">*</span></td>
														-->
														<td colspan="2">
															<apex:selectList style="color: {!IF(oBillingAddress.ISO_Country__c != null, '#000', '#aaa')}" value="{!oBillingAddress.ISO_Country__c}" size="1"  styleClass="login__input -required">
							            	                	<apex:selectOptions value="{!lstISOCountries}"/> 
							                	            	<apex:actionsupport event="onchange" action="{!onChangeBillingCountry}" rerender="panelEditContactInfo, panelVATEdit, panelBillingStatesProvince" />
							                    	    	</apex:selectList>
								                        </td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">State/Province<span class="required" style="display:{!IF(oBillingAddress.ISO_Country_Name__c == 'Canada' || oBillingAddress.ISO_Country_Name__c == 'United States', '', 'none')}">*</span></td>
														-->
														<td colspan="2">
															<apex:outputPanel id="panelBillingStatesProvince" layout="inline" rendered="{!bStateAvailable}">
																<apex:selectList title="State/Province" onchange="changeTextColor(this);" style="color: {!IF(oBillingAddress.ISO_State__c != null, '#000', '#aaa')}" value="{!oBillingAddress.ISO_State__c}" size="1" styleClass="login__input -required">
							            	                		<apex:selectOptions value="{!lstStateProvince}" />
							                	        		</apex:selectList>
						        	                		</apex:outputPanel>
														</td>
													</tr>
													<tr>
														<!-- 
														<td class="checkout-info__billingdetails-label">Zip/Postal code<span class="required" style="display:{!IF(oBillingAddress.ISO_Country_Name__c == 'Canada' || oBillingAddress.ISO_Country_Name__c == 'United States', '', 'none')}">*</span></td>
														-->
														<td colspan="2"><apex:inputText value="{!oBillingAddress.ZipCode__c}" styleClass="login__input" html-placeholder="Zip/Postal code"  /></td>
													</tr>
													<apex:outputPanel id="panelVATEdit" layout="none" rendered="{!vatConfig <> NULL}">
														<tr>
															<td colspan="2">
																<p class="checkout-info__subHeading">Tax Information</p>
															</td>
														</tr>
														<apex:outputPanel id="panelTax1Edit" layout="none" rendered="{!vatConfig.ShowTax1}">
															<tr>
														<!-- 
																<td class="checkout-info__billingdetails-label">{!vatConfig.Tax1Label}<apex:outputPanel id="panelTax1Required" rendered="{!vatConfig.TaxIDMandatory}"><span class="required">*</span></apex:outputPanel></td>
														-->
																<td colspan="2">
																	<apex:outputPanel rendered="{!vatConfig.VATValidationRequired}">
											                            <table style="width:100%">
											                            	<tr>
											                            		<td style="width:40px;padding-left: 0px;">
														                            <apex:inputText styleClass="login__input" value="{!vatConfig.CountryCode}" disabled="true" />
										        	                    		</td>
										        	                    		<td style="width:5px">&nbsp;</td>
										                	            		<td>
													        	                    <apex:inputText styleClass="login__input -required" value="{!oContact.Tax_1_ID__c}" maxlength="20" html-placeholder="{!vatConfig.Tax1Label}" title="{!vatConfig.Tax1Label}"/>
										                        	    		</td>
										                            		</tr>
										                            	</table>
										                            </apex:outputPanel>
																	<apex:inputText maxlength="20" value="{!oContact.Tax_1_ID__c}"  styleClass="login__input" html-placeholder="{!vatConfig.Tax1Label}" title="{!vatConfig.Tax1Label}" rendered="{!NOT(vatConfig.VATValidationRequired)}"/>
																</td>
															</tr>
														</apex:outputPanel>
														<apex:outputPanel id="panelTax2Edit" layout="none" rendered="{!vatConfig.ShowTax2}">
															<tr>
														<!-- 
																<td class="checkout-info__billingdetails-label">{!vatConfig.Tax2Label}<apex:outputPanel id="panelTax2Required" rendered="{!vatConfig.TaxIDMandatory}"><span class="required">*</span></apex:outputPanel></td>
														-->
																<td colspan="2"><apex:inputText maxlength="20" value="{!oContact.Tax_2_ID__c}"  styleClass="login__input" html-placeholder="{!vatConfig.Tax2Label}"  title="{!vatConfig.Tax2Label}" /></td>
															</tr>
														</apex:outputPanel>
													</apex:outputPanel>
												</table>
												<apex:commandButton styleClass="checkout-submit -fixed100" value="Save new details" action="{!updateContactInfo}" rerender="errorMessageContactInfo, panelContactInfo, panelTCs, panelAutoRenew, panelMETApaymentMethods, panelSubmitButton, panelReadOnlyContactInfo" oncomplete="refreshRenewTotal();" />
												<apex:commandButton styleClass="checkout-submit -fixed100" value="Cancel" action="{!cancelUpdateContactInfo}" rerender="errorMessageContactInfo, panelContactInfo, panelTCs, panelAutoRenew, panelMETApaymentMethods, panelSubmitButton" rendered="{!NOT(needToFillContactInfo)}" />
											</apex:outputPanel>
				           				
			    	       				</apex:outputPanel>	       
	           						</div>    
	           			
	           			
	           			
	       				    	<!-- Terms & conditions -->
           						<apex:outputPanel id="panelTCs" layout="block" styleClass="collapsableSection">
									<apex:outputPanel layout="block" rendered="{!NOT(needToFillContactInfo || inEditContactInfo)}">
	       								<div class="checkout-info__section -short">           				
											<apex:commandlink rendered="{!NOT(bExpandedTCs)}" action="{!toggleTCs}" value="Terms and Conditions" rerender="panelPurchaseSteps" styleClass="checkout-info__heading -link"/>
	    									<apex:outputPanel rendered="{!bExpandedTCs}">
												<h2 class="checkout-info__heading">Terms and Conditions</h2>
												<p class="checkout-info__subHeading" style="text-transform: none;">Please read the Terms and Conditions before checkout</p>
												<br/>
												<div style="margin-left:15px;">
												<c:IECTermsAndConditions ProductInformationIDs="{!listProductInformationIDs}" IECPageController="{!this}" ComponentKey="{!TC_COMPONENT_KEY}" RerenderComponentId="{!$Component.formRenew.panelPurchaseSteps}" />
												</div>
	    									</apex:outputPanel>
		        	   					</div>
		           					</apex:outputPanel>
           						</apex:outputPanel>
	           			

	           				
	           				<!-- Auto-renew -->
	           				<apex:outputPanel id="panelAutoRenew" layout="block">
	           					<apex:outputPanel layout="block"  rendered="{!hasAcceptedAllTnCs && NOT(inEditContactInfo)}">
       							<div class="checkout-info__section -short">       
									<apex:commandlink rendered="{!NOT(bExpandedAutoRenewal)}" action="{!toggleAutoRenew}" styleClass="checkout-info__heading -link" value="Auto Renewal" rerender="panelPurchaseSteps" />
   									<apex:outputPanel rendered="{!bExpandedAutoRenewal}">
       							    				
		    		       				<h2 class="checkout-info__heading">Auto Renewal</h2>
		    		       				<p class="checkout-info__subHeading" style="text-transform: none;">Do you want your subscription(s) to auto-renew?</p>
	    			       				<br/>
	        	   						<table class="checkout-table">
											<apex:repeat id="repeaterAutoRenew" var="autoRenew" value="{!lstLineItemAutoRenew}">
												<tr class="checkout-table__row">
													<td style="width: 70%;">
														<label class="checkout-info__checkbox-label" >
															<apex:outputText value="{!autoRenew.lineItem.Zuora__ProductName__c}"/>
															<br/>
															<apex:outputText styleClass="ratePlanName" style="font-family: inherit !important; font-size: 15px;" value="{!autoRenew.lineItem.Zuora__RatePlanName__c}"/>
						            					</label>
													</td>
													<td>
														<apex:selectRadio value="{!autoRenew.autoRenewFlag}" html-name="radAutoRenew{!autoRenew.lineItem.Id}"  styleClass="checkout-info__checkbox-label" style="font-family: inherit !important; font-size: 15px;">
															<apex:selectOption itemValue="true" itemLabel="Yes" />
															<apex:selectOption itemValue="false" itemLabel="No" />
															<apex:actionsupport event="onchange" rerender="panelMETApaymentMethods, errorMessage" /> 
														</apex:selectRadio>
													</td>
												</tr>
											

											</apex:repeat>
										</table>
									</apex:outputPanel>
								</div>
								</apex:outputPanel>
       						</apex:outputPanel>

							<div class="checkout-info__mobile-divider"></div>
	           				           				
	           				<!-- Payment Methods -->
	           				<apex:outputPanel id="panelMETApaymentMethods" layout="block">
			           				
			           			<apex:outputPanel id="panelPaymentMethods" layout="block" rendered="{!hasAcceptedAllTnCs && hasFilledAutoRenewFlags && NOT(inEditContactInfo)}">
	       							           				
	        						<!-- Payment information -->
					        	    <apex:outputPanel id="panelPayment" layout="block">
					        	    	<div class="checkout-info__section">
										<apex:commandlink rendered="{!NOT(bExpandedPaymentMethod)}" styleClass="checkout-info__heading -link" action="{!togglePaymentMethod}" value="Payment Methods" rerender="panelPurchaseSteps" />
										<apex:outputPanel rendered="{!bExpandedPaymentMethod}">
					        	    	
						        	    	<h2 class="checkout-info__heading">Payment Methods</h2>
						        	    	<br />
                                           <p Class="checkout-table__price" style="text-transform: none; padding-left: 30px; padding-right: 30px; font-family: 'Raleway', sans-serif; font-weight: 700; color: #969696;">Select an existing payment method or add a new one</p>
						               		<table style="margin-left: 10px;">
									               	<!-- ICH is only available for customer that have an ICH Code -->
									               	<tr style="display:{!IF(hasICHCode,'','none')}">
									               		<td class="paymentMethodRadio">
									               			<!-- work around for SF bug... -->
							    	   	                    <apex:outputPanel rendered="{!defaultPaymentMethodIsICH && isPaymentAvailableWithICH}">
						    	           						<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="ICH" onclick="togglePaymentMethodType()" checked="{!IF(isPaymentAvailableWithICH,'checked','')}" />
					    	            						<apex:variable var="selectedPaymentMethodType" value="ICH" />
						            	   					</apex:outputPanel>
								        	       			<apex:outputPanel rendered="{!not(defaultPaymentMethodIsICH) && isPaymentAvailableWithICH}">
								            	   				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="ICH" onclick="togglePaymentMethodType()" />
								               				</apex:outputPanel>
								               				<apex:outputPanel rendered="{!NOT(isPaymentAvailableWithICH)}">
						        	        					<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="ICH" disabled="disabled" />
							               					</apex:outputPanel>
							                				<span class="checkout-info__checkbox-label">ICH</span>
							                				<span class="checkout-info__checkbox-label" style="padding-left: 14px;">IATA Clearing House</span>
							                				<apex:outputPanel rendered="{!NOT(isPaymentAvailableWithICH)}" styleClass="checkout-info__checkbox-label" style="font-style: italic; padding-left: 10px;">
				                								&nbsp;<br />Minimum amount for payment through ICH is&nbsp;
				                								<apex:outputText value="${0, number,###,###,##0.00}" styleClass="checkout-table__total">
				                									<apex:param value="{!dICHMinAmount}"/>
			    	            								</apex:outputText>
				                							</apex:outputPanel>
									               		</td>
									               		<td></td>
									               	</tr>
						    	    	        	<!-- Bank Transfer is not part of this phase of the project -->
						        	       			<!-- 
								    	           	<tr>
								        	       		<td class="paymentMethodRadio">
								            	   			<!-- work around for SF bug... ->
								                	           <apex:outputPanel rendered="{!defaultPaymentMethodIsBankTransfer && isPaymentAvailableWithBankTransfer}">
						        	        					<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="BANK_TRANSFER" onclick="togglePaymentMethodType()" checked="checked" />
						               						</apex:outputPanel>
							               					<apex:outputPanel rendered="{!not(defaultPaymentMethodIsBankTransfer) && isPaymentAvailableWithBankTransfer}">
									               				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="BANK_TRANSFER" onclick="togglePaymentMethodType()" />
									               			</apex:outputPanel>
									               			<apex:outputPanel rendered="{!NOT(isPaymentAvailableWithBankTransfer)}">
									               				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="BANK_TRANSFER" disabled="disabled" />
							        	        			</apex:outputPanel>
							               					<span class="paymentMethod">Bank Transfer</span>&nbsp;<apex:outputPanel rendered="{!NOT(isPaymentAvailableWithBankTransfer)}" style="font-style: italic; padding-left: 10px;">This payment method has been disabled because it is not allowed for the total renew amount.</apex:outputPanel>
						    	           				</td>
									               		<td></td>
								    	           	</tr>
								        	       	-->
								            	   	<tr>
						        	        			<td class="paymentMethodRadio">
							               					<!-- work around for SF bug... -->
								                  		    <apex:outputPanel rendered="{!not(defaultPaymentMethodIsICH) && not(defaultPaymentMethodIsBankTransfer) && isPaymentAvailableWithCreditCard}">
									               				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="CREDIT_CARD" onclick="togglePaymentMethodType()" checked="checked" />
																<apex:variable var="selectedPaymentMethodType" value="CREDIT_CARD" />
									               			</apex:outputPanel>
									               			<apex:outputPanel rendered="{!(defaultPaymentMethodIsICH || defaultPaymentMethodIsBankTransfer) && isPaymentAvailableWithCreditCard}">
							        	        				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="CREDIT_CARD" onclick="togglePaymentMethodType()" />
							               					</apex:outputPanel>
						    	           					<apex:outputPanel rendered="{!NOT(isPaymentAvailableWithCreditCard)}">
									               				<input type="radio" id="radiopaymentmethodtype" name="radiopaymentmethodtype" value="CREDIT_CARD" disabled="disabled" />
								    	           			</apex:outputPanel>
			                								<span class="checkout-info__checkbox-label">Credit Card</span>
					                						<apex:outputPanel styleClass="checkout-info__checkbox-label" rendered="{!NOT(isPaymentAvailableWithCreditCard)}" style="font-style: italic; padding-left: 10px;">
						                						&nbsp;Maximum amount for payment by credit card is&nbsp;
						                						<apex:outputText value="${0, number,###,###,##0.00}" styleClass="checkout-table__total">
				                									<apex:param value="{!dCreditCardMaxAmount}"/>
			    	            								</apex:outputText>
						                					</apex:outputPanel>
								                			<script>
			                	                    	        togglePaymentMethodType();
				                       		                </script>
			                                  			</td>
							               				<td></td>
							               			</tr>
							               	</table>
							           	</apex:outputPanel>
							   		</div>
						                	
								    <apex:outputPanel id="panelCreditCard" layout="block" rendered="{!isPaymentAvailableWithCreditCard && bExpandedPaymentMethod}">
							        	<div class="checkout-info__section">  	
						                    
						                    
						                    <!-- Existing (credit card) payment methods -->
							                			<apex:outputPanel layout="block" rendered="{!hasPaymentMethods}">
							                				<table  class="checkout-table">
						    	            					<apex:repeat var="pm" value="{!paymentMethods}">
						        	            					<tr  class="checkout-table__row">
						            	        						<td>
												                            <table>
												                              <tr><td>&nbsp;</td></tr>
						                    	        						<tr>
						                        	        						<td colspan="2">
						                            									<!-- work around for SF bug... -->
						                                								<apex:outputPanel rendered="{!(pm.zId == defaultPaymentMethodId)}">
						                                									<input type="radio" id="radiopaymentmethodid" name="radiopaymentmethodid" value="{!pm.zId}" onclick="setSelectedCreditCardPaymentMethodId('{!pm.zId}');togglePaymentMethodType();" checked="checked" />
							                                    							<script>
							                                    								// set the default one as the selected
							                                        							setSelectedCreditCardPaymentMethodId('{!pm.zId}');
							                                       			 					//togglePaymentMethodType();
							                                    							</script>
							                                    						</apex:outputPanel>
							                                    						<apex:outputPanel rendered="{!(pm.zId != defaultPaymentMethodId)}">
						    	                                    						<input type="radio" id="radiopaymentmethodid" name="radiopaymentmethodid" value="{!pm.zId}" onclick="setSelectedCreditCardPaymentMethodId('{!pm.zId}');togglePaymentMethodType();" />
						        	                        							</apex:outputPanel>						                                	
						            	                    							<span class="checkout-info__subHeading">{!IF(pm.zId == defaultPaymentMethodId,'Default','Credit Card')}</span>
						                	                						</td>
						                    	            					</tr>
						                        	        					<tr>
						                            	    						<td  class="checkout-info__creditcard-label" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">Card holder name:</td>
						                                							<td  class="checkout-info__creditcard-value" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">{!pm.CreditCardHolderName}</td>
						                                						</tr>
						                                						<tr>
						                                							<td class="checkout-info__creditcard-label" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">Card Number:</td>
						                                    						<td class="checkout-info__creditcard-value" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">{!pm.CreditCardMaskNumber}</td>
						                                						</tr>
							                                					<tr>
							                                    					<td class="checkout-info__creditcard-label" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">Card Type:</td>
							                                    					<td class="checkout-info__creditcard-value" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">{!pm.creditCardType}</td>
							                                					</tr>
							                                					<tr>
							                                						<td class="checkout-info__creditcard-label" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">Expiration Date:</td>
							                                    					<td class="checkout-info__creditcard-value" style="font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif; text-align: right;">
						    	                                						<apex:outputText value="{0, number,00}"><apex:param value="{!pm.creditCardExpirationMonth}"/></apex:outputText>/{!pm.creditCardExpirationYear}
						        	                            					</td>
						            	                    					</tr>
						                	            						<tr><td>&nbsp;</td></tr>
						                	            					</table>
						                    	    					</td>
						                        					</tr>						                        					
						                    					</apex:repeat>
						                    				</table>
							                			</apex:outputPanel>
						                    
						                    
							                			<!-- New credit card -->
							                			<apex:commandButton id="buttonProceedWithNewCard" value="Pay with new Credit Card" style="padding-left: 10px; padding-right: 10px; margin-left: 19px; width: 265px !important; margin-bottom: -12px; margin-top: 10px;" action="{!showPopup}" rerender="tstpopup" styleClass="checkout-submit"  onclick="disablePaymentButtons()"/>
			    										
			    										<apex:outputPanel id="tstpopup">
    														<apex:outputPanel styleClass="checkout-popupBackground" layout="block" rendered="{!displayPopUp}"/>
        													<apex:outputPanel styleClass="checkout-popup" layout="block" rendered="{!displayPopUp}">

										                	    
										                	    <apex:outputPanel id="panelHPM" layout="block" rendered="{!NOT(hasConfigError)}">
											                	    <apex:outputPanel id="errorMessageHPM">
												                		<apex:pageMessages escape="no" />
											    	        		</apex:outputPanel>
								                        			<iframe id="z_hppm_iframe" name="z_hppm_iframe" width="100%" height="390" src="{!iframeSrc}" frameborder="0"></iframe>
								                    			</apex:outputPanel>
								                    			<apex:outputPanel layout="block" style="margin-left: 20px; height: 100%;" rendered="{!hasConfigError}">
								                        			HPM Configuration error(s) !
								                    			</apex:outputPanel>
            													<br/>
			            										<apex:commandLink value="Cancel" styleClass="checkout-submit_2buttons -left" rerender="tstpopup, errorMessage" action="{!closePopup}"   onclick="enablePaymentButtons()"/>
			            										<apex:commandLink value="Submit" styleClass="checkout-submit_2buttons -right" rerender="errorMessage"  onclick="proceedToAddNew();" />
        													</apex:outputPanel>
    													</apex:outputPanel>							                    
						                    
						                    
						                    
						                    
						                </div>
						         	</apex:outputPanel>
						        </apex:outputPanel>
									
		           				</apex:outputPanel>

		           					<!-- Proceed to Checkout button -->
									<apex:outputPanel id="panelSubmitButton" layout="block" style="text-align: center; margin-bottom: 50px;"  rendered="{!NOT(inEditContactInfo)}">
<!-- 
										<apex:commandButton id="buttonProceedPayment"     value="Proceed to Payment >>" onclick="proceedToPayment()" styleClass="checkout-submit" style="width:100%;" rerender="errorMessage" disabled="{!NOT(hasAcceptedAllTnCs && hasFilledAutoRenewFlags) || (NOT(isPaymentAvailableWithCreditCard) && NOT(isPaymentAvailableWithICH && hasICHCode)) || (selectedPaymentMethodType=='CREDIT_CARD' && (paymentMethods == null || paymentMethods.size == 0 || defaultPaymentMethodId == null || defaultPaymentMethodId=='' )) }"/>
-->										
										<apex:commandButton id="buttonProceedPayment" value="Proceed to Payment >>" onclick="proceedToPayment()" styleClass="checkout-submit" style="width:100%;" rerender="errorMessage" />

										<script>
											togglePaymentMethodType();
										</script>
										
										<br/>
					    				<apex:actionStatus id="proceedingToPaymentStatus">
				        					<apex:facet name="start">
			    	    						<div style="width:100%; height: 100%; opacity:0.75; filter:alpha(opacity=75);">
			        	   							<img style="padding-left: 1px;" src="{!$Resource.IEC_progress}" border="0" width="43" height="11" />
			            	    				</div>
			            					</apex:facet>
			        					</apex:actionStatus>
									</apex:outputPanel>	
					            
	           				</apex:outputPanel>
		           		
		           		
		           				
			           		</div>
		           		</apex:outputPanel>
		           		
            				
            			</div>
            		</div>
            	</apex:outputPanel>
            	
  

		       </div>    	
	        </apex:outputPanel>
        </apex:outputPanel>
        <script type="text/javascript">
        	//resizeIFrame();
	    </script>
    
    </div>
    </apex:form>
    



     </div>
      <div class="gadfooter">
        <!-- Footer -->
        <c:IECSiteFooter />
       </div>
    </div>

    <style> 
	 	html, body {
			height:100%;	
			margin:0;
			padding:0;
		}				
		.gdpwrapper {
			min-height:100%;
			position:relative;
		}
		.gdpbody{
 		 padding-bottom:141px; 
		}
        .gadfooter{
            width:100%;
            height:100px; 
            position:absolute;
            bottom:0;
            left:0;        
        }
  </style>
    
</apex:page>