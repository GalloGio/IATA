<apex:page controller="ISSP_APProcess" showHeader="false" sidebar="false" standardStylesheets="true" applyBodyTag="false" applyHtmlTag="false">
    <script>
    	function toggleChangeFields(myValue) {
            if(document.getElementById(myValue).value=='Change of Address') {
            	if(document.getElementById(myValue).checked) {
    				document.getElementById('{!$Component.APChangesForm.changeblock.AddressFields}').style.display='block';
				} else {
    				document.getElementById('{!$Component.APChangesForm.changeblock.AddressFields}').style.display='none';
				}
            } else if(document.getElementById(myValue).value=='Tax Number') {
            	if(document.getElementById(myValue).checked) {
    				document.getElementById('{!$Component.APChangesForm.changeblock.TaxFields}').style.display='block';
				} else {
    				document.getElementById('{!$Component.APChangesForm.changeblock.TaxFields}').style.display='none';
				}
            } else {
            	if(document.getElementById(myValue).checked) {
    				document.getElementById('{!$Component.APChangesForm.changeblock.MasterTableFields}').style.display='block';
				} else {
    				document.getElementById('{!$Component.APChangesForm.changeblock.MasterTableFields}').style.display='none';
				}
            }
            
        }
    
    function changePercentBox(myBox, myCheckBox, myPanel){
        var thisBox = document.getElementById(myBox);
        var thisCheckBox = document.getElementById(myCheckBox);
        var thisPanel = document.getElementById(myPanel);
        if (thisCheckBox.checked == true){
            thisPanel.style.display='block';
        }
        else{
            thisPanel.style.display='none';
            thisBox.value = '';
        }
    }
    
    </script>
     <style>
         label {margin-left:3px;font-size:12px;}
    </style>
    
    <div class="panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">{!IF(strChangeType=='Minor database changes', 'Airline Participation Change Request', 'Change of Bank Account details')}</h3>
            </div>
    <div class="panel-body" id="body-enquiries">
        <c:ISSP_APProcess_Progress 
            step="{!stepNumber}"
            operationType="{!strOperationType}"
            areaType="{!strAreaType}"
            changeType="{!strChangeType}"
            isSIS="{!OR(isISPAActive,isISUAActive)}" />
        
        <apex:form id="APChangesForm" styleClass="inline">
            <apex:pageBlock id="changeblock" mode="edit">
            
                    <apex:pageBlockButtons location="bottom">
                        <apex:actionStatus id="blockButtons">
                            <apex:facet name="start">
                                    <apex:outputPanel layout="none">
                                            <apex:commandButton styleclass="iatabtn iatabtn-default iatabtn-topMargin iatabtn-right" disabled="true" value="Next"/>
                                            <apex:commandButton styleclass="iatabtn iatabtn-danger iatabtn-topMargin iatabtn-right" disabled="true" value="Previous"/>
                                            <apex:commandButton styleclass="iatabtn iatabtn-default iatabtn-topMargin iatabtn-left" disabled="true" value="Save Draft and Leave"/>
                                        </apex:outputPanel>
                            </apex:facet>
                            
                            <apex:facet name="stop">
                                <apex:outputPanel layout="none">  
                                    <apex:commandButton styleclass="iatabtn iatabtn-default iatabtn-topMargin iatabtn-right" action="{!saveBSPFormAndGoForward}" status="blockButtons" value="Next"/>
                                    <apex:commandButton styleclass="iatabtn iatabtn-danger iatabtn-topMargin iatabtn-right" action="{!saveBSPFormAndGoBack}" status="blockButtons" value="Previous"/> 
                                    <apex:commandButton styleclass="iatabtn iatabtn-default iatabtn-topMargin iatabtn-left" action="{!saveBSPFormAndLeave}" status="blockButtons" value="Save Draft and Leave"/>                
                                </apex:outputPanel>
                            </apex:facet>
                        </apex:actionStatus>      
                    </apex:pageBlockButtons>  

            <apex:pageMessages />
            <div class="apcontainer">
                 <apex:pageBlockSection title="Thank you for informing IATA about {!IF(strChangeType='Minor database changes', 'any changes that impacts your participation in the operation concerned.','changes to your Bank Account details.')}" columns="1" collapsible="false">  
                    <apex:facet name="header">
                        <apex:outputpanel >
                            <apex:outputText style="font-weight:bold;font-size:15px;float:left;" value="Thank you for informing IATA about {!IF(strChangeType='Minor database changes', 'any changes that impacts your participation in the operation concerned.','changes to your Bank Account details.')}"/>
                        </apex:outputpanel>
                    </apex:facet>           
                    <apex:outputText >
                        <div class="aplabel">This form must be fully completed and submitted on-line.</div>
                        <div class="aplabel" style="margin: 5px 0px 10px 0px">
                            <apex:outputText value="
                                {!IF(strChangeType='Minor database changes',
                                 	"By agreeing with the Terms and Conditions, the Airline representative submitting this form confirms that they are authorized to do so and accepts the charges and fees related to the Airline  participation in IATA Settlement Systems as per the applicable Passenger and/or Cargo Agency Resolutions.",
                                    "By agreeing with the Terms and Conditions, the Airline representative submitting this form confirms that it is authorized to do so."
                               )}"
                          	/>
                        </div>
                        
                        <div style="color:#a31717; font-weight:bold; margin:20px 0px 10px 0px;border: 0px !important;">Note: the fields marked in red and with a "*" are required before you can submit your application.<br/>However, you can save the incomplete draft application and come back later to fill all the required fields before submitting it to IATA.</div>
                    </apex:outputText>
                </apex:pageBlockSection>
                
                <apex:pageBlockSection columns="2">
                    <apex:facet name="header">
                            General Details - {!apcountry}
                    </apex:facet>
                    <tr><td colspan="4" class="aplabel">
                        {!IF(strChangeType='Minor database changes', 'Please indicate the effective date of the change.','This instruction is effective from and including the settlement date below, and for each settlement thereafter.')}
                       </td></tr>
                     <apex:outputText ><!--empty: move following field to next row --></apex:outputText>
                         <apex:pageBlockSectionItem >
                            <apex:outputLabel value="* Desired commencement date" style="color:#a31717; font-weight: bold !important;"/>
                            <apex:inputField value="{!newForm.Desired_commencment_date__c}" />
                        </apex:pageBlockSectionItem>
                        
                    <tr><td colspan="4" class="aplabel">Contact person responsible for this {!strLoB} {!IF(strChangeType='Minor database changes','change request application','change of bank account details.')}</td></tr>
                     
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Social Title" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField required="{!isMandatory}" value="{!newForm.Contact_Resp_Salutation__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:outputText ><!--empty: move following field to next row --></apex:outputText> 
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* First Name" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Contact_Resp_F_Name__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Job Title" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Contact_Resp_Job_Title__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Last Name" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Contact_Resp_L_Name__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Email" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Contact_Resp_Email__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Phone" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Contact_Resp_Phone__c}" />
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                <br/>
                <apex:pageBlockSection columns="1" rendered="{!strChangeType='Minor database changes'}">
                    <apex:selectCheckboxes value="{!typeOfChangeRequested}" onchange="toggleChangeFields(this.id);" title="* Type of change requested" label="* Type of change requested"  style="width:80%;">
          				<apex:selectOptions value="{!changeItems}"/>
        			</apex:selectCheckboxes>
                </apex:pageBlockSection>    

                <apex:outputPanel id="AddressFields" style="{!IF (CONTAINS(newForm.Type_of_Change_Requested__c, 'Change of Address'), '', 'display:none')}" >
                    <apex:pageBlockSection collapsible="false" rendered="true" columns="1" title="Change of local address in {!strLoB} {!apcountry}">
                    <apex:outputText ><!--empty: move following field to next row --></apex:outputText>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel for="aladdress" value="New Address" />
                            <apex:inputField id="aladdress" html-placeholder="Street & No." value="{!newForm.BSP_Local_address__c}" />
                        </apex:pageBlockSectionItem>
                        <apex:outputText ><!--empty: move following field to next row --></apex:outputText> 
                        
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel for="zip" value="Zip code" />
                             <apex:inputText id="zip" value="{!newForm.BSP_Local_Zip_Code__c}" />
                        </apex:pageBlockSectionItem>
                        
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel for="city" value="City" />
                            <apex:inputField id="city" value="{!newForm.BSP_Local_City__c}" />
                        </apex:pageBlockSectionItem>
                        
                        <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Country" />
                            <apex:selectList style="width:300px" value="{!newForm.Airline_Local_address_in_the_BSP_Country__c}" size="1">
                            	<apex:selectOptions value="{!countryNameList}"/>
                        	</apex:selectList>
                    	</apex:pageBlockSectionItem>
                        
                    </apex:pageBlockSection>
                	
                </apex:outputPanel>
                <apex:outputPanel id="TaxFields" style="{!IF (CONTAINS(newForm.Type_of_Change_Requested__c, 'Tax Number'), '', 'display:none')}" >
                    <apex:pageBlockSection collapsible="false" rendered="true" columns="1" title="Change of Tax details">
						<apex:pageBlockSectionItem >
                        	<apex:outputLabel value="VAT/Tax number in your home country" for="vathomeno" />
                         	<apex:inputText id="vathomeno" value="{!newForm.VAT_Tax_number_in_your_home_country__c}" />
                    	</apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem rendered="{!NOT(OR(apcountryisocode='BR',apcountryisocode='EC',apcountryisocode='MX',apcountryisocode='VE'))}">
                            <apex:outputLabel value="VAT/Tax number in {!strLoB} {!apcountry}" for="vatbspno" />
                            <apex:inputText id="vatbspno" value="{!newForm.BSP_Country_VAT_Tax_number__c}" />
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem rendered="{!OR(apcountryisocode='EC',apcountryisocode='VE')}">
                            <apex:outputLabel value="{!CASE(apcountryisocode, 'EC', '* Your airlines VAT/RUC Number', '* Please provide the Registro Informacion Fiscal (RIF) information')}" for="vatrut"/>
                            <apex:inputText id="vatrut" value="{!newForm.BSP_Country_VAT_Tax_number__c}" />
                        </apex:pageBlockSectionItem>
                        
                        <apex:pageBlockSectionItem rendered="{!NOT(apcountryisocode='IT')}">
                            <apex:outputLabel value="Other TAX Identification" />
                            <apex:inputField value="{!newForm.Other_TAX_Identification__c}" />
                        </apex:pageBlockSectionItem>
                    
                        <apex:pageBlockSectionItem rendered="{!AND(OR(apcountryisocode='IT',apcountryisocode='CR'), strLoB='BSP')}">
                            <apex:outputLabel value="{!CASE(apcountryisocode, 'IT', '* Italian Fiscal code', '* Please indicate your airline\'s Fiscal ID cedula juridica')}" for="othertaxid"/>
                            <apex:inputText id="othertaxid" value="{!newForm.Other_TAX_Identification__c}" />
                        </apex:pageBlockSectionItem>
                        
                        <apex:pageBlockSectionItem rendered="{!AND(OR(apcountryisocode='EC',apcountryisocode='VE'), strLoB='BSP')}">
                            <apex:outputLabel for="contribtype" value="Type of Contributor {!CASE(apcountryisocode, 'EC', '(RUC)', '(RIF)')} applicable to your Airline"/>
                            <apex:inputField id="contribtype" value="{!newForm.Airline_s_Fiscal_Status__c}" />
                        </apex:pageBlockSectionItem>
                        
                        <apex:pageBlockSectionItem rendered="{!apcountryisocode='CO'}">
                            <apex:outputLabel for="rutname" value="Name appearing in the RUT"/>
                            <apex:inputField id="rutname" value="{!newForm.Name_Appearing_in_VAT__c}" />
                        </apex:pageBlockSectionItem> 
                    </apex:pageBlockSection>
                    
                    <!-- BRAZIL / MEXICO - START -->
                <apex:pageBlockSection title="Additional Tax Information - {!CASE(apcountryisocode, 'BR', 'Local VAT # (CNPJ - Certificado Nacional de Personas juridicas)', 'Local VAT - RFC #')}" columns="1" rendered="{!OR(apcountryisocode='BR',apcountryisocode='MX')}">
                
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="{!CASE(apcountryisocode, 'BR','CNPJ', 'RFC')} # to be entered in IATA Systems"/>
                        <apex:outputPanel >
                            <apex:inputField value="{!newForm.BSP_Country_VAT_Tax_number__c}" />
                            <apex:image value="/img/msg_icons/info16.png" title="{!CASE(apcountryisocode, 'BR', 'Format : XX.XXX.XXX/XXXX-XX. Must be that of the Bank Beneficiary Account Holder.', 'As per local law the RFC number (Local VAT no.) must correspond with the Local Fiscal Address of the Airline Participant and should be provided to IATA')}" html-data-html="true" html-data-placement="right" html-data-toggle="tooltip"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    
                    <apex:pageBlockSectionItem rendered="{!apcountryisocode='BR'}">
                        <apex:outputLabel value="Does the {!CASE(apcountryisocode, 'BR','CNPJ', 'RFC')} # provided correspond with the Bank Beneficiary Account Holder?"/>
                        <apex:inputField value="{!newForm.AP_BR_BankBeneficiary_Account_Holder__c}" />
                    </apex:pageBlockSectionItem>
                    
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Address to be inserted in IATA systems" />
                        <apex:inputField value="{!newForm.AP_BR_Address_To_Insert__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!apcountryisocode='BR'}">
                        <apex:outputLabel value="Does the supplied address correspond with the CNPJ # provided?"/>
                        <apex:inputField value="{!newForm.AP_BR_Address_CNP__c}" />
                        
                    </apex:pageBlockSectionItem>
                    
                    <apex:pageBlockSection title="Please enclose" columns="1" rendered="{!apcountryisocode='BR'}">
                        <apex:iframe scrolling="false" height="160px"
                            src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=0&reqRequired=Mandatory&reqName=1) A copy of the CNPJ Certification&reqDescription=&reqIdentifier=Additional_Information_BR1"/>
                        <apex:iframe scrolling="false" height="160px"
                            src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=1&reqRequired=Mandatory&reqName=2) The ANAC Authorization or Publication provided by the Offical Gazetta&reqDescription=&reqIdentifier=Additional_Information_BR2"/>
                    </apex:pageBlockSection>
                </apex:pageBlockSection>
                <!--  END OF Brazil / MEX  -->
                    
                     <!-- COLOMBIA - START -->
                <apex:pageBlockSection title="Additional Information for Colombia - ICA Taxes" columns="2" rendered="{!apcountryisocode='CO'}">
                    <tr class="aplabel">
                        <td colspan="2">City where the Industry and Commerce Tax (ICA) percentage applies.<br/>If your Airline is legally obliged to pay ICA in more than one city, please identify all cities and indicate the applicable ICA percentage.</td>
                    </tr>
                    <apex:pageBlockTable value="{!cityList}" var="city" columnsWidth="10%, 30%, 20%, 40%" >
                        <apex:column style="text-align:center" headerClass="columnTitleCenter" > 
                            <apex:facet name="header">
                               Selected
                            </apex:facet>
                            <apex:inputCheckBox value="{!city.selected}" id="theCheckBox" onchange="changePercentBox('{!$Component.thePercentBox}', '{!$Component.theCheckBox}', '{!$Component.thePanel}');" />
                        </apex:column>
                        <apex:column > 
                            <apex:facet name="header">
                               City
                            </apex:facet>
                            {!city.city}
                        </apex:column>
                        <apex:column > 
                            <apex:facet name="header">
                                ICA Percentage <br/><span style="font-weight:normal !important; font-style:italic">Please enter numbers and decimals only, e.g. [9.66/1000] or [9.66 x mil] should be entered as 9.66</span>
                            </apex:facet>
                            <apex:outputPanel id="thePanel" style="{!IF (city.selected, '', 'display:none')}" >
                                <apex:inputText onchange="checkPercentage('{!$Component.thePercentBox}')" onkeypress="return onlyNumbers(event);" value="{!city.percentage}" id="thePercentBox" />
                            </apex:outputPanel>
                        </apex:column>
                        <apex:column >
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlockSection>
                    
                    <!-- CANADA - START -->
                <apex:pageBlockSection title="Local Canadian VAT Information" columns="1" rendered="{!AND(apcountryisocode='CA', strLoB='BSP')}">
                    <apex:outputText escape="false">
                        The following local VAT information is required for Airlines maintaining an office in Canada.<br/>
                    For Airlines with more than one office location in Canada, the information is needed only for the Main office.
                        <br/><br/>
                    GST = Goods and services tax (federal)<br/>
                    HST = Harmonized sales tax (federal+provincial)<br/>
                    QST = Quebec sales tax (provincial only Quebec)<br/>
                    <br/>
                        <b>The type of tax applicable depends on the province where the Canada main office is located.</b><br/>
                        Airlines with no direct/principal office in Canada and are being represented by a GSA are not required to provide the local VAT information of the GSA.
                    </apex:outputText>
                            
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel style="color:#a31717; font-weight: bold !important;" value="* Does your Airline have a direct/principal office in Canada?"/>
                        <apex:inputField value="{!newForm.Canada_Has_Principal_Office__c}"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* If YES, please select the provincial location and GST/HST/QST information below?"/>
                        <apex:inputField value="{!newForm.Canada_Provincial_Offices__c}"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* GST/HST/QST information"/>
                        <apex:inputField value="{!newForm.Canada_LocalVAT_Info__c}"/>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                    
                </apex:outputPanel>
                
                <apex:outputPanel id="MasterTableFields" style="{!IF (CONTAINS(newForm.Type_of_Change_Requested__c, 'Master Table'), '', 'display:none')}" >
                    <apex:pageBlockSection collapsible="false" rendered="true" columns="2" title="Finance / Administration Contact Person & Title - {!strLoB}Link Master Table Change">
                	 <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Social Title" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact__c}"/>
                    </apex:pageBlockSectionItem>
                    <apex:outputText ><!--empty: move following field to next row --></apex:outputText> 
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* First Name" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_F_Name__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Last Name" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_L_Name__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Job Title" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_Job_Title__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Phone number" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_Phone__c}" html-placeholder="with country code" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Email Address" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_Email__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:outputText ><!--empty: move following field to next row --></apex:outputText>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Physical Address" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:outputPanel >
                            <apex:inputField value="{!newForm.Fin_Adm_Contact_Address__c}" />
                            <apex:image style="vertical-align:top; margin-left:3px" value="/img/msg_icons/info16.png" title="Enter a local address if this is required in the country requirements. To appear on billing reports." html-data-html="true" html-data-placement="right" html-data-toggle="tooltip"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Zip Code" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_Zip_Code__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* City" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:inputField value="{!newForm.Fin_Adm_Contact_City__c}" />
                    </apex:pageBlockSectionItem>                
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="* Country" style="color:#a31717; font-weight: bold !important;"/>
                        <apex:selectList style="width:300px" value="{!newForm.Fin_Adm_Contact_Country__c}" required="false" size="1">
                            <apex:selectOptions value="{!financialCountryNameList}"/>
                        </apex:selectList>
                    </apex:pageBlockSectionItem>

                    </apex:pageBlockSection>    
                </apex:outputPanel>
                    
            </div>     
         </apex:pageBlock>
          
        </apex:form>
        
     </div>   
     </div>    


</apex:page>