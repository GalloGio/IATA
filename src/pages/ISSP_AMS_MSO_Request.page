<apex:page controller="ISSP_AMS_MSO_Request_Controller"
           cache="false"
           sidebar="false"
           showHeader="false"
           standardStylesheets="false"
           applyBodyTag="false"
           applyHtmlTag="false"
           action="{!securityCheck}"
           >
<html> 
    <c:ISSP_Header communityName="{!communityName}" ></c:ISSP_Header>

    <style>
                .service-header {
            background-image: url("{!URLFOR($Resource.CurrencyCenter_Style, '/RegionalOutlookNews_banner.jpg')}");
            background-size:720px;
            background-repeat: no-repeat;
            background-position-x: 15px;
            padding-left: 60px;
            height: 170px;
        }
        @media (min-width:320px){
            .service-header{background-size:720px;}
        }
        @media (min-width:768px){
            .service-header{background-size:720px;}
        }
        @media (min-width:992px){
            .service-header{background-size:940px;}
        }
        @media (min-width:1200px){
            .service-header{background-size:1140px;}
        }

        .page-title {
            font-family: Helvetica;
            font-size: 28px;
            color: #FFFFFF;
            padding-top: 60px;
            margin-left: -15px;
        }
        .introduction-text {
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .btn-blue {
          background-color: #0075BC !important;
          color: #FFFFFF !important;
          height: 33px !important;
          margin-right: 10px !important;
        }

        .hm-table {
    margin-top: 12px;
}
.hm-table .table>thead>tr>th {
    background-color: #F5F5F5;
    /*text-align: center;*/
    vertical-align: top;
    text-transform: uppercase;
    font-family: Helvetica, sans-serif;
    font-size: 12px;
    color:#444444;
}
.hm-table .table .country-cell {
    width: 151px;
    height: 33px;
    background-color: #F5F5F5;  
    color: #444444;
    font-family: Helvetica, sans-serif;
    font-size: 12px;
}
.table-bordered>tbody>tr>td, .table-bordered>thead>tr>th {
    border: 1px solid #D4D9DB;
    font-size: 11px;
}
.hm-table .table>thead>tr>th a, .hm-table .table>thead>tr>th a:hover {
    color: #444444;
    text-decoration: none;
}
.hm-table .table>thead>tr>th>td {
    font-family: Helvetica;
    font-size: 12px;
}

        .pbTitle {
            width: 40% !important};
        }
       
        .pbBody {
            padding-left:10px !important;    
        }
            
       .pbBody a{color:#337ab7 !important}
               
        .bPageBlock {
            border-top-width : thin !important;
            background-color: #FFFFFF !important;
        }
        
        .bEditBlock input {
            vertical-align:top !important;
        }
       
       .btn {
            padding: 2px 12px !important;
        }
                             
        .btn-primary {
            color: #fff !important;
            background: inherit !important;
            background-color: #337ab7 !important;
            border-color: #2e6da4 !important;
            border: 1px solid transparent !important;
            /*background: */
        }
        
        .tb-header {
            padding-right:20px;
        }
                 
        .modalrow {
            padding-top:10px;
        }
                 
        input + label {
            font-weight:normal;
        }
            
        ul li, ol li {
            margin-left: inherit;
            padding-left: inherit;
        }

        td, th {
            border: 0px !important;
        }
        
        #contentWrapper {  background: #fff !important; margin: 0 auto;max-width: 1170px;}
            
        .requiredText {display:none;}
        
        .dateFormat {display:none;}
        
        .errorMsg {color:#d74c3b}
            
        .progress-bar-off {
                color:#6BBBEA;
                font-weight:bold;
                background-image:none !important;
                background-color:transparent !important;
                border-right:2px solid white;
        }
        
        body .bPageBlock .pbBody .pbSubheader{
                background-image: url('') !important;
                background-color:  #1797c0;
                color: #fff;
        }

        body .bPageBlock .pbBody .summary-subsection .pbSubheader{
                background-image: url('') !important;
                background-color: initial;
                color: initial;
        }
        
        .pbSubheader {
            font-weight:bold;
            font-size:15px;
        }
                   
        .contact-detail {
            font-size:12px;
            margin-bottom:3px;
        }
                   
        .tbFooter {
         text-align:right;
        }
                   
        .requiredBlock {
            width:5px !important;
        }

        .checkbox-td {
            text-align: center;
        }

        .summary-table th {
            text-align: center;
        }

        .summary-table td.dataCell {
            border: 1px solid #e0e3e5 !important;
        }
        
        .col1 {
            padding-bottom:5px;
            width:40%;
            vertical-align: text-top;
            font-weight:bold
        }
        
        .col1_regular {
            padding-bottom:5px;
            width:25%;
            vertical-align: text-top;
            font-weight:bold
        }       
               
        .col2 {width:60%; padding-left:50px;vertical-align: text-top;}
        .col2_regular {width:25%; padding-left:50px;vertical-align: text-top;}
        .col2_4 {width:10%;padding-left:5px;vertical-align: text-top;}
        .col3 {width:50%;vertical-align: text-top;}
        
        .col1_inner {width:25%; vertical-align: text-top;}
        .col2_inner {width:25%; vertical-align: text-top;}
               
        .row1 {padding-bottom:16px; vertical-align: text-top;}

        .billingStreetPanel {
            display: block;
            padding-top: 15px;
        }

        .bPageBlock .message {
                margin: 0 0 4px;
            }
            .message {
                border-radius: 4px;
            }
            .errorM6, .errorM4, .errorM3, .errorM2, .errorS1 {
                border-color: #c00;
            }
            .message {
                background-color: #ffc;
                border-style: solid;
                border-width: 1px;
                color: #000;
                margin: 4px 20px;
                padding: 6px 8px 6px 6px;
            }
            .errorM3 .msgIcon, .errorMedium {
                background-image: url("/img/msg_icons/error24.png");
                background-position: 0 0;
                height: 24px;
                width: 24px;
            }
            img {
                border: 0 none;
            }
            body, td {
                color: #222;
                font-family: Arial,Helvetica,sans-serif;
            }
            body, td {
                color: #333;
                margin: 0;
            }
            .message .messageText {
                margin-left: 8px;
            }
            .message .messageTable .messageCell {
                vertical-align: middle;
            }
            .pbBody, .pbBody a, .pbBody td, .lbBody a, .lbBodyDescription, .list .headerRow .noRowsHeader {
                color: #000;
            }
            .message .messageText h4 {
                display: block;
                font-weight: bold;
            }
            body .x-btn button, body .btn, body .btnImportant, body .btnDisabled, body .btnCancel, body .menuButton .menuButtonButton, body .menuButton .menuButtonMenu a, body .menuButton .menuButtonMenu input.theOption, h1, h2, h3, h4, h5, h6 {
                font-family: Arial,Helvetica,sans-serif;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 100%;
                margin: 0;
            }
            .bPageBlock .requiredInput {
                height: 100%;
                position: relative;
            }
            .bPageBlock .requiredInput .requiredBlock {
                background-color: #c00;
                bottom: 1px;
                left: -4px;
                position: absolute;
                top: 1px;
                width: 3px;
            }
            .errorStyle, .errorMsg, .importantWarning, .pbBody .errorStyle a, .pbBody .errorMsg a {
                color: #d74c3b;
            }

            /* suggestion list*/
            .autocomplete {
                /*the container must be positioned relative:*/
                position: relative;
                display: inline-block;
            }

            .autocomplete-items {
                position: absolute;
                border: 1px solid #d4d4d4;
                border-bottom: none;
                border-top: none;
                z-index: 99;
                /*position the autocomplete items to be the same width as the container:*/
                top: 100%;
                left: 0;
                right: 0;
            }
            .autocomplete-items div {
                padding: 10px;
                cursor: pointer;
                background-color: #fff;
                border-bottom: 1px solid #d4d4d4;
            }
            .autocomplete-items div:hover {
                /*when hovering an item:*/
                background-color: #e9e9e9;
            }
            .autocomplete-active {
                /*when navigating through the items using the arrow keys:*/
                background-color: DodgerBlue !important;
                color: #ffffff;
            }
    </style>

    <body>
        <apex:outputPanel id="amscountrylabel"> 
            <script>  
            
            </script>
        </apex:outputPanel>
        <div class="container">
            <div id="contentWrapper">

                <c:ISSP_CustomNavigation communityName="{!communityName}"></c:ISSP_CustomNavigation>

                <div class="panel-primary">
                    
                    <apex:form >            

                    <!-- FM AMSU-119 -->
                        <div class="row">
                            <div class="col-xs-20 service-header" >
                            
                                <div class="row page-title">
                                    <div class="col-xs-12 col-md-10" style="border:2px">
                                        <div class="">{!$Label.ISSP_AMS_New_MSO_Application}</div>
                                    </div>
                                    <div class="col-xs-2 col-md-2">
                                        <apex:outputPanel id="downloadButtons">
                                            <apex:commandButton styleclass="btn btn-blue" style="text-align: right;margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_AMS_MSO_GSA_Return_to_List}" immediate="true" status="buttonLoadingStep1" reRender="newMSOform"/>
                                        </apex:outputPanel>
                                    </div>
                                    
                                </div>
                            </div>

                    </div>
                        <br/>
                    
                    <apex:outputPanel id="msoForm">
                    <apex:pageBlock id="newMSOform" rendered="{! step == 'form' }"> 

                        <apex:pageMessages />       
                        

                        <apex:pageBlockButtons location="bottom" styleClass="col-xs-12 col-md-10" style="padding-left:200px" >  
                            <!--
                            <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true" />
                            <apex:commandButton styleclass="btn btn-default" action="{!save}" value="{!$Label.ISSP_AMS_Submit_IATA}" reRender="msoForm"/>
                            -->
                            <apex:actionStatus id="buttonLoadingStep1">
                                <apex:facet name="stop"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="padding-top:6px;margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true" status="buttonLoadingStep1" reRender="newMSOform"/>
                                    <apex:commandButton styleclass="btn btn-default" action="{!save}" value="{!$Label.ISSP_Next}" status="buttonLoadingStep1" onclick="setBilling();"/>
                                </apex:outputPanel></apex:facet>
                                <apex:facet name="start"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" value="{!$Label.ISSP_Cancel}..." disabled="true" reRender="newMSOform"/>
                                    <apex:commandButton styleclass="btn btn-default"  value="{!$Label.ISSP_Next}..." disabled="true"  reRender="newMSOform"/>
                                </apex:outputPanel></apex:facet>
                            </apex:actionStatus>
                        </apex:pageBlockButtons>

                        <apex:pageBlockSection columns="1" id="addressSection" collapsible="false">
                            <apex:facet name="header">
                                <apex:outputpanel style="padding-left:8px;padding-top:5px;padding-bottom:5px;">
                                        
                                    <label style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;color: #FFFFFF">
                                    {!$Label.ISSP_AMS_MSO_Application_Section_2}</label>
                                </apex:outputpanel>
                            </apex:facet>

                            <br/>
                            
                            <apex:actionRegion > 
                                <apex:actionFunction name="refreshStates" action="{!refreshStates}" reRender="billingStatePanel" oncomplete="refreshCities();"/>

                                <label for="countryconcerned" class="col-lg-2 control-label" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">* {!$Label.ISSP_CountryConcerned}</label>
                                
                                <div class="col-lg-10" >
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                            <apex:selectList id="countrySelected2" required="false" styleClass="form-control" style="width:40%" value="{!countrySelected}" size="1" onchange="refreshStates();">
                                                <apex:selectOptions value="{!countryISOCodeList}"/>
                                        </apex:selectList>
                                    </div>
                                </div>
                            </apex:actionRegion>
                            
                            <apex:actionRegion>
                                <apex:actionFunction name="refreshCities" action="{!refreshCities}" reRender="cityListPanel"/>
                                <apex:outputPanel id="billingStatePanel" styleClass="billingStreetPanel" style="display:{! IF(billingStatesList.size > 1,'','None')};">
                                    <label for="billingstate" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">* {!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Billing_State__c.Label}</label>
                                    
                                    <div class="col-lg-10" >
                                        <div class="requiredInput">
                                            <div class="requiredBlock"></div>                          
                                                <apex:selectList id="billingstate2" required="false" styleClass="form-control" style="width:40%" value="{!billingState}" size="1" onchange="clearCity(); refreshCities();">
                                                    <apex:selectOptions value="{!billingStatesList}"/>
                                            </apex:selectList>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                            </apex:actionRegion>
                            
                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="countryconcerned" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">{!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Branch_Office_City__c.Label}</label>

                                <div class="col-lg-10" >
                                <apex:inputField id="billingCity" required="true" value="{!accreditationForm.Branch_Office_City__c}"/>
                            </div>
                            </apex:outputPanel>

                            <apex:outputPanel id="billingStreetPanel2" styleClass="billingStreetPanel">
                                    <label for="billingstate" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">
                                    {!$Label.ISSP_AMS_MSO_GSA_Address}</label>
                                
                                <div class="col-lg-10">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>                          
                                        <apex:inputText id="billingStreet" required="true" value="{!accreditationForm.Branch_Office_Street_name_number__c}" />
                                        <apex:image value="/img/msg_icons/info16.png" style="padding-left: 5px;" title="{!$Label.ISSP_AMS_MSO_Alternatively}" />
                                    </div>
                                </div>
                            </apex:outputPanel>

                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="countryconcerned" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">{!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Branch_Office_Postal_code__c.Label}</label>
                                                                    
                                <div class="col-lg-10" >
                                        <apex:inputField id="billingPostalCode" required="false" label="" value="{!accreditationForm.Branch_Office_Postal_code__c}"/>
                                    
                            </div>
                            </apex:outputPanel>

                            

                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="countryconcerned" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_Office_Phone}</label>

                            <div class="col-lg-9" >
                                    <apex:inputField id="phoneNumber" required="false" value="{!accreditationForm.Branch_Office_Phone__c}" />
                            </div>
                            </apex:outputPanel>

                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="countryconcerned" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_AMS_MSO_Office_Email}</label>

                            <div class="col-lg-9" style="padding-top:7px;">                             
                                    <apex:inputField id="emailAddress" required="false" value="{!accreditationForm.Branch_Office_Email__c}"/>
                            </div>
                            </apex:outputPanel>
                            
                            <!-- WMO-578 --> 
                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="aggregator" class="col-lg-2" style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_AMS_MSO_Aggregator}</label>
                                <div class="col-lg-9" style="padding-top:7px;">
                                    <apex:inputField id="aggregator" value="{!accreditationForm.Trade_Name__c}"/>
                                    <apex:image value="/img/msg_icons/info16.png" style="padding-left: 5px;" title="{!$Label.ISSP_AMS_MSO_Aggregator_Info}" />
                                </div>
                            </apex:outputPanel>
                            
                            <br/>
                        </apex:pageBlockSection>

                    </apex:pageBlock>

                    <!--</apex:form>-->



                    <apex:pageBlock id="overview" rendered="{! step == 'review' }">
                        <apex:pageMessages />

                        <apex:pageBlockButtons location="bottom" styleClass="col-xs-12 col-md-10" style="padding-left:200px" > 
                            <!--
                            <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true" />
                            <apex:commandButton styleclass="btn btn-default" action="{!save}" value="{!$Label.ISSP_AMS_Submit_IATA}" />
                            -->
                            <apex:actionStatus id="buttonLoadingStep1">
                                <apex:facet name="stop"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancelRequest}" value="{!$Label.ISSP_Cancel}" immediate="true" status="buttonLoadingStep1" reRender="overview"/>
                                    <apex:commandButton styleclass="btn btn-default" action="{!submitAndApproveCase}" value="{!$Label.ISSP_AMS_Submit_IATA}" status="buttonLoadingStep1" reRender="overview" />
                                </apex:outputPanel></apex:facet>
                                <apex:facet name="start"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" value="{!$Label.ISSP_Cancel}..." disabled="true" reRender="overview"/>
                                    <apex:commandButton styleclass="btn btn-default"  value="{!$Label.ISSP_AMS_Submit_IATA}..." disabled="true" reRender="overview"/>
                                </apex:outputPanel></apex:facet>
                            </apex:actionStatus>
                        </apex:pageBlockButtons>

                        <apex:pageBlockSection columns="1" collapsible="false">
                                
                                <apex:outputpanel style="padding-left:8px;padding-top:5px;padding-bottom:5px;">
                                        <apex:outputText escape="false" value="{!$Label.ISSP_AMS_MSO_Application_Review}" rendered="{!step == 'review' }"/>
                                        <!--apex:commandButton styleclass="btn btn-blue" action="{!goBackToForm}" value="{!$Label.ISSP_EditSection}" id="Edit-Section1" style="float:right"/-->
                                    </apex:outputpanel>
                        </apex:pageBlockSection>

                        <br/>

                        <apex:pageBlockSection columns="1" id="addressSection" collapsible="false">
                            <apex:facet name="header">
                                    <apex:outputpanel style="padding-left:8px;padding-top:5px;padding-bottom:5px;">
                                        
                                        <label style="padding-top:6px; text-align: right; font-size: 91%; padding-right: 0px;color: #FFFFFF">{!$Label.ISSP_AMS_MSO_Application_Section_2}</label>
                                        
                                </apex:outputpanel>
                                                                        
                            </apex:facet>
                            
                            <apex:outputPanel id="billingStatePanel3" styleClass="billingStreetPanel">
                            <label for="countryconcerned" class="col-lg-2 control-label" style="text-align: right; font-size: 91%; padding-right: 0px;">* {!$Label.ISSP_CountryConcerned}</label>
                            
                            <div class="col-lg-10" >{!accreditationForm.Branch_Office_Country__r.Name}</div>
                            </apex:outputPanel>

                            <apex:outputPanel id="billingStatePanel6" styleClass="billingStreetPanel" rendered="{!AND(step == 'review',billingStatesList.size > 1) }">
                                <label for="billingstate" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">* {!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Billing_State__c.Label}</label>
                                
                                <div class="col-lg-10" >{!accreditationForm.IATA_ISO_State__r.Name}</div>
                            </apex:outputPanel>

                            <apex:outputPanel styleClass="billingStreetPanel">
                                <label for="countryconcerned" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">{!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Branch_Office_City__c.Label}</label>
                                    <div class="col-lg-10" >
                                        <apex:outputField id="billingCity" value="{!accreditationForm.Branch_Office_City__c}"/>                                
                                    </div>
                            </apex:outputPanel>

                            <apex:outputPanel id="billingStreetPanel" styleClass="billingStreetPanel">
                                    <label for="billingstate" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">
                                    {!$Label.ISSP_AMS_MSO_GSA_Address}</label>
                                    
                                    <div class="col-lg-10">
                                <apex:outputField id="billingStreet" value="{!accreditationForm.Branch_Office_Street_name_number__c}"/>
                            </div>
                                </apex:outputPanel>

                                <apex:outputPanel styleClass="billingStreetPanel">
                                        <label for="countryconcerned" class="col-lg-2" style=" text-align: right; font-size: 91%; padding-right: 0px;">{!$ObjectType.AMS_Pax_Accreditation_Form__c.fields.Branch_Office_Postal_code__c.Label}</label>
                                                                            
                                        <div class="col-lg-10" >
                                <apex:outputField id="billingPostalCode"  value="{!accreditationForm.Branch_Office_Postal_code__c}"/>
                                            
                            </div>
                                    </apex:outputPanel>                                

                                <apex:outputPanel styleClass="billingStreetPanel">
                                    <label for="countryconcerned" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_Office_Phone}</label>

                            <div class="col-lg-9" >
                                        <apex:outputField id="phoneNumber" value="{!accreditationForm.Branch_Office_Phone__c}" />
                            </div>
                                </apex:outputPanel>

                               <apex:outputPanel styleClass="billingStreetPanel">
                                    <label for="countryconcerned" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_AMS_MSO_Office_Email}</label>
                                    
                                    <div class="col-lg-9" style="">
                                        <apex:outputField id="emailAddress" value="{!accreditationForm.Branch_Office_Email__c}"/>
                            </div>
                                </apex:outputPanel>
                                
                                <!-- WMO-578 -->
                                <apex:outputPanel styleClass="billingStreetPanel">
                                    <label for="countryconcerned" class="col-lg-2" style="text-align: right; font-size: 91%; padding-right: 0px;">{!$Label.ISSP_AMS_MSO_Aggregator}</label>
                                    
                                    <div class="col-lg-9" style="">
                                        <apex:outputField id="tradeNameAgg" value="{!accreditationForm.Trade_Name__c}"/>
                                    </div>
                                </apex:outputPanel>

                                <br/>

                            
                            
                        </apex:pageBlockSection>

                    </apex:pageBlock>

                    </apex:outputPanel>
                    

                    <apex:pageBlock rendered="{! step == 'success' }" mode="maindetail">
                        <div style="color:#000000; font-size:14px; padding-bottom:10px; padding-top:10px;margin-left:200px">
                           
                            <!--<strong>
                                <apex:outputPanel>{!$Label.ISSP_AMS_MSO_StepFinal_Thanks}</apex:outputPanel>
                            </strong>-->
                           
                            <apex:outputPanel rendered="{!generatedIATACODE == null}" >
                                <br/> <br/> 
                                {!$Label.ISSP_AMS_StepFinal_Your_CaseNumber} <a href="/ISSP_Case?caseId={!oscarCase.Id}{!if(communityName=='CNS','&CommunityName='+communityName,'')}" target="_self">{!oscarCase.CaseNumber}</a>.
                                <br/><br/>
                                <a href="/ISSP_Case?caseId={!oscarCase.Id}{!if(communityName=='CNS','&CommunityName='+communityName,'')}" target="_self">{!$Label.ISSP_AMS_StepFinal_Access_Direct}</a>&nbsp;{!$Label.ISSP_AMS_StepFinal_Access_Direct2}
                                <br/><br/>
                                {!IF(communityName=='CNS', $Label.ISSP_AMS_StepFinal_In_Addition_CNS, $Label.ISSP_AMS_StepFinal_In_Addition)} <a href="/ISSP_CaseList{!if(communityName=='CNS','?CommunityName='+communityName,'')}" target="_self">{!$Label.ISSP_AMS_StepFinal_In_Addition2}</a>.
                            </apex:outputPanel>
                           
                            <apex:outputPanel rendered="{!generatedIATACODE <> null}" >
                                <strong>{!$Label.ISSP_AMS_MSO_Request_Successfull} {!generatedIATACODE}.</strong>
                                <br/> <br/> 
                                {!$Label.ISSP_AMS_StepFinal_Your_CaseNumber} <a href="/ISSP_Case?caseId={!oscarCase.Id}{!if(communityName=='CNS','&CommunityName='+communityName,'')}" target="_self">{!oscarCase.CaseNumber}</a>.
                            </apex:outputPanel>

                        </div>
                    </apex:pageBlock>
                    
                    <apex:pageBlock rendered="{! step == 'issue' }" mode="maindetail">
                        <apex:pageMessages />
                        <apex:pageBlockButtons location="bottom" styleClass="col-xs-12 col-md-10" style="padding-left:200px" > 
                        
                            <apex:actionStatus id="buttonLoadingStep1_1">

                                <apex:facet name="stop"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_AMS_MSO_GSA_Return_to_List}" immediate="true" status="buttonLoadingStep1" reRender="overview"/>
                                </apex:outputPanel></apex:facet>
                                <apex:facet name="start"><apex:outputPanel >
                                    <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" value="{!$Label.ISSP_AMS_MSO_GSA_Return_to_List}..." disabled="true" reRender="overview"/>
                                </apex:outputPanel></apex:facet>
                            </apex:actionStatus>
                        </apex:pageBlockButtons>
                        
                        <div style="color:#000000; font-size:14px; padding-bottom:10px; padding-top:10px;margin-left:200px">
                           
                            <apex:outputPanel rendered="{!reason == 'airline_designator2'}" >
                                <strong>{!$Label.ISSP_AMS_MSO_Request_Issue_Airline_Designator}</strong>
                                <br/> 
                            </apex:outputPanel>

                        </div>
                    </apex:pageBlock>
                    
                        <apex:inputHidden id="hiddenBillingCityId" value="{!billingCity}"/>
                    </apex:form>   

                </div>

            </div>
            <c:ISSP_CustomFooter communityName="{!communityName}"/>
        </div>
        

        <apex:outputPanel id="cityListPanel">
            <script>
                var cityList = JSON.parse(JSON.stringify({!billingCityListStr}));                 
            </script>
        </apex:outputPanel>
        
        

        <script type="text/javascript">

            
            let billingCityElement = document.querySelector('[id$=billingCity]');
            let currentFocus = -1;
            let billingCityId;
            let predictions = {};
            let cityChanged = false;
            
            billingCityElement.setAttribute('autocomplete', 'new-city');

            billingCityElement.addEventListener('input', function(){
                predictions = {};
                cityChanged = true;
                let a, b, count = 0, inputValue = this.value;
                
                /*close any already open lists of autocompleted values*/
                closeAllLists();
                if (!inputValue) { return false;}
                currentFocus = -1;

                a = document.createElement('DIV');
                a.setAttribute("id", "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                a.setAttribute("style", "width:"+this.offsetWidth+"px");

                this.parentNode.appendChild(a);
                
                for(var i = 0; i < cityList.length; i++){
                    
                    if(inputValue.toUpperCase() === cityList[i]["Name"].substr(0, inputValue.length).toUpperCase() ||
                       inputValue.toUpperCase() === cityList[i]["GeonameName__c"].substr(0, inputValue.length).toUpperCase() ){
                       /*create a DIV element for each matching element:*/
                       if(count < 5){
                        createDiv(cityList, i, inputValue, a);
                       
                        count++;
                        predictions[cityList[i]["Name"].toUpperCase()] = cityList[i];
                       }else{
                        count = 0;
                        break;
                        }

                    }else if(cityList[i]["GeonameAlternateNames__c"]?cityList[i]["GeonameAlternateNames__c"].toUpperCase().includes(inputValue.toUpperCase()):false){
                        /*create a DIV element for each matching element:*/
                       if(count < 5){
                        createDiv(cityList, i, inputValue, a);
                        predictions[cityList[i]["Name"].toUpperCase()] = cityList[i];
                        count++;
                       }else{
                        count = 0;
                        break;
                       }
                    }
                }
            });

            function createDiv(cityList, i, inputValue, a){
                         
                            b = document.createElement("DIV");
                            b.innerHTML = cityList[i]["Name"];
                            
                            /*insert a input field that will hold the current array item's value:*/
                            b.innerHTML += "<input id='name' type='hidden' value='" + cityList[i]["Name"] + "'>";
                            b.innerHTML += "<input id='sfId' type='hidden' value='" + cityList[i]["Id"] + "'>";
                            b.innerHTML += "<input id='geonameName' type='hidden' value='" + cityList[i]["GeonameName__c"] + "'>";
                            /*execute a function when someone clicks on the item value (DIV element):*/
                            b.addEventListener("click", function(e) {
                                /*insert the value for the autocomplete text field:*/
                                let inputElementArray = this.getElementsByTagName("input");
                                     
                                billingCityElement.value = inputElementArray[0].value;    
                                billingCityId = inputElementArray[1].value;
                                /*close the list of autocompleted values,
                                (or any other open lists of autocompleted values:*/
                                closeAllLists();
                            });
                            a.appendChild(b);
                            
            }
        
            billingCityElement.addEventListener('keydown', function(e){
                    
                let x = document.getElementById("autocomplete-list");                            
                if (x) x = x.getElementsByTagName("div");           
                
            
                if (e.key === 'ArrowDown') {				
                    
                    /*If the arrow DOWN key is pressed,
                    increase the currentFocus variable:*/
                    currentFocus++;
                    /*and and make the current item more visible:*/
                    
                    addActive(x);
                } else if (e.key === 'ArrowUp') { //up
                    /*If the arrow UP key is pressed,
                    decrease the currentFocus variable:*/
                    currentFocus--;
                    /*and and make the current item more visible:*/
                    addActive(x);
                } else if (e.key === 'Enter') {
                    /*If the ENTER key is pressed, prevent the form from being submitted,*/
                    e.preventDefault();
                    if (currentFocus > -1) {
                    /*and simulate a click on the "active" item:*/
                    if (x) x[currentFocus].click();
                    }				
                } else if (e.key === 'Tab'){
                    closeAllLists();
                } else{
                    currentFocus = -1;
                }
            });
           
            function addActive (x) {                            
                    /*a function to classify an item as "active":*/
                    if (!x) return false;
                    /*start by removing the "active" class on all items:*/
                    removeActive(x);
                    
                    if (currentFocus >= x.length) currentFocus = 0;
                    if (currentFocus < 0) currentFocus = (x.length - 1);
                    /*add class "autocomplete-active":*/
                    x[currentFocus].classList.add("autocomplete-active");
                    }
                    
            function removeActive (x) {
                
                /*a function to remove the "active" class from all autocomplete items:*/
                for (var i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active");
                }
            }
            
            function closeAllLists(elmnt) {
                let inp = billingCityElement.value;
                /*close all autocomplete lists in the document,
                except the one passed as an argument:*/
                var x = document.getElementsByClassName("autocomplete-items");  

                for (var i = 0; i < x.length; i++) {
                    if (elmnt != x[i] && elmnt != inp) {
                        x[i].parentNode.removeChild(x[i]);
                    }
                }
            }                

            function setBilling(){
                if(cityChanged){
                    let billingCityInput = document.querySelector('[id$=billingCity]').value.toUpperCase();                    
                    let billingCityId = predictions[billingCityInput]?predictions[billingCityInput]['Id']:null;                    
                    document.querySelector('[id$=hiddenBillingCityId]').value = billingCityId;
                }                    
            }

            function clearCity(){
                document.querySelector('[id$=billingCity]').value = '';
                document.querySelector('[id$=hiddenBillingCityId]').value = null;
                cityChanged = false;
                predictions = {};
            }
            
            document.addEventListener("click", function (e) {                              
                closeAllLists(e.target);                    
            });
                
        </script>
    </body>  
</html>

</apex:page>