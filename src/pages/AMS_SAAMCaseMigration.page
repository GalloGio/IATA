<apex:page showHeader="true" sidebar="true" controller="AMS_SAAMCaseMigrationController" tabStyle="Case" title="AMS - SAAM Case Migration" docType="html-5.0">
	
	<apex:form id="caseFilters">
		<apex:pageBlock title="SAAM Case Migration" >
			<apex:pageMessages id="pageMessages"/>
			
			<apex:pageBlockSection columns="1" id="searchPanel">
				<apex:selectList multiselect="false" size="1" value="{!searchOption}" label="Cases to Migrate:">
					<apex:actionSupport event="onchange" reRender="searchPanel"/>
					<apex:selectOptions value="{!searchOptions}" />
				</apex:selectList> 

				<apex:inputTextarea value="{!caseNumbers}" rows="5" rendered="{!showTextArea}" label="Case numbers:"/>
			</apex:pageBlockSection>

			<apex:pageBlockButtons location="bottom">
				<apex:commandButton action="{!search}" value="Search" reRender="pageMessages, caseTable" />
			</apex:pageBlockButtons>
		</apex:pageBlock>
	</apex:form>
	
	<apex:form id="caseTable" >
		<apex:pageBlock title="Cases" rendered="{!searched}">
			<apex:pageBlockTable value="{!emptyList}" var="message" rendered="{!saamCases.size == 0}">
				<apex:column >
					<apex:facet name="header"><apex:outputPanel layout="block">&nbsp;</apex:outputPanel></apex:facet>
					<apex:outputPanel layout="block" styleClass="emptyMessage">{!message}</apex:outputPanel>
				</apex:column>
			</apex:pageBlockTable>

			<apex:pageBlockTable value="{!casesOnPage}" var="container" rendered="{!saamCases.size > 0}">
				<apex:column>
					<apex:facet name="header">
					<apex:outputPanel layout="block" >
						<apex:inputCheckbox value="{!selectAll}" >
							<apex:actionSupport action="{!doSelectAll}" event="onchange" reRender="caseTable"/>
						</apex:inputCheckbox>
						Action
					</apex:outputPanel>
					</apex:facet>
					<apex:inputCheckbox value="{!container.selected}"/>
				</apex:column>

				<apex:column headerValue="{!$ObjectType.Case.Label}">
					<apex:outputLink value="{!URLFOR($Action.Case.View, container.c.Id)}">{!container.c.CaseNumber}</apex:outputLink>
				</apex:column>

				<apex:repeat value="{!caseFieldNames}" var="field">
					<apex:column value="{!container.c[field]}"/>
				</apex:repeat>
			</apex:pageBlockTable>
			
			<apex:outputPanel layout="block" style="text-align: right; margin-top: 5px;" rendered="{!saamCases.size > 0}">
				<apex:commandLink action="{!first}"		value="<< First"	rendered="{!pageNumber > 1}" reRender="caseTable"/>&nbsp;
				<apex:commandLink action="{!previous}"	value="< Previous"	rendered="{!pageNumber > 1}" reRender="caseTable"/>&nbsp;
				Page <apex:input size="2" type="number" value="{!pageNumber}" html-min="1" html-max="{!saamCases.size}"><!-- disabled="{!saamCases.size == 1}" causes page to crash, waiting for https://success.salesforce.com/issues_view?id=a1p30000000T4hBAAS --><apex:actionSupport event="onchange" reRender="caseTable"/></apex:input> of {!saamCases.size}&nbsp;
				<apex:commandLink action="{!next}"		value="Next >"		rendered="{!pageNumber < saamCases.size}" reRender="caseTable"/>&nbsp;
				<apex:commandLink action="{!last}"		value="Last >>"		rendered="{!pageNumber < saamCases.size}" reRender="caseTable"/>&nbsp;
			</apex:outputPanel>

			<apex:pageBlockButtons>
				<apex:commandButton action="{!convert}" value="Convert" />
			</apex:pageBlockButtons>

		</apex:pageBlock>
	</apex:form>
</apex:page>