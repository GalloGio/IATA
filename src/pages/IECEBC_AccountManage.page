<apex:page id="thePage" controller="vfIECEBC_AccountManage" applyHtmlTag="false" applyBodyTag="false" sidebar="false" showheader="false" 
	standardStylesheets="false" language="en" docType="html-5.0">
	
	<apex:message id="msg" />
	
	<apex:composition template="IECEBC_Layout">
		<apex:define name="pageHeadAdditions">
			<!-- Start of Page <head> -->
			<title>eBroadcast Manager Account</title>
			
			<!-- End of Page </head> -->
		</apex:define>
		<apex:define name="pageScriptAdditions">
			<!-- If any page specific .js, add them here -->
			
			<script type="text/javascript">
				$j = jQuery.noConflict();
				
				$j( document ).ready(function( $ ) {
					//startObservingClassMutation();	
                    SetFilter();
				});

				// =========================================================================================
				// startObservingClassMutation is used if we want to detect the chage of class of a component
				function startObservingClassMutation() 
				{
					// listener definition on class change
					var observer = new MutationObserver(function(mutations) {
						mutations.forEach(function(mutation) {
							if (mutation.attributeName === "class") {
								console.log("Class attribute from", $j(mutation));
								var attributeValue = $j(mutation.target).prop(mutation.attributeName);
								console.log("Class attribute changed to:", attributeValue);
								
								if ( !attributeValue.includes('is-open')) {
									rerenderDataTableForm();
									console.log( 'rerender data table') ;
								}
							}
						});
					});	
					
					var $div = $j("#actPopUpMenu");
					var obsConfig = { attributes: true, attributeOldValue: true};
					observer.observe($div[0],  obsConfig);
				}
            function SetFilter()
            {
               
                
                //$j("#divactivitytypesort").html("Activity Type <i class='fa fa-caret-down' aria-hidden='true'></i>");    
                //alert("hello");
                
                }
			</script>
			
		</apex:define>
		<apex:define name="pageContent">
		
			<script type="text/javascript">
				function rerenderDataTableForm() {
					console.log( 'rerenderDataTableForm' );
					//rerenderDataTableFormX();
					refreshActivityTable();
					return false;
				 }
			</script>
			  
			<!-- Start of Page Content -->
			<main class="main-content manage-account">
				<div class="inner-wrapper">
					<h1 class="page-title">Account Details</h1>
					
					<div class="tab-container">
						<ul class="nav tabs">
							<li class="active"><a href="{!URLFOR($Page.IECEBC_AccountManage)}">Overview</a></li>
							<li><a href="{!URLFOR($Page.IECEBC_AccountRatePlan)}">Rate plan</a></li>
							<li><a href="{!URLFOR($Page.IECEBC_AccountExtras)}">Extras</a></li>
                            <li><a href="{!URLFOR($Page.IECEBC_AccountEmailBlocks)}">Email Blocks</a></li>
							<li><a href="{!URLFOR($Page.IECEBC_AccountSettings)}">Settings</a></li> 
						</ul>
						
						<div class="tab-content">
							<div class="tab-pane is-open" id="pane-1">
								
								
								<div class="row">
									<div class="columns medium-8">
										<h2 class="heading-2">Current plan: <strong>{!productRatePlan.Name}</strong></h2>
										
										<h3 class="heading-3">Current cost per email: ${!productRatePlan.EBC_Currency_Cost_Per_Email__c}</h3>
										<apex:ActionRegion rendered="{!showSubscriptionEnd}">
											<p>This cost per email is guaranteed until the end of your subscription <strong>{!subscription.Zuora__SubscriptionEndDate__c}</strong></p>
										</apex:ActionRegion>
										<div class="alert default">
											<apex:ActionRegion rendered="{!showSuggestionMessage}">
												<p>Lower your cost per email as low as USD $0.05 with our Pre-Paid rate plans.</p>
												<a href="#">See our rate plans</a>
											</apex:ActionRegion>
										</div>
									</div>
									<div class="columns medium-4">
										<section class="group-container">
											<h2 class="heading-2 strong">Current account balance</h2>
											<div class="account-box dark">
												<strong class="number">
													<apex:outputText value="{0, number, ###,###,##0}"><apex:param value="{!billingAccount.eBroadcast_Email_Balance__c}" /></apex:outputText>
												</strong>
												<span class="label">
													{!IF((billingAccount.eBroadcast_Email_Balance__c < -1 || billingAccount.eBroadcast_Email_Balance__c>1  ),"emails", "email")}
												</span>
												<div class="icon">
													<i class="fa fa-envelope" aria-hidden="true"></i>
												</div>
											</div>
										</section>
									</div>
								</div>
								
								<section class="group-container account-activity">
									<h2 class="heading-2 strong">Account activity</h2>
									<ul class="list grid-3">
										<li>
											<div class="account-box">
												<strong class="number">
													<apex:outputText value="{0, number, ###,###,##0}"><apex:param value="{!totalCampaigns}" /></apex:outputText>
												</strong>
												<span class="label">Total campaigns</span>
												<div class="icon">
													<i class="fa fa-bullhorn" aria-hidden="true"></i>
												</div>
											</div>
										</li>
										<li>
											<div class="account-box">
												<strong class="number">
													<apex:outputText value="{0, number, ###,###,##0}"><apex:param value="{!totalSends}" /></apex:outputText>
												</strong>
												<span class="label">Total sends</span>
												<div class="icon">
													<i class="fa fa-paper-plane" aria-hidden="true"></i>
												</div>
											</div>
										</li>
										<li>
											<div class="account-box">
												<strong class="number">
													<apex:outputText value="{0, number, ###,###,##0}"><apex:param value="{!totalCredits}" /></apex:outputText>
												</strong>
												<span class="label">Total credits</span>
												<div class="icon">
													<i class="fa fa-database" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</section>
								
							<div class="tab-container">
								<ul class="nav tabs">
										<li class="" data-target="#pane-1-a"><a href="#">Timeline view</a></li>
										<li data-target="#pane-1-b" class="active"><a href="#">Data table</a></li>
									</ul>
									<div class="tab-content">
										<div class="tab-pane" id="pane-1-a">
											<ul class="nav tabs secondary">
												<li data-target="#pane-1-a-day"><a href="#">Day</a></li>
												<li data-target="#pane-1-a-week"><a href="#">Week</a></li>
												<li data-target="#pane-1-a-month" class="active"><a href="#">Month</a></li>
											</ul>
											<div class="tab-content">
												<div class="tab-pane" id="pane-1-a-day">
													<div style="border: 1px solid #ccc; padding: 10px;">
														Day graph plugin here
													</div>
												</div>
												<div class="tab-pane" id="pane-1-a-week">
													<div style="border: 1px solid #ccc; padding: 10px;">
														Week graph plugin here
													</div>
												</div>
												<div class="tab-pane is-open" id="pane-1-a-month">
													<div style="border: 1px solid #ccc; padding: 10px;">
														Month graph plugin here
													</div>
												</div>
											</div>
											
										</div>
                                       
                                        <!--       
 <apex:actionFunction name="refreshTableX" action="{!refreshTable}" rerender="actListOutputPanel,actListTable" />    
                                                
                                        <apex:actionFunction name="refresh" action="{!doNothing}" rerender="actListOutputPanel" />
                                        <apex:actionFunction name="rerenderDataTableForm" action="{!doNothing}" rerender="dataTableForm" />
                                        <apex:actionFunction name="refreshActivityTable" action="{!refreshTable}" rerender="actListOutputPanel" />
                                        <apex:actionFunction name="rerenderActListTable" action="{!refreshTable}" rerender="actListTable" />
                                        <apex:commandButton id="testButton" value="testButton" action="{!refreshTable}" rerender="actListOutputPanel" />
										-->
										<div class="tab-pane is-open" id="pane-1-b">
                                            <apex:form id="dataTableForm">
                                             
                                                <apex:actionFunction name="refreshTableX" action="{!refreshTable}"  />    
                                                <apex:actionFunction name="refresh" action="{!doNothing}"  />
                                                <apex:actionFunction name="rerenderDataTableForm" action="{!doNothing}"  />
                                                <apex:actionFunction name="refreshActivityTable" action="{!refreshTable}"  reRender="dataTableForm"/>
                                                <apex:actionFunction name="rerenderActListTable" action="{!refreshTable}"   />
                                                <div class="table-container data-table-container">
                                                    
                                                        
                                                        <table class="data-table manage-lists">
                                                            <thead>
                                                                <tr>
                                                                    <th class="activity-type" >
                                                                        <div id="divactivitytypesort">
                                                                        <a class="pcjs-toggle-type-sort" href="#" id="activitytypesort">Activity Type <i class="fa fa-caret-down" aria-hidden="true"></i></a>
                                                                       
                                                                         <!--
																		<apex:outputLink value="#" id="activitytypesort" styleClass="js-toggle-type-sort" >Activity Type <i class="fa fa-caret-down" aria-hidden="true"></i></apex:outputLink>
                                                                        
                                                                        <a class="js-toggle-type-sort" href="#" >Activity Type <i class="fa fa-caret-down" aria-hidden="true"></i></a>
                                                                       -->
                                                                        														
                                                                        <div class="type-sort" id="actPopUpMenu">
                                                                            
                                                                            <ul class="list">
        
                                                                                <apex:repeat id="typeSelectionRepeat" value="{!activityTypeWrapperList}" var="actSel">
                                                                                    <li class="checkbox-box">
                                                                                        <!-- -->																					
                                                                                        <div class="custom-user-input checkbox">
                                                                                            <apex:inputCheckbox id="chckActType" value="{!actSel.selected}" styleClass="user-input checkbox"                                                                                                       
                                                                                                onclick="refreshActivityTable();"
                                                                                                                
                                                                                                 />
                                                                                            <label class="custom-checkbox" for="{!$Component.chckActType}"><i class="icon"></i></label>
                                                                                        </div>
                                                                                        <label class="input-label" for="{!$Component.chckActType}">{!actSel.activityType}</label>
                                                                                    </li>
                                                                                </apex:repeat>
                                                                                
        
        <!--
                                                                                        <div class="custom-user-input checkbox">
                                                                                            <input class="user-input checkbox" type="checkbox" id="actType{!act.index}" data-target-row="js-sort-type-adjustments" checked="" />
                                                                                            <label class="custom-checkbox" for="actType{!act.index}"><i class="icon"></i></label>
                                                                                        </div>
                                                                                        <label class="input-label" for="actType{!act.index}">{!act.activityType}</label>
        
        
        
        
                                                                                <li class="checkbox-box">
                                                                                    <div class="custom-user-input checkbox">
                                                                                        <input class="user-input checkbox" type="checkbox" id="type-1" data-target-row="js-sort-type-adjustments" checked="" />
                                                                                        <label class="custom-checkbox" for="type-1"><i class="icon"></i></label>
                                                                                    </div>
                                                                                    <label class="input-label" for="type-1">Adjustments</label>
                                                                                </li>
                                                                                <li class="checkbox-box">
                                                                                    <div class="custom-user-input checkbox">
                                                                                        <input class="user-input checkbox" type="checkbox" id="type-2" data-target-row="js-sort-type-credits" checked="" />
                                                                                        <label class="custom-checkbox" for="type-2"><i class="icon"></i></label>
                                                                                    </div>
                                                                                    <label class="input-label" for="type-2">Credits</label>
                                                                                </li>
                                                                                <li class="checkbox-box">
                                                                                    <div class="custom-user-input checkbox">
                                                                                        <input class="user-input checkbox" type="checkbox" id="type-3" data-target-row="js-sort-type-sends" checked="" />
                                                                                        <label class="custom-checkbox" for="type-3"><i class="icon"></i></label>
                                                                                    </div>
                                                                                    <label class="input-label" for="type-3">Sends</label>
                                                                                </li>
        -->
                                                                            </ul>
                                                                        </div>
                                                                          </div>
                                                                    </th>
                                                                    
                                                                    <th class="activity-date">Activity Date/Time</th>
                                                                    <th class="name">Activity Name</th>
                                                                    <th class="id">Campaign ID</th>
                                                                    <th class="total-count">Total Count</th>
                                                                </tr>
                                                                
                                                                <!-- 
                                                                {!NOW()} | <br/>
                                                                activityTypeWrapperList: {!activityTypeWrapperList} 
                                                                <br/>
                                                                activityList: {!activityList}
                                                                <br/>
                                                                page: {!page}
                                                                 -->
                                                             
                                                             </thead>       
                                                             <tbody>
                                                             <apex:repeat id="actListTable" value="{!activityList}" var="act">
                                                                    <tr class="js-sort-type-credits">
                                                                        <td class="activity-type">{!act.Activity_Type__c}</td>
                                                                        <td class="activity-date">
                                                                               <apex:outputText value="{0, date, d MMMM yyyy HH:mm} GMT"><apex:param value="{!act.Activity_Date_Time__c}" /></apex:outputText>																
                                                                        </td>																
                                                                        <td class="name">{!act.Name}</td>
                                                                        <td class="id">{!act.EBC_Campaign__r.Campaign_ID__c}</td>
                                                                        <td class="total-count">{!act.Total_Count__c} {!IF((act.Total_Count__c < -1 || act.Total_Count__c>1  ),"emails", "email")}</td>
                                                                    </tr>
                                                                </apex:repeat>
                                                                
        <!--														
                                                                <tr class="js-sort-type-adjustments">
                                                                    <td class="activity-type">Adjustments</td>
                                                                    <td class="name">Campaign 2</td>
                                                                    <td class="id">C-00000011</td>
                                                                    <td class="activity-date">01 Mar. 2016</td>
                                                                    <td class="total-count">5 email(s)</td>
                                                                </tr>
                                                                <tr class="js-sort-type-sends">
                                                                    <td class="activity-type">Sends</td>
                                                                    <td class="name">Campaign 3</td>
                                                                    <td class="id">C-00000011</td>
                                                                    <td class="activity-date">01 Mar. 2016</td>
                                                                    <td class="total-count">5 email(s)</td>
                                                                </tr>
                                                                <tr class="js-sort-type-sends">
                                                                    <td class="activity-type">Sends</td>
                                                                    <td class="name">Campaign 4</td>
                                                                    <td class="id">C-00000011</td>
                                                                    <td class="activity-date">01 Mar. 2016</td>
                                                                    <td class="total-count">5 email(s)</td>
                                                                </tr>
         -->													
                                                            </tbody>
                                                        </table>  
                                                    <script>
                                                    $j = jQuery.noConflict();
                                                    //var test=$j("#divactivitytypesort").html();
                                                    //$j("#divactivitytypesort").html(test.replace("<a>test</a>","<a class='js-toggle-type-sort' id='activitytypesort' >Activity Type <i class='fa fa-caret-down' aria-hidden='true'></i></a>"));   
                                                    // $j('#activitytypesort').unbind();
                                                    $j('#activitytypesort').removeClass(className.open).next().removeClass(className.open);
                                                    $j('#activitytypesort').on('click',  function(event) {
                                                        event.preventDefault();
                                                        event.stopPropagation();
                                                        $j(this).toggleClass(className.open).next().toggleClass(className.open);
                                                     });
                                                        
                                                    //alert(test);
                                                        </script> 
                                                  
                                                        <div class="pagination">
                                                            <div class="page-number">
                                                                Page
                                                                <div class="custom-user-input select">
                                                                    <i class="icon angle-down"></i>
                                                                    <!-- 
                                                                    <select class="user-input select">
                                                                        <option value="{!page}">{!pageOptions}</option>
                                                                    </select>
                                                                     -->
                                                                    
                                                                    <apex:selectList value="{!page}" styleClass="user-input select" size="1">
                                                                        <apex:selectOptions value="{!pageOptions}"/>
                                                                        <apex:actionSupport event="onchange" action="{!doNothing}" reRender="dataTableForm" />
                                                                    </apex:selectList> 
                                                                    
                                                                </div>
                                                                of {!maxPage}
                                                            </div>
                                                        </div>
                                                    
                                                </div>
											</apex:form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
			<!-- End of Page Content -->
		</apex:define>
	</apex:composition>
</apex:page>