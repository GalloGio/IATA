<apex:page controller="ISSP_ANG_CodeSearch" language="en" cache="false" 
           sidebar="false" showHeader="false" applyBodyTag="false" applyHtmlTag="false"
           docType="html-5.0" 
           standardStylesheets="false">
	
  <head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <c:ISSP_Header></c:ISSP_Header>
    <c:iss_ap_css />

  </head>
    <style>
      .section-header {
        background-color: rgb(43, 120, 228);
        color: white;
        line-height: 1.42857143;
        padding: 8px;
        vertical-align: top;
        border-top: 1px solid #ddd;
      }

      .section-header>i {
        color: black;
        margin-right: 5px;
      }

      .section-body {
        margin: 8px;
      }

      .table {
        width: 95%;
        max-width: 100%;
        margin-bottom: 20px;
      }

      .search {
      	margin-top: 20px;
      	margin-left: 20px;
      	margin-bottom: 20px;
      }

      .searchResults {
        margin-top: 20px;
        margin-left: 20px;
        margin-bottom: 20px;
      }

      main {
        background-color: white;
      }

    </style>
    <script type="text/javascript">
      $(document).ready(function() {
        $(window).keydown(function(event){
          if(event.keyCode == 13) {
            event.preventDefault();
            doSearch();
            return false;
          }
        });
      });     	   
    </script>

  <body>
    <main class="container">
      <c:ISSP_CustomNavigation />
      <apex:form id="mainFrm">

		  <apex:actionFunction action="{!doSearch}" name="doSearch" rerender="searchResults"/>

        <div id="page-wrapper" class="col-lg-12">
          <div class="row">
            <div class="section-header">
              <strong>IATA Code Search</strong>
            </div>
          </div>
          <div class="row">
            <div class="panel panel-default">
              <div class="search">
		            <span>
	        	      <apex:outputLabel value="IATA Code"/>
                  <span>
                    <apex:input type="number" value="{!iataCode}"/>
                    <a href="#" onclick="doSearch();"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a>
                  </span>
                </span>

                <apex:pageBlock id="searchResults">

                  <apex:outputPanel rendered="{!activeError}" >
                    <apex:outputText value="{!errorMessage}" style="margin-top: 15px;"/>
                  </apex:outputPanel>                

                  <apex:outputPanel rendered="{!activeSearch}" >

                    <table style="margin-top: 30px;">
                      <tr style="display:{!IF(NOT(showParent),'','none')};">
                        <td>
                          <apex:outputLabel value="IATA Code"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.IATACode__c}"/>                      
                        </td>
                      </tr>

                      <tr style="display:{!IF(showParent,'','none')};">
                        <td colspan="2">
                          <apex:outputText value="{! heMessage}"/>
                        </td>
                      </tr>

                      <tr style="display:{!IF(showParent,'','none')};">
                        <td colspan="2">
                            &nbsp;
                        </td>
                      </tr>

                      <tr style="display:{!IF(showParent,'','none')};">
                        <td>
                          <apex:outputLabel value="IATA Code (HO / HE)"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.IATACode__c}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Legal Name"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.Legal_name__c}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Trade Name"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.TradeName__c}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Country"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.IATA_ISO_Country__r.Name}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Accreditation Type"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.ANG_Accreditation_Model__c}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Risk Status"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! riskStatus}"/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Financial Security Exists"/>
                        </td>
                        <td>
                          <i style="display:{!IF(financialSecurityExists,'','none')}; margin-left: 2px;" class="glyphicon glyphicon-ok"></i>
                          <i style="display:{!IF(NOT(financialSecurityExists),'','none')}; margin-left: 2px;" class="glyphicon glyphicon-remove"></i>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <apex:outputLabel value="Accumulated Irregularities"/>
                        </td>
                        <td>
                          <apex:outputText style="margin-left: 5px;" value="{! agency.Accumulated_Irregularities__c}"/>
                        </td>
                      </tr>

                    </table>                

                    <apex:outputLabel value="Risk Events" style="margin-top: 20px;"/>

                    <table id="riskHistoryTable" class="table table-striped" cellspacing="0" width="100%">
                      <thead>
                          <tr>
                              <th>{!$Label.ANG_ISSP_REH_RiskDescription}</th>
                              <th>{!$Label.ISSP_Status}</th>
                              <th>{!$ObjectType.ANG_Agency_Risk_Event__c.fields.ANG_Issued_Date__c.Label}</th>
                              <th>{!$Label.ISSP_AMS_CGO_BR_ReadOnly_SECTION5_header4}</th>
                              <th>{!$Label.IDCard_IATA_Code_Of_Location}</th>
                              <th>{!$Label.ISSP_CaseNumber}</th>
                          </tr>
                      </thead>
                      <tbody>
                        <apex:repeat value="{! riskEventsList}" var="riskEvent">
                          <tr>                            
                            <td>{! riskEvent.description}</td>
                            <td>{! riskEvent.status}</td>
                            <td>
                              <apex:outputText value="{0, date, d MMM yyyy}">
                                <apex:param value="{! riskEvent.dateAssigned}" />
                              </apex:outputText>
                            </td>
                            <td>
                              <apex:outputText value="{0, date, d MMM yyyy}">
                                <apex:param value="{! riskEvent.dateExpired}" />
                              </apex:outputText>
                            </td>
                            <td>{! riskEvent.iataCode}</td>
                            <td>
                              <apex:outputText escape="false" value="{! riskEvent.caseNumberLink}"></apex:outputText>
                            </td>
                          </tr>                            
                        </apex:repeat>                    
                      </tbody>
                    </table>
                    <script type="text/javascript">
                      $('#riskHistoryTable').dataTable( {
                        "pageLength": 5,
                        "lengthMenu": [ 5, 10, 25, 50 ],
                        "searching": false
                      } );                      
                    </script>
                  </apex:outputPanel>
                </apex:pageBlock>
              </div>
            </div>
          </div>
        </div>

      	<c:ISSP_CustomFooter />
      </apex:form>
  	</main>

    <script src="{!URLFOR($Resource.DataTablesBootstrap)}"></script>
    <script src="{!URLFOR($Resource.JqueryDataTables)}"></script>  
    <link type="text/css" rel="stylesheet" href="{!URLFOR($Resource.DataTablesBootstrapCSS,'dataTables.bootstrap.min.css')}" />

  </body>  

</apex:page>