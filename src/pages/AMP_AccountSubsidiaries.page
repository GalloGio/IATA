<apex:page showHeader="true" sidebar="true" standardController="Account" extensions="AMP_OwnershipController">
	<apex:pageMessages />

	<apex:form >
		<apex:pageBlock >
			<apex:outputPanel id="SubsidiariesTable">
				<h2>Airline-Subsidiaries</h2>

				<apex:pageBlockTable value="{!subsidiaries.amsAccountRoleList}" var="item">

					<apex:column style="width: 80px;">
	                    <apex:facet name="header">Actions</apex:facet>

	                    <apex:commandLink value="Del" action="{!DeleteLine}" onclick="if(!confirm('Are you sure you want to delete this line?')){return false};" rendered="{! !(isEditMode && IdConcerned == item.Id) && canEdit && (!item.No_Airline_Subsidiaries__c || subsidiaries.canUserHandleSpecialLine)}" >
                    		<apex:param name="IdConcerned" value="{!item.Id}" assignTo="{!IdConcerned}"/>
                    	</apex:commandLink>
                    	&nbsp;
                    	<apex:commandLink value="Edit" action="{!EditLine}" rerender="SubsidiariesTable" rendered="{! !(isEditMode && IdConcerned == item.Id) && canEdit && !item.No_Airline_Subsidiaries__c}" >
                    		<apex:param name="IdConcerned" value="{!item.Id}" assignTo="{!IdConcerned}"/>
                    	</apex:commandLink>

                    	<apex:commandLink value="Save" action="{!SaveLine}" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), true, false)}" >
                    		<apex:param name="IdConcerned" value="{!item.Id}" assignTo="{!IdConcerned}"/>
                    	</apex:commandLink>
                    	&nbsp;
                    	<apex:commandLink value="Cancel" action="{!CancelEdit}" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), true, false)}" >
                    		<apex:param name="IdConcerned" value="{!item.Id}" assignTo="{!IdConcerned}"/>
                    	</apex:commandLink>
	            	</apex:column>

	            	<apex:column >
	            		<apex:facet name="header">Account Name</apex:facet>

						<apex:outputPanel rendered="{! item.No_Airline_Subsidiaries__c == false}">
		            		<apex:inputField value="{!item.Account__c}" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), true, false)}" style="width: 80%;" />
	            			<apex:outputLink value="/{!item.Account__c}" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), false, true)}" target="_blank" >{!item.Account__r.Name}</apex:outputLink>
						</apex:outputPanel>
						<apex:outputPanel rendered="{! item.No_Airline_Subsidiaries__c == true}">
		            		<apex:outputText value="{! $Label.No_Airline_Subsidiaries_Label}" style="width: 80%;" />
						</apex:outputPanel>


	            	</apex:column>

	            	<apex:column >
	            		<apex:facet name="header">Subsidiary Type</apex:facet>

            			<apex:outputField value="{!item.Account__r.Membership_status__c}" rendered="{! item.No_Airline_Subsidiaries__c == false}"/>
	            	</apex:column>

	            	<apex:column >
	            		<apex:facet name="header">Percentage Held</apex:facet>

						<apex:outputPanel rendered="{! item.No_Airline_Subsidiaries__c == false}">
		            		<apex:inputField value="{!item.Percentage__c}" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), true, false)}" style="width: 90%;" />
	            			<apex:outputText value="{0,number,0}%" rendered="{!IF(AND(isEditMode, IdConcerned==item.Id), false, true)}" >
							    <apex:param value="{!item.Percentage__c}" />
							</apex:outputText>
						</apex:outputPanel>

	            	</apex:column>

				</apex:pageBlockTable>

				<apex:commandButton action="{!AddNewSubsidiary}" value="Add Subsidiary" rendered="{!IF(OR(isEditMode, NOT(canEdit)), false, true) && NOT(subsidiaries.hasSpecialLine)}" />
				<apex:commandButton action="{!AddNoAirlineSubsidiaries}" onclick="if(!confirm('Are you sure this airline has no subsidiaries?')){return false};" value="{! $Label.No_Subsidiaries}" rendered="{! !isEditMode && canEdit && subsidiaries.canSpecialLineBeAdded && subsidiaries.canUserHandleSpecialLine}" />
			</apex:outputPanel>



		</apex:pageBlock>

	</apex:form>
</apex:page>