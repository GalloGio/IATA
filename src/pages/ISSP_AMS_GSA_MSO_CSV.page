<apex:page controller="ISSP_AMS_MSO_Controller" contentType="text/csv#{!IF(isMSO,'MSO', 'GSA')}_Appointments.csv"  action="{!checkIfUserHasAccessToService}">{!CSVHeader}"{!$Label.ISSP_AMS_MSO_GSA_IATA_Code}","{!IF(isMSO, $Label.ISSP_AMS_MSO_GSA_Account_Name_MSO, $Label.ISSP_AMS_MSO_GSA_Account_Name_GSA)}","{!$Label.ISSP_AMS_MSO_GSA_Appointment_Status}","{!$Label.ISSP_AMS_MSO_GSA_Date_of_Appointment}","{!$Label.ISSP_AMS_MSO_GSA_Date_Appointment_Terminated}","{!IF(isMSO, ($Label.ISSP_AMS_MSO_GSA_Category + '","' + $Label.ISSP_AMS_MSO_GSA_Street_Address), $Label.ISSP_AMS_MSO_GSA_Territories) }","{!$Label.ISSP_AMS_MSO_GSA_City}","{!$Label.ISSP_AMS_MSO_GSA_Country}"

<apex:repeat value="{!lstDisplayAccounts}" var="a">
"{!a.appointment.Account__r.IATACode__c}","{!a.appointment.Account__r.Name}","{!CASE(a.appointment.Accreditation_Endorsement_Status_code__c, '0', $Label.ISSP_AMS_MSO_GSA_Appointment_Terminated, '9', $Label.ISSP_AMS_MSO_GSA_Appointment_Active, a.appointment.Accreditation_Endorsement_Status_code__c)}","{!IF(a.appointment.Accreditation_Endorsement_Status_code__c == '9', TEXT(a.appointment.Date_Organisation_Status_attained__c), '')}","{!IF(a.appointment.Accreditation_Endorsement_Status_code__c == '0', TEXT(a.appointment.Date_Organisation_Status_attained__c), '')}","{!IF(isMSO,(a.appointment.Account__r.Category__c + '","' + a.appointment.Account__r.BillingStreet), a.territories) }","{!a.appointment.Account__r.BillingCity}","{!a.appointment.Account__r.BillingCountry}"
</apex:repeat>

</apex:page>