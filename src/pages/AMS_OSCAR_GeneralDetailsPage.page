<apex:page extensions="AMS_OSCAR_Case_Detail_Controller" standardController="Case">
   
         <!-- <c:AMS_CrossObjectViewer displayedObject="{!AMS_OSCAR__c}"/> -->
    <apex:includeScript value="/support/console/34.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery2_1_4}"/>

    <script type="text/javascript">
        var eventHandler = function (result) {
            if('{!oscarObj}' != null){
                rerenderDetailInfo();
                rerenderwarningInspPanel();
                // INC273249 : avoid to refresh the whole page when switching between a Case sub-tabs (loss of unsaved information)
                // refreshTab();
            }
        };
        sforce.console.onFocusedSubtab(eventHandler);

        function RefreshPrimaryTab(id) 
        {
             if (sforce.console.isInConsole())
                  sforce.console.getFocusedPrimaryTabId(showTabId);
             else
                  window.top.location.href = '/' + id;
        }

        function refreshTab(){

            if (sforce.console.isInConsole()) {
                sforce.console.getEnclosingTabId(function(enclosingResult){
                    sforce.console.getEnclosingPrimaryTabId(function(primaryResult){
                        sforce.console.refreshPrimaryTabById(primaryResult.id,true,null);
                    });
                });
            } else {
                // for inline Vf
                window.top.location.href = '/'+redirectUrl
                // for normal vf
                // window.location.href = '/'+redirectUrl
            }
        }
        function refreshSubTab(){

           if (sforce.console.isInConsole()) {
                  sforce.console.getFocusedSubtabId(function(enclosingResult){
                        sforce.console.refreshSubtabById(enclosingResult.id,true,null);
                });
            } else {
                // for inline Vf
                window.top.location.href = '/'+redirectUrl
                // for normal vf
                // window.location.href = '/'+redirectUrl
            }
        }

        var showTabId = function showTabId(result) 
        {
            var tabId = result.id;
            sforce.console.refreshPrimaryTabById(tabId , true);
        };

        function openPrimaryTab(tabId,tabName) {
            var changeTab = function(result){
                if(result.success == false){
                    sforce.console.focusPrimaryTabByName(tabId);
                }
            };
            //Open a new agency primary tab
            sforce.console.openPrimaryTab(null, tabId, true,tabName, changeTab, tabId);
        }

        function openSubTab(url,label,name,openimmediately) {
          sforce.console.getEnclosingPrimaryTabId(function(primarytab){
            sforce.console.openSubtab(primarytab.id , url, openimmediately, label, null, function(result){
              // do any processing here if passes or fails, use result.success (boolean)
            }, name);
          });
        }
    </script>
   
    <style type="text/css">
            .dataCol {
                font-size:91%;
            }
            .labelCol {
                padding-top:2px;
                padding-right:10px;
                padding-bottom:2px;
                padding-left:2px;
                text-align:right;
                font-size:91%;
                font-weight:bold;
                color:#333
            }
            .labelCol.vfLabelColTextWrap {
                padding-top:2px;
                padding-right:10px;
                padding-bottom:2px;
                padding-left:2px;
                text-align:right;
                font-size:81%;
                font-weight:bold;
                color:#333
            }

            .mandatoryField{
                font-weight: bold;
            }

            .overlay{
                height: 100%;
                width: 100%;
                position: fixed;
                z-index: 100;
                top: 0;
                left: 0;
                background-color: rgb(0,0,0);
                background-color: rgba(0,0,0, 0.85);
                overflow-x: hidden;
            }

            .overlay-content {
                position: relative;
                top: 15%;
                width: 100%;
                text-align: center;
                margin-top: 30px;
            }

            .overlay a:hover, .overlay a:focus {
                color: #f1f1f1;
            }

            .overlay a:visited {
                color: #666666;
            }

            .overlay p, ul, li {
                padding: 8px;
                text-decoration: none;
                font-size: 22px;
                color: #818181;
                display: block; /* Display block instead of inline */
                transition: 0.3s; /* Transition effects on hover (color) */
            }

            .overlay ul, li {
                font-size: 14px;
                color: #818181;
                text-align: left;
                display: block; /* Display block instead of inline */
                line-height: 30%;
            }

            .editable{
                background-color: lightyellow;
            }
            th.editable:before{
                content: "*";
                color: red;
                font-weight: bold;
            }

     </style>

    <br />
    <br />
 
    <apex:form >
    
    <apex:outputPanel id="warningInspPanelContainer" >
        <apex:outputPanel id="warningInspPanel" rendered="{!IF( ExistOscarInspections ,false, true)}">
            <apex:pageMessages ></apex:pageMessages>
       </apex:outputPanel>
    </apex:outputPanel>
     
        <apex:pageBlock mode="maindetail" tabStyle="AMS_Pax_Accreditation_Form__c" title="Account Detail" rendered="{!accreditationObj != null}">

        
            <apex:pageBlockButtons location="both">
                <apex:commandButton value="Save" action="{!save}" id="saveButton" style="display: none;"/>
                <apex:commandButton value="Cancel" action="{!cancel}" id="cancelButton" style="display: none;"/>
            </apex:pageBlockButtons>
        
        <apex:pageMessage severity="WARNING"
            strength="1"
            summary="Field editing will be available based on the selected {!$ObjectType.AMS_OSCAR__c.fields.Type_of_change__c.label}"
            rendered="{!not(hasEditableFields)}"
        />
    
            <apex:pageBlockSection columns="2" id="AccountInformation" collapsible="false">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Account"></apex:outputLabel>
                     <apex:outputLink value="#" onclick="openPrimaryTab('/{!oscarObj.Account__c}?inContextPane=true','{!JSINHTMLENCODE(oscarObj.Account__r.name)}');return false;" >{!oscarObj.Account__r.name}</apex:outputLink>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >&nbsp;</apex:pageBlockSectionItem>

            <apex:repeat value="{!accreditationFields}" var="field">
                <apex:pageBlockSectionItem labelStyleClass="{!IF(isAgencyChanges, field.styleClass, '')}" dataStyleClass="{!IF(isAgencyChanges, field.styleClass, '')}">
                    <apex:outputLabel value="{!$ObjectType.AMS_Pax_Accreditation_Form__c.fields[field.name].Label}" />
                    <apex:outputField value="{!accreditationObj[field.name]}" >
                        <apex:inlineEditSupport event="{!field.event}" showonEdit="saveButton,cancelButton" disabled="{!NOT(field.inlineEdit)}" />
                <apex:outputField value="{!accreditationObj.Account_Name__c}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.IATACode__c}" >
                   <!-- <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" /> -->
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.ISSP_AMS_Legal_Status__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.CASS_Number__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Short_Name__c}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Location_Class__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Location_Type__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Trade_Name__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.ISSP_AMS_License_No__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.ISSP_AMS_VAT_number__c}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.ISSP_AMS_GDS_with_signed_contract__c}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_Country__c}" id="Branch_Office_Country" >
                    <apex:inlineEditSupport event="onclick" showonEdit="saveButton,cancelButton"  disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_Street_name_number__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_Postal_code__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <!-- 
                DT: Removed as per request
                <apex:outputField value="{!accreditationObj.Billing_State__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" />
                </apex:outputField>
                 -->
                 <!-- DT: Added as per request -->
                <!--<apex:outputField value="{!accreditationObj.ISO_Country__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" />
                </apex:outputField>
                -->
                <apex:outputField value="{!accreditationObj.Branch_Office_City__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.IATA_ISO_State__c}" id="IATA_ISO_State" >
                    <apex:inlineEditSupport event="onclick" showonEdit="saveButton,cancelButton"  disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <!-- 
                DT: Removed as per request
                <apex:outputField value="{!accreditationObj.Shipping_Country__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" />
                </apex:outputField>
                -->
                <apex:outputField value="{!accreditationObj.Shipping_Street__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Shipping_Postal_Code__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <!-- DT: Added as per request -->
                <apex:outputField value="{!accreditationObj.Shipping_ISO_Country__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <!-- DT: Added as per request -->
                <apex:outputField value="{!accreditationObj.Shipping_ISO_State__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <!-- 
                DT: Removed as per request
                <apex:outputField value="{!accreditationObj.Shipping_State__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" />
                </apex:outputField>
                -->
                <apex:outputField value="{!accreditationObj.Shipping_City__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_Email__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Website__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_Phone__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Branch_Office_FAX__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.ISSP_AMS_Premises_located_at_airport__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Mobile__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Abbreviated_name__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Abbreviated_Address__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Remittance_frequency__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Solicitation_Flag__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.VAT_Number_2__c}" >
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Is_your_firm_handling_Dangerous_Goods__c}" rendered="{!isCargoAgency}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                <apex:outputField value="{!accreditationObj.Link_agent_name__c}">
                    <apex:inlineEditSupport event="ondblClick" showonEdit="saveButton,cancelButton" disabled="{!IF(isCertificationOSCAR, true, false)}"/>
                </apex:outputField>
                </apex:pageBlockSectionItem>
            </apex:repeat>

            </apex:pageBlockSection>
                 

        </apex:pageBlock>
        
        <script>
        $(".branchOffice").dblclick(function() {
                      openSubTab('/{!accreditationObj.Branch_Office_Country__c}','','',true);return false;
                    });
        $(".isoState").dblclick(function() {
                      openSubTab('/{!accreditationObj.IATA_ISO_State__c}','','',true);return false;
                    });
        
            if({!saveAction}){
                refreshTab();
            }
        </script>
    
    <apex:actionFunction name="rerenderDetailInfo" rerender="detailInfo" />
    <apex:actionFunction name="rerenderwarningInspPanel" rerender="warningInspPanelContainer" />

    </apex:form>
    
    <hr/>

    <apex:detail id="detailInfo" subject="{!oscarObj}" relatedList="true"  title="false" rendered="{!IF(oscarObj != null, true, false)}" rerender="{!oscarObj}" inlineEdit="true" oncomplete="refreshTab()"/>

    <apex:pageBlock rendered="{!oscarObj == null}">
        <div class="overlay">
        <div class="overlay-content">
            <p style="font-size: 36px;">UNAVAILABLE</p>
            <p>This Case is in draft mode and does not have an OSCAR Accreditation object created. Please create an OSCAR (trough the wizard) before you can proceed.
            </p>
          </div>
        </div>
    </apex:pageBlock>

</apex:page>