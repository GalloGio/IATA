<!-- START CHANGE MINESH CHAUHAN 24/08/17: ADDED FOR SECURITY RECOMMENDATION -->
<!-- :changed language attribute on apex:page to retrieve language from URL parameter instead of from controller -->
<apex:page controller="ISSP_ForgotPasswordController" showHeader="false" sidebar="false" standardStylesheets="false" language="{!$CurrentPage.parameters.lang}" action="{!isLogined}" >
<!-- END CHANGE -->

  <style>
    h3.panel-title {background: none repeat scroll 0 0 #a1bc00;color: #fff;display: block;font-size: 19px;font-weight: normal;margin-top: 0;padding: 10px;}
    .btn-primarygreen {color: #ffffff;background-color: #a1bc00;border: 1px solid #4E8E15;font-weight: bold;cursor: pointer;}
  </style>

  <apex:composition template="{!CASE(communityName, 'CNS', 'CNS_Template', 'ISS', 'ISS_Template', 'ISS_Template')}">
    <apex:define name="body">
      <div class="{!CASE(communityName, 'CNS', 'logocns', 'logo')}"> </div>
      <div style="width:40%;margin: 0 auto;">
        <!-- START CHANGE MINESH CHAUHAN 24/08/17: ADDED FOR SECURITY RECOMMENDATION -->
        <!-- EMAILSENT VAR NO LONGER USED; CHANGED TO SUBMITTED VAR INSTEAD AND REMOVED DISPLAY CONDITION-->
        <div class="panel panel-default">
        <!-- END CHANGE -->
          <div>
            <h3 class="panel-title">{!$Label.site.forgot_your_password_q}</h3>
          </div>

          <apex:form styleClass="login_box form-horizontal" id="loginForm" forceSSL="true">
            <!-- START CHANGE MINESH CHAUHAN 24/08/17: ADDED FOR SECURITY RECOMMENDATION -->
            <!-- : added outputPanel with layout to render as a paragraph for containing the generic message -->
            <apex:outputPanel id="messages" layout="block">
              <!-- : added apex:pageMessages for catching email errors (null and pattern matching) -->
              <apex:pageMessages />
              <!-- : added generic message for non CNS portal users -->
              <apex:outputText value="{!$Label.ISSP_Forgot_Password_Message}" rendered="{!IF(AND(communityName!='CNS',submitted),'true','false')}" escape="false">
                <!-- : added username param to be injected into custom label to display username -->
                <apex:param value="{!username}"/>
                <!-- : added url for Troubleshooting Page to be injected into custom label, which renders it as hyperlink -->
                <apex:param value="http://portal.iata.org/faq/articles/{!IF($CurrentPage.parameters.lang!="",$CurrentPage.parameters.lang,'en_US')}/How_To/Customer-Portal-Troubleshooting?l={!IF($CurrentPage.parameters.lang!="",$CurrentPage.parameters.lang,'en_US')}"/>
              </apex:outputText>
              <!-- : added generic message for CNS portal users -->
              <apex:outputText value="{!$Label.ISSP_Forgot_Password_Message_CNS}" rendered="{!IF(AND(communityName=='CNS',submitted),'true','false')}" escape="false">
                <!-- : added username param to be injected into custom label to display username -->
                <apex:param value="{!username}"/>
              </apex:outputText>
            </apex:outputPanel>

            <br/>

            <!-- : added attribute style="display:{!if(submitted,'none','')}"" attribute to div -->
            <div class="form-group" style="display:{!if(submitted,'none;','')}">
            <!-- END CHANGE -->
              <apex:outputLabel styleclass="col-lg-4 control-label" value="{!$Label.site.email}" for="username"/>
              <div class="col-lg-8">
                <apex:inputText styleclass="form-control" id="username" value="{!username}"/>
              </div>
            </div>
            <!-- START CHANGE MINESH CHAUHAN 24/08/17: ADDED FOR SECURITY RECOMMENDATION -->
            <!--: added attribute style="{!if(submitted,'none','')}" to div -->
            <div class="row" style="display:{!if(submitted,'none;','')}">
              <div class="col-md-3  col-md-offset-9">
                <apex:commandButton styleclass="btn_iata  btn-primarygreen" action="{!forgotPassword}" value="{!$Label.site.submit}" id="btnSubmit"/>
              </div>
            </div>
            <apex:outputLink value="{!$Page.ISSP_Login}" id="LoginLink" styleClass="links">
              <apex:param name="communityName" value="{!communityName}"/>
              <apex:outputText value="{!$Label.site.go_to_login_page}" escape="false"/>
            </apex:outputLink>
          </apex:form>
        </div>
      </div>
    </apex:define>
  </apex:composition>
</apex:page>
