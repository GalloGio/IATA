<apex:page controller="ISSP_APProcess"
           cache="false"
           sidebar="false"
           showHeader="false"
           standardStylesheets="false"
           applyBodyTag="false"
           applyHtmlTag="false"
           >
<html>
    	<c:ISSP_Header ></c:ISSP_Header>
 		<body>

 <link rel="stylesheet" href="{!URLFOR($Resource.bootstrapselect, '/bootstrap-select-1.12.2/css/bootstrap-select.css')}" type="text/css" />
 <script src="{!URLFOR($Resource.bootstrapselect, '/bootstrap-select-1.12.2/js/bootstrap-select.js')}"></script>

  <style>
    .iatainputbox {
      width: 90%;
      height: 34px;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      color: #555;
      background-color: #fff;
      background-image: none;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    div.customTable {
      width: 80%;
    }

    div.customTable>div:nth-child(2n-1) {
      padding-top: 5px;
      width: 40%;
      float: left;
    }

    div.customTable>div:nth-child(2n) {
      padding-top: 5px;
      width: 60%;
      float: left;
    }
  </style>


  <script>
    var optInOut;

    function optInOut() {
       $('#optInOut').modal('toggle');
    }

    $(document).ready(function(){
        $('#optInOutSelected').on('change', function(){
          optInOut = $('#optInOutSelected option:selected').val();

          getListOfCountries(optInOut);
        });
    });



//      if(optInOut == '') {
//        document.querySelector("[Id$='optInOutSelectErrorMsg']").style.display = '';
//      }

    function getListOfCountriesSuccess() {
      $('.selectpicker').selectpicker('render');

      $( function() {
        if(optInOut == 'IN') {
          $( "#datepicker" ).datepicker({minDate: 0});
        } else {
          $( "#datepicker" ).datepicker({minDate: 30});
        }

        $( "#datepicker" ).datepicker( "option", $.datepicker.regional[ 'en' ] );
        $( "#datepicker" ).datepicker( "option", "dateFormat", "yy-mm-dd" );
        $( "#datepicker" ).on( "change", function() {
          $('[id$=effectiveDateOfChange]').val($("#datepicker").val());
        });
      });
    }

    function submitOptInOut() {
      var countries = $('[id$="countries"]').val();

      var efectiveDate = $('#datepicker').val();

      var ok = 1;

      if(efectiveDate == undefined || efectiveDate == null || efectiveDate == "") {
        document.querySelector("[Id$='efectiveDateErrorMsg']").style.display = '';
        ok = 0;
      } else {
        document.querySelector("[Id$='efectiveDateErrorMsg']").style.display = 'none';
      }
      if(countries == undefined || countries == null || countries == "") {
        document.querySelector("[Id$='countriesErrorMsg']").style.display = '';
        ok = 0;
      } else {
        document.querySelector("[Id$='countriesErrorMsg']").style.display = 'none';
      }

      if(ok == 1) {
        submitOptInOutServer(optInOut, countries, efectiveDate);
      }
    }

    function submitOptInOutServerSuccess() {

    }

  </script>

	<div class="container">
        <c:ISSP_CustomNavigation />
    <h3>Airline Participation</h3>
    <p/>
      <apex:outputText rendered="{!dupeDraftExists}" style="color: red; font-weight:bold" value="A {!$CurrentPage.parameters.cdupetype} {!IF($CurrentPage.parameters.proc=='chg','change request','joining application')} for {!apCountry} has already been submitted for {!hqAccount.Name}. (Case no. {!newCase.CaseNumber}, status '{!newCase.Status}')"></apex:outputText>
    <p/>
    <apex:image value="/img/msg_icons/info24.png" style="vertical-align:middle;margin-right:5px;float:left" />
    <div style="margin-bottom:6px;padding-left:24px">
      This area is used to access Airline Participation Joining Applications and Change Requests that you are currently working on (Draft or Pending Customer status).<br/>
      This gives you the possibility to resume your Joining Applications and Change Requests at any time in order to submit them to IATA for processing.<br/><br/>
      Please go to <a href="/ISSP_CaseList">My Cases</a> in order to check the status of all cases you have with IATA, including Airline Participation cases already submitted for Approval.
    </div>
    <apex:pageBlock rendered="{!IsNotEmpty}">
      <apex:pageBlockButtons location="top" style="Width:100%;margin-top:20px;">
        <apex:form >
          <center>
            <apex:commandButton rendered="{!strAreaType='Airline Joining'}" styleClass="btn btn-default" onClick="navigateToUrl('/ISSP_APProcess?retUrl=/ISSP_HomePage','LIST_VIEW','newCase');return false;" value="New Joining Application"/>
            <apex:commandButton rendered="{!APprocess=='chg'}" styleClass="btn btn-default" onClick="navigateToUrl('/ISSP_APProcess?proc=chg&retUrl=/ISSP_HomePage','LIST_VIEW','newCase');return false;" value="New Change Request"/>
            <apex:commandButton rendered="{!APprocess=='bnk'}" styleClass="btn btn-default" onClick="navigateToUrl('/ISSP_APProcess?proc=bnk&retUrl=/ISSP_HomePage','LIST_VIEW','newCase');return false;" value="New Change of bank details"/>
            <apex:commandButton rendered="{!APprocess=='chg'}" styleClass="btn btn-default" onClick="optInOut();return false;" value="Option IATA EasyPay Opt-in"/>


          </center>
        </apex:form>
      </apex:pageBlockButtons>
      <br />
      <div class="panel panel-default">
        <div class="panel-body">
          <apex:pageBlockTable value="{!APDraftCases}" var="MyIFAPCases" styleClass="table">
            <apex:column headerValue="{!$Label.ISSP_CaseNumber}">
              <apex:outputLink value="/ISSP_APProcess?caseId={!MyIFAPCases.Id}&step=2">{!MyIFAPCases.CaseNumber}</apex:outputLink>
            </apex:column>
            <apex:column value="{!MyIFAPCases.Account_Concerned__r.Site}"/>
            <apex:column value="{!MyIFAPCases.Subject}"/>
            <apex:column value="{!MyIFAPCases.Status}"/>
            <apex:column value="{!MyIFAPCases.CreatedDate}"/>

            <!-- <apex:column value="{!MyIFAPCases.Reason1__c}"/> -->
          </apex:pageBlockTable>
        </div>
      </div>
    </apex:pageBlock>

    <apex:pageBlock rendered="{!IsEmpty}" mode="maindetail">
      <div align="center" style="display: {!IF(APprocess=='chg','','none')}; color:#00AEEF; padding-bottom:10px;padding-top:10px;">
        <h3 style="color:#FFAE00"><a onclick="optInOut();">IATA Easy Pay Opt-in / Out</a></h3>
      </div>

      <div align="center" style="color:#00AEEF; padding-bottom:5cm;padding-top:1cm;">
        <img src="https://iata--c.eu3.content.force.com/servlet/servlet.ImageServer?id=01520000000zGve&oid=00D2000000008TF&lastMod=1401896785000"/><br/>
        <h3>You don't have any pending Airline Participation {!IF(APprocess=='chg', 'Change Requests', IF(APprocess=='bnk', 'change of bank account details', 'Joining Processes'))}</h3><br/>
        <h3 style="color:#FFAE00"><a href="/ISSP_APProcess?proc={!APprocess}&retURL=/ISSP_APCases">Create a new one</a></h3>
      </div>
    </apex:pageBlock>

    <c:ISSP_CustomFooter />
  </div><!-- end container-->

  <!-- Modal -->
  <div id="optInOut" class="modal fade" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">IATA EasyPay Opt-in / Out</h4>
        </div>
        <div class="modal-body">
          <p></p>
          <!--div class="alert alert-danger" id="optInOutSelectErrorMsg" style ="display: none">
            <strong> Must select either to Opt-IN or Opt-OUT Iata EasyPay.</strong>
          </div-->
          <div class="alert alert-danger" id="efectiveDateErrorMsg" style ="display: none">
            <strong>An efective date must be defined.</strong>
          </div>
          <div class="alert alert-danger" id="countriesErrorMsg" style ="display: none">
            <strong>One or more countries must be selected.</strong>
          </div>

          <apex:form>

            <apex:inputHidden value="{!pEfectiveDateStr}" id="effectiveDateOfChange"/>

            <apex:actionFunction name="getListOfCountries" action="{!getListOfCountries}" rerender="servicesRenderedPanel" oncomplete="getListOfCountriesSuccess();">
              <apex:param id="optInOutParamId" name="optInOutParam" value="" />
            </apex:actionFunction>

            <apex:actionFunction name="submitOptInOutServer" action="{!submitOptInOutServer}" oncomplete="submitOptInOutServerSuccess();">
              <apex:param id="optInOutParamId2" name="optInOutParam" value="" />
              <apex:param id="countriesId" name="countries" value="" />
              <apex:param id="efectiveDateId" name="efectiveDate" value="" />
            </apex:actionFunction>

            <div class="row">
              <div class="customTable" style="margin-left: 15px;">
                <div>
                  <apex:outputLabel value="My Airline wishes to :"/>
                </div>
                <div>
                  <select class="iatainputbox, selectpicker" id="optInOutSelected">
                    <option value="">-Select-</option>
                    <option value="IN">Opt-In to IATA EasyPay</option>
                    <option value="OUT">Opt-out from IATA EasyPay</option>
                  </select>
                </div>
              </div>
            </div>

            <apex:pageBlock id="servicesRenderedPanel">
              <apex:outputPanel rendered="{!flagShowCountries}">
                <hr></hr>
                <div class="row">
                  <div class="customTable" style="margin-left: 15px;">
                    <div>
                      <apex:outputLabel value="{!countriesLabel}"/>
                    </div>
                    <div>
                      <apex:selectList styleClass="iatainputbox, selectpicker" html-data-live-search="true" id="countries"
                        value="{!selectedCountries}" required="true" multiselect="true" size="5"
                        title="{!countriesTitle}">
                        <apex:selectOptions value="{!countries}"/>
                      </apex:selectList>
                    </div>
                  </div>
                </div>
                <br></br>
                <div class="row">
                  <div class="customTable" style="margin-left: 15px;">
                    <div>
                      <apex:outputLabel value="Effective Date : "/>
                    </div>
                    <div>
                      <input type="text" id="datepicker"/>
                    </div>
                  </div>
                </div>
              </apex:outputPanel>
            </apex:pageBlock>
          </apex:form>

        </div>
        <div class="modal-footer">
          <div class="row">
            <div class="col-md-6">
              <button type="button" class="btn btn-danger btn-block" data-dismiss="modal">Cancel</button>
            </div>
            <div class="col-md-6">
              <button type="button" id="submitOptInOutBtn" onclick="submitOptInOut()" class="btn btn-success btn-block" style="display: {!IF(flagShowCountries,'none','')};">Submit Request to IATA</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  </body>
</html>
</apex:page>