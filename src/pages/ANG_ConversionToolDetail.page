<apex:page controller="ANG_ConversionToolController" showHeader="true">

 <apex:includeScript value="/support/console/34.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery2_1_4}"/>

    <script type="text/javascript">
        function openPrimaryTab(tabId,tabName) {
            var changeTab = function(result){
                if(result.success == false){
                    sforce.console.focusPrimaryTabByName(tabId);
                }
            };
            //Open a new agency primary tab
            sforce.console.openPrimaryTab(null, tabId, true,tabName, changeTab, tabId);
        }
    </script>

	<apex:sectionHeader title="Agencies migration tool: exception management" />   
	<apex:form >
	<apex:PageBlock id="pb"  >
		<apex:pageBlockSection title="Exception management" collapsible="false" id="Overview"  rendered="true" columns="1">
			<h1>{!DetailMessage} for {!selectedCountryName}</h1>
			<br />
			The system identified some hierarchies containing branches abroad. There are an exception because the Multicountry accreditation type is not supported yet.
			<br /><br />
			<h1>Workaround</h1>
			<br />
			The system will convert all the hierarchies selected by the User applying the following rules:
			<ul>
				<li>Branches abroad will be converted in AE but they may have the flag "Is New Gen Agency" set to false!</li>
				<li>The location class will not be changed for any Agency so the flag "Is New Gen Agency" may still be false for some agencies</li>
			</ul>
		</apex:pageBlockSection>
		
		<apex:pageBlockSection title="{!DetailMessage}, ISO country: {!selectedCountryName}" collapsible="true" id="exList"  rendered="true" columns="1">
		<br /><br />
			
				<table style="width:60%;padding: 0px;border: 0px;border-spacing: 0px;">
					<tr>
						<td>		
							<apex:pageBlockTable value="{!DetailTable}" var="tbl" frame="vsides" >
								<apex:column headerValue="Select/Unselect all">
									<apex:facet name="header">
										<apex:inputCheckbox onclick="checkAll(this,'checkedone')"/>
									</apex:facet>
									<apex:inputCheckbox value="{!tbl.selected}" id="checkedone" />
								</apex:column>
								<apex:column headerValue="Hierarchy Top Parent">
									<!--<apex:outputLink value="/{!tbl.struct.topParentId}" id="accLink">{!tbl.struct.nameTopParent}</apex:outputLink>-->
								
								<apex:outputLink value="#" onclick="openPrimaryTab('/{!tbl.struct.topParentId}?inContextPane=true','{!JSINHTMLENCODE(tbl.struct.nameTopParent)}');return false;" >{!tbl.struct.nameTopParent}</apex:outputLink>

								</apex:column>
								<apex:column value="{!tbl.struct.iataCodeTopParent}" headerValue="IATA Code Top Parent" />
							</apex:pageBlockTable>
						</td>
					</tr>
					
					<tr>
						<td >
						<br /><br /><br /><br /><br /><br />	
						</td>
					</tr>
					<tr>
						<td style="border:0px #dddddd;text-align:center">
							<apex:commandButton action="{!migrateSelectedHierarchies}" value="Migrate selected hierarchies" rendered="true"  />
                            <apex:commandButton action="{!backToMainPage}" value="Back to the main page" rendered="true"  />
						</td>
					</tr>
				</table>			
		
			
		</apex:pageBlockSection>
		
	</apex:PageBlock>

			<apex:pageBlock mode="edit" id="StatusPageBlock">

            <apex:pageBlockSection columns="1" title="Process Status" rendered="{!batchStatusBool}">

                <apex:actionStatus id="act" startText="Checking..." />

                <apex:outputText styleClass="processText" value="Migration process status: {!batchJob.Status}"/>

                <apex:outputText styleClass="processText" value="Hierarchies migrated: {!batchJob.JobItemsProcessed}"/>

                <apex:outputText styleClass="processText" value="Errors found: {!batchJob.NumberOfErrors}"/>

                <apex:actionPoller interval="5" action="{!getBatchStatus}" enabled="{!pollerBool}" reRender="StatusPageBlock" status="act"/>
            
            </apex:pageBlockSection>

		</apex:pageBlock>

	</apex:form>

<script type="text/javascript">
    function checkAll(cb,cbid)
        {
            var inputElem = document.getElementsByTagName("input");                     
            for(var i=0; i<inputElem.length; i++)
            {             
                 if(inputElem[i].id.indexOf(cbid)!=-1){                                        
                    inputElem[i].checked = cb.checked;
                }
            }
        }
</script>

		

</apex:page>