<apex:page controller="ISSP_APProcess" showHeader="false" sidebar="false" standardStylesheets="true">
    <c:iss_ap_css />
    
    <div class="panel-primary">
            <div class="panel-heading head_panel_green">
               <h3 class="panel-title">{!IF(strAreaType=='Airline Joining', 'Airline Participation Joining Application', IF(strChangeType=='Minor database changes', 'Airline Participation Change Request', 'Change of Bank Account details'))}</h3>
            </div>
    <div class="panel-body" id="body-enquiries">
        <div class="progress">
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                A. Participation Country &amp; Type
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="0" style="width: 25%;">
                B. {!strLoB} Country requirements
            </div>
            <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                 C. BSP / CASS {!IF(strAreaType=='Airline Joining', 'Joining Form', IF(strChangeType=='Minor database changes','Change Request','Bank details change'))}
            </div>
            <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                D. Submit to IATA
            </div>
        </div>

    <apex:outputPanel layout="block" styleclass="alert alert-info" html-role="alert" rendered="{!DocumentGuide!=null}">
        Any doubts? Please check out our&nbsp;
        <apex:outputLink value="{!URLFOR($Action.Document.Download, DocumentGuide.Id)}" style="color:#31708f; text-decoration: underline;" target="_blank" onclick="updateGuideCounter();">guide</apex:outputLink>
    </apex:outputPanel>

     <apex:form id="FinalForm">
        <apex:pageBlock rendered="{!isStep4}" title="" mode="edit">
            
            <apex:pageBlockButtons >
                <apex:commandButton styleclass="apbutton" action="{!goToStep3}" value="Previous"/>&nbsp;
                <apex:commandButton styleclass="apbutton" action="{!goToFinalStep}" value="Submit to IATA" disabled="{!NOT(allfieldsfilled)}"/>
                <apex:commandButton styleclass="apbutton" action="{!saveBSPFormAndLeave}" value="Save Draft and Leave" style="float:right"/>
            </apex:pageBlockButtons>
            
            <apex:pageMessages />
            <div class="apcontainer">
                <apex:pageBlockSection title="Application Status" columns="1">
                    <apex:outputtext styleclass="{!IF(allfieldsfilled,'ap-green','ap-red')}" value="{!IF(allfieldsfilled,'All mandatory fields have been filled; You are ready to submit your application','You cannot submit your application until you go back and fill all the required fields, and agree to the Terms and Conditions below')}"/>                  
                </apex:pageBlockSection>
                <apex:pageBlockSection title="Bank Mandate" columns="1" rendered="{!OR(strAreaType=='Airline Joining', strChangeType=='Bank Account Instructions')}">
                    <apex:outputText >
                        <div style="padding-bottom:10px">
                            <div class="aplabel">The Airline needs to provide a Bank Account Mandate to IATA, so that the BSP / CASS proceedings can be settled. The bank account must either be:</div>
                            <div style="margin:20px 20px">
                                <p>1- an ICCS account (for cross border transfers) </p>
                                <p>2- or a local bank account in the ISS country and currency of settlement. </p>
                            </div>
                            
                        </div>
                    </apex:outputText>

                    <apex:pageBlockSectionItem rendered="{!NOT(ISNULL(ICCSProductCountry))}">
                        <apex:outputLabel value="Does your Airline wish to join ICCS (IATA Currency Clearance Service) in this market" styleclass="ap-required"/>
                        <apex:inputField id="mandateSelect" value="{!newForm.Airline_wish_to_join_ICCS__c}">
                            <apex:actionSupport event="onchange" rerender="FinalForm"/>
                        </apex:inputField>
                    </apex:pageBlockSectionItem>

                    <!-- Without ICCS -->
                    <apex:outputPanel layout="block" rendered="{!OR(ISNULL(ICCSProductCountry),newForm.Airline_wish_to_join_ICCS__c == 'No')}">
                        <p>
                            <b>Please download the Bank Mandate form using the link below:</b>
                            <div id="bankmandatelink_p">
                                <u><a href="{!BankMAndateUrl}" target="_blank">BSP / CASS Local Bank Account Beneficiary</a></u>
                            </div>
                        </p>

                        <apex:outputPanel layout="block" styleclass="red-box" rendered="{!AuthorizedSignatories.size=0}">
                            No authorized signatories. Text to be defined
                        </apex:outputPanel>
                        <apex:outputPanel layout="block" styleclass="red-box" rendered="{!AuthorizedSignatories.size>0}">
                            <p>
                                Kindly note the bank mandate must be issued from your Company's Head Office and signed by two (2) officers that are authorized as per your company's IATA FDS Authorized Signatories Package (ASP).
                                The following authorized officers can sign:
                            </p>
                            <ul style="display:lock;list-style-type: disc;">
                                <apex:repeat value="{!AuthorizedSignatories}" var="signatory" >
                                    <li>{!signatory.Contact__r.Name}</li>
                                </apex:repeat>
                            </ul>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSection>

                <!-- With ICCS and is not a Member -->
                <apex:pageBlockSection title="Information required to join ICCS" columns="1"
                    rendered="{!showJoinICCS}">
                    Scenario D<br/>
                    <a href="#" style="text-decoration: underline">Download a file</a><br/>
                    
                    <apex:iframe scrolling="false" height="160px"
                        src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=1&reqRequired=Mandatory&reqName=Information required to join ICCS&reqDescription=&reqIdentifier=ICCS_Join&onlyOne=true"/>
                </apex:pageBlockSection>

                <!-- With ICCS and is Member -->
                <apex:pageBlockSection title="Information required to join ICCS in this market" columns="1"
                    rendered="{!newForm.Airline_wish_to_join_ICCS__c=='Yes'}">
                    Scenario C<br/>
                    information required to join ICCS in this market. <br/>
                    <a href="#" style="text-decoration: underline">Download a file</a><br/>

                    <apex:iframe scrolling="false" height="160px"
                        src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=2&reqRequired=Mandatory&reqName=Information required to join ICCS in this market&reqDescription=&reqIdentifier=ICCS_Join_market&onlyOne=true"/>
                </apex:pageBlockSection>

                <apex:pageBlockSection title="Upload Bank Mandate" columns="1"
                        rendered="{!newForm.Airline_wish_to_join_ICCS__c=='No'}">
                    Please upload the completed Bank Mandates.
                    <apex:iframe scrolling="false" height="160px"
                        src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=3&reqRequired=Mandatory&reqName=Bank Mandate&reqDescription=&reqIdentifier=Bank_Mandate&onlyOne=true"/>
                </apex:pageBlockSection>

                <apex:pageBlockSection title="{!CASE(apcountryisocode, 'PE', 'Disclaimer', 'Additional Requirements')} for {!strLoB} {!apcountry}" columns="1" rendered="{!OR(apcountryisocode='IL',apcountryisocode='EC', AND(apcountryisocode='UA', strLOB='BSP'),AND(apcountryisocode='KR', strLOB='BSP'),apcountryisocode='PE',AND(apcountryisocode='RU', strLOB='BSP'))}">
                    <apex:outputText rendered="{!apcountryisocode='IL'}">
                        It is a legal requirement in {!strLOB} Israel that the participating Airline signs and submits the Antitrust Document.<br/>
                        It is the Airline that signs the form, even it is being represented in the market by a GSA/GSSA.<br/>
                        The document must show the Airline?s legal name, be dated, stamped, and sent to the following address:<br/><br/>
                        <div style="padding-left:50px;padding-bottom:30px; font-weight:bold">
                            IATA Israel<br/>
                            Trade Tower Building, 8th Floor 25 Hamereed Street<br/>
                            Tel Aviv, ISRAEL
                        </div>
                        <br/><br/>
                        <b>Please NOTE:</b>&nbsp;Processes should only be submitted to IATA if the applicable documents have been sent to the respective Local Office.
                        <br/><br/>
                        Please click here to download the form(s):&nbsp;
                    </apex:outputText>
                    
                    <apex:outputText rendered="{!apcountryisocode='EC'}">
                        <div>
                        Please be aware that the below documents are mandatory to operate in Ecuador.<br/><br/>
                            <apex:outputLabel style="color:#a31717; font-weight: bold !important;">*&nbsp;Kindly indicate if your airline holds such legal forms and is consequently compliant with the legal Ecuadorian requirements:&nbsp;</apex:outputLabel>
                        <apex:inputField value="{!newForm.Ecuador_Legal_Forms_requirements__c}" label=""/>
                        <div style="margin-left:20px;margin-top:5px;line-height:20px">
                            - Local Air Operator Certficate/Certificado de Transportador A?reo: <b>ON-line Carriers</b><br/>
                            - Local Comercialization permit/ Permiso de comercializaci?n: <b>OFF-line carriers</b><br/>
                        - Legal Constitution of the Airline or its GSA (including shareholding details)<br/>
                        </div>
                        </div>    
                    </apex:outputText>
                   
                    <apex:pageBlockSectionItem helpText="The EDRPOU must belong to the beneficiary account holder indicated in the bank mandate." rendered="{!AND(apcountryisocode='UA', strLOB='BSP')}">
                        <apex:outputLabel style="color:#a31717; font-weight: bold !important;">*&nbsp;Beneficiary Registration Code/ Local Registration Number (EDRPOU)</apex:outputLabel>
                        <apex:inputField value="{!newForm.BSP_UA_LocalReg_Number_EDRPOU__c}" label=""/>
                    </apex:pageBlockSectionItem>
              
                    <apex:pageBlockSectionItem rendered="{!AND(apcountryisocode='UA', strLOB='BSP')}">
                        <apex:outputLabel style="color:#a31717; font-weight: bold !important;">*&nbsp;Bank Code (MFO)</apex:outputLabel>
                        <apex:inputField value="{!newForm.BSP_UA_BankCode_MFO__c}" label=""/>
                    </apex:pageBlockSectionItem>
                    
                    <apex:outputText rendered="{!AND(apcountryisocode='UA', strLOB='BSP')}">
                        In addition the following Agreements are mandatory to be submitted to the IATA local office in Ukraine:
                        <br/><br/>
                        <b>Please NOTE:</b>&nbsp;Processes should only be submitted to IATA if the applicable documents have been sent to the respective Local Office.
                        <br/><br/>
                        (1) IATA-Carrier Agreement (If the Airline has its own Representative office in Ukraine)<br/>
                        OR<br/><br/>
                        IATA-Carrier-GSA Agreement (If the Airline has a GSA as its representative in Ukraine)<br/><br/>
                        (2) IATA-Carrier BG Agreement<br/><br/>
                        
                        The documents must be submitted in [ Word format ] to onatskya@iata.org, cc: kostyuky@iata.org and gogenkoi@iata.org.
                        <br/><br/>
                        Please click here to download the form(s):&nbsp;
                        
                    </apex:outputText>
                    
                    <apex:outputText rendered="{!AND(apcountryisocode='KR', strLOB='BSP')}">
                        For BSP Korea, Airlines who wish to impose ticket capping for travel agents must inform the ETSPs/GDSs directly.<br/><br/>
                        Alternatively, an Airline may avail of an optional service called Airline Capping Network.<br/>
                        The form is to be sent to selcs@iata.org.
                        <br/><br/>
                        Click here for further details and to download the form.
                    </apex:outputText>
                    
                    <apex:outputText rendered="{!apcountryisocode='PE'}">
                        For {!strLOB} Peru, the Disclaimer in Spanish must be signed by the applicant and included in the joining package / documents.
                        <br/><br/>
                        Please click here to download the disclaimer form:&nbsp;
                    </apex:outputText>
                    
                    <apex:outputText rendered="{!apcountryisocode='RU'}">
                        <div style="margin-bottom:30px;line-height:16px">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel style="color:#a31717; font-weight: bold !important;">*&nbsp;Is there is a ?Double Tax avoiding Treaty? between Russia and the Airline's country of Registration?&nbsp;</apex:outputLabel>
                            <apex:inputField value="{!newForm.BSP_Russia_Double_Tax_avoiding_Treaty__c}" label=""/>
                        </apex:pageBlockSectionItem>
                        <div style="margin-left:20px">
                            (a) If <b>Yes</b>, please enclose your 'Certificate of Residence' which should be issued in accordance with Russian Tax  code regulation.  For more clarification on this document, you may contact IATA MOW office through the customer portal.<br/><br/>
                            (b) If <b>No</b>, then your airline will need to participate in BSP Russia through a local GSA.
                        </div>
                        </div>
                        <b>Please NOTE:</b>&nbsp;Processes should only be submitted to IATA if the applicable documents have been sent to the respective Local Office.
                        <br/><br/>
  
                        Airlines who intend to use a local bank account for settlements must include the Company Card Draft in the joining package/documents.  The document must be submitted in [ Word format ].
                        <br/><br/>
                        Please click here to download the form:&nbsp;
                    </apex:outputText>
                    
                    <apex:dataList value="{!urlList}" var="urlItem">
                        <apex:outputLink value="{!urlItem.Download_URL__c}" target="_blank">{!urlItem.Link_label__c}</apex:outputLink>
                    </apex:dataList>
                    
                </apex:pageBlockSection>
                
                <!-- IATA EasyPay -->   
                <apex:pageBlockSection title="IATA EasyPay" columns="1" rendered="{! AND(strOperationType = 'BSP', isoCountryEligible)}">
                    <div class="aplabel">
                        <p>Kindly note that IATA EasyPay is secure and voluntary payment method for agents to issue tickets through the BSP. IATA EasyPay is an industry standard, established in Resolution and available by default to all carriers in <b>{!apcountry}</b>. However, should your airline wish to opt out of accepting IATA EasyPay please notify IATA through written notice a minimum of 30 days prior to the opt-out taking effect. Prior to doing so, please also ensure that your airline has fully assessed the impact of opting out of this payment method. Your airline’s opt-out will be communicated to all Accredited Agents in the market.
                        </p>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="* Will your Airline accept IATA EasyPay transactions in this BSP?" 
                                style="color:#a31717; font-weight: bold !important;"/>
                            <apex:inputField id="mandateSelectEasyPay" 
                                value="{!newForm.ANG_Airline_accepts_EasyPay_tr_in_BSP__c}"
                                label=""/>
                        </apex:pageBlockSectionItem>      

                    </div>
                </apex:pageBlockSection>

                <!-- Counter Indemnity Agreement -->
                <apex:pageBlockSection title="Counter Indemnity Agreement" columns="1"
                    rendered="{!
                            AND(strAreaType=='Airline Joining',
                                hqAccount.Sector__c=='Airline',
                                OR(
                                    AND(isBSP,NOT(hqAccount.BSP_CI_Valid__c)),
                                    AND(isCASS,NOT(hqAccount.CASS_CI_Valid__c))
                                )
                            )}">
                    <div class="aplabel">
                        <p>
                            According to our records, your airline needs to provide a counter indemnity agreement in order to join this operation. Please sondlowad in the download it in the following link and attach an escaned copy using the button below
                        </p>
                    </div>
                    <p>
                        <a href="#" style="text-decoration: underline;">Counter indemnity agreement</a>
                    </p>
                    <apex:iframe src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=4&reqRequired=Mandatory&reqName=Counter Indemnity Agreement&reqDescription=Please upload the completed Bank Mandates&reqIdentifier=CounterIndemnityAgreement" height="180px" width="100%" scrolling="false"/>
                </apex:pageBlockSection>

                <!-- Form of concurrence -->
                <apex:pageBlockSection title="Form of concurrence" columns="1"
                    rendered="{!AND(
                        strAreaType=='Airline Joining',
                        hqAccount.Sector__c=='Airline',
                        isBSP,
                        NOT(hqAccount.BSP_FOC_Valid__c),
                        hqAccount.Membership_status__c!='IATA Member'
                    )}">
                    <div class="aplabel">
                        <p>
                            According to our records, your airline needs to provide a form of authorization document signed. This document needs to be provided only once. Please download using the following link and attach an escaned copy using the button below. The hard copy must be send to the address below.
                        </p>
                    </div>
                    <p>
                        <a href="#" style="text-decoration: underline;">Form of Authorization</a>
                    </p>
                    <apex:iframe src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=5&reqRequired=Mandatory&reqName=Form of Authorization&reqDescription=&reqIdentifier=FormOfAuthorization" height="180px" width="100%" scrolling="false"/>
                </apex:pageBlockSection>

                <!-- Form Of Application -->
                <apex:pageBlockSection title="Form of Application" columns="1"
                    rendered="{!
                            AND(strAreaType=='Airline Joining',
                                hqAccount.Sector__c=='Airline',
                                isBSP
                            )}">
                    <div class="aplabel">
                        <p>
                            Text to be defined
                        </p>
                    </div>
                    <apex:iframe src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=6&reqRequired=Mandatory&reqName=Form of Application&reqDescription=&reqIdentifier=FormOfApplication" height="180px" width="100%" scrolling="false"/>
                </apex:pageBlockSection>

                <!-- Form Of Application and Concurrence -->
                <apex:pageBlockSection title="Form of Application and Concurrence" columns="1"
                    rendered="{!
                            AND(strAreaType=='Airline Joining',
                                hqAccount.Sector__c=='Airline',
                                isCASS
                            )}">
                    <div class="aplabel">
                        <p>
                            Text to be defined
                        </p>
                    </div>
                    <apex:iframe src="/ISSP_FormUpload?caseId={!newCase.Id}&reqCnt=7&reqRequired=Mandatory&reqName=Form of Application and Concurrence&reqDescription=&reqIdentifier=FormOfApplicationAndConcurrence" height="180px" width="100%" scrolling="false"/>
                </apex:pageBlockSection>

                <!-- Accept terms and conditions -->   
                <apex:pageBlockSection title="Terms and conditions" columns="1">
                    <div class="aplabel">
                        <p>By submitting the present application form to IATA,  I hereby confirm that all information is correct; that I am aware of the local laws and regulations governing the operations of air carriers in <b>{!apcountry}</b>
                            and that the ISS Participant on whose behalf I am executing the present form, will hold IATA, its directors, officers, employees and agents free from any liability, costs and expenses in case of non-compliance with these laws, including without limitations, any reasonable legal expenses.</p><br/>
                        <p>
                            I hereby confirm to IATA and duly represent that I am duly authorized to submit this Participation Details Form on behalf of the ISS Participant, and that I am fully authorized to bind the ISS Participant, as provided herein, including the indemnity mentioned at the preceding paragraph.
                        </p><br/> 
                        <p>
                            I also confirm that said participation in the ISS system is not to be construed as an admission of any liability and acceptance of assumption of any responsibility whatsoever by IATA regarding any default or non- compliance by the ISS Participant with respect to the applicable laws and governmental regulations.
                        </p>
                    
                    <apex:outputText rendered="{!AND(apcountryisocode='PE', strLOB='BSP')}">
                        <div style="line-height: 20px;font-weight:bold">
                        In addition I confirm that my airline fulfills the following legal requirements to operate in PERU:<br/>
                        <div style="margin-left:20px">
                        a)  Authorization issued by SUNAT for the Airline to issue E-tickets<br/>
                        b)  Registration with SUNARP of the Airline's branch office legal entity<br/>
                        c)  Registration with SUNAT Tax regulator for the RUC number of the Airline<br/>
                        d)  Operating Authorization permit granted by Civil Aviation -- applicable to ONLINE carriers<br/>
                        e)  DGAC government resolution authorizing an Airline to operate sales in Peru -- applicable to OFFLINE carriers<p/>
                        </div>
                        </div>
                     </apex:outputText>
                    </div>
                    <div class="aplabel">
                    By signing I, the undersigned, confirm that the above information is correct and that I am duly authorized to submit this BSP Participation Details Form on behalf of my Airline.

                    <br/>
                    <apex:inputField value="{!newForm.Accept_terms_and_conditions__c}" required="true"/>
                    </div>
                    
                </apex:pageBlockSection>
            </div>
            
        </apex:pageBlock>
    </apex:form>

    </div>
    </div>

</apex:page>