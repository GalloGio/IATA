<apex:page controller="MITA_PortalMyAgreementsCtrl" standardStylesheets="false" showHeader="false" sidebar="false" applyBodyTag="false" applyHtmlTag="false" action="{!initActions}">
	<html>
		<c:ISSP_Header />
		<head>
			<style>
				@font-face {
					font-family: 'DaMaWebFont';
					font-weight: 400;
					font-style: normal;
					src: url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Regular/AktivGrotesk_W_Rg.eot')}");
					/* IE9 Compat Modes */
					src: url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Regular/AktivGrotesk_W_Rg.eot?#iefix')}") format('embedded-opentype'),
					/* IE6-IE8 */
					url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Regular/AktivGrotesk_W_Rg.woff2')}") format('woff2'),
					/* Super Modern Browsers */
					url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Regular/AktivGrotesk_W_Rg.woff')}") format('woff');
					/* Pretty Modern Browsers */
				}

				@font-face {
					font-family: 'DaMaWebFont';
					font-weight: 500;
					font-style: normal;
					src: url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Medium/AktivGrotesk_W_Md.eot')}");
					/* IE9 Compat Modes */
					src: url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Medium/AktivGrotesk_W_Md.eot?#iefix')}") format('embedded-opentype'),
					/* IE6-IE8 */
					url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Medium/AktivGrotesk_W_Md.woff2')}") format('woff2'),
					/* Super Modern Browsers */
					url("{!URLFOR($Resource.LiveAgentCustomWindow, '/Fonts/WEB-AG/WEB-AG-Medium/AktivGrotesk_W_Md.woff')}") format('woff');
					/* Pretty Modern Browsers */
				}

				body {
					/*font-family: DaMaWebFont !important;*/
					color: #333;
				}

				li.topmenu {
					margin-left: 0;
				}

				.accountInfoPanel {
					font-size: small;
				}

				.mytabheadercontainer {
					margin: 10px 0;
					border-radius: 0;
				}

				.mytabheader {
					display: inline-block;
					border: 1px solid rgb(240, 242, 245);
					/*background: white;*/
					padding: 0.5em;
					/* margin-left: 0.1em; */
					font-weight: bold;
					cursor: pointer;
					background-image: none !important;
					background-color: #f0f2f5;
					border-bottom: none !important;
					color: #1e32fa;
				}

				.mytabheader:hover{
					text-decoration: underline;
				}

				.mytabheader.active {
					background: #1e32fa;
					border: none;
					color: white;
					border: 1px solid #1e32fa;
				}

				.mytabheader.active:hover{
					text-decoration: unset !important;
				}

				.mytabcontainer {
					/*border: 1px solid lightgrey;*/
					/* border-radius: 5px; */
					/* border-top-left-radius: 0; */
					margin-left: 1px;
				}

				.mytab {
					display: none;
				}

				.mytab.active {
					display: block;
				}

				.searchwrapper {
					display: inline-block;
				}

				.iconx {
					cursor: pointer;
					width: 1em;
				}

				.iconarrow {
					cursor: pointer;
					width: 1.2em;
				}

				.myinline {
					display: inline-block;
					width: inherit;
					margin-right: 1em;
				}

				.mydisabled {
					display: none;
				}

				.mytabcontainer .mytabheader {
					border-radius: 0px;
					width: 50%;
					text-align: center;
					/* margin: 1px; */
				}

				.mytabcontainer .mytabcontainer {
					padding: 1em;
					border: none;
					margin: 0px;
					padding-top: 10px;
					background-color: white;
				}

				.message.errorM3 {
					background-color: #E7C3C3;
					background: linear-gradient(to bottom, #F2DEDE 0px, #E7C3C3 100%);
					background: -webkit-linear-gradient(to bottom, #F2DEDE 0px, #E7C3C3 100%);
					/* For Safari 5.1 to 6.0 */
					background: -o-linear-gradient(to bottom, #F2DEDE 0px, #E7C3C3 100%);
					/* For Opera 11.1 to 12.0 */
					background: -moz-linear-gradient(to bottom, #F2DEDE 0px, #E7C3C3 100%);
					/* For Firefox 3.6 to 15 */
					background: linear-gradient(to bottom, #F2DEDE 0px, #E7C3C3 100%);
					/* Standard syntax */
					background-repeat: repeat-x;
					border: 1px solid #DCA7A7;
					padding: 1em;
					border-radius: 5px;
				}

				.progress{
					background-image: none;
					height: unset;
					background-color: #fff;
					box-shadow: none;
					margin-bottom: 0 !important;
				}

				.progress-bar {
					padding: 5px;
					color: #fff;
					font-weight: bold;
					font-size:inherit;
					background-image: none;
					/*background-color: #1e32fa;*/
					box-shadow: none;
				}

				input[type=search]{
					-webkit-appearance: searchfield;
					font-weight: normal;
				}

				input[type=checkbox], input[type=radio]{
					margin-right: 4px;
				}

				thead th{
					background-color: rgb(234, 234, 234) !important;
				}

				.dataTables_wrapper{
					font-size: 13px;
				}

				.agreementsTable{
					width: 100% !important;
				}
				.contactsTable{
					width: 100% !important;
				}
			</style>
		</head>
		<apex:stylesheet value="{!$Resource.CSP_VF_Stylesheet}" />

		<body>
			<c:ISSP_CustomNavigation />
			<div class="container">
				<apex:image styleclass="mastericonx" url="{!URLFOR($Resource.MITAicons, 'icon-x.png')}" style="display:none" />
				<apex:image styleclass="mastericonarrow" url="{!URLFOR($Resource.MITAicons, 'icon-arrow.png')}" style="display:none" />
				
				<apex:includeScript value="{!$Resource.jquery2_1_4}"/>
					<apex:actionStatus id="Loading" stopText="">
						<apex:facet name="start">
							<apex:outputPanel >
								<div id="loading">
									<div style="height:100%;width:100%;z-index:100; position:fixed;background:black;opacity:0.5; top:0; left:0;"></div>
								</div>
							</apex:outputPanel>
						</apex:facet>
					</apex:actionStatus>
				<script>
				function startLoading(){
					$('[id*="Loading"]').show();
				}
				function stopLoading(){
					$('[id*="Loading"]').hide();
				}
				</script>

				<apex:includescript value="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" />
				<apex:stylesheet value="//cdn.datatables.net/1.10.4/css/jquery.dataTables.css" />

				<apex:outputPanel id="messages">
					<apex:pageMessages />
				</apex:outputPanel>

				<script>
					var MITAagreementsTable;
					var BIETAagreementsTable;
					var MITAsuggestionsTable;
					var BIETAsuggestionsTable;
					var myActiveContactTable;
					var otherContactTable;

					var activeMainTab = '';
					var activeTab = {};

					/****** METHODS FOR AGREEMENTS ******/

					$(document).ready(function () {
						showTab('Existing');
					});

					
					function initAgreementTable(isMITA) {
						var agreementsTable = $('#' + (isMITA ? 'MITA' : 'BIETA') + 'agreementsTable').DataTable({
							"dom": '<"top" lf>rt<"bottom"ip><"clear">',
							"pageLength": 50,
							"columnDefs": [
								{ "name": "designator", "targets": 0},
								{ "name": "code", "targets": 1},
								{ "name": "prefix", "targets": 2},
								{ "name": "name", "targets": 3 },
								{ "name": "type", "targets": 4 },
								{ "name": "active", "targets": 5},
								{ "name": "actions", "targets": 6, "orderable": false}
							],
							"language": {
								"lengthMenu": "{!$Label.ISSP_Display_Records_per_page}",
								"zeroRecords": "{!$Label.ISSP_Nothing_found}",
								"info": "{!$Label.ISSP_Showing_page}",
								"infoEmpty": "{!$Label.ISSP_No_records_available}",
								"infoFiltered": "{!$Label.ISSP_filtered_from_total_records}",
								"search": "{!$Label.ISSP_Search}",
								"paginate": {
									"next": "{!$Label.ISSP_Next}",
									"previous": "{!$Label.ISSP_Previous}"
								}
							}
						});

						$(agreementsTable.rows().nodes()).find(".iconx").attr('src', $('.mastericonx').attr('src'));

						if (isMITA)
							MITAagreementsTable = agreementsTable;
						else
							BIETAagreementsTable = agreementsTable;

						filterAgreements(isMITA);

						$(".agreementtypefilter, .agreementactivefilter").on('change', function () {
							var isMITA = $(this).attr('data-type') == "MITA";
							filterAgreements(isMITA);
						});
					}

					function initContactTable(tblType) {
						var theContTable = $('#' + tblType + 'ContactTable').DataTable({
							"dom": '<"top" lf>rt<"bottom"ip><"clear">',
							"pageLength": 10,
							"columnDefs": [
								{ "name": "Name", "targets": 0},
								{ "name": "email", "targets": 1},
								{ "name": "phone", "targets": 2},
								{ "name": "ContactType", "targets": 3},
								{ "name": "Teletype", "targets": 4 }
							],
							"language": {
								"lengthMenu": "{!$Label.ISSP_Display_Records_per_page}",
								"zeroRecords": "{!$Label.ISSP_Nothing_found}",
								"info": "{!$Label.ISSP_Showing_page}",
								"infoEmpty": "{!$Label.ISSP_No_records_available}",
								"infoFiltered": "{!$Label.ISSP_filtered_from_total_records}",
								"search": "{!$Label.ISSP_Search}",
								"paginate": {
									"next": "{!$Label.ISSP_Next}",
									"previous": "{!$Label.ISSP_Previous}"
								}
							}
						});
						
						if (tblType=='myActive')
							myActiveContactTable = theContTable;
						else
							otherContactTable = theContTable;

						$(".contactTypefilter").on('change', function () {
							var typefilter = $('.contactTypefilter[data-type="Contact"]:checked').attr("data-value").trim();
							$('#myActiveContactTable').DataTable().column(3).search('"' + typefilter + '"').draw();
						});
					}

					function initMyAllContactTable() {
						var theMyAllContTable = $('#myAllContactTable').DataTable({
							"dom": '<"top" lf>rt<"bottom"ip><"clear">',
							"pageLength": 10,
							"columnDefs": [
								{ "name": "Name", "targets": 0},
								{ "name": "email", "targets": 1},
								{ "name": "phone", "targets": 2},
								{ "name": "Teletype", "targets": 3 }
							],
							"language": {
								"lengthMenu": "{!$Label.ISSP_Display_Records_per_page}",
								"zeroRecords": "{!$Label.ISSP_Nothing_found}",
								"info": "{!$Label.ISSP_Showing_page}",
								"infoEmpty": "{!$Label.ISSP_No_records_available}",
								"infoFiltered": "{!$Label.ISSP_filtered_from_total_records}",
								"search": "{!$Label.ISSP_Search}",
								"paginate": {
									"next": "{!$Label.ISSP_Next}",
									"previous": "{!$Label.ISSP_Previous}"
								}
							}
						});
						
						//$(theMyAllContTable.rows().nodes()).find(".iconx").attr('src', $('.mastericonx').attr('src'));
					}


					function filterAgreements(isMITA) {
						var MB = isMITA ? "MITA" : "BIETA";
						var typefilter = $('.agreementtypefilter[data-type="' + MB + '"]:checked').attr("data-value").trim();
						if (isMITA)
							MITAagreementsTable
							.column('type:name').search('"' + typefilter + '"')
							.draw();
						else
							BIETAagreementsTable
							.column('type:name').search('"' + typefilter + '"')
							.draw();
					}

					
					function initSuggestionTable(isMITA) {
						var suggestionsTable = $('#' + (isMITA ? 'MITA' : 'BIETA') + 'suggestionsTable').DataTable({
							"dom": '<"top" lf>rt<"bottom"ip><"clear">',
							"pageLength": 50,
							"columnDefs": [+
								{ "name": "dcode", "targets": 0, "width": "110px" },
								{ "name": "ncode", "targets": 1, "width": "110px" },
								{ "name": "prefix", "targets": 2, "width": "110px" },
								{ "name": "name", "targets": 3 },
								{ "name": "type", "targets": 4 }
							]
						});

						$(suggestionsTable.rows().nodes()).find(".iconarrow").attr('src', $('.mastericonarrow').attr('src'));

						if (isMITA)
							MITAsuggestionsTable = suggestionsTable;
						else
							BIETAsuggestionsTable = suggestionsTable;

						filterSuggestions(isMITA);

						$(".suggestiontypefilter, .suggestiontype").on('change', function () {
							var isMITA = $(this).attr('data-type') == "MITA";
							filterSuggestions(isMITA);
						});
					}

					
					function filterSuggestions(isMITA) {
						var MB = isMITA ? "MITA" : "BIETA";
						var typefilter = $('.suggestiontypefilter[data-type="' + MB + '"]:checked').attr("data-value").trim() + '(Senior)';

						if (isMITA)
							MITAsuggestionsTable
							.column('type:name').search('"' + typefilter + '"')
							.draw();
						else
							BIETAsuggestionsTable
							.column('type:name').search('"' + typefilter + '"')
							.draw();
					}

					
					function showTab(maintab, tab) {
						// If no parameter is received
						if (maintab == null) {
							maintab = activeMainTab;
							tab = activeTab[activeMainTab];
							$(".mytab, .mytabheader").removeClass("active");
							$("#tab" + maintab + ", #hd" + maintab).addClass("active");
							$("#tab" + tab + ", #hd" + tab).addClass("active");
							// Switching only the main tab
						} else if (maintab != null && tab == null) {
							$(".mytab.level1, .mytabheader.level1").removeClass("active");
							$("#tab" + maintab + ", #hd" + maintab).addClass("active");
							// Switching the second tab
						} else {
							$("#tab" + maintab + " .mytab.level2, #tab" + maintab + " .mytabheader.level2").removeClass("active");
							$("#tab" + tab + ", #hd" + tab).addClass("active");
						}
						
						activeMainTab = maintab;
						activeTab[maintab] = tab;
					}

					function showOtherAirlineContacts(){
						$( '#otherAirCon').modal('show');
						initContactTable('other');
					}

					function closeOtherAirlineContact() {
						$( '#otherAirCon' ).modal('hide');
					}

					function showEditContact(){
						$( '#editContact').modal('show');
					}
					function closeEditContact() {
						$( '#editContact' ).modal('hide');
					}

					function showRemoveContact(){
						$( '#delCon').modal('show');
					}
					function closeDeleteContact() {
						$( '#delCon' ).modal('hide');
					}
				</script>

				<apex:outputPanel id="column2" style="width:40%">
					<script>$('#canChangeTab').val('true')</script>

					<apex:outputPanel id="accountInfoPanel">
						<apex:form >
							<apex:actionFunction action="{!RetrieveOtherAirlineContacts}" name="RetrieveOtherAirlineContacts" onComplete="showOtherAirlineContacts();" reRender="ModalOtherContacts">
								<apex:param name="myParam" assignTo="{!selectedAirlineId}" value=""/>
							</apex:actionFunction>

							<apex:actionFunction action="{!retrieveContactToEdit}" name="editContact" onComplete="showEditContact();" reRender="modalEditContact">
								<apex:param name="myParam" assignTo="{!selectedContactToEdit}" value=""/>
							</apex:actionFunction>

							<apex:actionFunction action="{!retrieveContactToRemove}" name="removeContact" onComplete="showRemoveContact();" reRender="ModalRemoveContact">
								<apex:param name="myParam" assignTo="{!selectedContactToRemove}" value=""/>
							</apex:actionFunction>

							<!-- MODAL WINDOWS TO DELETE A CONTACTS -->
							<apex:outputPanel id="ModalRemoveContact">
								<apex:actionFunction action="{!ValidateContactRemoval}" name="ValidateContactRemoval" reRender="AfterDelValPnl" onComplete="PerformAfterRemovalValidation();return false;"/>
								<apex:actionFunction action="{!removeTheContact}" name="removeTheContact" reRender="pbsResult,pbsActiveContact" onComplete="CloseRemovalModalAndRemoveLoading();return false;"/>
								<script>
									modalDelete_alert = function() {}
									modalDelete_alert.warning = function(message) {
										if(message=='')
											$('#modalDelete_alert_placeholder').html('');
										else
											$('#modalDelete_alert_placeholder').html('<div class="alert alert-warning"><a class="close" data-dismiss="alert">×</a><span>'+message+'</span></div>');
									}
								</script>
								<div class="modal fade" id="delCon" role="dialog" data-backdrop="static" data-keyboard="false">
									<div class="modal-dialog modal-lg" style="width: 1100px;">
										<div class="modal-content">
											<div class="modal-header">
												<h4 class="modal-title">{!$Label.Button_Remove} {!ContactBeingRemoved.Name}</h4>
											</div>
											<div class="modal-body">
												{!$Label.ISSP_MITA_RemoveContactMsg}
											</div>
											<div id="modalDelete_alert_placeholder"></div>
											<div class="modal-footer">
												<button type="button" id='btnDel' class="iatabtn iatabtn-default" onclick="modalDelete_alert.warning('');ValidateContactRemoval();">{!$Label.Button_Remove}</button>
												<button type="button" id='btnDelClose' class="iatabtn iatabtn-default" data-dismiss="modal" onclick="stopLoading();">{!$Label.CSP_Cancel}</button>
											</div>
											<script>
												$('#btnDel').click(function(){
													$(this).attr("disabled", true);
													$(this).removeClass("iatabtn-default");
													$(this).addClass("iatabtn-danger");

													$('#btnDelClose').attr("disabled", true);
													$('#btnDelClose').removeClass("iatabtn-default");
													$('#btnDelClose').addClass("iatabtn-danger");
												});
											</script>
										</div>
									</div>
								</div>
								<apex:outputPanel id="AfterDelValPnl">
									<script>
										function CloseRemovalModalAndRemoveLoading(){
											$('#delCon').modal('hide');
											ActiveCon_EditContactSuccess('{!$Label.ISSP_MITA_EditContactSuccess}');
											stopLoading();
										}
										function PerformAfterRemovalValidation(){
											if('{!SaveError}' == ''){
												removeTheContact();
											}else{
												modalDelete_alert.warning('{!SaveError}');
												$('#btnDel').removeAttr("disabled");
												$('#btnDel').addClass("iatabtn-default");
												$('#btnDel').removeClass("iatabtn-danger");

												$('#btnDelClose').removeAttr("disabled");
												$('#btnDelClose').addClass("iatabtn-default");
												$('#btnDelClose').removeClass("iatabtn-danger");
											}
										}
									</script>
								</apex:outputPanel>
							</apex:outputPanel>
							<!-- END MODAL WINDOWS TO DELETE A CONTACTS-->

							<!-- MODAL WINDOWS TO SHOW OTHER AIRLINE CONTACTS -->
							<apex:outputPanel id="ModalOtherContacts">
								<div class="modal fade" id="otherAirCon" role="dialog" data-backdrop="static" data-keyboard="false">
									<div class="modal-dialog modal-lg" style="width: 1100px;">
										<div class="modal-content">
											<div class="modal-header">
												<h4 class="modal-title">{!$Label.ISSP_Airline}: {!selectedAirlineName}</h4>
											</div>
											<div class="modal-body">
												<table id="otherContactTable" class="contactsTable dataTable no-footer hover row-border compact">
													<thead>
														<tr>
															<th>{!$ObjectType.Contact.Fields.Name.Label}</th>
															<th>{!$ObjectType.Contact.Fields.email.Label}</th>
															<th>{!$ObjectType.Contact.Fields.phone.Label}</th>
															<th>{!$ObjectType.Contact.Fields.MITA_Contact_Type__c.Label}</th>
															<th>{!$ObjectType.Contact.Fields.MITA_Teletype__c.Label}</th>
														</tr>
													</thead>
													<tbody>
														<apex:outputText value="{!OtherAirlineContactTable}" escape="false" />
													</tbody>
												</table>
											</div>
											<div class="modal-footer">
												<button type="button" class="iatabtn iatabtn-default" data-dismiss="modal" onclick="stopLoading();">{!$Label.LAQ_Close}</button>
											</div>
										</div>
									</div>
								</div>
							</apex:outputPanel>
							<!-- END MODAL WINDOWS TO SHOW OTHER AIRLINE CONTACTS -->
							
							<!-- MODAL WINDOWS TO SHOW EDIT CONTACTS -->
							<apex:outputPanel id="modalEditContact">
								<apex:actionFunction action="{!ValidateContact}" name="ValidateContact" reRender="AfterValPnl" onComplete="PerformAfterValidation();return false;"/>
								<apex:actionFunction action="{!SaveTheContact}" name="SaveTheContact" reRender="pbsResult,pbsActiveContact" onComplete="CloseEditModalAndRemoveLoading();return false;"/>
								<script>
									modal_alert = function() {}
									modal_alert.warning = function(message) {
										if(message=='')
											$('#modal_alert_placeholder').html('');
										else
											$('#modal_alert_placeholder').html('<div class="alert alert-warning"><a class="close" data-dismiss="alert">×</a><span>'+message+'</span></div>');
									}
								</script>
								<div class="modal fade" id="editContact" role="dialog" data-backdrop="static" data-keyboard="false">
									<div class="modal-dialog modal-lg" style="width: 1100px;">
										<div class="modal-content">
											<div class="modal-header">
												<h4 class="modal-title">{!$Label.ISSP_Edit}: {!ContactBeingEdited.Salutation} {!ContactBeingEdited.Name}</h4>
											</div>
											<div class="modal-body">
												<div id="modal_alert_placeholder"></div>
												<apex:pageBlock>
													<apex:pageBlockSection>
														<apex:outputText value="{!ContactBeingEdited.email}" label="{!$ObjectType.Contact.fields.email.label}"/><br/><br/>
														<apex:outputText value="{!ContactBeingEdited.phone}" label="{!$ObjectType.Contact.fields.phone.label}"/><br/><br/>
														<apex:inputField value="{!ContactBeingEdited.MITA_Contact_Type__c}" label="{!$ObjectType.Contact.fields.MITA_Contact_Type__c.label}"/><br/><br/>
														<apex:inputField value="{!ContactBeingEdited.MITA_Teletype__c}" label="{!$ObjectType.Contact.fields.MITA_Teletype__c.label}"/><br/><br/>
													</apex:pageBlockSection>
													<apex:pageBlockSection columns="2">
														<div class="alert alert-info" role="alert">{!$Label.ISSP_MITA_EditContactMsg}</div>
													</apex:pageBlockSection>
												</apex:pageBlock>
											</div>
											<div class="modal-footer">
												<button type="button" id="btnSave" class="iatabtn iatabtn-default" onclick="modal_alert.warning('');ValidateContact();">{!$Label.ISSP_Save}</button>
												<button type="button" id="btnClose" class="iatabtn iatabtn-default" data-dismiss="modal" onclick="stopLoading();">{!$Label.LAQ_Close}</button>
												<script>
													$('#btnSave').click(function(){
														$(this).attr("disabled", true);
														$(this).removeClass("iatabtn-default");
														$(this).addClass("iatabtn-danger");

														$('#btnClose').attr("disabled", true);
														$('#btnClose').removeClass("iatabtn-default");
														$('#btnClose').addClass("iatabtn-danger");
													});
												</script>
											</div>
										</div>
									</div>
								</div>
								<apex:outputPanel id="AfterValPnl">
									<script>
										function CloseEditModalAndRemoveLoading(){
											$('#editContact').modal('hide');
											AllCon_EditContactSuccess('{!$Label.ISSP_MITA_EditContactSuccess}');
											ActiveCon_EditContactSuccess('{!$Label.ISSP_MITA_EditContactSuccess}');
											stopLoading();
										}
										function PerformAfterValidation(){
											if('{!SaveError}' == ''){
												SaveTheContact();
											}else{
												$('#btnClose').removeAttr("disabled");
												$('#btnClose').addClass("iatabtn-default");
												$('#btnClose').removeClass("iatabtn-danger");

												$('#btnSave').removeAttr("disabled");
												$('#btnSave').addClass("iatabtn-default");
												$('#btnSave').removeClass("iatabtn-danger");
												modal_alert.warning('{!SaveError}');
											}
										}
									</script>
								</apex:outputPanel>
							</apex:outputPanel>
							<!-- END MODAL WINDOWS TO SHOW EDIT CONTACTS -->

							<apex:pageBlock >
								<div class="panel-primary">
									<div class="panel-heading head_panel_green" id="container">
										<div id="left"><h3 class="panel-title">MITA agreements / {!acc.Name} / {!acc.Airline_designator__c} / {!acc.IATACode__c}</h3></div>
									</div>
									<div class="panel-body" id="body-enquiries">

										<!-- CUSTOM TAB HEADER -->
										<div class="mytabheadercontainer level1" style="padding-left: 2px;">
											<div class="mytabheader level1 active" id="hdExisting" onclick="showTab('Existing')" style="float: left;">{!$Label.ISSP_Existing_Agreements}</div>
											<div class="mytabheader level1" id="hdAdd" onclick="showTab('Add')">{!$Label.ISSP_Agreements_available}</div>
											<div class="mytabheader level1" id="hdContacts" onclick="AllCon_EditContactSuccess('');ActiveCon_EditContactSuccess('');showTab('Contacts')">{!$Label.ISSP_MITA_TAB}</div>
										</div>

										<!-- TAB CONTAINER -->
										<div class="mytabcontainer level1" style="background-color: #fff;">
											<!-- FIRST EXTERNAL TAB: EXISTING AGREEMENTS -->
											<div class="mytab level1 active" id="tabExisting">
												<div class="progress mytabheadercontainer">
													<div class="level2 mytabheader {!IF(acc.MITA_Member__c, 'active', 'mydisabled')}" style="float:left; width:50%" id="hdMITA" onclick="showTab('Existing','MITA')">MITA</div>
													<div class="level2 mytabheader {!IF(acc.BIETA_Member__c, IF(acc.MITA_Member__c, '', 'active'), 'mydisabled')}"  style="float:right; width:50%" id="hdBIETA" onclick="showTab('Existing','BIETA')">BIETA</div>
												</div>
												
												<div class="mytabcontainer level2" style="background-color: #fff;">
													<!-- FIRST INTERNAL TAB: MITA -->
													<div class="mytab level2 {!IF(acc.MITA_Member__c, 'active', 'mydisabled')}"  id="tabMITA">
														<!-- SECTION FOR MITA AGREEMENTS -->
														<apex:inputHidden value="{!MITAagreementid}" id="MITAagreementid" />
														<apex:pageBlockSection columns="1" id="MITAagreementSearchPanel">
															<apex:outputPanel>
																<div style="float:left;padding-bottom: 20px; padding-top: 20px;">
																	<apex:outputText value="{!MITAagreementTypes}" escape="false" />
																</div>
																<div style="float:right; visibility: hidden;">
																	<input type="radio" name="MITAagreementactive" class="agreementactivefilter" data-type="MITA" data-value=" " />{!$Label.ISSP_Show_all_the_agreements}
																	<br/>
																	<input type="radio" name="MITAagreementactive" class="agreementactivefilter" data-type="MITA" data-value="true" checked="checked"/>{!$Label.ISSP_Active_agreements}
																	<br/>
																	<input type="radio" name="MITAagreementactive" class="agreementactivefilter" data-type="MITA" data-value="false" />{!$Label.ISSP_Inactive_agreements}
																	<br/>
																</div>
																
																<table id="MITAagreementsTable" class="agreementsTable dataTable no-footer hover row-border compact">
																	<thead>
																		<tr>
																			<th>{!$Label.ISSP_IATA_Designator}</th>
																			<th>{!$Label.ISSP_3_Digit_Code}</th>
																			<th>{!$Label.ISSP_Airline_Prefix}</th>
																			<th>{!$Label.ISSP_Airline}</th>
																			<th>{!$Label.ISSP_Agreement_type}</th>
																			<th>{!$Label.ISSP_Active}</th>
																			<th>{!$Label.ISSP_View} {!$ObjectType.Contact.LabelPlural}</th>
																		</tr>
																	</thead>
																	<tbody>
																		<apex:outputText value="{!MITAAgreementTable}" escape="false" />
																	</tbody>
																</table>
																<script>
																	initAgreementTable(true);
																</script>
																<br/>
																<br/>
															</apex:outputPanel>
														</apex:pageBlockSection>
													</div>

													<!-- SECOND INTERNAL TAB: BIETA -->
													<div class="mytab level2 {!IF(acc.BIETA_Member__c, IF(acc.MITA_Member__c, '', 'active'), 'mydisabled')}" id="tabBIETA">

														<!-- SECTION FOR BIETA AGREEMENTS -->
														<apex:inputHidden value="{!BIETAagreementid}" id="BIETAagreementid" />

														<apex:pageBlockSection columns="1" id="BIETAagreementSearchPanel">
															<apex:outputPanel>
																<div style="float:left;padding-bottom: 20px; padding-top: 20px;">
																	<apex:outputText value="{!BIETAagreementTypes}" escape="false" />
																</div>
																<div style="float:right; visibility: hidden;">
																	<input type="radio" name="BIETAagreementactive" class="agreementactivefilter" data-type="BIETA" data-value=" " />{!$Label.ISSP_Show_all_the_agreements}
																	<br/>
																	<input type="radio" name="BIETAagreementactive" class="agreementactivefilter" data-type="BIETA" data-value="true" checked="checked"/>{!$Label.ISSP_Active_agreements}
																	<br/>
																	<input type="radio" name="BIETAagreementactive" class="agreementactivefilter" data-type="BIETA" data-value="false" />{!$Label.ISSP_Inactive_agreements}
																	<br/>
																</div>
																
																<table id="BIETAagreementsTable" class="agreementsTable dataTable no-footer hover row-border compact">
																	<thead>
																		<tr>
																			<th>{!$Label.ISSP_IATA_Designator}</th>
																			<th>{!$Label.ISSP_3_Digit_Code}</th>
																			<th>{!$Label.ISSP_Airline_Prefix}</th>
																			<th>{!$Label.ISSP_Airline}</th>
																			<th>{!$Label.ISSP_Agreement_type}</th>
																			<th>{!$Label.ISSP_Active}</th>
																			<th>{!$Label.ISSP_View} {!$ObjectType.Contact.LabelPlural}</th>
																		</tr>
																	</thead>
																	<tbody>
																		<apex:outputText value="{!BIETAAgreementTable}" escape="false" />
																	</tbody>
																</table>
																<script>
																	initAgreementTable(false);
																</script>
																<br/>
																<br/>
															</apex:outputPanel>
														</apex:pageBlockSection>
													</div>
												</div>
											</div>
											
											<!-- SECOND EXTERNAL TAB: AVAILABLE AGREEMENTS -->
											<div class="mytab level1" id="tabAdd">
												<div class="mytabheadercontainer level2">
													<div class="mytabheader level2 {!IF(acc.MITA_Member__c, 'active', 'mydisabled')}" style="float:left;" id="hdNewMITA" onclick="showTab('Add','NewMITA')">MITA</div>
													<div class="mytabheader level2 {!IF(acc.BIETA_Member__c, IF(acc.MITA_Member__c, '', 'active'), 'mydisabled')}" style="float:right;" id="hdNewBIETA" onclick="showTab('Add','NewBIETA')">BIETA</div>
												</div>
												
												<div class="mytabcontainer level2">
													<apex:outputPanel id="NewMITAPanel">
														<apex:inputHidden value="{!MITAairlineID}" id="MITAairlineid" />
														
														<!-- FIRST INTERNAL TAB: NEW MITA -->
														<div class="mytab level2 {!IF(acc.MITA_Member__c, 'active', 'mydisabled')}" id="tabNewMITA">
															<div style="float:left;padding-bottom: 20px; padding-top: 30px;">
																<apex:outputText value="{!MITASuggestionTypes}" escape="false" />
															</div>
															<apex:pageBlockSection>
																<apex:outputPanel >
																	<table id="MITAsuggestionsTable" class="suggestionsTable dataTable no-footer hover row-border compact">
																		<thead>
																			<tr>
																				<th>{!$Label.ISSP_IATA_Designator}</th>
																				<th>{!$Label.ISSP_3_Digit_Code}</th>
																				<th>{!$Label.ISSP_Airline_Prefix}</th>
																				<th>{!$Label.ISSP_Airline}</th>
																				<th>{!$Label.ISSP_Available_types}</th>
																			</tr>
																		</thead>
																		<tbody>
																			<apex:outputText value="{!MITASuggestionTable}" escape="false" />
																		</tbody>
																	</table>
																	<script>
																		initSuggestionTable(true);
																	</script>
																</apex:outputPanel>
															</apex:pageBlockSection>
															<br/>
															<br/>
														</div>
													</apex:outputPanel>
													
													<apex:outputPanel id="NewBIETAPanel">
														<apex:inputHidden value="{!BIETAairlineID}" id="BIETAairlineid" />
														<!-- SECOND INTERNAL TAB: NEW BIETA -->
														<div class="mytab level2 {!IF(acc.BIETA_Member__c, IF(acc.MITA_Member__c, '', 'active'), 'mydisabled')}" id="tabNewBIETA">
															<div style="float:left;padding-bottom: 20px; padding-top: 30px;">
																<apex:outputText value="{!BIETASuggestionTypes}" escape="false" />
															</div>
															
															<br style="clear:both" />
															<apex:pageBlockSection>
																<apex:outputPanel >
																	<table id="BIETAsuggestionsTable" class="suggestionsTable dataTable no-footer hover row-border compact">
																		<thead>
																			<tr>
																				<th>{!$Label.ISSP_IATA_Designator}</th>
																				<th>{!$Label.ISSP_3_Digit_Code}</th>
																				<th>{!$Label.ISSP_Airline_Prefix}</th>
																				<th>{!$Label.ISSP_Airline}</th>
																				<th>{!$Label.ISSP_Available_types}</th>
																			</tr>
																		</thead>
																		<tbody>
																			<apex:outputText value="{!BIETASuggestionTable}" escape="false" />
																		</tbody>
																	</table>
																	<script>
																		initSuggestionTable(false);
																	</script>
																</apex:outputPanel>
															</apex:pageBlockSection>
															<br/>
															<br/>
														</div>
													</apex:outputPanel>
												</div>
											</div>
											
											<div class="mytab level1" id="tabContacts">
												<div class="mytabheadercontainer">
													<div class="mytabheader level2 active" style="float:left;" id="hdActiveContacts" onclick="AllCon_EditContactSuccess('');ActiveCon_EditContactSuccess('');showTab('Contacts','ActiveContacts')">{!$Label.ISSP_MITA_SUBTAB_01}</div>
													<div class="mytabheader level2" style="float:right;" id="hdAllContacts" onclick="AllCon_EditContactSuccess('');ActiveCon_EditContactSuccess('');showTab('Contacts','AllContacts')">{!$Label.ISSP_MITA_SUBTAB_02}</div>
												</div>

												<div class="mytabcontainer level2">
													<apex:outputPanel id="ActiveContactsPanel">
														<!-- FIRST INTERNAL TAB: Active Contacts -->
														<div class="mytab level2 active"  id="tabActiveContacts">
															<div style="float:left;padding-bottom: 20px; padding-top: 30px; width:100%">
																<apex:pageBlockSection columns="1">
																	<div id="ActiveCon_EditContactSuccess_ph"></div>
																</apex:pageBlockSection>
																<apex:pageBlockSection columns="1">
																	<apex:outputText value="{!ContactTypes}" escape="false" /><br/><br/>
																</apex:pageBlockSection>
																<apex:pageBlockSection >
																	<button type="button" class="iatabtn iatabtn-default" onclick="showTab('Contacts','AllContacts')">{!$Label.ISSP_MITA_Add_Contact}</button>
																</apex:pageBlockSection>
															</div>
															<apex:pageBlockSection columns="1" id="pbsActiveContact">
																<apex:outputPanel>
																	<table id="myActiveContactTable" class="contactsTable dataTable no-footer hover row-border compact">
																		<thead>
																			<tr>
																				<th>{!$ObjectType.Contact.Fields.Name.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.email.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.phone.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.MITA_Contact_Type__c.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.MITA_Teletype__c.Label}</th>
																				<th>{!$Label.Action}</th>
																			</tr>
																		</thead>
																		<tbody>
																			<apex:outputText value="{!MyActiveContactsTable}" escape="false" />
																		</tbody>
																	</table>
																	<script>
																		initContactTable('myActive');
																	</script>
																</apex:outputPanel>
															</apex:pageBlockSection>
															<br/>
															<br/>
														</div>
													</apex:outputPanel>

													<!-- SECOND INTERNAL TAB: All Contacts -->
													<apex:actionFunction name="SearchContact" action="{!SearchContact}" oncomplete="stopLoading();" reRender="tableAllConSearchResult,pbsResult">
														<apex:param name="myParam" assignTo="{!SearchCriteria}" value=""/>
													</apex:actionFunction>

													<script>
														search_alert = function() {}
														search_alert.warning = function(message) {
															$('#search_alert_placeholder').html('<div class="alert alert-warning"><a class="close" data-dismiss="alert">×</a><span>'+message+'</span></div>');
														}

														
														AllCon_EditContactSuccess = function(message){
															if(message=='')
																$('#AllCon_EditContactSuccess_ph').html('');
															else
																$('#AllCon_EditContactSuccess_ph').html('<div class="alert alert-success"><a class="close" data-dismiss="alert">×</a><span>'+message+'</span></div>');
														}

														ActiveCon_EditContactSuccess = function(message){
															if(message=='')
																$('#ActiveCon_EditContactSuccess_ph').html('');
															else
																$('#ActiveCon_EditContactSuccess_ph').html('<div class="alert alert-success" role="alert"><a class="close" data-dismiss="alert">×</a><span>'+message+'</span></div>');
														}

														function checkInputs(){
															$('#search_alert_placeholder').html('');
															var searchCrit = $('#searchCrit').val();
															if(searchCrit=="" || searchCrit==null || searchCrit.length >=3){
																var letterNumber = /^[0-9a-zA-Z@.\-_+ ]+$/;
																if(searchCrit=="" || searchCrit==null || searchCrit.match(letterNumber)) {
																	startLoading();
																	SearchContact(searchCrit);
																	initMyAllContactTable();
																}else{
																	search_alert.warning('{!$Label.ISSP_MITA_Search_ValidInput}');
																}
															}else{
																search_alert.warning('{!$Label.ISSP_MITA_Search_At_Least3Chars}');
															}
														}
													</script>

													<apex:outputPanel id="AllContactsPanel">
														<div class="mytab level2" id="tabAllContacts">
															<div style="float:left;padding-bottom: 20px; padding-top: 30px;">
																<apex:pageBlockSection columns="1">
																	<div id="AllCon_EditContactSuccess_ph"></div>
																</apex:pageBlockSection>
																<apex:pageBlockSection columns="1">
																	<div class="alert alert-info" role="alert">{!$Label.ISSP_MITA_Search_Text01}</div>
																</apex:pageBlockSection>
																<apex:pageBlockSection>
																	<input type="search" id="searchCrit"/>
																	<button type="submit" class="iatabtn iatabtn-default" onclick="checkInputs();return false;">{!$Label.ISSP_MITA_Search_Button}</button>
																</apex:pageBlockSection>
																<apex:pageBlockSection>
																	<div id="search_alert_placeholder"></div>
																</apex:pageBlockSection>
																<apex:pageBlockSection columns="1">
																	<div class="alert alert-info" role="alert">{!$Label.ISSP_MITA_Search_Text02}</div>
																</apex:pageBlockSection>
															</div>
															
															<apex:pageBlockSection columns="1" id="pbsResult">
																<apex:outputPanel id="tableAllConSearchResult" rendered="{!hasSearched}">
																	<table id="myAllContactTable" class="contactsTable dataTable no-footer hover row-border compact">
																		<thead>
																			<tr>
																				<th>{!$ObjectType.Contact.Fields.Name.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.email.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.phone.Label}</th>
																				<th>{!$ObjectType.Contact.Fields.MITA_Teletype__c.Label}</th>
																				<th>{!$Label.Action}</th>
																			</tr>
																		</thead>
																		<tbody>
																			<apex:outputText value="{!MyAllContactsTable}" escape="false" />
																		</tbody>
																	</table>
																</apex:outputPanel>
															</apex:pageBlockSection>
														</div>
													</apex:outputPanel>
												</div>
											</div>
										</div>
										<br/>
										<br/>
									</div>
								</div>
							</apex:pageBlock>
						</apex:form>
					</apex:outputPanel>
				</apex:outputPanel>
			</div>
			
			<c:ISSP_CustomFooter />
		</body>
	</html>
</apex:page>