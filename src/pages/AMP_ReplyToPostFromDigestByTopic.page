<apex:page controller="AMP_ReplyToPostFromDigestByTopic" showHeader="true" tabStyle="Account">

	<script>
		function cvCheckAllOrNone(allOrNoneCheckbox) {
		
			// Find parent table
			var container = allOrNoneCheckbox;
			while (container.tagName != "TABLE") {
				container = container.parentNode;
			}
		
			// Switch all checkboxes
			var inputs = container.getElementsByTagName("input");
			var checked = allOrNoneCheckbox.checked;
			for (var i = 0; i < inputs.length; i++) {
				var input = inputs.item(i);
				if (input.type == "checkbox") {
					if (input != allOrNoneCheckbox) {
						input.checked = checked;
					}
				}
			}
		}
	</script>

	<apex:form >

		<apex:pageBlock id="mainBlock" title="Respond to Chatter Post" >
			
			<apex:pageBlockSection columns="2" collapsible="false" >
			
			    <apex:outputText style="float: left;" value="{0} {1}" escape="false">
			    	<apex:param value="<b>Chatter Post:</b>" />
			    	<apex:param value="{!commentBody}" />
			    </apex:outputText>
			
			</apex:pageBlockSection>
					
			<apex:pageMessages escape="false" />

			<apex:pageBlockSection title="Step 1 - Select accounts on which you wish your response to be posted" columns="1" collapsible="false" rendered="{! step == 1}">
		
				<apex:pageBlockSectionItem >
					<apex:outputPanel >
						<apex:commandButton action="{!nextStep}" value="Next >" reRender="mainBlock" style="float: right;" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>

				<apex:pageBlockTable value="{!feedItemAccountLst}" var="wrap" id="feedItemAccountTable">

					<apex:column style="width:100px;">

						<apex:facet name="header">
							<apex:inputCheckbox onclick="cvCheckAllOrNone(this);"/> 
						</apex:facet>

						<apex:inputCheckbox value="{!wrap.isSelected}" />

					</apex:column>

					<apex:column headerValue="{!$ObjectType.Account.fields['Name'].label}" value="{!wrap.feedItem.Parent.Name}"/>

				</apex:pageBlockTable>

				<apex:pageBlockSectionItem >
					<apex:outputPanel >
						<apex:commandButton action="{!nextStep}" value="Next >" reRender="mainBlock" style="float: right;" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>

			</apex:pageBlockSection>
			
			<apex:pageBlockSection title="Step 2 - Send your response" columns="1" collapsible="false" rendered="{! step == 2}">

				<apex:inputTextarea cols="50" rows="4" value="{!message}" label="Insert Response:"/>

				<b>Your response will be posted on the following accounts ({!numberOfAccounts}):</b>
				
				<br/>

				{!acctListStr}

				<apex:outputPanel >
					<apex:commandButton action="{!previousStep}" value="< Back to Account Selection" reRender="mainBlock" />
					<apex:commandButton action="{!postReplyMessages}" value="Post Response" reRender="mainBlock" style="float: right;" status="replyStatusId"/>
					<apex:actionStatus id="replyStatusId" >
						<apex:facet name="start" >
							<img src="/img/loading.gif" style="float: right;"/>
						</apex:facet>
					</apex:actionStatus>
				</apex:outputPanel>

			</apex:pageBlockSection>
		
			<apex:pageBlockSection columns="1" collapsible="false" rendered="{! step == 3}">

				<apex:commandButton action="{!restartFromStep1}" value="New response" reRender="mainBlock" />

			</apex:pageBlockSection>

		</apex:pageBlock>

	</apex:form>

</apex:page>