<apex:page standardController="Tracked_Email__c" extensions="sendSingleTrackedEmailController" action="{!applyTemplate}" >

<!-- <apex:includeScript value="{!$Resource.jQuery_min_1_11_0}"/> -->

<style>
	input[type='text'] { width: 460px; }
	textarea {
		height: 90px;
		width: 458px 
	}
</style>

<apex:form id="editform" >

<!-- 	<apex:actionFunction name="applyTemplate" action="{!reloadPage}" /> -->

	<apex:pagemessages />

<!-- 	NEW TRACKED EMAIL SECTION -->
	<apex:outputPanel id="editPanel" rendered="{!isNew}" >

		<apex:sectionHeader title="Task" subtitle="Send a Tracked Email"/>

		<apex:pageBlock mode="edit" rendered="{!cse!=null}" >

			<apex:pageBlockSection title="Edit Tracked Email" columns="1" collapsible="false" >
				<apex:outputField value="{!email.Case__c}" />
				<apex:pageBlockSectionItem >
					<apex:outputLabel value="From Address" />
					<apex:selectList value="{!selectedFrom}" size="1" >
						<apex:selectOptions value="{!fromAddresses}" />
					</apex:selectList>
				</apex:pageBlockSectionItem>

				<apex:inputField value="{!email.ToContact__c}" required="false" />
<!-- 				<apex:inputField value="{!email.CcAddress__c}" required="false" /> -->
<!-- 				<apex:inputField value="{!email.BccAddress__c}" required="false" /> -->
				<apex:inputField value="{!email.Subject__c}" required="false" />
<!-- 				<apex:inputTextArea value="{!email.TextBody__c}" required="true" /> -->
				<apex:inputField value="{!email.Html_Body__c}" required="false" />
			</apex:pageBlockSection>

			<apex:pageBlockButtons location="both" >
				<apex:commandButton value="Cancel" action="{!cancel}" immediate="true" />
				<apex:commandButton value="Send Tracked Email" action="{!sendTrackedEmail}" />
<!-- 				<apex:commandButton value="Send Tracked Email2" onclick="openTemplateSelector(event)" /> -->
				<input id="selectTemplate" value="Select Template" class="btn" type="button" onclick="showTemplatePanel(true);" ></input>
			</apex:pageBlockButtons>

		</apex:pageBlock>

	</apex:outputPanel>

<!-- 	VIEW TRACKED EMAIL -->
	<apex:outputPanel id="viewPanel" rendered="{!!isNew}" >

		<apex:sectionHeader title="View" subtitle="Tracked Email"/>

		<apex:pageBlock mode="detail" >

			<apex:pageBlockSection title="Tracked Email" columns="1" collapsible="false" >
				<apex:outputField value="{!email.FromAddress__c}" />
				<apex:outputField value="{!email.CcAddress__c}" />
				<apex:outputField value="{!email.BccAddress__c}" />
				<apex:outputField value="{!email.Subject__c}" />
				<apex:outputText value="{!email.TextBody__c}" />

<!-- 				<apex:outputText value="{!email.Signaturit_Id__c}" /> -->
<!-- 				<apex:outputText value="{!email.Signaturit_Certificate_Ids__c}" /> -->
			</apex:pageBlockSection>

			<apex:pageBlockButtons location="both" >
				<apex:commandButton value="Cancel" action="{!cancel}" immediate="true" />
			</apex:pageBlockButtons>

		</apex:pageBlock>

	</apex:outputPanel>

	<c:SelectEmailTemplate ctrl="{!thisController}" />

</apex:form>

<apex:outputPanel id="relatedLists" rendered="{!!isNew}" >
<!-- 	<apex:relatedList list="Attachments" /> -->
	<apex:relatedList list="Tracked_Email_Events__r" />
</apex:outputPanel>


</apex:page>