<apex:page controller="ISSP_Registration"  standardStylesheets="false" showHeader="false" sidebar="false"  applyBodyTag="false" applyHtmlTag="false"  language="{!lang}">
 
 
 <apex:outputPanel rendered="{!displayNewCaseForm}" >
    <c:ISSP_Registration_NewCaseForm ctrl="{!thisCtrlForNewCaseForm}" />
  </apex:outputPanel>


  <apex:composition template="{!templatename}">
    <apex:define name="body">
      <div class="registration_page" id="CreateContact">
        <div class="logo"> </div>
        <div class="col-md-6 col-md-push-3">
          
          
          <!-- SECOND LOG BOX  -->
          <div class="panel panel-default conMode" >
            <div class="panel-heading2">
              <h3 class="panel-title">{!$Label.ISSP_Registration_RegistrationProcess}</h3>
            </div>
            <apex:form id="newContact" styleclass="login_box1" >
              <div class="alert alert-danger" style="display:{!if(errorMessage.size==0,'none','')}">
                <strong>{!$Label.ISSP_Error}</strong>
                <apex:repeat value="{!errorMessage}" var="er" id="theRepeat">
                  <p><apex:outputText value="{!er}" escape="false" /></p>
                </apex:repeat>
              </div>
              <div id="recFields" class="alert alert-danger" style="display:none">
                <strong>{!$Label.ISSP_fill_required_fields}</strong>
                <span></span>
              </div>
              <div class="form-group">
                <div class="row">
                  <label class="col-lg-5 control-label" for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.Email.Label}</label>
                  <div class="col-lg-7">
                    <p style="line-height: 26px;">{!con.Email}</p>

                  </div>
                </div>
              </div>
              <!--
              <div class="form-group" id="TypeOfCustomer">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Type_of_Customer}</label>
                <apex:selectList styleclass="form-control rec" id="TypeSelect" value="{!selectedCustomerType}" onchange="TypeOfCustomerChange()" size="1" required="true">
                  <apex:selectOption itemValue="" itemLabel=" - Select the Type of your Company - "/>
                  <apex:selectOption itemValue="Airline" itemLabel="Airline"/>
                  <apex:selectOption itemValue="GloballSalesAgent" itemLabel="General Sales Agent"/>
                  <apex:selectOption itemValue="Agency" itemLabel="Agency"/>
                  <apex:selectOption itemValue="NonIATAAgent" itemLabel="Non IATA Agent"/>
                  <apex:selectOption itemValue="TIESS" itemLabel="TIESS"/>
                  <apex:selectOption itemValue="OtherCompany" itemLabel="Other Company"/>
                  <apex:selectOption itemValue="GeneralPublic" itemLabel="General public"/>
                </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_TypeofCustomer}</p>
                  </div>                
              </div>
              -->
              <div class="form-group" id="Country" style="display:none"> 
                <label class="control-label"  for="inputError"><span class="required">*</span>{!$Label.ISSP_Location}</label>
                <apex:selectList styleclass="form-control" value="{!con.ISO_Country__c}" size="1" >
                    <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Registration_CountryNone}"/>
                    <apex:selectOptions value="{!ISOCountry}"/>
    <!--                            <apex:actionSupport event="onchange" reRender=""/> -->
                </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_Location}</p>
                  </div>                    
              </div>
             <div class="form-group" id="Salutation">
                <div><label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Salutation}</label></div>
    
                    <apex:selectList styleclass="form-control rec" value="{!con.Salutation}" size="1" required="true">
                      <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Registration_None}"/>
                      <apex:selectOption itemValue="Mr." itemLabel="{!$Label.ISSP_Registration_MR}"/>
                      <apex:selectOption itemValue="Mrs." itemLabel="{!$Label.ISSP_Registration_MRS}"/>
                      <apex:selectOption itemValue="Ms." itemLabel="{!$Label.ISSP_Registration_MS}"/>
                      <apex:selectOption itemValue="Others " itemLabel="{!$Label.ISSP_Registration_Others}"/>
                    </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_Salutation}</p>
                  </div>                        
            </div>
        
              <div class="form-group" id="FirstName">               
                <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.FirstName.Label}</label>
                <apex:inputField styleClass="form-control rec"  value="{!con.FirstName}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_FirstName}</p>
                  </div>                    
            </div>
              <div class="form-group" id="LastName">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.LastName.Label}</label>             
                <apex:inputField styleclass="form-control rec" value="{!con.LastName}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_LastName}</p>
                  </div>                    
              </div>
              <div class="form-group" id="Title">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Registration_JobTitle}</label>         
                <apex:inputField styleclass="form-control rec" value="{!con.Title}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_JobTitle}</p>
                  </div>                    
              </div>
              <div class="form-group" id="Function">
             
                <span class="rec multiSelectFunction">
                    <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.Membership_Function__c.Label}</label>                   
                    <apex:inputField styleclass="form-control" value="{!con.Membership_Function__c}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_JobFunction}</p>
                  </div>                        
                </span>
              </div>
              <div class="form-group" id="Phone">
                <label for="businessphoneinput"><span class="required">*</span>{!$Label.ISSP_Registration_BusinessPhone}</label><br/>
                <apex:inputHidden id="businessphone" value="{!con.Phone}" />
                <apex:inputHidden id="phone1" value="{!phone1}"/>
                <apex:inputHidden id="phone2" value="{!phone2}"/>
                <apex:inputHidden id="phone3" value="{!phone3}"/>
                
                <apex:inputField id="businessphoneinput" html-placeholder="" styleclass="form-control rec" value="{!con.PhoneNational__c}" onblur="setInternationalPhoneNo('phone');"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_BusinessPhone}</p>
                  </div>                    
              </div>
              
                        
              
              <div class="form-group" id="Phone2">
                <label   for="exampleInputEmail1">{!$Label.ISSP_Registration_MobilePhone}</label><br/>
                <apex:inputHidden id="businessmobile" value="{!con.MobilePhone}" />          
                <apex:inputField id="businessmobileinput" styleclass="form-control" html-placeholder="" value="{!con.MobileNational__c}" onblur="setInternationalPhoneNo('mobile');"/>
              </div> 
              <div class="form-group" id="Fax">
                <label   for="exampleInputFax">{!$ObjectType.Contact.fields.Fax.Label}</label><br/>
                <apex:inputHidden id="businessfax" value="{!con.Fax}" />
                <apex:inputField id="businessfaxinput" styleclass="form-control" value="{!con.FAXNational__c}" onblur="setInternationalPhoneNo('fax');"/>
              </div>
              
              <div class="form-group"><!--  onClick="if(!validateNewUser())return false;" {!registerContact}-->  
<!--                <apex:commandButton styleclass="btn_iata btn-lg btn-block btn-success" action="{!getRegPage}" value="Back" id="back"/> -->
                <apex:commandButton styleclass="btn_iata btn-lg btn-block btn-success2" onClick="if(!validateNewUser())return false;" action="{!submitContact}" value="{!$Label.ISSP_Next}" id="next" />
              </div>
        </apex:form>
   
              
<script>
    //in create contact page
    // description popups
    $('#Title').popover({placement:'top',trigger:'hover',content:'{!JSENCODE($Label.ISSP_Registration_Title_Bubble)}',title:''});
    $('#Country').popover({placement:'top',trigger:'hover',content:'{!JSENCODE($Label.ISSP_Registration_Country_Bubble)}',title:''});
    
    // run at first time (to show the country picklist)
    TypeOfCustomerChange();
    
    if ({!displayNewCaseForm})
        $("#NewCasePopUp").modal('show');
                 
    // if type is General Public - show Country selection
    function TypeOfCustomerChange(){
        var type = $("select[id*='TypeSelect']").val();
        $('#Country').hide().removeClass('rec');
        $('#Country select').removeClass('rec');
        if(type == 'GeneralPublic'){
            $('#Country').show();
            $('#Country select').addClass('rec');
        }
    }
                
                function validateNewUser(){
                
                    //Save dial code and country values into hidden fields

    
                    var natphone = $("input[name='{!$Component.newContact.businessphoneinput}']");
                    var natmobile = $("input[name='{!$Component.newContact.businessmobileinput}']").intlTelInput("getSelectedCountryData");
                    var natfax = $("input[name='{!$Component.newContact.businessfaxinput}']").intlTelInput("getSelectedCountryData");
                    
                    var input1 = $("input[name='{!$Component.newContact.businessphoneinput}']");
                    var final1 = '+' + input1.intlTelInput("getSelectedCountryData").dialCode;
                    var number1 = input1.intlTelInput("getNumber");
                    number1 = number1.replace(final1,"");
                    number1 = number1.replace("+1","");                    
                    final1 = final1 + number1;
                    var temp1 = document.getElementById('j_id0:j_id43:newContact:phone1');
                    temp1.value = final1;
                    //alert("Final 1: " + final1);
                    
                    var input2 = $("input[name='{!$Component.newContact.businessmobileinput}']");
                    var final2 = '+' + input2.intlTelInput("getSelectedCountryData").dialCode;
                    var number2 = input2.intlTelInput("getNumber");
                    if (number2 != "") {
                        number2 = number2.replace(final2,"");
                        number2 = number2.replace("+1","");   
                        final2 = final2 + number2;
                        var temp2 = document.getElementById('j_id0:j_id43:newContact:phone2');
                        temp2.value = final2;
                        //alert("Final 2: " + final2);
                    }
                    
                    var input3 = $("input[name='{!$Component.newContact.businessfaxinput}']");
                    var final3 = '+' + input3.intlTelInput("getSelectedCountryData").dialCode;
                    var number3 = input3.intlTelInput("getNumber");
                    if (number3 != "") {
                        number3 = number3.replace(final3,"");
                        number3 = number3.replace("+1","");                    
                        final3 = final3 + number3;
                        var temp3 = document.getElementById('j_id0:j_id43:newContact:phone3');
                        temp3.value = final3;
                        //alert("Final 3: " + final3);
                    }
                    
                    
                    
                
                    var type = $("select[id*='TypeSelect']").val();
                    var flag = true;
                    $('#recFields').hide();
                    $('.rec').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                            if($(this).hasClass("multiSelectFunction")){
                                if($(this).find('select[id*="_selected"]').first().find('option').length==0){
                                    flag = false;
                                    $(this).parents('.form-group').addClass('has-error');
                                }
                            }
                            else if(!$(this).val()){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                            
                        }
                    )
                    if(flag == false){
                        $('#recFields').show();
                    }
                    return flag;
                 }
              </script>
        <script src="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/js/intlTelInput.js')}"></script>  
        <script>
        var natphone = $("input[name='{!$Component.newContact.businessphoneinput}']");
        var phone = $("input[name='{!$Component.newContact.businessphone}']");
        
        
        natphone.intlTelInput({
            //defaultCountry: "auto",
            geoIpLookup: function(callback) {
                $.get('https://www.telize.com/geoip', function() {}, "jsonp").always(function(resp) {
                var countryCode = (resp && resp.country_code) ? resp.country_code : "";
                callback(countryCode);
                });
            },
            //nationalMode: true,
            separateDialCode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        
        /*
        natphone.intlTelInput({
            defaultCountry: "{!country}",
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        */
        
        var natmobile = $("input[name='{!$Component.newContact.businessmobileinput}']");
        var mobile = $("input[name='{!$Component.newContact.businessmobile}']");
        
        natmobile.intlTelInput({
            defaultCountry: "{!country}",
            //nationalMode: true,
            preferredCountries: [""],
            numberType: "MOBILE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        var natfax = $("input[name='{!$Component.newContact.businessfaxinput}']");
        var fax = $("input[name='{!$Component.newContact.businessfax}']");
        
        natfax.intlTelInput({
            //defaultCountry: "auto",
            //nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        function setInternationalPhoneNo(p) {
            if(p=='phone') {
                phone.val(natphone.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobile.val(natmobile.intlTelInput("getNumber"));
            } else {
                fax.val(natfax.intlTelInput("getNumber"));
            }
        }
        
        
        //Fix EM: If user goes back we need to set again the country code/ country already selected
        
        var natphone = $("input[name='{!$Component.newContact.businessphoneinput}']");
        var natmobile = $("input[name='{!$Component.newContact.businessmobileinput}']");
        var natfax = $("input[name='{!$Component.newContact.businessfaxinput}']");
   
        
        
        var phonenat = "{!con.Phone}";
        var phonemobile = "{!con.MobilePhone}";
        var phonefax = "{!con.Fax}";
        //alert(phonenat);
        //alert(phonefax );
        if (phonenat != "") {
        

            natphone.intlTelInput("setNumber", phonenat);
            var code = natphone.intlTelInput("getSelectedCountryData").dialCode;

            //natphone.value = natphone.replace("+" + code1, "");
            //natphone.intlTelInput("setCountry", coun1);

        }
        if (phonemobile != "") {
            //natmobile.intlTelInput("setNumber", phonemobile);
            //var countryData = natmobile.intlTelInput("getSelectedCountryData");
            //var number = phonemobile.replace("+" + code2 ,"");
            natmobile.intlTelInput("setNumber", phonemobile);
            //natmobile.intlTelInput("setCountry", coun2);
        
        }
            
        if (phonefax != "") {
        
            //natfax.intlTelInput("setNumber", phonefax);
            //var countryData = natfax.intlTelInput("getSelectedCountryData");
            //var number = phonefax.replace("+" + code3 ,"");
            natfax.intlTelInput("setNumber", phonefax);
            //natfax.intlTelInput("setCountry", coun3);

        }
        

        
        
      </script>
              
            
          </div>
        </div>
      </div>
    </apex:define>
  </apex:composition>
  

           
</apex:page>