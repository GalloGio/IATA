<apex:page controller="ISSP_Registration"  standardStylesheets="false" showHeader="false" sidebar="false"  applyBodyTag="false" applyHtmlTag="false"  language="{!lang}">
    
     <style>
           .multiSelectFunction {}
           .multiSelectFunction table.multiSelectPicklistTable { width: 100% }
           .multiSelectFunction table.multiSelectPicklistTable td {vertical-align: top;}
           .multiSelectFunction table.multiSelectPicklistTable td.multiSelectPicklistCell {width: 9%;}
           .multiSelectFunction table.multiSelectPicklistTable td img.form-control {  border: 0 none;}
           .multiSelectPicklistTable td select {height: 82px;}
           .has-error .hiddenerror {display: inline !important;}
           .errormsg {font-weight: bold; font-size: 14px; color: #C90435;}
           .btn-success2 {color: #ffffff;background-color: #a1bc00;border: 1px solid #4E8E15;font-weight: bold;cursor: pointer;}
           h3.panel-title {background: none repeat scroll 0 0 #a1bc00;color: #fff;display: block;font-size: 19px;font-weight: normal;margin-top: 0;padding: 10px;}
    </style>
 
 <apex:outputPanel rendered="{!displayNewCaseForm}" >
    <c:ISSP_Registration_NewCaseForm ctrl="{!thisCtrlForNewCaseForm}" />
  </apex:outputPanel>

  <apex:composition template="ISS_Template">
    <apex:define name="body">
      <div class="registration_page">
        <div class="logo"> </div>
        <div class="col-md-6 col-md-push-3">
          
          
          <!-- SECOND LOG BOX  -->
          <div class="panel panel-default conMode" >
            <div class="panel-heading2">
              <h3 class="panel-title">{!$Label.ISSP_Registration_RegistrationProcess}</h3>
            </div>
            <apex:form id="newContact" styleclass="login_box1" >
              <div class="alert alert-danger" style="display:{!if(errorMessage.size==0,'none','')}">
                <strong>{!$Label.ISSP_Error}</strong>
                <apex:repeat value="{!errorMessage}" var="er" id="theRepeat">
                  <p><apex:outputText value="{!er}" escape="false" /></p>
                </apex:repeat>
              </div>
              <div id="recFields" class="alert alert-danger" style="display:none">
                <strong>{!$Label.ISSP_fill_required_fields}</strong>
                <span></span>
              </div>
              <div class="form-group">
                <div class="row">
                  <label class="col-lg-5 control-label" for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.Email.Label}</label>
                  <div class="col-lg-7">
                    <p style="line-height: 26px;">{!con.Email}</p>

                  </div>
                </div>
              </div>
              <!--
              <div class="form-group" id="TypeOfCustomer">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Type_of_Customer}</label>
                <apex:selectList styleclass="form-control rec" id="TypeSelect" value="{!selectedCustomerType}" onchange="TypeOfCustomerChange()" size="1" required="true">
                  <apex:selectOption itemValue="" itemLabel=" - Select the Type of your Company - "/>
                  <apex:selectOption itemValue="Airline" itemLabel="Airline"/>
                  <apex:selectOption itemValue="GloballSalesAgent" itemLabel="General Sales Agent"/>
                  <apex:selectOption itemValue="Agency" itemLabel="Agency"/>
                  <apex:selectOption itemValue="NonIATAAgent" itemLabel="Non IATA Agent"/>
                  <apex:selectOption itemValue="TIESS" itemLabel="TIESS"/>
                  <apex:selectOption itemValue="OtherCompany" itemLabel="Other Company"/>
                  <apex:selectOption itemValue="GeneralPublic" itemLabel="General public"/>
                </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_TypeofCustomer}</p>
                  </div>                
              </div>
              -->
              <div class="form-group" id="Country" style="display:none"> 
                <label class="control-label"  for="inputError"><span class="required">*</span>{!$Label.ISSP_Location}</label>
                <apex:selectList styleclass="form-control" value="{!con.ISO_Country__c}" size="1" >
                    <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Registration_CountryNone}"/>
                    <apex:selectOptions value="{!ISOCountry}"/>
    <!--                            <apex:actionSupport event="onchange" reRender=""/> -->
                </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_Location}</p>
                  </div>                    
              </div>
             <div class="form-group" id="Salutation">
                <div><label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Salutation}</label></div>
    
                    <apex:selectList styleclass="form-control rec" value="{!con.Salutation}" size="1" required="true">
                      <apex:selectOption itemValue="" itemLabel="{!$Label.ISSP_Registration_None}"/>
                      <apex:selectOption itemValue="Mr." itemLabel="{!$Label.ISSP_Registration_MR}"/>
                      <apex:selectOption itemValue="Mrs." itemLabel="{!$Label.ISSP_Registration_MRS}"/>
                      <apex:selectOption itemValue="Ms." itemLabel="{!$Label.ISSP_Registration_MS}"/>
                      <apex:selectOption itemValue="Others " itemLabel="{!$Label.ISSP_Registration_Others}"/>
                    </apex:selectList>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_Salutation}</p>
                  </div>                        
            </div>
        
              <div class="form-group" id="FirstName">               
                <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.FirstName.Label}</label>
                <apex:inputField styleClass="form-control rec"  value="{!con.FirstName}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_FirstName}</p>
                  </div>                    
            </div>
              <div class="form-group" id="LastName">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.LastName.Label}</label>             
                <apex:inputField styleclass="form-control rec" value="{!con.LastName}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_LastName}</p>
                  </div>                    
              </div>
              <div class="form-group" id="Title">
                <label for="exampleInputEmail1"><span class="required">*</span>{!$Label.ISSP_Registration_JobTitle}</label>         
                <apex:inputField styleclass="form-control rec" value="{!con.Title}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_JobTitle}</p>
                  </div>                    
              </div>
              <div class="form-group" id="Function">
             
                <span class="rec multiSelectFunction">
                    <label for="exampleInputEmail1"><span class="required">*</span>{!$ObjectType.Contact.fields.Membership_Function__c.Label}</label>                   
                    <apex:inputField styleclass="form-control" value="{!con.Membership_Function__c}"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_JobFunction}</p>
                  </div>                        
                </span>
              </div>
              <div class="form-group" id="Phone">
                <label for="businessphoneinput"><span class="required">*</span>{!$Label.ISSP_Registration_BusinessPhone}</label><br/>
                <apex:inputHidden id="businessphone" value="{!con.Phone}" />
                <apex:inputField id="businessphoneinput" html-placeholder="" styleclass="form-control rec" value="{!con.PhoneNational__c}" onblur="setInternationalPhoneNo('phone');"/>
                  <div class="hiddenerror" style="display: none;">
                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_BusinessPhone}</p>
                  </div>                    
              </div> 
              <div class="form-group" id="Phone2">
                <label   for="exampleInputEmail1">{!$Label.ISSP_Registration_MobilePhone}</label><br/>
                <apex:inputHidden id="businessmobile" value="{!con.MobilePhone}" />          
                <apex:inputField id="businessmobileinput" styleclass="form-control" html-placeholder="" value="{!con.MobileNational__c}" onblur="setInternationalPhoneNo('mobile');"/>
              </div> 
              <div class="form-group" id="Fax">
                <label   for="exampleInputFax">{!$ObjectType.Contact.fields.Fax.Label}</label><br/>
                <apex:inputHidden id="businessfax" value="{!con.Fax}" />
                <apex:inputField id="businessfaxinput" styleclass="form-control" value="{!con.FAXNational__c}" onblur="setInternationalPhoneNo('fax');"/>
              </div>
              
              <div class="form-group"><!--  onClick="if(!validateNewUser())return false;" {!registerContact}-->  
<!--                <apex:commandButton styleclass="btn_iata btn-lg btn-block btn-success" action="{!getRegPage}" value="Back" id="back"/> -->
                <apex:commandButton styleclass="btn_iata btn-lg btn-block btn-success2" onClick="if(!validateNewUser())return false;" action="{!submitContact}" value="{!$Label.ISSP_Next}" id="next" />
              </div>
        </apex:form>
          
              
<script>
    //in create contact page
    // description popups
    $('#Title').popover({placement:'top',trigger:'hover',content:'{!JSENCODE($Label.ISSP_Registration_Title_Bubble)}',title:''});
    $('#Country').popover({placement:'top',trigger:'hover',content:'{!JSENCODE($Label.ISSP_Registration_Country_Bubble)}',title:''});
    
    // run at first time (to show the country picklist)
    TypeOfCustomerChange();
    
    if ({!displayNewCaseForm})
        $("#NewCasePopUp").modal('show');
                 
    // if type is General Public - show Country selection
    function TypeOfCustomerChange(){
        var type = $("select[id*='TypeSelect']").val();
        $('#Country').hide().removeClass('rec');
        $('#Country select').removeClass('rec');
        if(type == 'GeneralPublic'){
            $('#Country').show();
            $('#Country select').addClass('rec');
        }
    }
                
                function validateNewUser(){
                    var type = $("select[id*='TypeSelect']").val();
                    var flag = true;
                    $('#recFields').hide();
                    $('.rec').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                            if($(this).hasClass("multiSelectFunction")){
                                if($(this).find('select[id*="_selected"]').first().find('option').length==0){
                                    flag = false;
                                    $(this).parents('.form-group').addClass('has-error');
                                }
                            }
                            else if(!$(this).val()){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                            
                        }
                    )
                    if(flag == false){
                        $('#recFields').show();
                    }
                    return flag;
                 }
              </script>
        <script src="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/js/intlTelInput.js')}"></script>  
        <script>
        var natphone = $("input[name='{!$Component.newContact.businessphoneinput}']");
        var phone = $("input[name='{!$Component.newContact.businessphone}']");
        
        /*
        natphone.intlTelInput({
            defaultCountry: "auto",
            geoIpLookup: function(callback) {
                $.get('https://www.telize.com/geoip', function() {}, "jsonp").always(function(resp) {
                var countryCode = (resp && resp.country_code) ? resp.country_code : "";
                callback(countryCode);
                });
            },
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        */
        
        natphone.intlTelInput({
            defaultCountry: "{!country}",
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        var natmobile = $("input[name='{!$Component.newContact.businessmobileinput}']");
        var mobile = $("input[name='{!$Component.newContact.businessmobile}']");
        
        natmobile.intlTelInput({
            defaultCountry: "{!country}",
            nationalMode: true,
            preferredCountries: [""],
            numberType: "MOBILE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        var natfax = $("input[name='{!$Component.newContact.businessfaxinput}']");
        var fax = $("input[name='{!$Component.newContact.businessfax}']");
        
        natfax.intlTelInput({
            defaultCountry: "{!country}",
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
        
        function setInternationalPhoneNo(p) {
            if(p=='phone') {
                phone.val(natphone.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobile.val(natmobile.intlTelInput("getNumber"));
            } else {
                fax.val(natfax.intlTelInput("getNumber"));
            }
        }
          
      </script>
              
            
          </div>
        </div>
      </div>
    </apex:define>
  </apex:composition>
</apex:page>