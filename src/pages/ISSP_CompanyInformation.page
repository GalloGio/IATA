<apex:page controller="ISSP_PersonalInformation" extensions="ISSP_PersonalInformationWithoutSharing"  standardStylesheets="false" showHeader="false" sidebar="false"  applyBodyTag="false" applyHtmlTag="false">
 <html>
 <c:ISSP_Header communityName="{!communityName}"></c:ISSP_Header>    
 <body>
     <link rel="stylesheet" href="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/css/intlTelInput.css')}"/>
     <script type="text/javascript">
     $(document).ready(function() {
  		if({!isEditMode}){
  			$('.saveMode').hide();
            $('.editMode').show();
            $('.editModeBtn').show();
    	} else {
    		$('.selected-flag').hide();
    	}
         //alert({!isEditMode});
  		}); 
     </script>
      <style>
           	.has-error .hiddenerror {display: inline !important;}
           	.errormsg {font-weight: bold; font-size: 14px; color: #C90435;}
           	.btn-success2 {color: #ffffff;background-color: #a1bc00;border: 1px solid #4E8E15;font-weight: bold;cursor: pointer;}
         	.required {color: #C90435;font-size: 24px;padding: 0 5px 0 0;}
    </style>

    <div class="container">
        <c:ISSP_CustomNavigation communityName="{!communityName}"/>
        <div class="panel panel-primary">
            <div class="panel-heading head_panel_green">
                <a name="form"></a>
                <h3 class="panel-title">{!$Label.ISSP_Registration_MyCompany}</h3>
            </div>
            <div class="panel-body">
                <div class="alert alert-danger" style="display:{!if(errorMessage.size==0,'none','')}" >
                    <strong>Error: </strong>
                    <apex:repeat value="{!errorMessage}" var="er" id="theRepeat">
                        <p> {!er}</p>
                    </apex:repeat>
                </div>
                <div class="row">
                    <!-- My Company panel  -->
                    <div class="col-md-6">
                        <apex:form id="companyProfile">
                        <div class="panel-body form-horizontal" style="padding-top: 0px;" >
                            <div class="row">
                            <apex:outPutPanel layout="block" rendered="{!isLegalNamePopulated}">
                                <label class="lbl col-lg-5" style="padding-left:28px" for="exampleInputEmail1">{!$ObjectType.Account.fields.Legal_name__c.Label}</label>
                                <div class="col-lg-7">
                                    {!con.Account.Top_Parent__r.Legal_name__c}
                                </div>
                            </apex:outPutPanel>
                            </div>
                            <div class="row">
                                <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Name_on_AOC__c.Label}</label>
                                <div class="col-lg-7">
                                    {!con.Account.Top_Parent__r.Name_on_AOC__c}
                                </div>
                            </div>
                            <apex:outputText rendered="{!isIATAAgencyAcct}">
                                <div class="row form-group">
                                     <div class="col-lg-5">
                                    <label class="lbl" style="padding-left:10px">{!$ObjectType.Account.fields.TradeName__c.Label}</label>
                                    </div>
                                    <div class="col-lg-7">
                                    <apex:inputField styleclass="form-control editMode editModeTradeName latinonly" value="{!con.Account.TradeName__c}"/>
                                    <div class="hiddenerror" style="display: none;">
                        				<p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_EnterValidString} </p>
                      				</div>
                                   	<span class="saveMode saveModeTradeName" style="line-height: 24px;">
                                    	<apex:outputField value="{!con.Account.TradeName__c}"/>
                                        <apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeTradeName').hide();$('.editModeTradeName').show();$('.editModeBtn').show();" rendered="{!AND(bIsAdmin,isIATAAgencyAcct,bIsMinorChangeEnabled,!isTerminatedAgent, NOT(bBlockTradeNameChange))}"> [{!$Label.ISSP_edit_lowercase}]</apex:outputLink>
                                        </span>
                                	</div>
                                </div>
                                <div class="col-lg-7">
                                <apex:inputField styleclass="form-control editMode editModeTradeName latinonly" value="{!con.Account.TradeName__c}"/>
                                <div class="hiddenerror" style="display: none;">
                    				<p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_EnterValidString} </p>
                  				</div>
                               	<span class="saveMode saveModeTradeName" style="line-height: 24px;">
                                	<apex:outputField value="{!con.Account.TradeName__c}"/>
                                    <apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeTradeName').hide();$('.editModeTradeName').show();$('.editModeBtn').show();" rendered="{!canChangeTradeName}"> [{!$Label.ISSP_edit_lowercase}]</apex:outputLink>
                                    </span>
                            	</div>
                            </div>
                            </apex:outputText>
                            <!-- end row -->
                           
                                <apex:outputText rendered="{!isIATAAirlineAcct}">
                                    <div class="row">
                                        <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Airline_designator__c.Label}</label>
                                        <div class="col-lg-7">{!con.Account.Airline_designator__c}</div>
                                     </div>
                                     <!-- end row -->
                                    <div class="row">
                                        <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.ICAO_designator__c.Label}</label>
                                        <div class="col-lg-7">{!con.Account.ICAO_designator__c}</div>
                                     </div>
                                     <!-- end row -->
                                </apex:outputText>
                           
                            <div class="row">
                                <apex:outPutPanel layout="block" rendered="{!con.Account.Status__c != 'New application pending'}">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.IATACode__c.Label}</label>
                                    <div class="col-lg-7">
                                        <div>{!con.Account.IATACode__c} </div>
                                    </div>
                                </apex:outPutPanel>
                            </div>

                            <div class="row">
                                <apex:outPutPanel layout="block" rendered="{!isIATAAirlineAcct}">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Airline_Prefix__c.Label}</label>
                                    <div class="col-lg-7">
                                        <div>{!con.Account.Airline_Prefix__c} </div>
                                    </div>
                                </apex:outPutPanel>
                            </div>
                            
                            <div class="row">
                                <apex:outputPanel rendered="{!con.Account.Sector__c != null}" layout="block">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Sector__c.Label}</label>
                                    <div class="col-lg-7">
                                        {!con.Account.Sector__c}
                                    </div>
                                </apex:outputPanel>
                            </div>
                            <!-- end row -->
                            <div class="row">
                                <apex:outputPanel rendered="{!AND(!isCNSAccount, con.Account.Category__c!= null)}" layout="block">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Category__c.Label}</label>
                                    <div class="col-lg-7">
                                        {!con.Account.Category__c}
                                    </div>
                                </apex:outputPanel>
                            </div>
                            <!-- end row -->
                            
                            <apex:outputText rendered="{!isIATAAirlineAcct}">
                                <div class="row">
                                    <apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.Field_Head_Office__c.Label}" />
                                    <div class="col-lg-7"><apex:outPutField value="{!con.Account.Field_Head_Office__c}"/></div>
                                </div>    
                             </apex:outputText>
                                
                             <apex:outputText rendered="{!isIATAAgencyAcct}">
                                  <div class="row">
                                    <apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.Location_Type__c.Label}" />
                                    <div class="col-lg-7"><apex:outPutField value="{!con.Account.Location_Type__c}"/></div>
                                  </div>
                                 </apex:outputText>
                            
                                                      
                            <div class="row form-group">
                            <apex:outputPanel rendered="{!IF(showIEPStatus,true,false)}" >
                                <div class="col-lg-5" style="padding-left:28px">                                
                                    <label class="lbl">{!$ObjectType.Account.fields.ANG_IEP_Status_FF__c.Label}</label>
                                </div>
                                <div class="col-lg-7">                                                                        
                                    <span class="saveMode">                                        
                                        <apex:outputText value="{!con.Account.ANG_IEP_Status_FF__c}"/>
                                    </span>                                    
                                </div>
                                </apex:outputPanel>
                            </div>
                            
                            <apex:outputText rendered="{!isIATAAirlineAcct}">
                                <div class="row">
                                <apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.Membership_status__c.Label}" />
                                    <div class="col-lg-7">
                                        <apex:outPutField value="{!con.Account.Membership_status__c}"/>
                                    </div>
                             </div>
                        </apex:outputText>
                        
                        <apex:outputPanel layout="block" styleclass="form-group row" rendered="{!NOT(PermissionForStandardAccount)}">
                            <div class="lbl col-lg-5">
                                <label class="lbl" for="exampleInputEmail1"><apex:outputText escape="false" value="{!IF(isIATAAgencyAcct,'*', '&nbsp;')}" styleClass="required"/>{!$Label.ISSP_Registration_BusinessPhone}</label>
                           	</div>
                            
                            <div class="col-lg-7 phone">
                                    <apex:inputHidden id="businessphone" value="{!con.Account.Phone}" />
                                    <apex:inputField id="businessphoneinput" styleclass="form-control editMode editModePhone col-lg-8 rec" value="{!con.Account.PhoneNational__c}" onblur="setInternationalPhoneNo('phone');"/>
                                    <div class="hiddenerror" style="display: none;">
                    					<p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_BusinessPhone}</p>
                  					</div>   
                                    <span class="saveMode saveModePhone" style="line-height: 36px;">
                                        <apex:outputField value="{!con.Account.Phone}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModePhone').hide();$('.phone .selected-flag').show();$('.editModePhone').show();$('.editModeBtn').show()" rendered="{!AND(bIsAdmin,isIATAAgencyAcct,bIsMinorChangeEnabled,!isTerminatedAgent)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                         </apex:outputPanel>
                         
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="exampleInputEmail1">{!$ObjectType.Contact.fields.Fax.Label}</label>
                                </div>
                                <div class="col-md-7 fax">
                                    <apex:inputHidden id="businessfax" value="{!con.Account.Fax}" />
                                    <apex:inputField id="businessfaxinput" styleclass="form-control editMode editModeFax col-lg-8" value="{!con.Account.FAXNational__c}" onblur="setInternationalPhoneNo('fax');"/>
                                    <span class="saveMode saveModeFax">
                                        <apex:outputField value="{!con.Account.Fax}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeFax').hide();$('.fax .selected-flag').show();$('.editModeFax').show();$('.editModeBtn').show()" rendered="{!OR(AND(bIsAdmin,isIATAAgencyAcct,bIsMinorChangeEnabled,!isTerminatedAgent),PermissionForStandardAccount)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="businessemailinput">{!$Label.ISSP_Office_Email}</label>
                                </div>
                                <div class="col-md-7 email">
                                    <apex:inputHidden id="businessemail" value="{!con.Account.Email__c}" />
                                    <apex:inputField id="businessemailinput" styleclass="form-control editMode editModeEmail col-lg-8" value="{!con.Account.Email__c}"/>
                                    <span class="saveMode saveModeEmail">
                                        <apex:outputField value="{!con.Account.Email__c}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeEmail').hide();$('.editModeEmail').show();$('.editModeBtn').show()" rendered="{!OR(AND(bIsAdmin,isIATAAgencyAcct,bIsMinorChangeEnabled,!isTerminatedAgent),PermissionForStandardAccount)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="businessinputwebsite">Web site</label>
                                </div>
                                <div class="col-md-7 email">
                                    <apex:inputHidden id="businesswebsite" value="{!con.Account.WebSite}" />
                                    <apex:inputField id="businesswebsiteinput" styleclass="form-control editMode editModeWebSite col-lg-8" value="{!con.Account.WebSite}"/>
                                    <span class="saveMode saveModeWebSite">
                                        <apex:outputField value="{!con.Account.WebSite}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeWebSite').hide();$('.editModeWebSite').show();$('.editModeBtn').show()" rendered="{!OR(AND(bIsAdmin,isIATAAgencyAcct,bIsMinorChangeEnabled,!isTerminatedAgent),PermissionForStandardAccount)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            <!-- end row -->
                           
                            <div class="row">
                                <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.IATA_ISO_Country__c.Label}</label>
                                <div class="col-lg-7">
                                    <div>{!con.Account.IATA_ISO_Country__r.Name}</div>
                                </div>
                </div>
                            <!-- end row -->
                            <div class="row">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl">{!$label.ISSP_CompanyAddressInformation}</label>
                                </div>
                                <div class="col-md-7">
                                    <apex:inputHidden id="BillingStreet" value="{!con.Account.BillingStreet}" />
                                    <apex:inputField styleclass="BillingAddressinput editModeBillingAddress form-control editMode col-lg-8" value="{!con.Account.BillingStreet}" html-placeholder="{!$ObjectType.Account.fields.BillingStreet.label}" rendered="{!PermissionForStandardAccount}"/>
                                    <apex:inputHidden id="BillingCity" value="{!con.Account.BillingCity}" />
                                    <apex:inputField styleclass="BillingAddressinput editModeBillingAddress form-control editMode col-lg-8" value="{!con.Account.BillingCity}" html-placeholder="{!$ObjectType.Account.fields.BillingCity.label}" rendered="{!PermissionForStandardAccount}"/>
                                    <apex:inputHidden id="BillingPostalCode" value="{!con.Account.BillingPostalCode}" />
                                    <apex:inputField styleclass="BillingAddressinput editModeBillingAddress form-control editMode col-lg-8" value="{!con.Account.BillingPostalCode}" html-placeholder="{!$ObjectType.Account.fields.BillingPostalCode.label}" rendered="{!PermissionForStandardAccount}"/>
                                    <apex:inputHidden id="BillingState" value="{!con.Account.BillingState}" />
                                    <apex:inputField styleclass="BillingAddressinput editModeBillingAddress form-control editMode col-lg-8" value="{!con.Account.BillingState}" html-placeholder="{!$ObjectType.Account.fields.BillingState.label}" rendered="{!PermissionForStandardAccount}"/>
                                    <apex:inputHidden id="BillingCountry" value="{!con.Account.BillingCountry}" />
                                    <apex:inputField styleclass="BillingAddressinput editModeBillingAddress form-control editMode col-lg-8" value="{!con.Account.BillingCountry}" html-placeholder="{!$ObjectType.Account.fields.BillingCountry.label}" rendered="{!PermissionForStandardAccount}"/>
                                    <span class="saveMode saveModeBillingAddress">
                                        <apex:outputField value="{!con.Account.BillingStreet}"/>&nbsp;
                                        <span style="padding-left:10px"><apex:outputLink value="#form" styleClass="saveMode" onclick="$('.saveModeBillingAddress').hide();$('.editModeBillingAddress').show();$('.editModeBtn').show()" rendered="{!PermissionForStandardAccount}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span><br/>
                                        <apex:outputField value="{!con.Account.BillingCity}"/><br/>
                                        <apex:outputField value="{!con.Account.BillingPostalCode}"/><br/>
                                        <apex:outputField value="{!con.Account.BillingState}"/><br/>
                                        <apex:outputField value="{!con.Account.BillingCountry}"/><br/>
                                    </span>
                                </div>
                            </div>
                            <!-- end row --> 
                            
                            <!-- DTULLO 20160202. Add DDS Section -->
                            <apex:outputPanel rendered="{!AND(bIsAdmin, con.Account.DDS_Status__c=='Opt-Out')}">
	                            <div class="row">
	                            	<apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.DDS_Status__c.Label}" />
	                                <div class="col-lg-7">
	                                	<apex:outPutField value="{!con.Account.DDS_Status__c}"/>
	                                </div>
	                            </div>
	                            <div class="row">
	                            	<apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.DDS_Last_Update_Date__c.Label}" />
	                                <div class="col-lg-7">
	                                	<apex:outPutField value="{!con.Account.DDS_Last_Update_Date__c}"/>&nbsp;
	                                	<apex:outputLink value="/ISSP_ChangeDDS_OI">{!$Label.ISSP_Opt_In}</apex:outputLink>
	                                </div>
	                            </div>
	                        </apex:outputPanel>
                            <!-- end row --> 
                            
                            <apex:outputpanel rendered="{!isValidatedAirlineUser}">
                                <div class="row">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Contact.fields.Airline_Credit_Risk_Manager__c.Label}</label>
                                    <div class="col-lg-7">
                                        {!ValidatedAirlineUser_Str}
                                    </div>
                                </div>
                            </apex:outputpanel>
                             <div class="row">
           						<div class="col-md-12 col-md-offset-9"  style="clear: both; ">
               						<apex:commandButton styleclass="btn_iata btn-success btn_save editModeBtn" onClick="if(!validateCompanyProfile())return false;" action="{!saveAccount}" value="{!$Label.site.save}" id="loginButton" reRender="companyProfile"/>
                					<button type="button" class="btn_iata btn-danger btn_cancel editModeBtn" onClick="clearErrorMessages();$('.saveMode').show();$('.editMode').hide();$('.editModeBtn').hide();$('.alert').hide();$('.selected-flag').hide();" >{!$Label.site.cancel}</button>
            					</div>
         					</div>
                             
                        </div>
                        <!-- end panel -->
                         <script>
            $('.editMode').hide();
            $('.editModeBtn').hide();
         </script>
         <script src="{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/build/js/intlTelInput.js')}"></script>      
        <script>
        var natphone = $("input[name='{!$Component.companyProfile.businessphoneinput}']");
        var phone = $("input[name='{!$Component.companyProfile.businessphone}']");
     
        natphone.intlTelInput({
            defaultCountry: '{!accountCountryISOCode}',
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
                    
        natphone.intlTelInput("setNumber", phone.val());
                    
        var natmobile = $("input[name='{!$Component.companyProfile.businessmobileinput}']");
        var mobile = $("input[name='{!$Component.companyProfile.businessmobile}']");
        
        natmobile.intlTelInput({
            defaultCountry: '{!accountCountryISOCode}',
            nationalMode: true,
            preferredCountries: [""],
            numberType: "MOBILE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
                    
        natmobile.intlTelInput("setNumber", mobile.val());
                    
        var natfax = $("input[name='{!$Component.companyProfile.businessfaxinput}']");
        var fax = $("input[name='{!$Component.companyProfile.businessfax}']");
        
        natfax.intlTelInput({
            defaultCountry: '{!accountCountryISOCode}',
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
                    
    	natfax.intlTelInput("setNumber", fax.val());
        
        function setInternationalPhoneNo(p) {
            if(p=='phone') {
                phone.val(natphone.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobile.val(natmobile.intlTelInput("getNumber"));
            } else {
                fax.val(natfax.intlTelInput("getNumber"));
            }
        }
     
     	function setInternationalPhoneNoBR(p) {
            if(p=='phone') {
                phoneBR.val(natphoneBR.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobileBR.val(natmobileBR.intlTelInput("getNumber"));
            } else {
                faxBR.val(natfaxBR.intlTelInput("getNumber"));
            }
        }

           $('.saveMode').show();
            $('.editMode').hide();
            $('.editModeBtn').hide();
            $('.selected-flag').hide();
      </script>
                         </apex:form>
                    </div>
                    <!-- end col -->
                    <div class="col-md-6 col-sm-12">
                      <div class="panel-body form-horizontal" style="padding-top: 0px;" >
                          <apex:outputText rendered="{!showIrregularities}">
                           <div class="row">
                                    <label class="lbl col-lg-8">{!$Label.ISSP_Homepage_Irregularities}</label> 
                                <div class="col-lg-4">
                                    <span class="{!if(noirr=='0',"badge ","badge redbadge")}">{!blankvalue(noirr,"0")}</span>
                                    
                               </div>
                            </div>
                           
                          <div class="row">
                              <div style="display:{!if(noirr=='0' || noirr=='',"none","block")}" class="col-md-12">
                                       <i>{!$Label.ISSP_PageDescription_ISSP_CompanyInformation}</i> 
                                    </div>
                          </div>
                             
                          <hr />
                          </apex:outputText>
                           <apex:outputText rendered="{!AND(OpenDebts!='',!PermissionForStandardAccount)}">
                           <b><apex:outputText escape="false" value="{!$Label.ISSP_outstanding_invoices}"/> </b>
                          </apex:outputText>
                          
                          <hr />

                          <apex:outputText rendered="{!AND(FinSubmission!='',!PermissionForStandardAccount, NOT(flagCashOptedOutFinReview))}">   
                          <div class="row">
                                <apex:outputLabel styleClass="lbl col-xs-5" value="{!$ObjectType.Account.fields.Fin_statements_submission_deadline__c.Label}" />
                                <div class="col-md-7">
                                   {!FinSubmission}
                                </div>
                             </div>
                          </apex:outputText> 
                     <apex:outputPanel rendered="{!AND(ifapName!='', !PermissionForStandardAccount)}">
                        <div class="row">
                            <label class="lbl col-lg-4 ">{!$Label.ISSP_IFAP_Name}</label>
                            <div class="col-lg-8">{!ifapName}</div>
                        </div>
                     
                     <hr />
                     
                        <div class="row">
                            <label class="lbl col-lg-4">{!$Label.ISSP_IFAP_Email}</label>
                            <div class="col-lg-8">{!ifapEmail}</div>
                        </div>
                             
                        <div class="row">
                            
                            <div class="col-lg-8">
                                <apex:form >
                                    <apex:commandButton action="{!AssignIFAPContact}" styleclass="btn btn_iata_primary btn-block" value="{!$Label.ISSP_Assign_IFAP}" id="assignIFAP"/>
                                </apex:form>
                            </div>
                        </div>
                    
                </apex:outputPanel>
                        </div>

                        <!-- Account email domain validation  -->
                        <apex:outputPanel layout="block" styleclass="panel-body form-horizontal" style="padding-top: 0px;" rendered="{! AND (bIsAdmin, AccountDomainValidRT) }">
                          <apex:form >
                            <div style="padding-top:15px;" >
                                <div class="row">
                                    <div class="lbl col-lg-12" style="padding-bottom:5px;">{! $Label.ISSP_CompanyInformation_EMADOMVAL_Title }</div>
                                </div>
                                <apex:repeat value="{! validEmailDomains }" var="ved">
                                    <apex:outputText styleclass="col-lg-12" style="padding-left:18px;" value="- {! ved.Name }" />
                                </apex:repeat>
                                <div class="row">
                                    <div class="col-lg-8">
                                          <apex:commandButton styleClass="btn btn_iata_primary btn-block" style="margin-top:12px;" value="{! $Label.ISSP_CompanyInformation_EMADOMVAL_AddBtn }" action="{! goToEmaDomVal }" immediate="true" />
                                    </div>
                                </div>
                            </div>
                          </apex:form>
                        </apex:outputPanel>
                    </div>
                    <!-- end col -->
                </div>
                <!--- end row -->
                <!-- Admin information for Active users -->
                <apex:outputPanel rendered="{!AND(portalAdmins.size>0, theUserContact.User_Portal_Status__c != 'Pending Approval')}">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <h5 class="blueback">{!$Label.ISSP_Homepage_Portal_Delegates_Administrators}</h5>
                                <table class="table table-hover">
                                    <div style="margin-left: 100px;">
                                        <apex:repeat value="{!portalAdmins}" var="admin">
                                            <tr>
                                                <td>
                                                    <apex:outputText value="({0}) {1} {2} ">
                                                        <apex:param value="{!admin.TeamMemberRole}"/>
                                                        <apex:param value="{!admin.User.Contact.Salutation}"/>
                                                        <apex:param value="{!admin.User.Contact.Name}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!admin.User.Contact.Email}"/>
                                                </td>
                                                <td>
                                                    <apex:outputText value=" {0}">
                                                        <apex:param value="{!admin.User.Contact.Account.BillingCountry}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                            <!-- AEF -->
                                            <div style="display:none;">
                                                <apex:outputField value="{!admin.User.Contact.AccountId}" />
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </table>
                            </div>
                            <!-- end col -->
                        </div>
                    </div>
                </apex:outputPanel>
                <!-- Admin information for Pending Approval users -->
                <apex:outputPanel rendered="{!AND(portalAdmins.size>0, theUserContact.User_Portal_Status__c == 'Pending Approval')}">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <h5 class="blueback">{!$Label.ISSP_Homepage_Portal_Delegates_Administrators}</h5>
                                <table class="table table-hover">
                                    <div style="margin-left: 100px;">
                                        <apex:repeat value="{!portalAdmins}" var="admin">
                                            <tr>
                                                <td>
                                                    <apex:outputText value="({0}) {1} {2} ">
                                                        <apex:param value="{!admin.TeamMemberRole}"/>
                                                        <apex:param value="{!admin.User.Contact.Salutation}"/>
                                                        <apex:param value="{!admin.User.Contact.Name}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                </table>
                            </div>
                            <!-- end col -->
                        </div>
                    </div>
                </apex:outputPanel>
               
                <!-- end My Company panel  -->
            </div>
            <!-- end panel body -->
           
        </div>
      
        <!-- end  div class="panel panel-primary"-->
        
        <apex:form id="branchOffice" rendered="{!AND(isIATAAgencyAcct, bIsAdmin, PAXBranches.size > 1)}" >
            <apex:actionFunction name="getBranchOffice" action="{!getBranchOffice}" reRender="branchOffice">
        	   <apex:param value="" assignTo="{!selectedBranchAccount}" name="selectedBranchAccount"/>
            </apex:actionFunction>
        <div class="panel panel-primary">
            <div class="panel-heading head_panel_green">
                <h3 class="panel-title">{!$Label.ISSP_AMS_View_Branch_details}</h3>
            </div>
            <div class="panel-body">
               
                <div class="form-group">
                        <label for="approval focus" class="col-lg-3 control-label">{!$Label.ISSP_AMS_Branch_Offices}</label>
                        <div class="col-lg-9">
                            <apex:selectList styleClass="form-control" id="officetypelist" style="width:45%" value="{!selectedBranchAccount}" onchange="getBranchOffice(this.value);" size="1">
                                <apex:selectOptions value="{!PAXBranches}"/>
                            </apex:selectList>                           
                        </div>
                        <br/>
                        <hr/>

            	</div>
                
                <apex:outputPanel rendered="{!branchOffice != null}" style="padding-top:12px">
                  <div class="col-md-6">
                 <div class="row">
                                <a name="formBR"></a>
                                <label class="lbl col-lg-5" style="padding-left:28px" for="exampleInputEmail1">{!$ObjectType.Account.fields.Legal_name__c.Label}</label>
                                <div class="col-lg-7">
                                    {!branchOffice.Name}
                                </div>
                            </div>
                <div class="row form-group">
                                 <div class="col-lg-5">
                                <label class="lbl" style="padding-left:10px">{!$ObjectType.Account.fields.TradeName__c.Label}</label>
                                </div>
                                <div class="col-lg-7">
                                <apex:inputField styleclass="form-control editModeBR editModeTradeNameBR latinonlyBR" value="{!branchOffice.TradeName__c}"/>
                                <div class="hiddenerror" style="display: none;">
                                    <p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_EnterValidString} </p>
                                </div>
                                <span class="saveModeBR saveModeTradeNameBR" style="line-height: 24px;">
                                	<apex:outputField value="{!branchOffice.TradeName__c}"/>
                                    <apex:outputLink value="#formBR" styleClass="saveMode" onclick="$('.saveModeTradeNameBR').hide();$('.editModeTradeNameBR').show();$('.editModeBtnBR').show();" rendered="{!canChangeTradeNameBR}"> [{!$Label.ISSP_edit_lowercase}]</apex:outputLink>
                                    </span>
                            	</div>
                            </div>
                <div class="row">
                                <apex:outPutPanel layout="block" >
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Status__c.Label}</label>
                                    <div class="col-lg-7">
                                        <div>{!branchOffice.Status__c} </div>
                                    </div>
                                </apex:outPutPanel>
                </div>
                <div class="row">
                                <apex:outPutPanel layout="block" rendered="{!branchOffice.Status__c != 'New application pending'}">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.IATACode__c.Label}</label>
                                    <div class="col-lg-7">
                                        <div>{!branchOffice.IATACode__c} </div>
                                    </div>
                                </apex:outPutPanel>
              	</div>
                <div class="row">
                                <apex:outputPanel rendered="{!branchOffice.Sector__c != null}" layout="block">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Sector__c.Label}</label>
                                    <div class="col-lg-7">
                                        {!branchOffice.Sector__c}
                                    </div>
                                </apex:outputPanel>
                            </div>
                            <!-- end row -->
                            <div class="row">
                                <apex:outputPanel rendered="{!branchOffice.Category__c!= null}" layout="block">
                                    <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.Category__c.Label}</label>
                                    <div class="col-lg-7">
                                        {!branchOffice.Category__c}
                                    </div>
                                </apex:outputPanel>
                            </div>
                	<div class="row">
                                    <apex:outputLabel styleClass="lbl col-lg-5" style="padding-left:28px" value="{!$ObjectType.Account.fields.Location_Type__c.Label}" />
                                    <div class="col-lg-7"><apex:outPutField value="{!branchOffice.Location_Type__c}"/></div>
                	</div>
                    <div class="form-group row">
                            <div class="lbl col-lg-5">
                                <label class="lbl" for="exampleInputEmail1"><apex:outputText escape="false" value="{!IF(isIATAAgencyAcctBR,'*', '&nbsp;')}" styleClass="required"/>{!$Label.ISSP_Registration_BusinessPhone}</label>
                           	</div>
                            
                            <div class="col-lg-7 phoneBR">
                                    <apex:inputHidden id="businessphone" value="{!branchOffice.Phone}" />
                                    <apex:inputField id="businessphoneinput" styleclass="form-control editModeBR editModePhoneBR col-lg-8 recBR" value="{!branchOffice.PhoneNational__c}" onblur="setInternationalPhoneNoBR('phone');"/>
                                    <div class="hiddenerror" style="display: none;">
                    					<p class="errormsg" style="line-height: 26px;">{!$Label.ISSP_Registration_Error_BusinessPhone}</p>
                  					</div>   
                                    <span class="saveModeBR saveModePhoneBR" style="line-height: 36px;">
                                        <apex:outputField value="{!branchOffice.Phone}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#formBR" styleClass="saveMode" onclick="$('.saveModePhoneBR').hide();$('.phoneBR .selected-flag').show();$('.editModePhoneBR').show();$('.editModeBtnBR').show()" rendered="{!AND(bIsAdmin,bUserHO,isIATAAgencyAcctBR,bIsMinorChangeEnabledBR,!isTerminatedAgentBR)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                         </div>

                    
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="exampleInputEmail1">{!$ObjectType.Contact.fields.Fax.Label}</label>
                                </div>
                                <div class="col-md-7 faxBR">
                                    <apex:inputHidden id="businessfax" value="{!branchOffice.Fax}" />
                                    <apex:inputField id="businessfaxinput" styleclass="form-control editModeBR editModeFaxBR col-lg-8" value="{!branchOffice.FAXNational__c}" onblur="setInternationalPhoneNoBR('fax');"/>
                                    <span class="saveModeBR saveModeFaxBR">
                                        <apex:outputField value="{!branchOffice.Fax}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#formBR" styleClass="saveMode" onclick="$('.saveModeFaxBR').hide();$('.faxBR .selected-flag').show();$('.editModeFaxBR').show();$('.editModeBtnBR').show()" rendered="{!AND(bIsAdmin,bUserHO,isIATAAgencyAcctBR,bIsMinorChangeEnabledBR,!isTerminatedAgentBR)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="businessemailinput">{!$Label.ISSP_Office_Email}</label>
                                </div>
                                <div class="col-md-7 emailBR">
                                    <apex:inputHidden id="businessemail" value="{!branchOffice.Email__c}" />
                                    <apex:inputField id="businessemailinput" styleclass="form-control editModeBR editModeEmailBR col-lg-8" value="{!branchOffice.Email__c}"/>
                                    <span class="saveModeBR saveModeEmailBR">
                                        <apex:outputField value="{!branchOffice.Email__c}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#formBR" styleClass="saveMode" onclick="$('.saveModeEmailBR').hide();$('.editModeEmailBR').show();$('.editModeBtnBR').show()" rendered="{!AND(bIsAdmin,bUserHO,isIATAAgencyAcctBR,bIsMinorChangeEnabledBR,!isTerminatedAgentBR)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="row form-group">
                                <div class="col-md-5" style="padding-left:28px">
                                    <label class="lbl" for="businessinputwebsite">[{!$Label.Web_Site}]</label>
                                </div>
                                <div class="col-md-7 emailBR">
                                    <apex:inputHidden id="businesswebsite" value="{!branchOffice.WebSite}" />
                                    <apex:inputField id="businesswebsiteinput" styleclass="form-control editModeBR editModeWebSiteBR col-lg-8" value="{!branchOffice.WebSite}"/>
                                    <span class="saveModeBR saveModeWebSiteBR" id='businesswebsiteBR'>
                                        <apex:outputField value="{!branchOffice.WebSite}"/>
                                        <span style="padding-left:10px"><apex:outputLink value="#formBR" styleClass="saveMode" onclick="$('.saveModeWebSiteBR').hide();$('.editModeWebSiteBR').show();$('.editModeBtnBR').show()" rendered="{!AND(bIsAdmin,bUserHO,isIATAAgencyAcctBR,bIsMinorChangeEnabledBR,!isTerminatedAgentBR)}">[{!$Label.ISSP_edit_lowercase}]</apex:outputLink></span>
                                    </span>
                                </div>
                            </div>
                            <!-- end row -->
                           
                            <div class="row">
                                <label class="lbl col-lg-5" style="padding-left:28px">{!$ObjectType.Account.fields.IATA_ISO_Country__c.Label}</label>
                                <div class="col-lg-7">
                                    <div>{!branchOffice.IATA_ISO_Country__r.Name}</div>
                                </div>
                </div>
                            <!-- end row -->
                            <div class="row">
                                <label class="lbl col-lg-5" style="padding-left:28px">{!$label.ISSP_CompanyAddressInformation}</label>
                                <div class="col-lg-7">
                                    {!branchOffice.BillingStreet}<br/>
                                    {!branchOffice.BillingCity} 
                                    {!branchOffice.BillingPostalCode}<br/>
                                    {!branchOffice.BillingState}<br/>
                                    
                                     {!branchOffice.BillingCountry}<br/>
                                    
                                </div>
                            </div>
                            <!-- end row --> 
                            <!-- **********************************************************-->
                            
                        
                <script>
     	var natphoneBR = $("input[name='{!$Component.branchOffice.businessphoneinput}']");
        var phoneBR = $("input[name='{!$Component.branchOffice.businessphone}']");
     
     	natphoneBR.intlTelInput({
            defaultCountry: '{!accountCountryISOCodeBR}',
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
                    
     	natphoneBR.intlTelInput("setNumber", phoneBR.val());
                    
        // var natmobileBR = $("input[name='{!$Component.companyProfile.businessmobileinput}']");
        // var mobileBR = $("input[name='{!$Component.companyProfile.businessmobile}']");
        
        // natmobileBR.intlTelInput({
        //     defaultCountry: '{!accountCountryISOCodeBR}',
        //     nationalMode: true,
        //     preferredCountries: [""],
        //     numberType: "MOBILE",
        //   utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        // });
                    
        // natmobileBR.intlTelInput("setNumber", mobile.val());
                    
        var natfaxBR = $("input[name='{!$Component.branchOffice.businessfaxinput}']");
        var faxBR = $("input[name='{!$Component.branchOffice.businessfax}']");
        
        natfaxBR.intlTelInput({
            defaultCountry: '{!accountCountryISOCodeBR}',
            nationalMode: true,
            preferredCountries: [""],
            numberType: "FIXED_LINE",
          utilsScript: "{!URLFOR($Resource.InternationalPhoneNumberFormat, '/intl-tel-input-master/lib/libphonenumber/build/utils.js')}"
        });
                    
    	natfaxBR.intlTelInput("setNumber", faxBR.val());
        
        function setInternationalPhoneNo(p) {
            if(p=='phone') {
                phone.val(natphone.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobile.val(natmobile.intlTelInput("getNumber"));
            } else {
                fax.val(natfax.intlTelInput("getNumber"));
            }
        }
     
     	function setInternationalPhoneNoBR(p) {
            if(p=='phone') {
                phoneBR.val(natphoneBR.intlTelInput("getNumber"));
            } else if(p=='mobile') {
                mobileBR.val(natmobileBR.intlTelInput("getNumber"));
            } else {
                faxBR.val(natfaxBR.intlTelInput("getNumber"));
            }
        }
                    
            $('.saveModeBR').show();
            $('.editModeBR').hide();
            $('.editModeBtnBR').hide();
            $('.selected-flag').hide();
      </script>
               </div>
            <div class="ol-md-3 col-md-offset-10 "  style="clear: both; ">
               		<apex:commandButton styleclass="btn_iata btn-success btn_save editModeBtnBR" onClick="if(!validateCompanyProfileBR())return false;" action="{!saveAccountBR}" value="{!$Label.site.save}" id="loginButton" reRender="branchOffice"/>
                	<button type="button" class="btn_iata btn-danger btn_cancel editModeBtnBR" onClick="clearErrorMessagesBR();$('.saveModeBR').show();$('.editModeBR').hide();$('.editModeBtnBR').hide();$('.alert').hide();$('.phoneBR .selected-flag').hide();$('.faxBR .selected-flag').hide();" >{!$Label.site.cancel}</button>
            	</div>
                </apex:outputPanel>
            </div>
          </div>
            
        </apex:form>
        
        
          <c:ISSP_CustomFooter communityName="{!communityName}"/>
    </div>
    <script>
      function validateCompanyProfile(){
      	var flag = true;
        	$('#recFields').hide();
            $('.rec').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                            if(!$(this).val()){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                        }
                    )
            
            if(flag == false){
                $('#recFields').show();
            }else{
                flag = validateLatinCharsOnly();
            }
            return flag;
        }
     
     	function validateLatinCharsOnly(){
        var regExLatin = new RegExp("^[\\x00-\\x7F\\xA0-\\xFF]+$");
        var flag = true;
            $('.latinonly').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                
                            if($(this).val() != '' && !regExLatin.exec($(this).val())){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                        }
                    )
            return flag;
        }

        function validateCompanyProfileBR(){
            var flag = true;
            $('#recBRFields').hide();
            $('.recBR').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                            if(!$(this).val()){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                            
                        }
                    )
            if(flag == false){
                $('#recBRFields').show();
            }else{
                flag = validateLatinCharsOnlyBR();
            }
            return flag;
        }

        function validateLatinCharsOnlyBR(){
        var regExLatin = new RegExp("^[\\x00-\\x7F\\xA0-\\xFF]+$");
        var flag = true;
            $('.latinonlyBR').each(function (){
                            $(this).parents('.form-group').removeClass('has-error');
                
                            if($(this).val() != '' && !regExLatin.exec($(this).val())){
                                flag = false;
                                $(this).parents('.form-group').addClass('has-error');
                            }
                        }
                    )
            return flag;
        }
              
        function clearErrorMessages() {
        	$('.rec').each(function (){
                    $(this).parents('.form-group').removeClass('has-error');
                }
        	)
            $('.latinonly').each(function (){
                    $(this).parents('.form-group').removeClass('has-error');
                }
            )
        }

        function clearErrorMessagesBR() {
            $('.recBR').each(function (){
                    $(this).parents('.form-group').removeClass('has-error');
                }
            )
            $('.latinonlyBR').each(function (){
                    $(this).parents('.form-group').removeClass('has-error');
                }
            )
        }
                    
              </script>
     </body>
    </html>
</apex:page>