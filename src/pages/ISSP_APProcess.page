<apex:page controller="ISSP_APProcess"
           cache="false"
           sidebar="false"
           showHeader="false"
           standardStylesheets="true"
           applyBodyTag="false"
           applyHtmlTag="false"
           action="{!securityCheck}">
    
    <html> 
        <c:ISSP_Header ></c:ISSP_Header>
        <body>
            
            <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
            <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
            
            <style>
                .pbTitle {
                    {!IF(isstep2,'width: 90% !important','width: 40% !important')};
                }
            
            .bPageBlock {
                border-top : 0px;
            }
            
            ul li, ol li {
                margin-left: inherit;
                padding-left: inherit;
            }
            
            #contentWrapper {  background: #fff !important; margin: 0 auto;max-width: 1170px;}
            
            .requiredText {display:none;}
            
            .errorMsg {color:#d74c3b}
            
            .progress-bar-off {
                color:#6BBBEA;
                font-weight:bold;
                background-image:none !important;
                background-color:transparent !important;
                border-right:2px solid white;
            } 
            .row {
              display: flex;
            }
            .col {
              flex: 1;
            }
            .doc-link {
                color: #6BBBEA;
                font-weight: bold;
            }
            .req {
                border-left: 3px solid red;
                padding: 0px 10px 0px 10px;
            }
            .center {
              text-align: center;
            }
            </style>
                       <script>
                       $(document).ready(function() {
                           $(".cass-airlines-select").select2({width : "resolve"});
                       
                           $(".country-select").select2({width : "resolve"});
                       
                           $(".join-type-select").select2({width : "15%"});
                       });
                       
                       $(function () {
                           $('[data-toggle="tooltip"]').tooltip()
                       })
                       function updateGuideCounter() {
                           ISSP_APProcess.updateGuideCounter("{!newCase.Id}",function(result, event) {});
                       }
                       </script>
            
            <div class="container">
                <div id="contentWrapper">
                    <c:ISSP_CustomNavigation />
                    
                    <!----------------------------------------->
                    <!-- STEP 1 -->
                    <!----------------------------------------->
                    <!--Online form to create an airline joining process-->
                    <apex:outputPanel rendered="{!isStep1}">
                        <div class="panel-primary">
                            <div class="panel-heading head_panel_green">
                                <h3 class="panel-title">{!IF(strAreaType=='Airline Joining', 'Airline Participation Joining Application', IF(strChangeType=='Minor database changes', 'Airline Participation Change Request', 'Change of Bank Account details'))}</h3>
                            </div>
                            <div class="panel-body" id="body-enquiries">
                                
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                        A. Participation Country &amp; Type
                                    </div>
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="0" style="width: 25%;">
                                        B. Review Country Requirements
                                    </div>
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                        C. BSP / CASS {!IF(strAreaType=='Airline Joining', 'Joining Form', IF(strChangeType=='Minor database changes','Change Request','Bank details change'))}
                                    </div>
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                        D. Submit to IATA
                                    </div>
                                </div>

                                <apex:outputPanel layout="block" styleclass="alert alert-info" html-role="alert" rendered="{!DocumentGuide!=null}">
                                    Any doubts? Please check out our&nbsp;
                                    <apex:outputLink value="{!URLFOR($Action.Document.Download, DocumentGuide.Id)}" style="color:#31708f; text-decoration: underline;" target="_blank" onclick="updateGuideCounter();">guide</apex:outputLink>
                                </apex:outputPanel>

                                <apex:form styleClass="form-horizontal">
                                    <apex:actionFunction action="{!null}" name="refreshCountryList" reRender="countryList" oncomplete="$('.country-select').select2({width : 'resolve'});">
                                        <apex:param value="" assignTo="{!strOT}" name="strOT"/>
                                    </apex:actionFunction>
                                    <apex:actionFunction action="{!null}" name="refreshCASSAirlineList" reRender="cassAirlineList" oncomplete="$('.cass-airlines-select').select2({width : 'resolve'});">
                                        <apex:param value="" assignTo="{!gssaCountryISOCode}" name="gssaCountryISOCode"/>
                                    </apex:actionFunction>
                                    <apex:pageBlock mode="edit">
                                        <apex:pageBlockButtons location="bottom" style="padding-left:100px">
                                            <apex:commandButton styleclass="btn btn-default" style="margin-right:8px" action="{!cancel}" value="{!$Label.ISSP_Cancel}" immediate="true"/>&nbsp;
                                            <apex:commandButton styleclass="btn btn-default" action="{!save}" value="Continue"/>
                                        </apex:pageBlockButtons>
                                        <apex:pageMessages ></apex:pageMessages>
                                        <div class="alert alert-info" role="alert">You can save your {!CASE(APProcess, 'chg', 'change request', 'bnk', 'change of bank account', 'joining form')} at anytime and come back later to complete it.</div>
                                        <div class="alert alert-warning" role="alert">{!IF(strAreaType=='Airline Joining', 'Online Joining Applications', IF(strChangeType=='Minor database changes','Online Change Requests','Online changes of bank details'))} must be submitted within 2 weeks, otherwise you will need to restart the process for each participation type and country.
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="jointype" class="col-sm-2 control-label">* Type of Participation</label>
                                            <div class="col-sm-10">
                                                <apex:selectList id="jointype" Label="Type of Participation" styleClass="join-type-select" value="{!strOperationType}" onchange="refreshCountryList(this.value);" required="true" size="1">
                                                    <apex:selectOptions value="{!APTypes}"/>
                                                </apex:selectList>
                                            </div>
                                        </div>
                                        
                                        <apex:outputPanel id="countryList">
                                            <div class="form-group">
                                                <label for="countryconcerned" class="col-sm-2 control-label">* BSP / CASS Country</label>
                                                <div class="col-sm-10">
                                                    <apex:selectList id="countryconcerned" Label="BSP / CASS Country" styleClass="country-select" style="width:200px" value="{!newCase.IFAP_Country_ISO__c}" onchange="refreshCASSAirlineList(this.value);" required="true" size="1">
                                                        <apex:selectOptions value="{!items}"/>
                                                    </apex:selectList>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                        
                                        <apex:outputPanel id="cassAirlineList" rendered="{!isGSSAUser}">
                                            <div class="form-group">
                                                <label for="airlineconcerned" class="col-sm-2 control-label">* Airline Concerned</label>
                                                <div class="col-sm-10">
                                                    <apex:selectList styleClass="cass-airlines-select"  Label="Airline Concerned" id="airlineconcerned" value="{!cassairlineid}" required="true" size="1">
                                                        <apex:selectOptions value="{!CassAirlines}"/>
                                                    </apex:selectList>&nbsp;
                                                    <apex:image value="/img/msg_icons/info16.png" title="Start typing Airline name, 2-letter designator code or IATA Code in the box to quickly locate the airline." html-data-placement="right" html-data-toggle="tooltip"/>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                        
                                        <div class="form-group">
                                            <label for="description" class="col-sm-2 control-label">* Description</label>
                                            <div class="col-sm-10">
                                                <apex:inputField id="description" styleClass="form-control" value="{!newCase.Description}" required="true"/>
                                            </div>
                                        </div>    
                                    </apex:pageBlock>
                                </apex:form>
                            </div>
                        </div>
                    </apex:outputPanel>
                    <!----------------------------------------->
                    <!--STEP 1 Check the created case details-->
                   <!------------------------
                    <apex:pageBlock rendered="{!AND(isStep1, NOT(isNewCase))}" title="Airline Joining information">
                        <apex:form styleClass="form-inline">
                            
                            <div class="row">
                                <div class="col-md-1">
                                    <label>Case number</label>
                                </div>
                                <div class="col-md-3"><apex:outPutText value="{!newCase.CaseNumber}"/></div>
                                <div class="col-md-1">
                                    <label>Case area</label>
                                </div>
                                <div class="col-md-7"><apex:outputText value="{!newCase.CaseArea__c}"/></div>
                            </div>
                            <div class="row">
                                <div class="col-md-1">
                                    <label>Status</label>
                                </div>
                                <div class="col-md-3"><apex:outputText value="{!newCase.Status}"/></div>
                                <div class="col-md-1">
                                    <label>Case reason</label>
                                </div>
                                <div class="col-md-7"><apex:outPutText value="{!newCase.Reason1__c}"/></div>
                            </div>
                            <div class="row">
                                <div class="col-md-1">
                                    <label>Joining Country</label>
                                </div>
                                <div class="col-md-3"><apex:outputText value="{!newCase.Country_concerned_by_the_query__c}"/></div>
                            </div>
                            <div style="padding:20px;"/> 
                            <center>
                                <apex:commandButton styleclass="btn btn-default" action="{!goToStep2}" value="Next" id="Next"/>
                            </center>
                        </apex:form>
                    </apex:pageBlock>
        ----------------->
      
                    <!------------------------------------------->
                    <!--STEP 2 Display the country requirements-->
                    <!----------------------------------------- -->
                    <apex:outputText rendered="{!isStep2&&countryRequirementFound}">
                        <div class="panel-primary">
                            <div class="panel-heading head_panel_green">
                                <h3 class="panel-title">{!IF(strAreaType=='Airline Joining', 'Airline Participation Joining Application', IF(strChangeType=='Minor database changes', 'Airline Participation Change Request', 'Change of Bank Account details'))}</h3>
                            </div>
                            <div class="panel-body" id="body-enquiries">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                        A. Participation Country &amp; Type
                                    </div>
                                    <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="0" style="width: 25%;">
                                        B. Review Country Requirements:{!strLoB}-{!apCountry}
                                    </div>
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                       C. BSP / CASS {!IF(strAreaType=='Airline Joining', 'Joining Form', IF(strChangeType=='Minor database changes','Change Request','Bank details change'))}
                                    </div>
                                    <div class="progress-bar progress-bar-off" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                                        D. Submit to IATA
                                    </div>
                                </div>
                                
                                <apex:form >
                                    <!-- for CASS show an Accept conditions box -->
                                    <apex:outputPanel layout="block" style="padding: 40px;" rendered="{!isCASS}">
                                        <div class="alert alert-info" role="alert">Please note that as part of the joining process, a test file for CASSlink billing have to be submitted. The requirements dor this file are described in the CASSlink specifications handbook, and we have also prepared a guide with the most frequent issues encuntered during the testing process. Please make sure you read the documents below and made the necessary preparation.</div>
                                        <div class="row">
                                            <apex:outputPanel layout="block" styleclass="col center" rendered="{!DocumentCASSSpecification!=null}">
                                                Download the&nbsp;<apex:outputLink value="{!URLFOR($Action.Document.Download, DocumentCASSSpecification.Id)}" styleclass="doc-link" target="_blank" onclick="updateGuideCounter();">{!DocumentCASSSpecification.Name}</apex:outputLink>&nbsp;(pdf)
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="block" styleclass="col center" rendered="{!DocumentAppendixA!=null}">
                                                Download the&nbsp;<apex:outputLink value="{!URLFOR($Action.Document.Download, DocumentAppendixA.Id)}" styleclass="doc-link" target="_blank" onclick="updateGuideCounter();">{!DocumentAppendixA.Name}</apex:outputLink>&nbsp;(pdf)
                                            </apex:outputPanel>
                                        </div>
                                        <div class="center" style="margin-top: 20px;">
                                            <apex:outputLabel styleclass="req" value="I understand these requirements"/>
                                            <apex:inputField value="{!newForm.Accept_Requirements__c}" rendered="{!!newForm.Accept_Requirements__c}"/>
                                            <apex:outputField value="{!newForm.Accept_Requirements__c}" rendered="{!newForm.Accept_Requirements__c}"/>
                                        </div>
                                    </apex:outputPanel>
                                
                                    <c:ISSP_AP_Country_Reqs_Modal />
                                
                                    <center>
                                        <apex:pageBlock mode="edit">
                                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep1}" value="Previous" id="Previous"/>&nbsp;
                                            <apex:commandButton styleclass="btn btn-default" action="{!goToStep3}" value="Next" id="Next"/>
                                        </apex:pageBlock>
                                    </center>
                                </apex:form>
                                
                            </div>   
                        </div>
                    </apex:outputText>
                    
                    <apex:pageBlock rendered="{!isStep2&&!countryRequirementFound}" title="Country requirements for {!apCountry} - {!strLOB}">
                        <div class="apcontainer">
                            <apex:outPutText >
                                <div class="aplabel">
                                    <br/><br/><br/>The {!strLOB} operation you have selected is not available in {!apCountry}. Please go back and choose another Operation or Country.<br/><br/><br/> 
                                </div>
                            </apex:outPutText>
                            <apex:form >
                                <center>
                                    <apex:pageBlock >
                                        <apex:commandButton styleclass="apbutton" action="{!goToStep1}" value="Previous" id="Previous"/>
                                        <apex:commandButton styleclass="apbutton" action="{!goToStep3}" disabled="True" value="Next" id="Next"/>
                                    </apex:pageBlock>
                                </center>
                            </apex:form>
                        </div>
                    </apex:pageBlock>
                    
                    <!----------------------------------->
                    <!--STEP 3 Display BSP or CASS FORM-->
                    <!----------------------------------->
                    
                    <apex:include pageName="ISSP_AP_BSP_Form" rendered="{!AND(strAreaType=='Airline Joining', isBSP, isStep3)}"/>     
                    <apex:include pageName="ISSP_AP_CASS_Form" rendered="{!AND(strAreaType=='Airline Joining', isCASS, isStep3)}"/>
                    <apex:include pageName="ISSP_AP_Changes" rendered="{!AND(strAreaType=='Airline Change', isStep3)}"/>
                    
                    <!--------------------->
                    <!--STEP 4 Validation-->
                    <!---------------------> 
                    
                    <apex:include pageName="ISSP_AP_Submit" rendered="{!isStep4}"/>
                    
                    
                    <!----------------------------------------->
                    <!--STEP 5 Check the created case details-->
                    <!----------------------------------------->
                    <apex:pageBlock rendered="{!isFinalStep}" mode="maindetail">
                        <div style="color:#000000; font-size:14px; padding-bottom:10px; padding-top:10px;margin-left:200px">
                            <h3>Thank you for submitting your Airline Participation {!IF(strAreaType=='Airline Joining', 'Joining application', 'Change request')}.</h3>
                            <br/><br/>
                            <div class="col-md-12 row">Your case number is <a href="/ISSP_Case?caseId={!newCase.Id}" target="_blank">{!newCase.CaseNumber}</a>.</div>
                            <br/><br/>
                            <apex:outputPanel rendered="{!(strAreaType=='Airline Joining')}">
                                <img src="{!URLFOR($Resource.PDF_icon_large)}" style="vertical-align:middle"/>
                                You can also <a href="/ISSP_PDF_Form{!IF(isCASS,'_CASS','')}?caseId={!newCase.Id}&step=3" target="_new">download a PDF version</a> of the application you just submitted.
                            </apex:outputPanel>
                            <br/><br/>
                            
                            <br/>
                            Please <a href="/ISSP_Case?caseId={!newCase.Id}" target="_blank">access your case</a> directly if you wish to attach additional files to your application.
                            <br/><br/>
                            In addition you can follow all your cases with IATA in the <a href="/ISSP_CaseList" target="_blank">"My Cases"</a> area.
                            <br/><br/><br/><br/>
                            
                            <a href="/ISSP_APCases?proc={!IF(strAreaType=='Airline Joining', '', IF(strChangeType=='Minor database changes','chg','bnk'))}&retURL=/ISSP_Homepage">
                                <apex:image value="https://iata--c.eu3.content.force.com/servlet/servlet.ImageServer?id=015w0000002SzVg&oid=00D2000000008TF&lastMod=1425387305000" width="60" height="60" style="vertical-align: middle;" rendered="{!strAreaType=='Airline Joining'}"/>
                                <apex:image value="https://iata--c.eu3.content.force.com/servlet/servlet.ImageServer?id=015w000000361Bb&oid=00D2000000008TF&lastMod=1425387305000" width="60" height="60" style="vertical-align: middle;" rendered="{!strChangeType=='Bank Account Instructions'}"/>
                                <apex:image value="https://iata--c.eu3.content.force.com/servlet/servlet.ImageServer?id=015w000000361Dr&oid=00D2000000008TF&lastMod=1425387305000" width="60" height="60" style="vertical-align: middle;" rendered="{!strChangeType=='Minor database changes'}"/>
                            </a>&nbsp;<b>Create new BSP / CASS {!IF(strAreaType=='Airline Joining', 'Joining application', IF(strChangeType=='Minor database changes', 'Change request', 'Bank Account details change'))}.</b>
                            
                        </div>
                    </apex:pageBlock>
                </div>
                <c:ISSP_CustomFooter />
            </div>
            
        </body>  
    </html>
    
</apex:page>