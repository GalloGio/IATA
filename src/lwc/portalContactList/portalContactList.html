<!--
 - Created by pvavruska on 6/4/2019.
 -->

<!-- Portal Contact List -->
<template>
    <div class="slds-p-vertical_large customBorderlessCardWhite">

        <!-- OPEN MODAL -->
        <template if:true={openmodel}>
            <c-portal-profile-custom-box open-model={openmodel} record-id={recordid} object-id={objectid}
                object-name={objectName} fields-list={fieldsListToCreate} onclosemodal={closeModal}
                onclosemodalwithsuccess={closemodalWithSuccess}></c-portal-profile-custom-box>
        </template>
        <!-- END MODAL -->

        <!-- CONTACT LIST -->
        <template if:true={hasRecords}>
            <table class="slds-m-vertical_medium profileTable slds-table">
                <!-- HEADER -->
                <thead>
                    <tr>
                        <th class="tableLefty"></th>
                        <th class="underLinded">
                            <!-- arrow spacer -->
                        </th>
                        <template for:each={fieldsList.ROWS} for:item="field" for:index="index">
                            <th class={field.className} key={field.label} onclick={columnSort}
                                data-name={field.fieldName}>
                                {field.label}
                                <lightning-icon class="slds-is-absolute" if:true={field.isAsc}
                                    icon-name="utility:arrowup" size="xx-small"></lightning-icon>
                                <lightning-icon class="slds-is-absolute" if:true={field.isDesc}
                                    icon-name="utility:arrowdown" size="xx-small"></lightning-icon>
                            </th>
                        </template>
                        <th class="tableLefty"></th>
                    </tr>
                </thead>


                <template for:each={records} for:item="record" for:index="index">
                    <tbody key={record.Id}>
                        <tr>
                            <td class="tableLefty"></td>
                            <td class="underLinded chevronColumn">
                                <div class="cursorPointer inline-block" onclick={openRecordDetail} data-item={index}>
                                    <lightning-icon class="darkBlueIcon" if:true={record.open}
                                        icon-name="utility:chevrondown" size="xx-small" data-item={index}>
                                    </lightning-icon>
                                    <lightning-icon class="darkBlueIcon" if:false={record.open}
                                        icon-name="utility:chevronright" size="xx-small" data-item={index}>
                                    </lightning-icon>
                                </div>
                            </td>

                            <template for:each={record.rowValues} for:item="rowValue">
                                <td key={rowValue.value} class={rowValue.className}>
                                    <span>{rowValue.value}</span>
                                </td>
                            </template>

                            <td class="tableLefty"></td>
                        </tr>

                        <tr if:true={record.open} class="slds-p-vertical_x-large text-xsmall openTransition" data-item={index}>
                            <td class="noPadding" colspan={fieldCount}>
                                <div class="recordDetail">
                                    <div class="recordDetailBox">
                                        <!-- iterate over sections here -->

                                        <template if:true={isAccount}>
                                            <c-portal-record-form-wrapper section-title="Basics"
                                                object-name={objectName} record-id={record.Id}
                                                edit-fields={fieldsList.Basics} fields={fieldsList.Basics}
                                                show-edit="false"
                                                section-class="slds-p-vertical_xx-large slds-p-horizontal_x-large slds-m-bottom_medium section">
                                            </c-portal-record-form-wrapper>

                                            <hr class="hr">

                                            <c-portal-record-form-wrapper section-title="Branch Contact"
                                                object-name={objectName} record-id={record.Id}
                                                edit-fields={fieldsList.BranchContact} fields={fieldsList.BranchContact}
                                                show-edit="true"
                                                section-class="slds-p-vertical_xx-large slds-p-horizontal_x-large slds-m-bottom_medium section">
                                            </c-portal-record-form-wrapper>
                                        </template>

                                        <template if:false={isAccount}>
                                            <c-portal-record-form-wrapper object-name={objectName} record-id={record.Id}
                                                edit-fields={fieldsList.EDITS} static-fields={record}
                                                fields={fieldsList.VIEW} show-edit="true"
                                                header-class="slds-float_right" showarea="true"
                                                section-class="slds-p-vertical_xx-large slds-p-horizontal_x-large slds-m-bottom_medium section">
                                            </c-portal-record-form-wrapper>
                                        </template>

                                    </div>
                                </div>

                            </td>

                        </tr>
                    </tbody>
                </template>


            </table>
        </template>


        <!-- NO RECORDS -->
        <template if:false={hasRecords}>
            <div class="text-medium text-bold slds-p-top_xx-large text-darkGray centered">
                {labels.CSP_NoSearchResults}
            </div>
        </template>



    </div>
</template>