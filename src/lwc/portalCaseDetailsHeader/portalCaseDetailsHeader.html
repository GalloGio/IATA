<template>
    <div class="customCard">
        <template if:true={loading}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </template>
        <template if:false={loading}>
            <div if:true={pendingCustomerCase} class="WarningRectangle">
                <span class="slds-icon_container slds-p-left_medium" title="info">
                    <lightning-icon icon-name="utility:info_alt" size="small">
                    </lightning-icon>
                </span>
                <span class="text-uppercase slds-p-left_medium text-bold text-xxxsmall text-gray">{pendingCustomerCaseWarningLabel}</span>
            </div>
            <div class="slds-grid slds-wrap customCardTitleBox">
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-12 slds-large-size_2-of-12 slds-p-around_medium" >
                    <span style="color: #9a9eb0;">Case Number</span><br/>
                    <span style="font-size: 1.3rem;font-weight: 400;">{caseDetails.CaseNumber}</span>
                </div>
                <div class="slds-col slds-size_1-of-1 slds-medium-size_8-of-12 slds-large-size_8-of-12 slds-p-around_medium" style="border-right: 1px solid #9a9eb0;border-left: 1px solid #9a9eb0;" >
                    <span style="color: #9a9eb0;">Subject</span><br/>
                    <span style="font-size: 1.3rem;font-weight: 400;">{caseDetails.Subject}</span>
                </div>
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-12 slds-large-size_2-of-12 slds-p-around_medium" >
                    <span style="color: #9a9eb0;">Status</span><br/>
                    <span style="font-size: 1.3rem;font-weight: 400;">{caseDetails.Portal_Case_Status__c}</span>
                </div>
            </div>
            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-size_1-of-1 slds-medium-size_5-of-12 slds-large-size_5-of-12 slds-p-around_medium" >
                    <div>
                        <span style="color: #9a9eb0;">Created on &nbsp;</span>
                        <span>
                            <lightning-formatted-date-time value={caseDetails.CreatedDate} year="numeric" month="numeric" day="numeric" hour="2-digit"
                            minute="2-digit"  hour12="true"></lightning-formatted-date-time>
                            &nbsp; by {caseDetails.CreatedBy.Name}
                        </span>
                    </div>
                    <div>
                        <span style="color: #9a9eb0;">Last Update &nbsp;</span>
                        <span>
                            <lightning-formatted-date-time value={caseDetails.LastModifiedDate} year="numeric" month="numeric" day="numeric" hour="2-digit"
                            minute="2-digit"  hour12="true"></lightning-formatted-date-time>
                        </span>
                    </div>
                    
                </div>
                <div class="slds-col slds-size_1-of-1 slds-medium-size_7-of-12 slds-large-size_7-of-12 slds-p-around_medium" >
                    <div if:true={haveRecipients} style="align-items: center;">
                        <span style="color: #9a9eb0;">Recipients &nbsp;</span>
                        <div style="white-space: nowrap;
                        max-width:50%;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        display:inline-block;">
                            {caseDetails.E2CP__AdditionalCC__c}
                        </div>
                        <lightning-button variant="base" label="Manage Recipients" onclick={openManageRecipientsPopup} ></lightning-button>
                    </div>
                    <div if:false={haveRecipients}>
                        Anyone else to be informed?
                        <lightning-button variant="base" label="Manage Recipients" onclick={openManageRecipientsPopup} ></lightning-button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Manage Recipients Popup -->
    <template if:true={showManageRecipientsPopup}>
        <div class="modal">

            <div class="customPopupInteriorHalfScreenCentered">
                <!-- Popup Header -->
                <div class="slds-p-around_medium" style="font-size: 20px;font-weight: 500;font-style: normal;font-stretch: normal;line-height: 1.6;letter-spacing: normal;color: #333333;">
                    Manage Recipients
                </div>

                <!-- Popup Body -->
                <div class="slds-p-around_medium customWhiteBackground">
                    <div class="slds-p-vertical_large" style="font-size: 16px;
                    font-weight: normal;
                    font-style: normal;
                    font-stretch: normal;
                    line-height: 1.63;
                    letter-spacing: normal;
                    color: #525252;">
                        You can manage the people that you want to be informed about this case. 
                        Add new recipients or remove existing ones.
                    </div>

                    <div class="slds-p-around_small" style="font-size: 14px; font-weight: normal; font-style: normal; font-stretch: normal; line-height: 1.43; letter-spacing: normal; color: #525252;">
                        E-mail Adress
                    </div>
                    <div class="aroundLightGrayBorder slds-p-around_small" >
                        <lightning-input
                            name="newRecipientTextInput"
                            class="hideInputLabel borderlessInput newRecipientTextInput" 
                            onchange={handleInputChange}
                            value={newRecipient}
                            style="display: inline-block;width: 80%;" 
                            type="email" >
                        </lightning-input >
                        <lightning-button label="Add" variant="neutral" onclick={addNewRecipientButtonClick} style="display: inline-block;float: right;"></lightning-button>
                    </div>
                    <div class="slds-m-top_large" style="min-height:150px;" >

                        <template for:each={lstRecipients} for:item="recipient">
                            <span key={recipient.id} class="slds-p-around_x-small slds-m-around_xx-small" style="display:inline-block;border-radius: 1px;background-color: #f7f8fc;font-size: 14px; font-weight: normal; font-style: normal; font-stretch: normal; line-height: 1.71; letter-spacing: normal;color: #4a4d61;">
                                {recipient.email}
                                <lightning-icon class="cursorPointer" key={recipient.id} icon-name="utility:close" size="x-small" onclick={removeRecipient} data-item={recipient.id}></lightning-icon>
                            </span>
                        </template>

                    </div>


                </div>

                <!-- Popup Footer -->
                <div class="slds-p-around_medium topLightGrayBorder customWhiteBackground">
                    <lightning-button class="containedButton" label="Ok" variant="neutral" onclick={closeManageRecipientsPopup}></lightning-button>
                </div>

            </div>
              
        </div>

    </template>
    
</template>