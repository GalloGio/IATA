<aura:component controller="AMP_KeyAccountPlanExtension">
    <aura:attribute name="accountId" type="Id"/>
    <aura:attribute name="accountPlanId" type="Id"/>
    <aura:attribute name="data" type="Object"/>
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="activityName" type="String"/>
    <aura:attribute name="canEdit" type="Boolean"/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="refreshTab" event="c:AWW_RefreshTabEvent" action="{!c.refreshTab}"/>  

    <aura:registerEvent name="closeMilestones" type="c:AWW_CloseMilestones"/>

    <aura:method name="showMilestones" action="{!c.showMilestones}">
        <aura:attribute name="accountPlanId" type="Id"/>
        <aura:attribute name="activityName" type="String"/>
    </aura:method>

    <div class="slds-p-around_medium">
        <div class="slds-box slds-p-around_none slds-theme_shade">
            <lightning:card class="bckColor" title="{!'Milestones for activity: ' + v.activityName}" iconName="standard:task">
                <aura:set attribute="actions">
                    <div class="slds-grid slds-gutters slds-grid_vertical-align-end">
                        <div class="slds-col">
                            <lightning:button variant="Neutral" iconName="utility:left" label="Back to Activities" title="Back to Activities" onclick="{!c.back}"/>
                        </div>
                        <div class="{!'slds-col ' + if(v.canEdit,'','slds-hide')}">
                            <lightning:button variant="Neutral" label="New" title="New" onclick="{!c.new}"/> 
                        </div>
                    </div>
                </aura:set>
                <div class="slds-m-around_medium slds-table_bordered slds-border_left slds-border_right">
                    <lightning:datatable
                        keyField="Id"
                        data="{!v.data}"
                        columns="{!v.columns}"
                        resizeColumnDisabled="true"
                        onrowaction="{!c.handleRowAction}"
                        hideCheckboxColumn="true"/>                    
                </div>
            </lightning:card>
        </div>
    </div>

    <c:AWW_AccountPlanMilestonesEdit aura:id="manage-record"/> 
    <c:AWW_AccountPlanMilestoneDelete aura:id="delete-record"/> 
</aura:component>