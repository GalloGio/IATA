/*
Copyright (c) 2008 salesforce.com, inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:

1. Redistributions of source code must retain the above copyright
	 notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
	 notice, this list of conditions and the following disclaimer in the
	 documentation and/or other materials provided with the distribution.
3. The name of the author may not be used to endorse or promote products
	 derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/



/* reference for this class is best found on Amazon developer site
 *
 *  http://docs.amazonwebservices.com/AmazonS3/latest/

 * example of connector class to send and retrieve data from Amazon S3 using SOAP
 * after install, you must add https://s3.amazonaws.com to your remote site access list
 * and set key and secret values into the Apex Class AWSKeys
 */


 /*
		 Additioal information: This code was generated by the WSDL2Apex functionality within the force.com platform.
		 	The code that is commented out has not yet been implemented in this version of the Force.com Toolkit for Amazon Web Services.
	 		The code was purposely left in this Apex Class for developers to enable, if needed for their solution.
 */

public class S3 {
	public class CopyObjectResult {
		public DateTime LastModified;
		public String ETag;
		private String[] LastModified_type_info = new String[]{'LastModified','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
		private String[] ETag_type_info = new String[]{'ETag','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'LastModified','ETag'};
	}

	public class MetadataEntry {
		public String Name {get; set;}
		public String Value;
		private String[] Name_type_info = new String[]{'Name','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] Value_type_info = new String[]{'Value','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'Name','Value'};
	}

	/*
	 	This inner class, AmazonS3, contains the methods that invoke the Web Service calls to Amazon Web Services.
	*/
	public class AmazonS3 {
		public AmazonS3(String key, String secret){
			this.key = key;
			this.secret= secret;
		}

		public AmazonS3(){ }

		/*
			Per the AWS S3 documentation:
			The RFC 2104 HMAC-SHA1 digest (go to http://www.ietf.org/rfc/rfc2104.txt) of the
			concatenation of "AmazonS3" + OPERATION + Timestamp, using your AWS Secret Access Key as the key.
		*/
		public string signature( string op, Datetime now) {
			//format should be  2006-01-01T12:00:00.000Z
			system.assert( this.secret != null ,' missing S3.secret key');
			String formattednow = now.formatGmt('yyyy-MM-dd')+'T'+now.formatGmt('HH:mm:ss')+'.'+now.formatGMT('SSS')+'Z';
			String canonical = 'AmazonS3'+op+formattednow; //"AmazonS3" + OPERATION + Timestamp
			Blob bsig = Crypto.generateMac('HmacSHA1', Blob.valueOf(canonical), Blob.valueOf(this.secret));
			return EncodingUtil.base64Encode(bsig);
		}


		public string secret { get; set; }
		public string key { get; set; }
		public String endpoint_x = 'https://s3-eu-west-1.amazonaws.com/soap'; //'https://s3.amazonaws.com/soap';
		public Map<String,String> inputHttpHeaders_x;
		public Map<String,String> outputHttpHeaders_x;
		public String clientCert_x;
		public String clientCertPasswd_x;
		private String[] ns_map_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/', 'S3'};


		/*
			 This method invokes the S3 DeleteObject web service operation.
		*/
		public S3.Status DeleteObject(String Bucket,String Key,String AWSAccessKeyId,DateTime Timestamp,String Signature,String Credential) {
			S3.DeleteObject_element request_x = new S3.DeleteObject_element();
			S3.DeleteObjectResponse_element response_x;
			request_x.Bucket = Bucket;
			request_x.Key = Key;
			request_x.AWSAccessKeyId = AWSAccessKeyId;
			request_x.Timestamp = Timestamp;
			request_x.Signature = Signature;
			request_x.Credential = Credential;
			Map<String, S3.DeleteObjectResponse_element> response_map_x = new Map<String, S3.DeleteObjectResponse_element>();
			response_map_x.put('response_x', response_x);
			WebServiceCallout.invoke(
				this,
				request_x,
				response_map_x,
				new String[]{endpoint_x,
				'',
				'http://s3.amazonaws.com/doc/2006-03-01/',
				'DeleteObject',
				'http://s3.amazonaws.com/doc/2006-03-01/',
				'DeleteObjectResponse',
				'S3.DeleteObjectResponse_element'}
			);
			response_x = response_map_x.get('response_x');
			return response_x.DeleteObjectResponse;
		}

		public S3.CopyObjectResult CopyObject(String SourceBucket,String SourceKey,String DestinationBucket,String DestinationKey,String MetadataDirective,S3.MetadataEntry[] Metadata,S3.AccessControlList AccessControlList,DateTime CopySourceIfModifiedSince,DateTime CopySourceIfUnmodifiedSince,String[] CopySourceIfMatch,String[] CopySourceIfNoneMatch,String StorageClass,String AWSAccessKeyId,DateTime Timestamp,String Signature,String Credential) {
			S3.CopyObject_element request_x = new S3.CopyObject_element();
			S3.CopyObjectResponse_element response_x;
			request_x.SourceBucket = SourceBucket;
			request_x.SourceKey = SourceKey;
			request_x.DestinationBucket = DestinationBucket;
			request_x.DestinationKey = DestinationKey;
			request_x.MetadataDirective = MetadataDirective;
			request_x.Metadata = Metadata;
			request_x.AccessControlList = AccessControlList;
			request_x.CopySourceIfModifiedSince = CopySourceIfModifiedSince;
			request_x.CopySourceIfUnmodifiedSince = CopySourceIfUnmodifiedSince;
			request_x.CopySourceIfMatch = CopySourceIfMatch;
			request_x.CopySourceIfNoneMatch = CopySourceIfNoneMatch;
			request_x.StorageClass = StorageClass;
			request_x.AWSAccessKeyId = AWSAccessKeyId;
			request_x.Timestamp = Timestamp;
			request_x.Signature = Signature;
			request_x.Credential = Credential;
			Map<String, S3.CopyObjectResponse_element> response_map_x = new Map<String, S3.CopyObjectResponse_element>();
			response_map_x.put('response_x', response_x);
			WebServiceCallout.invoke(
				this,
				request_x,
				response_map_x,
				new String[]{endpoint_x,
				'',
				'http://s3.amazonaws.com/doc/2006-03-01/',
				'CopyObject',
				'http://s3.amazonaws.com/doc/2006-03-01/',
				'CopyObjectResponse',
				'S3.CopyObjectResponse_element'}
			);
			response_x = response_map_x.get('response_x');
			return response_x.CopyObjectResponse;
		}

	}

	public class DeleteObject_element {
		public String Bucket;
		public String Key;
		public String AWSAccessKeyId;
		public DateTime Timestamp;
		public String Signature;
		public String Credential;
		private String[] Bucket_type_info = new String[]{'Bucket','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] Key_type_info = new String[]{'Key','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] AWSAccessKeyId_type_info = new String[]{'AWSAccessKeyId','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] Timestamp_type_info = new String[]{'Timestamp','http://www.w3.org/2001/XMLSchema','dateTime','0','1','false'};
		private String[] Signature_type_info = new String[]{'Signature','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] Credential_type_info = new String[]{'Credential','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'Bucket','Key','AWSAccessKeyId','Timestamp','Signature','Credential'};
	}

	public class Status {
			public Integer Code {get;set;}
			public String Description {get;set;}
			private String[] Code_type_info = new String[]{'Code','http://www.w3.org/2001/XMLSchema','int','1','1','false'};
			private String[] Description_type_info = new String[]{'Description','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
			private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
			private String[] field_order_type_info = new String[]{'Code','Description'};
	}

	public class DeleteObjectResponse_element {
		public S3.Status DeleteObjectResponse;
		private String[] DeleteObjectResponse_type_info = new String[]{'DeleteObjectResponse','http://s3.amazonaws.com/doc/2006-03-01/','Status','1','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'DeleteObjectResponse'};
	}

	public class PutObjectResult {
		public String ETag;
		public DateTime LastModified;
		private String[] ETag_type_info = new String[]{'ETag','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] LastModified_type_info = new String[]{'LastModified','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'ETag','LastModified'};
	}

	public class CopyObjectResponse_element {
		public S3.CopyObjectResult CopyObjectResponse; //CopyObjectResult;
		private String[] CopyObjectResponse_type_info = new String[]{'CopyObjectResponse','http://s3.amazonaws.com/doc/2006-03-01/','CopyObjectResult','1','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'CopyObjectResponse'};
	}

	public class AccessControlList {
		private String[] Grant_type_info = new String[]{'Grant','http://s3.amazonaws.com/doc/2006-03-01/','Grant','0','100','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'Grant'};
	}

	public class CopyObject_element {
		public String SourceBucket;
		public String SourceKey;
		public String DestinationBucket;
		public String DestinationKey;
		public String MetadataDirective;
		public S3.MetadataEntry[] Metadata;
		public S3.AccessControlList AccessControlList;
		public DateTime CopySourceIfModifiedSince;
		public DateTime CopySourceIfUnmodifiedSince;
		public String[] CopySourceIfMatch;
		public String[] CopySourceIfNoneMatch;
		public String StorageClass;
		public String AWSAccessKeyId;
		public DateTime Timestamp;
		public String Signature;
		public String Credential;
		private String[] SourceBucket_type_info = new String[]{'SourceBucket','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] SourceKey_type_info = new String[]{'SourceKey','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] DestinationBucket_type_info = new String[]{'DestinationBucket','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] DestinationKey_type_info = new String[]{'DestinationKey','http://www.w3.org/2001/XMLSchema','string','1','1','false'};
		private String[] MetadataDirective_type_info = new String[]{'MetadataDirective','http://s3.amazonaws.com/doc/2006-03-01/','MetadataDirective','0','1','false'};
		private String[] Metadata_type_info = new String[]{'Metadata','http://s3.amazonaws.com/doc/2006-03-01/','MetadataEntry','0','100','false'};
		private String[] AccessControlList_type_info = new String[]{'AccessControlList','http://s3.amazonaws.com/doc/2006-03-01/','AccessControlList','0','1','false'};
		private String[] CopySourceIfModifiedSince_type_info = new String[]{'CopySourceIfModifiedSince','http://www.w3.org/2001/XMLSchema','dateTime','0','1','false'};
		private String[] CopySourceIfUnmodifiedSince_type_info = new String[]{'CopySourceIfUnmodifiedSince','http://www.w3.org/2001/XMLSchema','dateTime','0','1','false'};
		private String[] CopySourceIfMatch_type_info = new String[]{'CopySourceIfMatch','http://www.w3.org/2001/XMLSchema','string','0','100','false'};
		private String[] CopySourceIfNoneMatch_type_info = new String[]{'CopySourceIfNoneMatch','http://www.w3.org/2001/XMLSchema','string','0','100','false'};
		private String[] StorageClass_type_info = new String[]{'StorageClass','http://s3.amazonaws.com/doc/2006-03-01/','StorageClass','0','1','false'};
		private String[] AWSAccessKeyId_type_info = new String[]{'AWSAccessKeyId','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] Timestamp_type_info = new String[]{'Timestamp','http://www.w3.org/2001/XMLSchema','dateTime','0','1','false'};
		private String[] Signature_type_info = new String[]{'Signature','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] Credential_type_info = new String[]{'Credential','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
		private String[] apex_schema_type_info = new String[]{'http://s3.amazonaws.com/doc/2006-03-01/','true'};
		private String[] field_order_type_info = new String[]{'SourceBucket','SourceKey','DestinationBucket','DestinationKey','MetadataDirective','Metadata','AccessControlList','CopySourceIfModifiedSince','CopySourceIfUnmodifiedSince','CopySourceIfMatch','CopySourceIfNoneMatch','StorageClass','AWSAccessKeyId','Timestamp','Signature','Credential'};
	}
}
