@isTest
private class ISSP_TC_Accept_Test {

	static testMethod void myUnitTest_1() {
		String profileId = [SELECT Id FROM Profile WHERE Name = 'ISS Portal DPC' LIMIT 1].Id;
    	Account acc = ISSP_ObjectFactory.createNewAccount();
		insert acc;
		Contact contact = ISSP_ObjectFactory.createNewContact();
        contact.AccountId = acc.Id;
        contact.User_Portal_Status__c = 'Pending Approval';
        insert contact;
        User newUser = new User(alias = 'dsfsdfds', 
	                            email = contact.email, 
	                            emailencodingkey = 'UTF-8', 
	                            firstname = contact.firstName, 
	                            lastname = contact.lastname, 
	                            languagelocalekey = 'en_US', 
	                            localesidkey = 'en_US', 
	                            contactId = contact.Id,
	                            timezonesidkey = 'Asia/Dubai',
	                            username = contact.email+'dfgdf',
	                            PortalRole = 'Manager',
	                            CommunityNickname = contact.email.substring(0, contact.email.indexOf('@'))+Datetime.now().formatLong().substring(10,15),
	                            ProfileId = profileId,
	                            IsActive = true,
	                            Community__c = 'IEC');
    	insert newUser;
		
    	ISSP_CS__c issc = new ISSP_CS__c(name = 'PasswordResetPeriod', value__c = '90');
    	insert issc;
    	
    	system.runAs(newUser){
        	ISSP_TC_Accept cttr = new ISSP_TC_Accept();
        	cttr.accept = false;
        	cttr.redirectChangePassword();
        	cttr.redirectTC_Accept();
        	cttr.docontinue();
        	cttr.accept = true;
        	cttr.docontinue();
    	}
    }
    
    static testMethod void myUnitTest_2() {
		String profileId = [SELECT Id FROM Profile WHERE Name = 'ISS Portal DPC' LIMIT 1].Id;
    	Account acc = ISSP_ObjectFactory.createNewAccount();
		insert acc;
		Contact contact = ISSP_ObjectFactory.createNewContact();
        contact.AccountId = acc.Id;
        contact.User_Portal_Status__c = 'Pending Approval';
        insert contact;
        User newUser = new User(alias = 'dsfsdfds', 
	                            email = contact.email, 
	                            emailencodingkey = 'UTF-8', 
	                            firstname = contact.firstName, 
	                            lastname = contact.lastname, 
	                            languagelocalekey = 'en_US', 
	                            localesidkey = 'en_US', 
	                            contactId = contact.Id,
	                            timezonesidkey = 'Asia/Dubai',
	                            username = contact.email+'dfgdf',
	                            PortalRole = 'Manager',
	                            CommunityNickname = contact.email.substring(0, contact.email.indexOf('@'))+Datetime.now().formatLong().substring(10,15),
	                            ProfileId = profileId,
	                            UID__c = '1234',
	                            ToU_Accepted__c = true,
	                            IsActive = true,
	                            Community__c = 'IEC');
    	insert newUser;
    	
    	Portal_Applications__c newApp = new Portal_Applications__c();
		newApp.Name = 'TEST';
		insert newApp;
		Portal_Application_Right__c newAppRight = new Portal_Application_Right__c();
		newAppRight.Contact__c = contact.Id;
		newAppRight.Portal_Application__c = newApp.Id;
		newAppRight.Right__c = 'Access Granted';
		insert newAppRight;
		ISSP_Portal_Service_Ids__c theIds = new ISSP_Portal_Service_Ids__c();
		theIds.BSPLink__c = newApp.Id;
		insert theIds;
		
    	ISSP_CS__c issc = new ISSP_CS__c(name = 'PasswordResetPeriod', value__c = '90');
    	insert issc;
    	
    	system.runAs(newUser){
        	ISSP_TC_Accept cttr = new ISSP_TC_Accept();
        	cttr.accept = true;
        	cttr.redirectChangePassword();
        	cttr.redirectTC_Accept();
    	}
    }
    
    static testMethod void myUnitTest_3() {
		String profileId = [SELECT Id FROM Profile WHERE Name = 'ISS Portal DPC' LIMIT 1].Id;
    	Account acc = ISSP_ObjectFactory.createNewAccount();
		insert acc;
		Contact contact = ISSP_ObjectFactory.createNewContact();
        contact.AccountId = acc.Id;
        contact.User_Portal_Status__c = 'Pending Approval';
        insert contact;
        User newUser = new User(alias = 'dsfsdfds', 
	                            email = contact.email, 
	                            emailencodingkey = 'UTF-8', 
	                            firstname = contact.firstName, 
	                            lastname = contact.lastname, 
	                            languagelocalekey = 'en_US', 
	                            localesidkey = 'en_US', 
	                            contactId = contact.Id,
	                            timezonesidkey = 'Asia/Dubai',
	                            username = contact.email+'dfgdf',
	                            PortalRole = 'Manager',
	                            CommunityNickname = contact.email.substring(0, contact.email.indexOf('@'))+Datetime.now().formatLong().substring(10,15),
	                            ProfileId = profileId,
	                            UID__c = '1234',
	                            IsActive = true,
	                            Community__c = 'IEC');
    	insert newUser;
    	
    	ISSP_CS__c issc = new ISSP_CS__c(name = 'PasswordResetPeriod', value__c = '90');
    	insert issc;
    	
    	ISSPLogoutSurvey__c newSurvey = new ISSPLogoutSurvey__c();
    	newSurvey.Name = 'test';
    	newSurvey.Survey_Link__c = 'http:\\test&iv=1234';
    	newSurvey.isActive__c = true;
    	insert newSurvey;
    	
    	system.runAs(newUser){
        	ISSP_TC_Accept cttr = new ISSP_TC_Accept();
        	cttr.CheckLogoutorSurvey();
    	}
    }
    
    static testMethod void myUnitTest_4() {
		String profileId = [SELECT Id FROM Profile WHERE Name = 'ISS Portal DPC' LIMIT 1].Id;
    	Account acc = ISSP_ObjectFactory.createNewAccount();
		insert acc;
		Contact contact = ISSP_ObjectFactory.createNewContact();
        contact.AccountId = acc.Id;
        contact.User_Portal_Status__c = 'Pending Approval';
        insert contact;
        User newUser = new User(alias = 'dsfsdfds', 
	                            email = contact.email, 
	                            emailencodingkey = 'UTF-8', 
	                            firstname = contact.firstName, 
	                            lastname = contact.lastname, 
	                            languagelocalekey = 'en_US', 
	                            localesidkey = 'en_US', 
	                            contactId = contact.Id,
	                            timezonesidkey = 'Asia/Dubai',
	                            username = contact.email+'dfgdf',
	                            PortalRole = 'Manager',
	                            CommunityNickname = contact.email.substring(0, contact.email.indexOf('@'))+Datetime.now().formatLong().substring(10,15),
	                            ProfileId = profileId,
	                            UID__c = '1234',
	                            IsActive = true,
	                            Community__c = 'IEC');
    	insert newUser;
    	
    	ISSP_CS__c issc = new ISSP_CS__c(name = 'PasswordResetPeriod', value__c = '90');
    	insert issc;
    	
    	ISSPLogoutSurvey__c newSurvey = new ISSPLogoutSurvey__c();
    	newSurvey.Name = 'test';
    	newSurvey.Survey_Link__c = 'http:\\test&iv=1234';
    	newSurvey.isActive__c = true;
    	insert newSurvey;
    	Instant_Surveys__c newSurvey1 = new Instant_Surveys__c();
    	newSurvey1.SurveyUserID__c = newUser.Id;
    	newSurvey1.SurveyURL__c = '1234';
    	insert newSurvey1;
    	
    	system.runAs(newUser){
        	ISSP_TC_Accept cttr = new ISSP_TC_Accept();
        	cttr.CheckLogoutorSurvey();
    	}
    }

}