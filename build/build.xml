<project name="Retrieve and Deploy SFDC metadata" default="deployEmptyCheckOnly" basedir=".." xmlns:sf="antlib:com.salesforce">
    <taskdef uri="antlib:com.salesforce"
        resource="com/salesforce/antlib.xml"
        classpath="${basedir}/build/ant-salesforce.jar"/>
  <taskdef
         resource="net/sf/antcontrib/antlib.xml"
        classpath="${basedir}/build/ant-contrib/ant-contrib-1.0b3.jar"/>



    <property file="${basedir}/build/build.properties"/>
    <property environment="env"/>




<target name="deployPermissions"> 
    <echo level="info">Deploying APEX and VISUALFORCE</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <mkdir dir="${basedir}/Code/permissionsets"/>
       <mkdir dir="${basedir}/Code/profiles"/>


     <echo level="info">moving files</echo>
      
      <for list="${objectFolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/permissionsets">
            <fileset dir="${basedir}/src/permissionsetsObjects">
            </fileset>
          </move>
       </sequential>
     </for>


   <for list="${objectFolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/profiles">
            <fileset dir="${basedir}/src/profilesObjects">
            </fileset>
          </move>
       </sequential>
     </for>


 <move file="${basedir}/src/permissions.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />
          <antcallback target="deployProfilesApex" />

  </target> 



<target name="deployProfilesApex"> 
    <echo level="info">Deploying APEX and VISUALFORCE</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
       <mkdir dir="${basedir}/Code/permissionsets"/>
        <mkdir dir="${basedir}/Code/profiles"/>

     <echo level="info">moving files</echo>

   <for list="${apexFolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/permissionsets">
            <fileset dir="${basedir}/src/permissionsetsApex">
            </fileset>
          </move>
       </sequential>
     </for>


   <for list="${apexFolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/profiles">
            <fileset dir="${basedir}/src/profilesApex">
            </fileset>
          </move>
       </sequential>
     </for>



 <move file="${basedir}/src/permissions2.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />

  </target> 




<target name="checkCodeFolder">
  <condition property="deldir">
    <available file="${basedir}/Code" type="dir"/>
  </condition>
 </target>

 <target name="deldir"    depends="checkCodeFolder" if="deldir"  >
        <echo level="info">deleting  ${basedir}/Code </echo>

  <delete includeEmptyDirs="true">
   <fileset dir="${basedir}/Code">
    
   </fileset>
</delete>
 </target>


<target name="deployCode"> 
    <echo level="info">Deploying STARTS</echo>
    <antcallback target="deldir" />
    <mkdir dir="${basedir}/Code"/>
    
    
    <move file="${basedir}/fixingUpdate/" tofile="${basedir}/Code/"/>  
    <antcallback target="deployStaticResource" />
  
</target> 

<target name="deployCodeProd"> 


      <antcallback target="deployStaticResource" />
  
  </target> 

<target name="deployCodeObjects"> 
    <echo level="info">Deploying OBJECTS</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${object.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${object.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/objectPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
      <antcallback target="deployTemplate" />
  
  </target> 



<target name="deployTemplate"> 
    <echo level="info">Deploying TEMPLATES</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${listEmailTemplateFolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${listEmailTemplateFolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/templatePackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
      <antcallback target="deployWorkflows" />
  
  </target> 


<target name="deployLabelsOnly"> 
    <echo level="info">Deploying LABELS</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${labelsTranslation.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${labelsTranslation.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/labelPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
  </target>

  
<target name="deployStaticResource"> 
    <echo level="info">Deploying STATIC RESOURCES</echo>
    <antcallback target="deldir" />
    <mkdir dir="${basedir}/Code"/>
    
    <for list="${staticResource.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
             <fileset dir="${basedir}/src/@{param}">
             </fileset>
          </move>
       </sequential>
    </for>
    
    <move file="${basedir}/src/staticPackage.xml" tofile="${basedir}/Code/package.xml"/>  
    <antcallback target="deployCodeLocal" />
    <antcallback target="deployLabelFolder" />
</target> 


<target name="deployLabelFolder"> 
    <echo level="info">Deploying LABELS</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${labelsTranslation.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${labelsTranslation.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/labelPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
       <antcallback target="deployGroups" />
  </target> 




<target name="deployGroups"> 
    <echo level="info">Deploying LABELS</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${groupsPackage.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${groupsPackage.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/groupsPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
       <antcallback target="deployCodeObjects" />
  </target> 



<target name="deployWorkflows"> 
    <echo level="info">Deploying WORKFLOWS</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${workflowPackage.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${workflowPackage.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/workflowPackage.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />
        <antcallback target="deployApex" />

  </target> 



<target name="deployApex"> 
    <echo level="info">Deploying APEX and VISUALFORCE</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${code.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${code.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

    <move file="${basedir}/src/codePackage.xml" tofile="${basedir}/Code/package.xml"/>  
   <!-- <move file="${basedir}/src/destructiveChangesPre.xml" tofile="${basedir}/Code/destructiveChangesPre.xml"/>  
    <move file="${basedir}/src/destructiveChangesPost.xml" tofile="${basedir}/Code/destructiveChangesPost.xml"/>   -->
   
      <antcallback target="deployCodeLocal" />
          <antcallback target="deployLayout" />

  </target> 


<target name="deployApexAndDeploy"> 
    <echo level="info">Deploying APEX and VISUALFORCE</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${code.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${code.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/codePackage.xml" tofile="${basedir}/Code/package.xml"/>  
  <move file="${basedir}/src/destructiveChangesPre.xml" tofile="${basedir}/Code/destructiveChangesPre.xml"/>  
     
      <antcallback target="deployCodeLocal" />
          <antcallback target="deployLayout" />

  </target> 



<target name="deployLayout"> 
    <echo level="info">Deploying LAYOUT</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${layout.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${layout.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/layoutPackage.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />
        <antcallback target="deployApprovals" /> 

  </target> 





<target name="deployApprovals"> 
    <echo level="info">Deploying APPROVALS</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${approvalPackage.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${approvalPackage.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/approvalPackage.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />
         <!--   <antcallback target="deployDontRetrieve" /> -->

  </target> 





<target name="deployDontRetrieve"> 
    <echo level="info">Deploying DONTRETRIEVE</echo>
   <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${dontRetrieve.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${dontRetrieve.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/dontRetrieve.xml" tofile="${basedir}/Code/package.xml"/>  
      
      <antcallback target="deployCodeLocal" />
  
  </target> 




<target name="deployCodeObjectsOnly"> 
    <echo level="info">Deploying OBJECTS</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${object.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${object.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/objectPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
      <antcallback target="deployCodeLocal" />
       <antcallback target="deployLabelFolderOnlyObjects" />
  
  </target> 



<target name="deployLabelFolderOnlyObjects"> 
    <echo level="info">Deploying LABELS ONLY</echo>
  <antcallback target="deldir" />
   <mkdir dir="${basedir}/Code"/>
  
      <for list="${labelsTranslation.listfolders}" param="param" >
        <sequential>
             <mkdir dir="${basedir}/Code/@{param}"/>
       </sequential>
     </for>

     <echo level="info">moving files</echo>
      
      <for list="${labelsTranslation.listfolders}" param="param" delimiter=",">
        <sequential>
          <move todir="${basedir}/Code/@{param}">
            <fileset dir="${basedir}/src/@{param}">
            </fileset>
          </move>
       </sequential>
     </for>

 <move file="${basedir}/src/labelPackage.xml" tofile="${basedir}/Code/package.xml"/>  

      
  </target> 







    <target name="getCode">
      <echo level="info">Retrieving the server's version of OBJECTs </echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/objectPackageRetrieve.xml" />

      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/objectPackageRetrieve.xml" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/profiles/" tofile="src/profilesObjects/" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/permissionsets/" tofile="src/permissionsetsObjects/" />  

      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
   
        <antcallback target="compressProfiles" >
         <param name="folder" value="profilesObjects"/>
      </antcallback>

        <antcallback target="compressPermissionSets" >
         <param name="folderPermissionSet" value="permissionsetsObjects"/>
      </antcallback>

     <antcallback target="getLabel" /> 
    </target>



    <target name="getApex">
      <echo level="info">Retrieving the server's version of APEX VISUALFORCE</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/codePackageRetrieve.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/codePackageRetrieve.xml"/>
    
      <move file="${basedir}/${sfdc.retrieveTarget}/profiles/" tofile="src/profilesApex/"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/permissionsets/" tofile="src/permissionsetsApex"/>

      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>



        <antcallback target="compressProfiles" >
         <param name="folder" value="profilesApex"/>
      </antcallback>

        <antcallback target="compressPermissionSets" >
         <param name="folderPermissionSet" value="permissionsetsApex"/>
      </antcallback>

     <antcallback target="getStaticResource" /> 

    </target>




<target name="compressProfiles">

<property name="folder" value="folder"/>

 <for param="file">
  <path>
   <fileset dir="src/${folder}"  />
  </path>
  <sequential>
   <var name="name" unset="true"/>
   <basename file="@{file}" property="name" />
   <echo message=" ${name}"/>
           <exec executable = "perl">
         <arg value = "-pi"/>
            <arg value = "build/profileCompress.pl"/>
            <arg value = "src/${folder}/${name}"/>
        </exec>
  </sequential>
 </for>              


  <delete>
    <fileset dir="src/${folder}" includes="*.profile.bak"  />
  </delete>

 </target>



<target name="compressPermissionSets">
<property name="folderPermissionSet" value="folderPermissionSet"/>


 <for param="file">
  <path>
   <fileset dir="src/${folderPermissionSet}"  />
  </path>
  <sequential>
   <var name="name" unset="true"/>
   <basename file="@{file}" property="name" />
   <echo message=" ${name}"/>
           <exec executable = "perl">
           <arg value = "-pi"/>
            <arg value = "build/profileCompress.pl"/>
            <arg value = "src/${folderPermissionSet}/${name}"/>
        </exec>
  </sequential>
 </for>              
  <delete>
    <fileset dir="src/${folderPermissionSet}" includes="*.permissionset.bak"  />
  </delete>
 </target>







    <target name="getLabel">
      <echo level="info">Retrieving the server's version of LABELS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/labelPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/labelPackage.xml"/>  
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
       <antcallback target="getWorkflowLocal" />
    </target>




  <target name="getGroups">
      <echo level="info">Retrieving the server's version of LABELS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/groupsPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/groupsPackage.xml"/>  
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
       <antcallback target="getWorkflowLocal" />
    </target>



    <target name="getWorkflowLocal">
      <echo level="info">Retrieving the server's version of WORKFLOWs</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/workflowPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/workflowPackage.xml"/>  
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
       <antcallback target="getApex" />
    </target>



 
    <target name="getStaticResource">
      <echo level="info">Retrieving the server's version of STATIC RESOURCES</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/staticPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/staticPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>

    <antcallback target="getLayouts" /> 

    </target>

     <target name="getLayouts">
      <echo level="info">Retrieving the server's version of LAYOUTS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/layoutPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/layoutPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>

       <antcallback target="getApproval" /> 

    </target>
    


     <target name="getApproval">
      <echo level="info">Retrieving the server's version of APPROVALS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/approvalPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/approvalPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>

     <!--  <antcallback target="getApproval" />  -->

    </target>
    


   <target name="getCodePointAndClick">
      <echo level="info">Retrieving the server's version of OBJECTs </echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/objectPackageRetrieve.xml" />

      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/objectPackageRetrieve.xml" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/profiles/" tofile="src/profilesObjects/" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/permissionsets/" tofile="src/permissionsetsObjects/" />  

      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
   
        <antcallback target="compressProfiles" >
         <param name="folder" value="profilesObjects"/>
      </antcallback>

        <antcallback target="compressPermissionSets" >
         <param name="folderPermissionSet" value="permissionsetsObjects"/>
      </antcallback>

     <antcallback target="getLabelPointAndClick" /> 
    </target>



    <target name="getLabelPointAndClick">
      <echo level="info">Retrieving the server's version of LABELS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/labelPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/labelPackage.xml"/>  
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
       <antcallback target="getGroupsPointAndClick" />
    </target>

      <target name="getGroupsPointAndClick">
      <echo level="info">Retrieving the server's version of LABELS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/groupsPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/groupsPackage.xml"/>  
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>
       <antcallback target="getWorkflowLocalPointAndClick" />
    </target>



    <target name="getWorkflowLocalPointAndClick">
      <echo level="info">Retrieving the server's version of WORKFLOWS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/workflowPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/workflowPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>

       <antcallback target="getLayouts" /> 

    </target>

 




  
<target name="bulkRetrieveEmailTemplate">
 <echo level="info">Retrieving the emailtemplates</echo>
 
   <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>

      <for list="${listEmailTemplateFoldersName}" param="param" >
        <sequential>
     <sf:bulkRetrieve
              username="${sfdc.username}"
                password="${sfdc.password}"
                serverurl="${sfdc.serverurl}"
                metadataType="EmailTemplate"
                  retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
                 containingFolder="@{param}"
       />
       </sequential>
     </for>

   <delete file="${basedir}/${sfdc.retrieveTarget}/package.xml"/>
   <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>


    <!--  <echo level="info">Compressing profiles </echo>

      <antcallback target="compressProfiles" />

      <echo level="info">Deleting profiles.bak </echo>

      <antcallback target="deletebakprofiles" /> 

      <echo level="info">Compressing permissionSets </echo>

      <antcallback target="compressPermissionSets" />
      <echo level="info">deleting permissionSets.bak </echo>

        <antcallback target="deletebakpermissionsets" />-->

</target>



     <target name="getLayoutsOnly">
      <echo level="info">Retrieving the server's version of LAYOUTS</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/layoutPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/layoutPackage.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}" tofile="src"/>

       <antcallback target="getApproval" /> 

    </target>
    


<target name="deployCodeLocal">
      <echo level="info">Performing the deploy</echo>
      <sf:deploy
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        deployRoot="${basedir}/Code"
        pollWaitMillis="${sfdc.pollWaitMillis}"
        maxPoll="${sfdc.maxPoll}"/>
    </target>
 



  
    <target name="deployLabelsFix">
      <echo level="info">Performing the deploy of the labels as they were in preprod</echo>
      <sf:deploy
        autoUpdatePackage = "true"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        deployRoot="${basedir}/labelsfix"
        pollWaitMillis="${sfdc.pollWaitMillis}"
        maxPoll="${sfdc.maxPoll}"/>
    </target>
  

  
    <target name="undeployCodeLocal">
        <echo level="info">Undeploying code</echo>
        <sf:deploy
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        maxPoll="${sfdc.maxPoll}"
        rollbackOnError="true"
        allowMissingFiles="false"
        autoUpdatePackage="false"
        ignoreWarnings="true"
        logType="Debugonly"
        purgeOnDelete="true"
        deployroot="${basedir}/removecodepkg" />
    </target> 





<target name="getProfilesObjects">
      <echo level="info">Retrieving the server's version of OBJECTs </echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/objectPackageRetrieve.xml" />

      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/objectPackageRetrieve.xml" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/profiles/" tofile="src/profilesObjects/" />  
      <move file="${basedir}/${sfdc.retrieveTarget}/permissionsets/" tofile="src/permissionsetsObjects/" />  

        <antcallback target="compressProfiles" >
         <param name="folder" value="profilesObjects"/>
      </antcallback>

        <antcallback target="getProfilesApex" >
      </antcallback>

    </target>



    <target name="getProfilesApex">
      <echo level="info">Retrieving the server's version of APEX VISUALFORCE</echo>
      <mkdir dir="${basedir}/${sfdc.retrieveTarget}"/>
      <sf:retrieve
        retrieveTarget="${basedir}/${sfdc.retrieveTarget}"
        username="${sfdc.username}"
        password="${sfdc.password}"
        serverurl="${sfdc.serverurl}"
        unpackaged="src/codePackageRetrieve.xml"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/package.xml" tofile="src/codePackageRetrieve.xml"/>
    
      <move file="${basedir}/${sfdc.retrieveTarget}/profiles/" tofile="src/profilesApex/"/>
      <move file="${basedir}/${sfdc.retrieveTarget}/permissionsets/" tofile="src/permissionsetsApex"/>

        <antcallback target="compressProfiles" >
         <param name="folder" value="profilesApex"/>
      </antcallback>

        <antcallback target="compressPermissionSets" >
         <param name="folderPermissionSet" value="permissionsetsApex"/>
      </antcallback>


    </target>




</project>